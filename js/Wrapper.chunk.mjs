/*! third party licenses: js/vendor.LICENSE.txt */
var Ht=e=>{throw TypeError(e)};var gt=(e,s,i)=>s.has(e)||Ht("Cannot "+i);var a=(e,s,i)=>(gt(e,s,"read from private field"),i?i.call(e):s.get(e)),u=(e,s,i)=>s.has(e)?Ht("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(e):s.set(e,i),h=(e,s,i,n)=>(gt(e,s,"write to private field"),n?n.call(e,i):s.set(e,i),i),m=(e,s,i)=>(gt(e,s,"access private method"),i);var Vt=(e,s,i,n)=>({set _(o){h(e,s,o,i)},get _(){return a(e,s,n)}});import{d as ft,r as Pe}from"./vue.runtime.esm.chunk.mjs";import{O as Zt,A as Le,B as z,G as Gt,H as k,J as Fe,K as I,L as $,Q as q,V as Xt,W as te,X as $t,t as ee,Z as se,_ as ie,$ as Be,a0 as He,a1 as Ve,a2 as We,a3 as ne,a4 as oe,a5 as ae,a6 as V,j as Mt,a7 as Tt,k as re,a8 as je,a9 as Ke,aa as ze,ab as Je,ac as Qe,ad as qe,ae as Ye,af as ce,ag as Wt,ah as Ze,ai as Ge,aj as Xe,ak as ts,al as es,am as ss,an as is,ao as ns,ap as os,aq as as,ar as rs,as as cs,at as ls}from"./RichText.chunk.mjs";import{n as M}from"./_plugin-vue2_normalizer.chunk.mjs";import{c as le,_ as he,d as hs,U as ds}from"./index.chunk3.mjs";import{a as Rt,c as jt,g as us}from"./emoji-picker.chunk.mjs";import{d as de,s as ue,m as ps}from"./index.chunk.mjs";import{N as Dt,f as _s,g as ms,d as Kt,h as fs}from"./NcUserBubble-DMjZyrGY.chunk.mjs";import{b as vs,N as ys,u as gs,s as bt}from"./NcNoteCard-BLPU1den.chunk.mjs";import{p as ut,a as bs,e as pe,l as ws}from"./modulepreload-polyfill.chunk.mjs";import{l as _e}from"./index.chunk4.mjs";import{u as vt,e as xs,c as me,g as fe,h as ks,d as Cs,A as Es,m as Ss,n as As,o as Is}from"./MediaHandler.provider.chunk.mjs";import{l as w}from"./logger.chunk.mjs";const wt=3e4;class Os extends Zt{constructor(s){super(),this.doc=s,this.clientID=s.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{const i=z();this.getLocalState()!==null&&wt/2<=i-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const n=[];this.meta.forEach((o,r)=>{r!==this.clientID&&wt<=i-o.lastUpdated&&this.states.has(r)&&n.push(r)}),n.length>0&&Ut(this,n,"timeout")},Le(wt/10)),s.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(s){const i=this.clientID,n=this.meta.get(i),o=n===void 0?0:n.clock+1,r=this.states.get(i);s===null?this.states.delete(i):this.states.set(i,s),this.meta.set(i,{clock:o,lastUpdated:z()});const c=[],_=[],g=[],T=[];s===null?T.push(i):r==null?s!=null&&c.push(i):(_.push(i),Gt(r,s)||g.push(i)),(c.length>0||g.length>0||T.length>0)&&this.emit("change",[{added:c,updated:g,removed:T},"local"]),this.emit("update",[{added:c,updated:_,removed:T},"local"])}setLocalStateField(s,i){const n=this.getLocalState();n!==null&&this.setLocalState({...n,[s]:i})}getStates(){return this.states}}const Ut=(e,s,i)=>{const n=[];for(let o=0;o<s.length;o++){const r=s[o];if(e.states.has(r)){if(e.states.delete(r),r===e.clientID){const c=e.meta.get(r);e.meta.set(r,{clock:c.clock+1,lastUpdated:z()})}n.push(r)}}n.length>0&&(e.emit("change",[{added:[],updated:[],removed:n},i]),e.emit("update",[{added:[],updated:[],removed:n},i]))},nt=(e,s,i=e.states)=>{const n=s.length,o=$();k(o,n);for(let r=0;r<n;r++){const c=s[r],_=i.get(c)||null,g=e.meta.get(c).clock;k(o,c),k(o,g),Fe(o,JSON.stringify(_))}return I(o)},Ns=(e,s,i)=>{const n=te(s),o=z(),r=[],c=[],_=[],g=[],T=q(n);for(let b=0;b<T;b++){const d=q(n);let l=q(n);const v=JSON.parse(Xt(n)),y=e.meta.get(d),R=e.states.get(d),D=y===void 0?0:y.clock;(D<l||D===l&&v===null&&e.states.has(d))&&(v===null?d===e.clientID&&e.getLocalState()!=null?l++:e.states.delete(d):e.states.set(d,v),e.meta.set(d,{clock:l,lastUpdated:o}),y===void 0&&v!==null?r.push(d):y!==void 0&&v===null?g.push(d):v!==null&&(Gt(v,R)||_.push(d),c.push(d)))}(r.length>0||_.length>0||g.length>0)&&e.emit("change",[{added:r,updated:_,removed:g},i]),(r.length>0||c.length>0||g.length>0)&&e.emit("update",[{added:r,updated:c,removed:g},i])},$s={name:"NcActionButton",components:{NextcloudVueNcActionButton:Dt},extends:$t,mounted(){this.$editor.on("transaction",()=>this.updateState())},methods:{runAction(){var s;const{actionEntry:e}=this;e.click?e.click(this):(s=e.action(this.$editor.chain().focus()))==null||s.run(),this.$nextTick(()=>{this.$emit("trigged",{...e})})}}};var Ms=function(){var e=this,s=e._self._c;return s("NextcloudVueNcActionButton",e._g({staticClass:"entry-single-action entry-action entry-action-item",class:e.state.class,attrs:{disabled:e.state.disabled,"aria-keyshortcuts":e.keyshortcuts||void 0,"data-text-action-entry":e.actionEntry.key,type:e.state.type,"model-value":e.state.type!=="button"?e.state.active:void 0,"close-after-click":""},on:{click:e.runAction},scopedSlots:e._u([{key:"icon",fn:function(){return[s(e.icon,{tag:"component"})]},proxy:!0}])},e.$listeners),[e._v(" "+e._s(e.label)+" ")])},Ts=[],Rs=M($s,Ms,Ts,!1,null,null,null,null);const Ds=Rs.exports,Us={name:"ActionList",components:{NcActions:vs,NcActionSeparator:ee,ActionListItem:Ds},extends:$t,mixins:[se,ie,Be],props:{forceEnabled:{type:Boolean,default:!1}},data:()=>({visible:!1,hasEnabledChild:!0}),computed:{currentChild(){const{state:e,$editor:s,actionEntry:{children:i}}=this;return e.active?i.find(n=>He(n,s)):null},icon(){return this.currentChild?this.currentChild.icon:this.actionEntry.icon},iconKey(){return"".concat(this.actionEntry.key,"/").concat(this.activeKey)},activeKey(){var e;return(e=this.currentChild)==null?void 0:e.key},children(){return this.actionEntry.children.filter(({visible:e})=>e===void 0?!0:typeof e=="function"?e(this):e)},labelWithSelected(){return this.currentChild?t("text",'{menuItemName}, "{selectedSubMenuItemName}" is selected',{menuItemName:this.actionEntry.label,selectedSubMenuItemName:this.currentChild.label}):this.actionEntry.label},isEnabled(){return this.forceEnabled||this.hasEnabledChild}},mounted(){this.$_updateState=de(this.checkStateOfChildren.bind(this),50),this.$editor.on("update",this.$_updateState),this.$editor.on("selectionUpdate",this.$_updateState)},beforeDestroy(){this.$editor.off("update",this.$_updateState),this.$editor.off("selectionUpdate",this.$_updateState)},methods:{onOpenChange(e){this.visible=e},runAction(){},onTrigger(e){e!=null&&e.click||(this.$editor.chain().focus().run(),this.$emit("trigged",e))},checkStateOfChildren(){this.hasEnabledChild=this.children.some(e=>this.isChildEnabled(e))},isChildEnabled(e){return!e.isSeparator&&!Ve(e,this.$editor).disabled}}};var Ps=function(){var e=this,s=e._self._c;return s("NcActions",e._b({staticClass:"entry-list-action entry-action",attrs:{title:e.tooltip,container:e.menuIDSelector,"aria-label":e.labelWithSelected,type:e.state.active?"primary":"tertiary","force-menu":!0,"data-text-action-entry":e.actionEntry.key,"data-text-action-active":e.activeKey,disabled:!e.isEnabled},on:{"update:open":e.onOpenChange},scopedSlots:e._u([{key:"icon",fn:function(){return[s(e.icon,{key:e.iconKey,tag:"component"})]},proxy:!0}])},"NcActions",e.state,!1),[e._l(e.children,function(i){var n;return[i.isSeparator?s("NcActionSeparator",{key:"child-".concat(i.key)}):s("ActionListItem",e._g({key:"child-".concat(i.key),attrs:{active:((n=e.currentChild)==null?void 0:n.key)===i.key,"is-item":"","action-entry":i},on:{trigged:e.onTrigger}},e.$listeners))]}),e._t("lastAction",null,null,{visible:e.visible})],2)},Ls=[],Fs=M(Us,Ps,Ls,!1,null,null,null,null);const ve=Fs.exports,Bs={name:"ActionSingle",components:{NcButton:ys},extends:$t,props:{isItem:{type:Boolean,default:!1}},mounted(){this.$editor.on("transaction",()=>this.updateState())},methods:{runAction(){var s;const{actionEntry:e}=this;e.click?e.click(this):(s=e.action(this.$editor.chain().focus()))==null||s.run(),this.$nextTick(()=>{this.$emit("trigged",{...e})})}}};var Hs=function(){var e=this,s=e._self._c;return s("NcButton",e._g({staticClass:"entry-single-action entry-action",class:e.state.class,attrs:{disabled:e.state.disabled,"aria-keyshortcuts":e.keyshortcuts||void 0,"data-text-action-entry":e.actionEntry.key,"aria-label":e.label,title:e.tooltip,type:"tertiary",pressed:e.state.type!=="button"?e.state.active:void 0},on:{click:e.runAction},scopedSlots:e._u([{key:"icon",fn:function(){return[s(e.icon,{tag:"component"})]},proxy:!0},e.actionEntry.forceLabel?{key:"default",fn:function(){return[e._v(" "+e._s(e.label)+" ")]},proxy:!0}:null],null,!0)},e.$listeners))},Vs=[],Ws=M(Bs,Hs,Vs,!1,null,null,null,null);const ye=Ws.exports,ge=ft({data(){return{activeMenuEntry:0,entries:[]}},computed:{visibleEntries(){return this.entries}},watch:{visibleEntries(){this.$nextTick(()=>{var e;(this.activeMenuEntry>this.visibleEntries.length||(e=this.visibleEntries[this.activeMenuEntry])!=null&&e.disabled)&&this.setNextMenuEntry()})}},methods:{disableMenuEntry(e,s){const i=this.visibleEntries.findIndex(({key:n})=>n===e);this.visibleEntries[i].disabled=s,s===!1&&this.activeMenuEntry===i&&this.$nextTick(()=>this.setNextMenuEntry())},setNextMenuEntry(){const e=this.visibleEntries.length+(this.$refs.remainingEntries?1:0);do this.activeMenuEntry=(this.activeMenuEntry+1)%e;while(this.activeMenuEntry<this.visibleEntries.length&&this.visibleEntries[this.activeMenuEntry].disabled)},setPreviousMenuEntry(){const e=this.visibleEntries.length+(this.$refs.remainingEntries?1:0);do{const s=this.activeMenuEntry-1;this.activeMenuEntry=(s%e+e)%e}while(this.activeMenuEntry<this.visibleEntries.length&&this.visibleEntries[this.activeMenuEntry].disabled)},handleToolbarNavigation(e){var s,i;e.key==="ArrowRight"?this.setNextMenuEntry():e.key==="ArrowLeft"&&this.setPreviousMenuEntry(),this.activeMenuEntry===this.visibleEntries.length?(i=(s=this.$refs.remainingEntries)==null?void 0:s.focusButton)==null||i.call(s):[...this.$refs.menuEntries].sort((n,o)=>this.visibleEntries.findIndex(({key:r})=>r===n.$vnode.data.key)-this.visibleEntries.findIndex(({key:r})=>r===o.$vnode.data.key))[this.activeMenuEntry].focusButton()}}}),js=ft({name:"ReadonlyBar",components:{ActionList:ve,ActionSingle:ye},extends:ge,data(){return{entries:We}}});var Ks=function(){var e=this,s=e._self._c;return e._self._setupProxy,s("div",{staticClass:"text-readonly-bar",attrs:{"data-text-el":"readonly-bar"}},[s("div",{ref:"menubar",staticClass:"text-readonly-bar__entries",attrs:{role:"toolbar","aria-label":e.t("text","Editor actions")}},e._l(e.visibleEntries,function(i,n){return s(i.component?i.component:i.children?"ActionList":"ActionSingle",{key:i.key,ref:"menuEntries",refInFor:!0,tag:"component",attrs:{"action-entry":i,"can-be-focussed":e.activeMenuEntry===n},on:{disabled:function(o){return e.disableMenuEntry(i.key,o)}}})}),1),s("div",{staticClass:"text-menubar__slot"},[e._t("default")],2)])},zs=[],Js=M(js,Ks,zs,!1,null,"c35c5130",null,null);const Nn=Js.exports;function Pt(e){const s=new Uint8Array(e);return ne(s)}function be(e){return oe(e)}const we=0,Lt=1,xe=2,Ct=(e,s)=>{k(e,we);const i=ae(s);V(e,i)},ke=(e,s,i)=>{k(e,Lt),V(e,Mt(s,i))},Qs=(e,s,i)=>ke(s,i,Tt(e)),Ce=(e,s,i)=>{try{re(s,Tt(e),i)}catch(n){console.error("Caught error while handling a Yjs update",n)}},Ee=(e,s)=>{k(e,xe),V(e,s)},qs=Ce,Ys=(e,s,i,n)=>{const o=q(e);switch(o){case we:Qs(e,s,i);break;case Lt:Ce(e,i,n);break;case xe:qs(e,i,n);break;default:throw new Error("Unknown message type")}return o},Se=new Map;class Zs{constructor(s){this.room=s,this.onmessage=null,this._onChange=i=>i.key===s&&this.onmessage!==null&&this.onmessage({data:oe(i.newValue||"")}),ze(this._onChange)}postMessage(s){Je.setItem(this.room,ne(Qe(s)))}close(){qe(this._onChange)}}const Gs=typeof BroadcastChannel>"u"?Zs:BroadcastChannel,Ft=e=>je(Se,e,()=>{const s=Ke(),i=new Gs(e);return i.onmessage=n=>s.forEach(o=>o(n.data,"broadcastchannel")),{bc:i,subs:s}}),Xs=(e,s)=>(Ft(e).subs.add(s),s),ti=(e,s)=>{const i=Ft(e),n=i.subs.delete(s);return n&&i.subs.size===0&&(i.bc.close(),Se.delete(e)),n},J=(e,s,i=null)=>{const n=Ft(e);n.bc.postMessage(s),n.subs.forEach(o=>o(s,i))},ei=0,si=(e,s,i)=>{switch(q(e)){case ei:i(s,Xt(e))}},ii=e=>Ye(e,(s,i)=>"".concat(encodeURIComponent(i),"=").concat(encodeURIComponent(s))).join("&"),H=0,Ae=3,Y=1,ni=2,it=[];it[H]=(e,s,i,n,o)=>{k(e,H);const r=Ys(s,e,i.doc,i);n&&r===Lt&&!i.synced&&(i.synced=!0)},it[Ae]=(e,s,i,n,o)=>{k(e,Y),V(e,nt(i.awareness,Array.from(i.awareness.getStates().keys())))},it[Y]=(e,s,i,n,o)=>{Ns(i.awareness,Tt(s),i)},it[ni]=(e,s,i,n,o)=>{si(s,i.doc,(r,c)=>oi(i,c))};const zt=3e4,oi=(e,s)=>console.warn("Permission denied to access ".concat(e.url,".\n").concat(s)),Ie=(e,s,i)=>{const n=te(s),o=$(),r=q(n),c=e.messageHandlers[r];return c?c(o,n,e,i,r):console.error("Unable to compute message"),o},Oe=e=>{if(e.shouldConnect&&e.ws===null){const s=new e._WS(e.url,e.protocols);s.binaryType="arraybuffer",e.ws=s,e.wsconnecting=!0,e.wsconnected=!1,e.synced=!1,s.onmessage=i=>{e.wsLastMessageReceived=z();const n=Ie(e,new Uint8Array(i.data),!0);ce(n)>1&&s.send(I(n))},s.onerror=i=>{e.emit("connection-error",[i,e])},s.onclose=i=>{e.emit("connection-close",[i,e]),e.ws=null,e.wsconnecting=!1,e.wsconnected?(e.wsconnected=!1,e.synced=!1,Ut(e.awareness,Array.from(e.awareness.getStates().keys()).filter(n=>n!==e.doc.clientID),e),e.emit("status",[{status:"disconnected"}])):e.wsUnsuccessfulReconnects++,setTimeout(Oe,Ze(Ge(2,e.wsUnsuccessfulReconnects)*100,e.maxBackoffTime),e)},s.onopen=()=>{e.wsLastMessageReceived=z(),e.wsconnecting=!1,e.wsconnected=!0,e.wsUnsuccessfulReconnects=0,e.emit("status",[{status:"connected"}]);const i=$();if(k(i,H),Ct(i,e.doc),s.send(I(i)),e.awareness.getLocalState()!==null){const n=$();k(n,Y),V(n,nt(e.awareness,[e.doc.clientID])),s.send(I(n))}},e.emit("status",[{status:"connecting"}])}},xt=(e,s)=>{const i=e.ws;e.wsconnected&&i&&i.readyState===i.OPEN&&i.send(s),e.bcconnected&&J(e.bcChannel,s,e)};class $n extends Zt{constructor(s,i,n,{connect:o=!0,awareness:r=new Os(n),params:c={},protocols:_=[],WebSocketPolyfill:g=WebSocket,resyncInterval:T=-1,maxBackoffTime:b=2500,disableBc:d=!1}={}){for(super();s[s.length-1]==="/";)s=s.slice(0,s.length-1);this.serverUrl=s,this.bcChannel=s+"/"+i,this.maxBackoffTime=b,this.params=c,this.protocols=_,this.roomname=i,this.doc=n,this._WS=g,this.awareness=r,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.disableBc=d,this.wsUnsuccessfulReconnects=0,this.messageHandlers=it.slice(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=o,this._resyncInterval=0,T>0&&(this._resyncInterval=setInterval(()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){const l=$();k(l,H),Ct(l,n),this.ws.send(I(l))}},T)),this._bcSubscriber=(l,v)=>{if(v!==this){const y=Ie(this,new Uint8Array(l),!1);ce(y)>1&&J(this.bcChannel,I(y),this)}},this._updateHandler=(l,v)=>{if(v!==this){const y=$();k(y,H),Ee(y,l),xt(this,I(y))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:l,updated:v,removed:y},R)=>{const D=l.concat(v).concat(y),E=$();k(E,Y),V(E,nt(r,D)),xt(this,I(E))},this._exitHandler=()=>{Ut(this.awareness,[n.clientID],"app closed")},Wt&&typeof ut<"u"&&ut.on("exit",this._exitHandler),r.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval(()=>{this.wsconnected&&zt<z()-this.wsLastMessageReceived&&this.ws.close()},zt/10),o&&this.connect()}get url(){const s=ii(this.params);return this.serverUrl+"/"+this.roomname+(s.length===0?"":"?"+s)}get synced(){return this._synced}set synced(s){this._synced!==s&&(this._synced=s,this.emit("synced",[s]),this.emit("sync",[s]))}destroy(){this._resyncInterval!==0&&clearInterval(this._resyncInterval),clearInterval(this._checkInterval),this.disconnect(),Wt&&typeof ut<"u"&&ut.off("exit",this._exitHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){if(this.disableBc)return;this.bcconnected||(Xs(this.bcChannel,this._bcSubscriber),this.bcconnected=!0);const s=$();k(s,H),Ct(s,this.doc),J(this.bcChannel,I(s),this);const i=$();k(i,H),ke(i,this.doc),J(this.bcChannel,I(i),this);const n=$();k(n,Ae),J(this.bcChannel,I(n),this);const o=$();k(o,Y),V(o,nt(this.awareness,[this.doc.clientID])),J(this.bcChannel,I(o),this)}disconnectBc(){const s=$();k(s,Y),V(s,nt(this.awareness,[this.doc.clientID],new Map)),xt(this,I(s)),this.bcconnected&&(ti(this.bcChannel,this._bcSubscriber),this.bcconnected=!1)}disconnect(){this.shouldConnect=!1,this.disconnectBc(),this.ws!==null&&this.ws.close()}connect(){this.shouldConnect=!0,!this.wsconnected&&this.ws===null&&(Oe(this),this.connectBc())}}function Mn(e){const s=Mt(e);return Pt(s)}function Tn(e,s,i){const n=be(s);re(e,n,i)}function Rn(e,s){const i=be(s),n=Xe(i),o=ae(e);if(ci(n,o))return;const r=$();k(r,H);const c=Mt(e,n);return Ee(r,c),I(r)}function ai(e){return e.map(s=>Pt(s)).filter(s=>s<"AQ")}function ri(e){return e.map(s=>Pt(s)).findLast(s=>s>"AQ")||""}function ci(e,s){return e.length===s.length&&e.every((i,n)=>s[n]===i)}function Ne(e){return{all:e=e||new Map,on:function(s,i){var n=e.get(s);n?n.push(i):e.set(s,[i])},off:function(s,i){var n=e.get(s);n&&(i?n.splice(n.indexOf(i)>>>0,1):e.set(s,[]))},emit:function(s,i){var n=e.get(s);n&&n.slice().map(function(o){o(i)}),(n=e.get("*"))&&n.slice().map(function(o){o(s,i)})}}}class li extends Error{constructor(s="Close has already been called on the connection",...i){super(s,...i)}}var U,_t,$e;class hi{constructor(s={}){u(this,_t);u(this,U);h(this,U,s)}open({fileId:s,baseVersionEtag:i}){return le.put(m(this,_t,$e).call(this,"session/".concat(s,"/create")),{fileId:s,baseVersionEtag:i,filePath:a(this,U).filePath,token:a(this,U).shareToken,guestName:a(this,U).guestName,forceRecreate:a(this,U).forceRecreate}).then(n=>new Me(n,a(this,U)))}}U=new WeakMap,_t=new WeakSet,$e=function(s){const i=!!a(this,U).shareToken;return pt(s,i)};var at,Nt,Z,x,N,mt,rt,L,f,W,F,Q;class Me{constructor(s,i){u(this,f);u(this,at);u(this,Nt);u(this,Z);u(this,x);u(this,N);u(this,mt);u(this,rt);u(this,L);const{document:n,session:o,lock:r,readOnly:c,content:_,documentState:g}=s.data;h(this,x,n),h(this,N,o),h(this,mt,r),h(this,rt,c),h(this,at,_),h(this,Z,g),h(this,L,i),this.isPublic=!!i.shareToken,this.closed=!1}get session(){return a(this,N)}get document(){return a(this,x)}get docStateVersion(){return a(this,Z)?a(this,x).lastSavedVersion:0}get state(){return{document:{...a(this,x),readOnly:a(this,rt)},session:a(this,N),documentSource:a(this,at)||"",documentState:a(this,Z)}}get isClosed(){return this.closed}sync({version:s}){return m(this,f,F).call(this,m(this,f,Q).call(this,"session/".concat(a(this,x).id,"/sync")),{...a(this,f,W),filePath:a(this,L).filePath,baseVersionEtag:a(this,x).baseVersionEtag,version:s})}save({version:s,autosaveContent:i,documentState:n,force:o,manualSave:r}){return m(this,f,F).call(this,m(this,f,Q).call(this,"session/".concat(a(this,x).id,"/save")),{...a(this,f,W),filePath:a(this,L).filePath,baseVersionEtag:a(this,x).baseVersionEtag,version:s,autosaveContent:i,documentState:n,force:o,manualSave:r})}push({steps:s,version:i,awareness:n}){return m(this,f,F).call(this,m(this,f,Q).call(this,"session/".concat(a(this,x).id,"/push")),{...a(this,f,W),filePath:a(this,L).filePath,baseVersionEtag:a(this,x).baseVersionEtag,steps:s,version:i,awareness:n})}update(s){return m(this,f,F).call(this,m(this,f,Q).call(this,"session/".concat(a(this,x).id,"/session")),{...a(this,f,W),guestName:s}).then(({data:i})=>{h(this,N,i)})}uploadAttachment(s){const i=new FormData;i.append("file",s);const n=pt("attachment/upload")+"?documentId="+encodeURIComponent(a(this,x).id)+"&sessionId="+encodeURIComponent(a(this,N).id)+"&sessionToken="+encodeURIComponent(a(this,N).token)+"&shareToken="+encodeURIComponent(a(this,L).shareToken||"");return m(this,f,F).call(this,n,i,{headers:{"Content-Type":"multipart/form-data"}})}insertAttachmentFile(s){return m(this,f,F).call(this,pt("attachment/filepath"),{documentId:a(this,x).id,sessionId:a(this,N).id,sessionToken:a(this,N).token,filePath:s})}close(){return m(this,f,F).call(this,m(this,f,Q).call(this,"session/".concat(a(this,x).id,"/close")),a(this,f,W)).then(()=>{this.closed=!0})}setBaseVersionEtag(s){a(this,x).baseVersionEtag=s}}at=new WeakMap,Nt=new WeakMap,Z=new WeakMap,x=new WeakMap,N=new WeakMap,mt=new WeakMap,rt=new WeakMap,L=new WeakMap,f=new WeakSet,W=function(){return{documentId:a(this,x).id,sessionId:a(this,N).id,sessionToken:a(this,N).token,token:a(this,L).shareToken}},F=function(...s){return this.closed?Promise.reject(new li):le.post(...s)},Q=function(s){const i=!!a(this,f,W).token;return pt(s,i)};function pt(e,s=!1){const i=he("/apps/text");return s?"".concat(i,"/public/").concat(e):"".concat(i,"/").concat(e)}var ot={};const di=Rt(_s),ui=Rt(hs),pi=Rt(bs);var _i=jt&&jt.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ot,"__esModule",{value:!0});var Te=ot.listen=ot.getSupportedTypes=void 0;const Re=di,mi=_i(ui),Jt=pi;function fi(){const e=(0,Re.getCapabilities)();return e.notify_push?e.notify_push.type:[]}ot.getSupportedTypes=fi;function vi(e,s,i={}){return yi(i),window._notify_push_listeners[e]||(window._notify_push_listeners[e]=[]),window._notify_push_listeners[e].push(s),window._notify_push_ws!==null&&typeof window._notify_push_ws=="object"?window._notify_push_ws.send("listen "+e):Bt(i),window._notify_push_available}Te=ot.listen=vi;function yi(e={}){typeof window._notify_push_listeners>"u"&&(window._notify_push_listeners={},window._notify_push_ws=null,window._notify_push_online=!0,window._notify_push_available=!1,window._notify_push_error_count=0,(0,Jt.subscribe)("networkOffline",()=>{window._notify_push_online=!1,window._notify_push_ws=null}),(0,Jt.subscribe)("networkOnline",()=>{window._notify_push_error_count=0,window._notify_push_online=!0,Bt(e)}))}async function Bt(e={}){if(window._notify_push_ws)return!0;window._notify_push_ws=!0;const s=(0,Re.getCapabilities)();if(!s.notify_push)return window._notify_push_available=!1,window._notify_push_ws=null,!1;window._notify_push_available=!0;let i;return e.credentials||(i=(await mi.default.post(s.notify_push.endpoints.pre_auth)).data),window._notify_push_ws=new WebSocket(s.notify_push.endpoints.websocket),window._notify_push_ws.onopen=()=>{if(typeof window._notify_push_ws=="object"&&window._notify_push_ws){i?(window._notify_push_ws.send(""),window._notify_push_ws.send(i)):e.credentials&&(window._notify_push_ws.send(e.credentials.username),window._notify_push_ws.send(e.credentials.password));for(let n in window._notify_push_listeners)window._notify_push_ws.send("listen "+n)}},window._notify_push_ws.onmessage=n=>{if(n.data==="authenticated")window._notify_push_error_count=0;else{const o=n.data.indexOf(" ");let[r,c]=o>0?[n.data.slice(0,o),n.data.slice(o+1)]:[n.data,null];if(c&&(c=JSON.parse(c)),window._notify_push_listeners[r])for(let _ of window._notify_push_listeners[r])_(r,c)}},window._notify_push_ws.onerror=window._notify_push_ws.onclose=()=>{window._notify_push_ws=null,window._notify_push_error_count+=1,setTimeout(()=>{window._notify_push_online&&Bt(e)},1e3*window._notify_push_error_count)},!0}if(!window._nc_text_notify){const e=_e("text","notify_push",!1)?Te("text_steps",(s,i)=>{var n;(n=window._nc_text_notify)==null||n.emit("notify_push",{messageType:s,messageBody:i})}):void 0;window._nc_text_notify=e?Ne():null}const gi=()=>window._nc_text_notify,Qt=300,bi=5e3,wi=5e3,xi=3e4,De=3e4,kt=3e4,ki=5,Ci=De*1.5;var C,G,X,A,j,tt,P,K;class Ei{constructor(s,i){u(this,C);u(this,G);u(this,X);u(this,A);u(this,j);u(this,tt);u(this,P);u(this,K);h(this,C,s),h(this,G,i),h(this,A,Qt),h(this,j,0),h(this,X,0)}connect(){if(this.fetcher>0){console.error("Trying to connect, but already connected");return}h(this,P,!1),this.fetcher=setInterval(this._fetchSteps.bind(this),50),document.addEventListener("visibilitychange",this.visibilitychange.bind(this)),h(this,K,gi())}async _fetchSteps(){if(a(this,tt))return;const s=Date.now();if(!(a(this,X)>s-a(this,A))){if(!this.fetcher){console.error("No inverval but triggered");return}h(this,tt,!0),w.debug("[PollingBackend] Fetching steps",a(this,C).version),await a(this,G).sync({version:a(this,C).version}).then(this._handleResponse.bind(this),this._handleError.bind(this)),h(this,X,Date.now()),h(this,tt,!1)}}handleNotifyPush({messageType:s,messageBody:i}){i.documentId===a(this,G).document.id&&this._handleResponse({data:i.response})}_handleResponse({data:s}){const{document:i,sessions:n}=s;if(h(this,j,0),a(this,C).emit("change",{document:i,sessions:n}),a(this,C)._receiveSteps(s),s.steps.length===0){if(a(this,P)||h(this,P,!0),a(this,C).checkIdle())return;const o=Date.now()-Ci,r=n.filter(c=>c.lastContact*1e3>o);a(this,C).isReadOnly?this.maximumReadOnlyTimer():r.length<2?this.maximumRefetchTimer():this.increaseRefetchTimer(),a(this,C).emit("stateChange",{initialLoading:!0});return}a(this,P)&&this.resetRefetchTimer()}_handleError(s){!s.response||s.code==="ECONNABORTED"?Vt(this,j)._++>=ki?(w.error("[PollingBackend:fetchSteps] Network error when fetching steps, emitting CONNECTION_FAILED"),a(this,C).emit("error",{type:O.CONNECTION_FAILED,data:{}})):w.error("[PollingBackend:fetchSteps] Network error when fetching steps, retry ".concat(a(this,j))):s.response.status===409?(this._handleResponse(s.response),w.error("Conflict during file save, please resolve"),a(this,C).emit("error",{type:O.SAVE_COLLISSION,data:{outsideChange:s.response.data.outsideChange}})):s.response.status===412?(a(this,C).emit("error",{type:O.LOAD_ERROR,data:s.response}),this.disconnect()):s.response.status===403?(a(this,C).emit("error",{type:O.SOURCE_NOT_FOUND,data:{}}),this.disconnect()):s.response.status===404?(a(this,C).emit("error",{type:O.SOURCE_NOT_FOUND,data:{}}),this.disconnect()):s.response.status===503?(this.increaseRefetchTimer(),a(this,C).emit("error",{type:O.CONNECTION_FAILED,data:{}}),w.error("Failed to fetch steps due to unavailable service",{error:s})):(this.disconnect(),a(this,C).emit("error",{type:O.CONNECTION_FAILED,data:{}}),w.error("Failed to fetch steps due to other reason",{error:s}))}disconnect(){clearInterval(this.fetcher),this.fetcher=0,document.removeEventListener("visibilitychange",this.visibilitychange.bind(this))}resetRefetchTimer(){if(a(this,K)&&a(this,P)){h(this,A,kt);return}h(this,A,Qt)}increaseRefetchTimer(){if(a(this,K)&&a(this,P)){h(this,A,kt);return}h(this,A,Math.min(a(this,A)*2,bi))}maximumRefetchTimer(){if(a(this,K)&&a(this,P)){h(this,A,kt);return}h(this,A,wi)}maximumReadOnlyTimer(){h(this,A,xi)}visibilitychange(){document.visibilityState==="hidden"?h(this,A,De):this.resetRefetchTimer()}}C=new WeakMap,G=new WeakMap,X=new WeakMap,A=new WeakMap,j=new WeakMap,tt=new WeakMap,P=new WeakMap,K=new WeakMap;const Si=1440,Ai=3e4,Dn=60,Ii=90,O={SAVE_COLLISSION:0,PUSH_FAILURE:1,LOAD_ERROR:2,CONNECTION_FAILED:3,SOURCE_NOT_FOUND:4,PUSH_FORBIDDEN:5};var B,p;class Un{constructor({baseVersionEtag:s,serialize:i,getDocumentState:n,...o}){u(this,B);u(this,p);return this._bus=Ne(),this.serialize=i,this.getDocumentState=n,this._api=new hi(o),h(this,p,null),this.stepClientIDs=[],this.lastStepPush=Date.now(),this.version=null,this.baseVersionEtag=s,this.sending=!1,h(this,B,null),this.autosave=de(this._autosave.bind(this),Ai),this}get isReadOnly(){return a(this,p).state.document.readOnly}get guestName(){return a(this,p).session.guestName}async open({fileId:s,initialSession:i}){if(a(this,p)&&!a(this,p).isClosed)return;const n=i?Promise.resolve(new Me({data:i},{})):this._api.open({fileId:s,baseVersionEtag:this.baseVersionEtag}).catch(o=>this._emitError(o));h(this,p,await n),a(this,p)&&(this.backend=new Ei(this,a(this,p)),this.version=a(this,p).docStateVersion,this.baseVersionEtag=a(this,p).document.baseVersionEtag,this.emit("opened",{...a(this,p).state,version:this.version}),this.emit("loaded",{...a(this,p).state,version:this.version}))}startSync(){this.backend.connect()}syncUp(){this.backend.resetRefetchTimer()}_emitError(s){!s.response||s.code==="ECONNABORTED"?this.emit("error",{type:O.CONNECTION_FAILED,data:{}}):this.emit("error",{type:O.LOAD_ERROR,data:s.response})}updateSession(s){return a(this,p).isPublic?a(this,p).update(s).catch(i=>(w.error("Failed to update the session",{error:i}),Promise.reject(i))):Promise.reject(new Error)}sendSteps(s){if(!a(this,B))return new Promise((i,n)=>{h(this,B,setInterval(()=>{a(this,p)&&!this.sending&&this.sendStepsNow(s).then(i).catch(n)},200))})}sendStepsNow(s){this.sending=!0,clearInterval(a(this,B)),h(this,B,null);const i=s();return i.steps.length>0&&this.emit("stateChange",{dirty:!0}),a(this,p).push(i).then(n=>{this.sending=!1,this.emit("sync",{steps:[],document:a(this,p).document,version:this.version})}).catch(n=>{var c;const{response:o,code:r}=n;throw this.sending=!1,(!o||r==="ECONNABORTED")&&this.emit("error",{type:O.CONNECTION_FAILED,data:{}}),(o==null?void 0:o.status)===412?this.emit("error",{type:O.LOAD_ERROR,data:o}):(o==null?void 0:o.status)===403&&(i.document||(w.error("failed to write to document - not allowed"),this.emit("error",{type:O.PUSH_FORBIDDEN,data:{}})),((c=o.data.document)==null?void 0:c.currentVersion)===this.version&&(this.emit("error",{type:O.PUSH_FAILURE,data:{}}),OC.Notification.showTemporary("Changes could not be sent yet"))),new Error("Failed to apply steps. Retry!",{cause:n})})}_receiveSteps({steps:s,document:i,sessions:n}){const o=[...n.filter(r=>r.lastContact>Math.floor(Date.now()/1e3)-Ii).filter(r=>r.lastAwarenessMessage).map(r=>({step:r.lastAwarenessMessage,clientId:r.clientId}))];for(let r=0;r<s.length;r++){const c=s[r].data;if(this.version<s[r].version&&(this.version=s[r].version),!Array.isArray(c)){w.error("Invalid step data, skipping step",{step:s[r]});continue}c.forEach(_=>{o.push({step:_,clientID:s[r].sessionId})})}this.lastStepPush=Date.now(),this.emit("sync",{steps:o,document:a(this,p).document,version:this.version})}checkIdle(){return(Date.now()-this.lastStepPush)/1e3/60>Si?(w.debug("[SyncService] Document is idle for ".concat(this.IDLE_TIMEOUT," minutes, suspending connection")),this.emit("idle"),!0):!1}_getContent(){return this.serialize()}async save({force:s=!1,manualSave:i=!0}={}){w.debug("[SyncService] saving",arguments[0]);try{const n=await a(this,p).save({version:this.version,autosaveContent:this._getContent(),documentState:this.getDocumentState(),force:s,manualSave:i});this.emit("stateChange",{dirty:!1}),a(this,p).document.lastSavedVersionTime=Date.now()/1e3,w.debug("[SyncService] saved",n);const{document:o,sessions:r}=n.data;this.emit("save",{document:o,sessions:r}),this.autosave.clear()}catch(n){throw w.error("Failed to save document.",{error:n}),n}}forceSave(){return this.save({force:!0})}_autosave(){return this.save({manualSave:!1}).catch(s=>{w.error("Failed to autosave document.",{error:s})})}async sendRemainingSteps(s){var r;if(s.length===0)return;let i=[];const n=ai(s),o=ri(s);return(r=this.sendStepsNow(()=>{const c={steps:n,awareness:o,version:this.version};return i=[...s],w.debug("sending final steps ",c),c}))==null?void 0:r.then(()=>{s.splice(0,s.length,...s.filter(c=>!i.includes(c)))},c=>w.error(c))}async close(){var s;if(this.autosave.clear(),(s=this.backend)==null||s.disconnect(),!(!a(this,p)||a(this,p).isClosed))return a(this,p).close().catch(i=>{w.info("Failed to close connection.",{e:i})})}uploadAttachment(s){return a(this,p).uploadAttachment(s)}insertAttachmentFile(s){return a(this,p).insertAttachmentFile(s)}on(s,i){return this._bus.on(s,i),this}off(s,i){return this._bus.off(s,i),this}emit(s,i){this._bus.emit(s,i)}}B=new WeakMap,p=new WeakMap;var Et={exports:{}};(function(e,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;function i(b){"@babel/helpers - typeof";return i=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},i(b)}var n=47,o=46,r=function(b){var d=i(b);if(d!=="string")throw new TypeError("Expected a string, got a ".concat(d))},c=function(b,d){for(var l="",v=0,y=-1,R=0,D,E=0;E<=b.length;++E){if(E<b.length)D=b.charCodeAt(E);else{if(D===n)break;D=n}if(D===n){if(!(y===E-1||R===1))if(y!==E-1&&R===2){if(l.length<2||v!==2||l.charCodeAt(l.length-1)!==o||l.charCodeAt(l.length-2)!==o){if(l.length>2){var yt=l.lastIndexOf("/");if(yt!==l.length-1){yt===-1?(l="",v=0):(l=l.slice(0,yt),v=l.length-1-l.lastIndexOf("/")),y=E,R=0;continue}}else if(l.length===2||l.length===1){l="",v=0,y=E,R=0;continue}}d&&(l.length>0?l+="/..":l="..",v=2)}else l.length>0?l+="/"+b.slice(y+1,E):l=b.slice(y+1,E),v=E-y-1;y=E,R=0}else D===o&&R!==-1?++R:R=-1}return l},_=function(b){try{return decodeURIComponent(b)}catch{return b}},g=function(b){r(b);var d=b;if(d.length===0)return".";var l=d.charCodeAt(0)===n,v=d.charCodeAt(d.length-1)===n;return d=_(d),d=c(d,!l),d.length===0&&!l&&(d="."),d.length>0&&v&&(d+="/"),l?"/"+d:d},T=g;s.default=T,e.exports=s.default})(Et,Et.exports);var Oi=Et.exports;const Ni=us(Oi),$i=e=>ue.dispatch("text/setAttachmentList",e),qt=ue.getters["text/findAttachment"];var ct,et,st,lt,ht,dt,S,St,At,It,Ue,Ot;class Pn{constructor({session:s,user:i,shareToken:n,currentDirectory:o,fileId:r}){u(this,S);u(this,ct);u(this,et);u(this,st);u(this,lt);u(this,ht);u(this,dt);h(this,ct,s),h(this,et,i),h(this,st,n),h(this,lt,o),h(this,ht,r!=null?r:s.documentId),h(this,dt,m(this,S,St).call(this))}async resolve(s,i=!0){let n;const o=/^\.attachments\.\d+\//;if(s.match(o)){const r=decodeURIComponent(s.replace(o,"").split("?")[0]);if(await a(this,dt),n=qt(r),i&&!n&&(await m(this,S,St).call(this),n=qt(r)),n)return n}return Mi(s)?{isImage:!0,name:m(this,S,At).call(this,s),previewUrl:s,fullUrl:s}:{isImage:!0,name:m(this,S,At).call(this,s),previewUrl:m(this,S,It).call(this,s),fullUrl:m(this,S,It).call(this,s)}}}ct=new WeakMap,et=new WeakMap,st=new WeakMap,lt=new WeakMap,ht=new WeakMap,dt=new WeakMap,S=new WeakSet,St=async function(){return $i({documentId:a(this,ht),session:a(this,ct),shareToken:a(this,st)})},At=function(s){return s.split("/").pop()},It=function(s){if(a(this,et)){const r=a(this,et).uid,c=m(this,S,Ot).call(this,s).split("/").map(encodeURIComponent).join("/");return ds("dav/files/".concat(r).concat(c))}const i=m(this,S,Ot).call(this,s).split("/"),n=i.pop(),o=i.join("/");return he("/s/{token}/download?path={dirname}&files={basename}",{token:a(this,st),basename:n,dirname:o})},Ue=function(s){return decodeURI(s.split("?")[0])},Ot=function(s){const i=[a(this,lt),m(this,S,Ue).call(this,s)].join("/");return Ni(i)};function Mi(e){return e.startsWith("http://")||e.startsWith("https://")||e.startsWith("data:")}const Ti=ft({name:"NcActionButton",components:{NextcloudVueNcActionButton:Dt,Help:ts}});var Ri=function(){var e=this,s=e._self._c;return e._self._setupProxy,s("NextcloudVueNcActionButton",e._g({attrs:{"close-after-click":"","data-text-action-entry":"formatting-help"},scopedSlots:e._u([{key:"icon",fn:function(){return[s("Help")]},proxy:!0}])},e.$listeners),[e._v(" "+e._s(e.t("text","Formatting help"))+" ")])},Di=[],Ui=M(Ti,Ri,Di,!1,null,null,null,null);const Pi=Ui.exports,Li=ft({name:"CharacterCount",components:{AlphabeticalVariant:es,NcActionText:ms},mixins:[vt],props:{visible:Boolean},data:()=>({wordCount:0,charCount:0}),computed:{countString(){return"".concat(Kt("text","%n word","%n words",this.wordCount),", ").concat(Kt("text","%n char","%n chars",this.charCount))}},watch:{visible:"refresh"},created(){this.refresh()},methods:{refresh(){this.wordCount=this.$editor.storage.characterCount.words(),this.charCount=this.$editor.storage.characterCount.characters()}}});var Fi=function(){var e=this,s=e._self._c;return e._self._setupProxy,s("NcActionText",{attrs:{"data-text-action-entry":"character-count"},scopedSlots:e._u([{key:"icon",fn:function(){return[s("AlphabeticalVariant")]},proxy:!0},{key:"default",fn:function(){return[e._v(" "+e._s(e.countString)+" ")]},proxy:!0}])})},Bi=[],Hi=M(Li,Fi,Bi,!1,null,null,null,null);const Vi=Hi.exports;function Wi(){var e;return((e=navigator==null?void 0:navigator.userAgentData)==null?void 0:e.mobile)!==void 0?navigator.userAgentData.mobile:[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/playbook/i,/silk/i,/BlackBerry/i,/Windows Phone/i].some(s=>navigator.userAgent.match(s))}const ji={name:"HelpModal",components:{NcDialog:fs},data(){return{formatted:{bold:!0,italic:!0,strikethrough:!0,heading1:!0,heading6:!0,unorderdList:!0,orderedList:!0,checkList:!0,blockQuote:!0,codeBlock:!0}}},computed:{isFormatted(){return e=>this.formatted[e]},isMobileCached(){return this.isMobilePlatform()}},methods:{toggleFormatted(e){this.formatted[e]=!this.formatted[e]},isMobilePlatform:Wi}};var Ki=function(){var e=this,s=e._self._c;return s("NcDialog",{attrs:{size:"normal","data-text-el":"formatting-help",name:e.t("text","Formatting and shortcuts"),"close-on-click-outside":!0},on:{closing:function(i){return e.$emit("close")}}},[s("h2",[e._v(e._s(e.t("text","Formatting and shortcuts")))]),s("p",[e._v(e._s(e.t("text","Speed up your writing with simple shortcuts.")))]),e.isMobileCached?s("p",[e._v(" "+e._s(e.t("text","Just type the Markdown syntax from below."))+" ")]):s("p",[e._v(" "+e._s(e.t("text","Just type the Markdown syntax or use keyboard shortcuts from below."))+" ")]),s("table",[s("thead",[s("tr",[s("th",[e._v(e._s(e.t("text","Style")))]),s("th",[e._v(e._s(e.t("text","Syntax")))]),e.isMobileCached?e._e():s("th",[e._v(" "+e._s(e.t("text","Keyboard shortcuts"))+" ")])])]),s("tbody",[s("tr",[s("td",[e._v(e._s(e.t("text","New paragraph")))]),s("td",[s("kbd",[e._v(e._s(e.t("text","Enter")))])]),e.isMobileCached?e._e():s("td")]),s("tr",[s("td",[e._v(e._s(e.t("text","Hard line break")))]),s("td",[s("kbd",[e._v(e._s(e.t("text","Enter")))]),e._v(" "+e._s(e.t("text","followed by"))+" "),s("kbd",[e._v(e._s(e.t("text","Backspace")))])]),e.isMobileCached?e._e():s("td",[s("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),s("kbd",[e._v(e._s(e.t("text","Enter")))])])]),s("tr",[s("td",[e._v(e._s(e.t("text","Bold")))]),s("td",[s("code",[e._v("**"+e._s(e.t("text","Bold text"))+"**")])]),e.isMobileCached?e._e():s("td",[s("kbd",[e._v(e._s(e.t("text","Ctrl")))]),e._v(" + "),s("kbd",[e._v("B")])])]),s("tr",[s("td",[e._v(e._s(e.t("text","Italic")))]),s("td",[s("code",[e._v("*"+e._s(e.t("text","Italicized text"))+"*")])]),e.isMobileCached?e._e():s("td",[s("kbd",[e._v(e._s(e.t("text","Ctrl")))]),e._v(" + "),s("kbd",[e._v("I")])])]),s("tr",[s("td",[e._v(e._s(e.t("text","Strikethrough")))]),s("td",[s("code",[e._v("~~"+e._s(e.t("text","Mistaken text"))+"~~")])]),e.isMobileCached?e._e():s("td",[s("kbd",[e._v(e._s(e.t("text","Ctrl")))]),e._v(" + "),s("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),s("kbd",[e._v("S")])])]),s("tr",[s("td",[e._v(e._s(e.t("text","Underline")))]),s("td",[s("code",[e._v("__"+e._s(e.t("text","Underlined text"))+"__")])]),e.isMobileCached?e._e():s("td",[s("kbd",[e._v(e._s(e.t("text","Ctrl")))]),e._v(" + "),s("kbd",[e._v("U")])])]),s("tr",[s("td",{staticClass:"ellipsis_top"},[e._v(" "+e._s(e.t("text","Heading 1"))+" ")]),s("td",{staticClass:"ellipsis_top"},[s("code",[e._v("# "+e._s(e.t("text","Heading level 1")))])]),e.isMobileCached?e._e():s("td",{staticClass:"ellipsis_top"},[s("kbd",[e._v(e._s(e.t("text","Ctrl")))]),e._v(" + "),s("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),s("kbd",[e._v("1")])])]),s("tr",[s("td",{staticClass:"noborder ellipsis"},[e._v(" … ")]),s("td",{staticClass:"noborder ellipsis"},[e._v(" … ")]),e.isMobileCached?e._e():s("td",{staticClass:"ellipsis noborder"},[e._v(" … ")])]),s("tr",[s("td",{staticClass:"noborder ellipsis_bottom"},[e._v(" "+e._s(e.t("text","Heading 6"))+" ")]),s("td",{staticClass:"noborder ellipsis_bottom"},[s("code",[e._v("###### "+e._s(e.t("text","Heading level 6")))])]),e.isMobileCached?e._e():s("td",{staticClass:"noborder ellipsis_bottom"},[s("kbd",[e._v(e._s(e.t("text","Ctrl")))]),e._v(" + "),s("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),s("kbd",[e._v("6")])])]),s("tr",[s("td",[e._v(e._s(e.t("text","Unordered list")))]),s("td",[s("code",[e._v("* "+e._s(e.t("text","An item")))])]),e.isMobileCached?e._e():s("td",[s("kbd",[e._v(e._s(e.t("text","Ctrl")))]),e._v(" + "),s("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),s("kbd",[e._v("8")])])]),s("tr",[s("td",[e._v(e._s(e.t("text","Ordered list")))]),s("td",[s("code",[e._v("1. "+e._s(e.t("text","First item")))])]),e.isMobileCached?e._e():s("td",[s("kbd",[e._v(e._s(e.t("text","Ctrl")))]),e._v(" + "),s("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),s("kbd",[e._v("7")])])]),s("tr",[s("td",[e._v(e._s(e.t("text","Checklist")))]),s("td",[s("code",[e._v("* [] "+e._s(e.t("text","To-Do item")))])]),e.isMobileCached?e._e():s("td")]),s("tr",[s("td",[e._v(e._s(e.t("text","Blockquote")))]),s("td",[s("code",[e._v("> "+e._s(e.t("text","Quoted text")))])]),e.isMobileCached?e._e():s("td",[s("kbd",[e._v(e._s(e.t("text","Ctrl")))]),e._v(" + "),s("kbd",[e._v(">")])])]),s("tr",[s("td",[e._v(e._s(e.t("text","Code block")))]),s("td",[s("code",[e._v("``` "+e._s(e.t("text","Some code")))])]),e.isMobileCached?e._e():s("td")]),s("tr",[s("td",[e._v(e._s(e.t("text","Link")))]),s("td",[s("code",[e._v("[Title](https://example.org)")])]),e.isMobileCached?e._e():s("td")]),s("tr",[s("td",[e._v(e._s(e.t("text","Insert emoji")))]),s("td",[s("code",[e._v(":"+e._s(e.t("text","emoji")))])]),e.isMobileCached?e._e():s("td")]),s("tr",[s("td",[e._v(e._s(e.t("text","Mention someone")))]),s("td",[s("code",[e._v("@"+e._s(e.t("text","name")))])]),e.isMobileCached?e._e():s("td")]),s("tr",[s("td",[e._v(e._s(e.t("text","Smart picker")))]),s("td",[s("code",[e._v("/"+e._s(e.t("text","something")))])]),e.isMobileCached?e._e():s("td")])])]),s("table",{attrs:{vif:"!isMobileCached"}},[s("thead",[s("tr",[s("th",[e._v(e._s(e.t("text","Action")))]),s("th",[e._v(e._s(e.t("text","Keyboard shortcuts")))])])]),s("tbody",[s("tr",[s("td",[e._v(e._s(e.t("text","Undo")))]),s("td",[s("kbd",[e._v(e._s(e.t("text","Ctrl")))]),e._v(" + "),s("kbd",[e._v("Z")])])]),s("tr",[s("td",[e._v(e._s(e.t("text","Redo")))]),s("td",[s("kbd",[e._v(e._s(e.t("text","Ctrl")))]),e._v(" + "),s("kbd",[e._v("Y")])])]),s("tr",[s("td",[e._v(e._s(e.t("text","Toggle outline")))]),s("td",[s("kbd",[e._v(e._s(e.t("text","Ctrl")))]),e._v(" + "),s("kbd",[e._v(e._s(e.t("text","Alt")))]),e._v(" + "),s("kbd",[e._v("H")])])])])])])},zi=[],Ji=M(ji,Ki,zi,!1,null,"bdf077d8",null,null);const Qi=Ji.exports,qi={name:"MenuBar",components:{ActionFormattingHelp:Pi,ActionList:ve,ActionSingle:ye,HelpModal:Qi,NcActionSeparator:ee,NcActionButton:Dt,CharacterCount:Vi,TranslateVariant:ss},extends:ge,mixins:[vt,xs,me,fe],provide(){const e={};return Object.defineProperties(e,{[os]:{get:()=>this.randomID}}),e},props:{isHidden:{type:Boolean,default:!1}},setup(){const e=Pe(),{width:s}=gs(e);return{menubar:e,width:s}},data(){return{entries:[...is],randomID:"menu-bar-".concat(Math.ceil(Math.random()*1e4+500).toString(16)),displayHelp:!1,isReady:!1,canTranslate:_e("text","translation_languages",[]).length>0,resize:null}},computed:{visibleEntries(){return this.entries.filter(({priority:e})=>e===void 0||e<=this.iconsLimit)},hiddenEntries(){const e=this.entries.filter(({priority:i})=>i!==void 0&&i>this.iconsLimit),s=e.reduce((i,n,o)=>{var c;const r=(c=n.children)!=null?c:[n];if(r.length>1){const _=i.length&&!i.at(-1).isSeparator?[{key:"separator-before-".concat(n.id),isSeparator:!0}]:[],g=o!==e.length-1?[{key:"separator-after-".concat(n.id),isSeparator:!0}]:[];return[...i,..._,...r,...g]}return[...i,...r]},[]);return{key:"remain",label:this.t("text","Remaining actions"),icon:ns,children:s}},iconWidth(){var s;const e=(s=this.menubar&&getComputedStyle(this.menubar))==null?void 0:s.getPropertyValue("--default-clickable-area");return parseInt(e)||34},iconsLimit(){const e=this.width-4,s=this.$isMobile?this.iconWidth:this.iconWidth+2;return Math.floor(e/s)-1}},mounted(){this.$nextTick(()=>{this.isReady=!0,this.$emit("update:loaded",!0)})},methods:{showHelp(){this.displayHelp=!0},hideHelp(){this.displayHelp=!1},showTranslate(){const{from:e,to:s}=this.$editor.view.state.selection;let i=this.$editor.view.state.doc.textBetween(e,s," ");i.trim().length||(this.$editor.commands.selectAll(),i=this.$editor.view.state.doc.textContent),console.debug("translation click",this.$editor.view.state.selection,i),pe("text:translate-modal:show",{content:i})}}};var Yi=function(){var e=this,s=e._self._c;return s("div",{staticClass:"text-menubar",class:{"text-menubar--ready":e.isReady,"text-menubar--hide":e.isHidden,"text-menubar--is-workspace":e.$isRichWorkspace},attrs:{id:e.randomID,"data-text-el":"menubar",role:"region","aria-label":e.t("text","Editor actions")}},[e.displayHelp?s("HelpModal",{on:{close:e.hideHelp}}):e._e(),e.$isRichEditor?s("div",{ref:"menubar",staticClass:"text-menubar__entries",attrs:{role:"toolbar","aria-label":e.t("text","Formatting menu bar")},on:{keydown:[function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"left",37,i.key,["Left","ArrowLeft"])||"button"in i&&i.button!==0?null:(i.stopPropagation(),e.handleToolbarNavigation.apply(null,arguments))},function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"right",39,i.key,["Right","ArrowRight"])||"button"in i&&i.button!==2?null:(i.stopPropagation(),e.handleToolbarNavigation.apply(null,arguments))}]}},[e._l(e.visibleEntries,function(i,n){return s(i.component?i.component:i.children?"ActionList":"ActionSingle",{key:i.key,ref:"menuEntries",refInFor:!0,tag:"component",attrs:{"action-entry":i,"can-be-focussed":e.activeMenuEntry===n},on:{disabled:function(o){return e.disableMenuEntry(i.key,o)},click:function(o){e.activeMenuEntry=n}}})}),s("ActionList",{ref:"remainingEntries",attrs:{"action-entry":e.hiddenEntries,"can-be-focussed":e.activeMenuEntry===e.visibleEntries.length,"force-enabled":!0},on:{click:function(i){e.activeMenuEntry="remain"}},scopedSlots:e._u([{key:"lastAction",fn:function({visible:i}){return[e.canTranslate?s("NcActionButton",{attrs:{"close-after-click":""},on:{click:e.showTranslate},scopedSlots:e._u([{key:"icon",fn:function(){return[s("TranslateVariant")]},proxy:!0}],null,!0)},[e._v(" "+e._s(e.t("text","Translate"))+" ")]):e._e(),s("ActionFormattingHelp",{on:{click:e.showHelp}}),s("NcActionSeparator"),s("CharacterCount",e._b({},"CharacterCount",{visible:i},!1))]}}],null,!1,2316723924)})],2):e._e(),s("div",{staticClass:"text-menubar__slot"},[e._t("default")],2)],1)},Zi=[],Gi=M(qi,Yi,Zi,!1,null,"adb1028b",null,null);const Ln=Gi.exports,Xi={name:"ContentContainer",components:{EditorContent:as,EditorOutline:rs},mixins:[vt,ie],computed:{showOutline(){return this.$outlineState.visible}}};var tn=function(){var e=this,s=e._self._c;return s("div",{staticClass:"content-wrapper text-editor__content-wrapper",class:{"--show-outline":e.showOutline},attrs:{"data-text-el":"editor-content-wrapper"}},[e.showOutline?s("div",{staticClass:"text-editor__content-wrapper__left"},[s("EditorOutline")],1):e._e(),e._t("default"),s("EditorContent",{staticClass:"editor__content text-editor__content",attrs:{role:"document",editor:e.$editor}}),s("div",{staticClass:"text-editor__content-wrapper__right"})],2)},en=[],sn=M(Xi,tn,en,!1,null,"a3b97a85",null,null);const Fn=sn.exports,Yt=e=>e.split("/").slice(0,-1).join("/"),nn={name:"MediaHandler",mixins:[vt,ks,Cs],provide(){const e={};return Object.defineProperties(e,{[Es]:{get:()=>this.showAttachmentPrompt},[Ss]:{get:()=>this.chooseLocalFile},[As]:{get:()=>this.state}}),e},data(){return{lastFilePath:null,draggedOver:!1,state:{isUploadingAttachments:!1}}},computed:{initialFilePath(){var e,s,i;return(i=this.lastFilePath)!=null?i:Yt((s=(e=this.$file)==null?void 0:e.relativePath)!=null?s:"/")}},methods:{setDraggedOver(e){this.draggedOver=e},onPaste(e){this.uploadAttachmentFiles(e.detail.files)},onEditorDrop(e){this.uploadAttachmentFiles(e.detail.files,e.detail.position),this.draggedOver=!1},onAttachmentUploadFilePicked(e){this.uploadAttachmentFiles(e.target.files),e.target.value=""},chooseLocalFile(){this.$refs.attachmentFileInput.click()},async uploadAttachmentFiles(e,s=null){if(!e)return;this.state.isUploadingAttachments=!0;const i=[...e].map(n=>this.uploadAttachmentFile(n,s));return Promise.all(i).catch(n=>{var o,r;w.error("Uploading multiple images failed",{error:n}),bt(((r=(o=n==null?void 0:n.response)==null?void 0:o.data)==null?void 0:r.error)||n.message)}).then(()=>{this.state.isUploadingAttachments=!1})},async uploadAttachmentFile(e,s=null){return this.state.isUploadingAttachments=!0,this.$syncService.uploadAttachment(e).then(i=>{var n,o,r;this.insertAttachment((n=i.data)==null?void 0:n.name,(o=i.data)==null?void 0:o.id,e.type,s,(r=i.data)==null?void 0:r.dirname)}).catch(i=>{var n,o;w.error("Uploading image failed",{error:i}),bt((o=(n=i==null?void 0:i.response)==null?void 0:n.data)==null?void 0:o.error)}).then(()=>{this.state.isUploadingAttachments=!1})},showAttachmentPrompt(){ws()&&OC.dialogs.filepicker(t("text","Insert an attachment"),e=>{this.insertFromPath(e)},!1,[],!0,void 0,this.initialFilePath)},insertFromPath(e){return this.lastFilePath=Yt(e),this.state.isUploadingAttachments=!0,this.$syncService.insertAttachmentFile(e).then(s=>{var i,n,o,r;this.insertAttachment((i=s.data)==null?void 0:i.name,(n=s.data)==null?void 0:n.id,(o=s.data)==null?void 0:o.mimetype,null,(r=s.data)==null?void 0:r.dirname)}).catch(s=>{var i,n;w.error("Failed to insert image path",{error:s}),bt(((n=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:n.error)||s.message)}).then(()=>{this.state.isUploadingAttachments=!1})},insertAttachment(e,s,i,n=null,o=""){const r=o+"/"+encodeURIComponent(e).replace(/[!'()*]/g,g=>"%"+g.charCodeAt(0).toString(16).toUpperCase()),c=e.replaceAll(/[[\]]/g,"");(n?this.$editor.chain().focus(n):this.$editor.chain()).setImage({src:r,alt:c}).run();const _=this.$editor.view.state.selection;_.empty||this.$editor.commands.focus(_.to),this.$editor.commands.scrollIntoView(),pe("text:image-node:add",null)}}};var on=function(){var e=this,s=e._self._c;return s("div",{staticClass:"editor editor-media-handler",class:{draggedOver:e.draggedOver},attrs:{"data-text-el":"editor-media-handler"},on:{"image-paste":e.onPaste,dragover:function(i){return i.preventDefault(),i.stopPropagation(),e.setDraggedOver(!0)},dragleave:function(i){return i.preventDefault(),i.stopPropagation(),e.setDraggedOver(!1)},"file-drop":e.onEditorDrop}},[s("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"attachmentFileInput",attrs:{"data-text-el":"attachment-file-input",type:"file",accept:"*/*",multiple:""},on:{change:e.onAttachmentUploadFilePicked}}),e._t("default")],2)},an=[],rn=M(nn,on,an,!1,null,null,null,null);const cn=rn.exports,ln={name:"MainContainer",components:{MediaHandler:cn},mixins:[Is]};var hn=function(){var e=this,s=e._self._c;return s("div",{staticClass:"editor"},[e.$editorUpload?s("MediaHandler",{staticClass:"text-editor__main"},[e._t("default")],2):e._t("default")],2)},dn=[],un=M(ln,hn,dn,!1,null,"f2d30048",null,null);const Bn=un.exports,pn={name:"Wrapper",mixins:[se,me,fe],provide(){const e={};return Object.defineProperties(e,{[cs]:{get:()=>this.outline},[ls]:{get:()=>({toggle:this.outlineToggle})}}),e},props:{syncError:{type:Object,default:null},hasConnectionIssue:{type:Boolean,default:!1},contentLoaded:{type:Boolean,default:!0},showOutlineOutside:{type:Boolean,default:!1}},data:()=>({outline:{visible:!1,enable:!1}}),computed:{...ps({viewWidth:e=>e.text.viewWidth}),hasSyncCollission(){return this.syncError&&this.syncError.type===O.SAVE_COLLISSION},showOutline(){return this.isAbleToShowOutline?this.outline.visible:!1},isAbleToShowOutline(){return this.$isRichWorkspace?!1:this.viewWidth>1265}},watch:{showOutlineOutside(){this.outline.visible=this.showOutlineOutside}},mounted(){this.outline.enable=this.isAbleToShowOutline,this.$watch(()=>this.isAbleToShowOutline,e=>{Object.assign(this.outline,{enable:e})}),document.addEventListener("keydown",this.handleKeyDown)},beforeDestroy(){document.removeEventListener("keydown",this.handleKeyDown)},methods:{outlineToggle(){this.outline.visible=!this.outline.visible,this.$emit("outline-toggled",this.outline.visible)},handleKeyDown(e){e.ctrlKey&&e.altKey&&e.key==="h"&&this.outlineToggle()}}};var _n=function(){var e=this,s=e._self._c;return s("div",{staticClass:"text-editor__wrapper",class:{"has-conflicts":e.hasSyncCollission,"is-rich-workspace":e.$isRichWorkspace,"is-rich-editor":e.$isRichEditor}},[e._t("default")],2)},mn=[],fn=M(pn,_n,mn,!1,null,"b579724b",null,null);const Hn=fn.exports;export{Pn as A,Fn as C,O as E,Si as I,Bn as M,Nn as R,Un as S,$n as W,ai as a,ri as b,Hn as c,be as d,Ln as e,Mn as f,gi as g,Tn as h,Rn as i,Ii as j,Dn as k};
