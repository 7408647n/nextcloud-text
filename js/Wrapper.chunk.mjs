/*! third party licenses: js/vendor.LICENSE.txt */
var Ut=e=>{throw TypeError(e)};var ft=(e,s,i)=>s.has(e)||Ut("Cannot "+i);var o=(e,s,i)=>(ft(e,s,"read from private field"),i?i.call(e):s.get(e)),u=(e,s,i)=>s.has(e)?Ut("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(e):s.set(e,i),d=(e,s,i,n)=>(ft(e,s,"write to private field"),n?n.call(e,i):s.set(e,i),i),v=(e,s,i)=>(ft(e,s,"access private method"),i);var Lt=(e,s,i,n)=>({set _(a){d(e,s,a,i)},get _(){return o(e,s,n)}});import{d as mt,r as Se}from"./vue.runtime.esm.chunk.mjs";import{O as jt,A as Ae,B as K,G as Kt,H as x,J as Ie,K as S,L as O,Q,V as zt,W as Jt,X as It,t as Qt,Z as qt,_ as Yt,$ as Oe,a0 as Ne,a1 as Me,a2 as $e,a3 as Zt,a4 as Gt,a5 as Xt,a6 as H,j as Ot,a7 as Nt,k as te,a8 as Re,a9 as Te,aa as De,ab as Ue,ac as Le,ad as Pe,ae as Fe,af as ee,ag as Pt,ah as Be,ai as He,aj as Ve,ak as We,al as je,am as Ke,an as ze,ao as Je,ap as Qe,aq as qe,ar as Ye,as as Ze,at as Ge}from"./RichText.chunk.mjs";import{n as R}from"./_plugin-vue2_normalizer.chunk.mjs";import{c as se,_ as ie,U as Xe}from"./index.chunk3.mjs";import{g as ts}from"./emoji-picker.chunk.mjs";import{d as ne,s as ae,m as es}from"./index.chunk.mjs";import{N as Mt,f as ss,d as Ft,g as is}from"./NcUserBubble-DMjZyrGY.chunk.mjs";import{b as ns,N as as,u as os,s as gt}from"./NcNoteCard-BLPU1den.chunk.mjs";import{p as ht,e as oe,l as rs}from"./modulepreload-polyfill.chunk.mjs";import{l as cs}from"./index.chunk4.mjs";import{u as vt,e as ls,c as re,g as ce,h as hs,d as ds,A as us,m as ps,n as ms,o as vs}from"./MediaHandler.provider.chunk.mjs";import{l as y}from"./logger.chunk.mjs";const bt=3e4;class _s extends jt{constructor(s){super(),this.doc=s,this.clientID=s.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{const i=K();this.getLocalState()!==null&&bt/2<=i-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const n=[];this.meta.forEach((a,r)=>{r!==this.clientID&&bt<=i-a.lastUpdated&&this.states.has(r)&&n.push(r)}),n.length>0&&$t(this,n,"timeout")},Ae(bt/10)),s.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(s){const i=this.clientID,n=this.meta.get(i),a=n===void 0?0:n.clock+1,r=this.states.get(i);s===null?this.states.delete(i):this.states.set(i,s),this.meta.set(i,{clock:a,lastUpdated:K()});const c=[],g=[],f=[],D=[];s===null?D.push(i):r==null?s!=null&&c.push(i):(g.push(i),Kt(r,s)||f.push(i)),(c.length>0||f.length>0||D.length>0)&&this.emit("change",[{added:c,updated:f,removed:D},"local"]),this.emit("update",[{added:c,updated:g,removed:D},"local"])}setLocalStateField(s,i){const n=this.getLocalState();n!==null&&this.setLocalState({...n,[s]:i})}getStates(){return this.states}}const $t=(e,s,i)=>{const n=[];for(let a=0;a<s.length;a++){const r=s[a];if(e.states.has(r)){if(e.states.delete(r),r===e.clientID){const c=e.meta.get(r);e.meta.set(r,{clock:c.clock+1,lastUpdated:K()})}n.push(r)}}n.length>0&&(e.emit("change",[{added:[],updated:[],removed:n},i]),e.emit("update",[{added:[],updated:[],removed:n},i]))},st=(e,s,i=e.states)=>{const n=s.length,a=O();x(a,n);for(let r=0;r<n;r++){const c=s[r],g=i.get(c)||null,f=e.meta.get(c).clock;x(a,c),x(a,f),Ie(a,JSON.stringify(g))}return S(a)},fs=(e,s,i)=>{const n=Jt(s),a=K(),r=[],c=[],g=[],f=[],D=Q(n);for(let b=0;b<D;b++){const l=Q(n);let h=Q(n);const m=JSON.parse(zt(n)),E=e.meta.get(l),N=e.states.get(l),M=E===void 0?0:E.clock;(M<h||M===h&&m===null&&e.states.has(l))&&(m===null?l===e.clientID&&e.getLocalState()!=null?h++:e.states.delete(l):e.states.set(l,m),e.meta.set(l,{clock:h,lastUpdated:a}),E===void 0&&m!==null?r.push(l):E!==void 0&&m===null?f.push(l):m!==null&&(Kt(m,N)||g.push(l),c.push(l)))}(r.length>0||g.length>0||f.length>0)&&e.emit("change",[{added:r,updated:g,removed:f},i]),(r.length>0||c.length>0||f.length>0)&&e.emit("update",[{added:r,updated:c,removed:f},i])},gs={name:"NcActionButton",components:{NextcloudVueNcActionButton:Mt},extends:It,mounted(){this.$editor.on("transaction",()=>this.updateState())},methods:{runAction(){var s;const{actionEntry:e}=this;e.click?e.click(this):(s=e.action(this.$editor.chain().focus()))==null||s.run(),this.$nextTick(()=>{this.$emit("trigged",{...e})})}}};var bs=function(){var e=this,s=e._self._c;return s("NextcloudVueNcActionButton",e._g({staticClass:"entry-single-action entry-action entry-action-item",class:e.state.class,attrs:{disabled:e.state.disabled,"aria-keyshortcuts":e.keyshortcuts||void 0,"data-text-action-entry":e.actionEntry.key,type:e.state.type,"model-value":e.state.type!=="button"?e.state.active:void 0,"close-after-click":""},on:{click:e.runAction},scopedSlots:e._u([{key:"icon",fn:function(){return[s(e.icon,{tag:"component"})]},proxy:!0}])},e.$listeners),[e._v(" "+e._s(e.label)+" ")])},ys=[],ks=R(gs,bs,ys,!1,null,null,null,null);const xs=ks.exports,ws={name:"ActionList",components:{NcActions:ns,NcActionSeparator:Qt,ActionListItem:xs},extends:It,mixins:[qt,Yt,Oe],props:{forceEnabled:{type:Boolean,default:!1}},data:()=>({visible:!1,hasEnabledChild:!0}),computed:{currentChild(){const{state:e,$editor:s,actionEntry:{children:i}}=this;return e.active?i.find(n=>Ne(n,s)):null},icon(){return this.currentChild?this.currentChild.icon:this.actionEntry.icon},iconKey(){return"".concat(this.actionEntry.key,"/").concat(this.activeKey)},activeKey(){var e;return(e=this.currentChild)==null?void 0:e.key},children(){return this.actionEntry.children.filter(({visible:e})=>e===void 0?!0:typeof e=="function"?e(this):e)},labelWithSelected(){return this.currentChild?t("text",'{menuItemName}, "{selectedSubMenuItemName}" is selected',{menuItemName:this.actionEntry.label,selectedSubMenuItemName:this.currentChild.label}):this.actionEntry.label},isEnabled(){return this.forceEnabled||this.hasEnabledChild}},mounted(){this.$_updateState=ne(this.checkStateOfChildren.bind(this),50),this.$editor.on("update",this.$_updateState),this.$editor.on("selectionUpdate",this.$_updateState)},beforeDestroy(){this.$editor.off("update",this.$_updateState),this.$editor.off("selectionUpdate",this.$_updateState)},methods:{onOpenChange(e){this.visible=e},runAction(){},onTrigger(e){e!=null&&e.click||(this.$editor.chain().focus().run(),this.$emit("trigged",e))},checkStateOfChildren(){this.hasEnabledChild=this.children.some(e=>this.isChildEnabled(e))},isChildEnabled(e){return!e.isSeparator&&!Me(e,this.$editor).disabled}}};var Cs=function(){var e=this,s=e._self._c;return s("NcActions",e._b({staticClass:"entry-list-action entry-action",attrs:{title:e.tooltip,container:e.menuIDSelector,"aria-label":e.labelWithSelected,type:e.state.active?"primary":"tertiary","force-menu":!0,"data-text-action-entry":e.actionEntry.key,"data-text-action-active":e.activeKey,disabled:!e.isEnabled},on:{"update:open":e.onOpenChange},scopedSlots:e._u([{key:"icon",fn:function(){return[s(e.icon,{key:e.iconKey,tag:"component"})]},proxy:!0}])},"NcActions",e.state,!1),[e._l(e.children,function(i){var n;return[i.isSeparator?s("NcActionSeparator",{key:"child-".concat(i.key)}):s("ActionListItem",e._g({key:"child-".concat(i.key),attrs:{active:((n=e.currentChild)==null?void 0:n.key)===i.key,"is-item":"","action-entry":i},on:{trigged:e.onTrigger}},e.$listeners))]}),e._t("lastAction",null,null,{visible:e.visible})],2)},Es=[],Ss=R(ws,Cs,Es,!1,null,null,null,null);const le=Ss.exports,As={name:"ActionSingle",components:{NcButton:as},extends:It,props:{isItem:{type:Boolean,default:!1}},mounted(){this.$editor.on("transaction",()=>this.updateState())},methods:{runAction(){var s;const{actionEntry:e}=this;e.click?e.click(this):(s=e.action(this.$editor.chain().focus()))==null||s.run(),this.$nextTick(()=>{this.$emit("trigged",{...e})})}}};var Is=function(){var e=this,s=e._self._c;return s("NcButton",e._g({staticClass:"entry-single-action entry-action",class:e.state.class,attrs:{disabled:e.state.disabled,"aria-keyshortcuts":e.keyshortcuts||void 0,"data-text-action-entry":e.actionEntry.key,"aria-label":e.label,title:e.tooltip,type:"tertiary",pressed:e.state.type!=="button"?e.state.active:void 0},on:{click:e.runAction},scopedSlots:e._u([{key:"icon",fn:function(){return[s(e.icon,{tag:"component"})]},proxy:!0},e.actionEntry.forceLabel?{key:"default",fn:function(){return[e._v(" "+e._s(e.label)+" ")]},proxy:!0}:null],null,!0)},e.$listeners))},Os=[],Ns=R(As,Is,Os,!1,null,null,null,null);const he=Ns.exports,de=mt({data(){return{activeMenuEntry:0,entries:[]}},computed:{visibleEntries(){return this.entries}},watch:{visibleEntries(){this.$nextTick(()=>{var e;(this.activeMenuEntry>this.visibleEntries.length||(e=this.visibleEntries[this.activeMenuEntry])!=null&&e.disabled)&&this.setNextMenuEntry()})}},methods:{disableMenuEntry(e,s){const i=this.visibleEntries.findIndex(({key:n})=>n===e);this.visibleEntries[i].disabled=s,s===!1&&this.activeMenuEntry===i&&this.$nextTick(()=>this.setNextMenuEntry())},setNextMenuEntry(){const e=this.visibleEntries.length+(this.$refs.remainingEntries?1:0);do this.activeMenuEntry=(this.activeMenuEntry+1)%e;while(this.activeMenuEntry<this.visibleEntries.length&&this.visibleEntries[this.activeMenuEntry].disabled)},setPreviousMenuEntry(){const e=this.visibleEntries.length+(this.$refs.remainingEntries?1:0);do{const s=this.activeMenuEntry-1;this.activeMenuEntry=(s%e+e)%e}while(this.activeMenuEntry<this.visibleEntries.length&&this.visibleEntries[this.activeMenuEntry].disabled)},handleToolbarNavigation(e){var s,i;e.key==="ArrowRight"?this.setNextMenuEntry():e.key==="ArrowLeft"&&this.setPreviousMenuEntry(),this.activeMenuEntry===this.visibleEntries.length?(i=(s=this.$refs.remainingEntries)==null?void 0:s.focusButton)==null||i.call(s):[...this.$refs.menuEntries].sort((n,a)=>this.visibleEntries.findIndex(({key:r})=>r===n.$vnode.data.key)-this.visibleEntries.findIndex(({key:r})=>r===a.$vnode.data.key))[this.activeMenuEntry].focusButton()}}}),Ms=mt({name:"ReadonlyBar",components:{ActionList:le,ActionSingle:he},extends:de,data(){return{entries:$e}}});var $s=function(){var e=this,s=e._self._c;return e._self._setupProxy,s("div",{staticClass:"text-readonly-bar",attrs:{"data-text-el":"readonly-bar"}},[s("div",{ref:"menubar",staticClass:"text-readonly-bar__entries",attrs:{role:"toolbar","aria-label":e.t("text","Editor actions")}},e._l(e.visibleEntries,function(i,n){return s(i.component?i.component:i.children?"ActionList":"ActionSingle",{key:i.key,ref:"menuEntries",refInFor:!0,tag:"component",attrs:{"action-entry":i,"can-be-focussed":e.activeMenuEntry===n},on:{disabled:function(a){return e.disableMenuEntry(i.key,a)}}})}),1),s("div",{staticClass:"text-menubar__slot"},[e._t("default")],2)])},Rs=[],Ts=R(Ms,$s,Rs,!1,null,"c35c5130",null,null);const ln=Ts.exports;function Rt(e){const s=new Uint8Array(e);return Zt(s)}function ue(e){return Gt(e)}const pe=0,Tt=1,me=2,kt=(e,s)=>{x(e,pe);const i=Xt(s);H(e,i)},ve=(e,s,i)=>{x(e,Tt),H(e,Ot(s,i))},Ds=(e,s,i)=>ve(s,i,Nt(e)),_e=(e,s,i)=>{try{te(s,Nt(e),i)}catch(n){console.error("Caught error while handling a Yjs update",n)}},fe=(e,s)=>{x(e,me),H(e,s)},Us=_e,Ls=(e,s,i,n)=>{const a=Q(e);switch(a){case pe:Ds(e,s,i);break;case Tt:_e(e,i,n);break;case me:Us(e,i,n);break;default:throw new Error("Unknown message type")}return a},ge=new Map;class Ps{constructor(s){this.room=s,this.onmessage=null,this._onChange=i=>i.key===s&&this.onmessage!==null&&this.onmessage({data:Gt(i.newValue||"")}),De(this._onChange)}postMessage(s){Ue.setItem(this.room,Zt(Le(s)))}close(){Pe(this._onChange)}}const Fs=typeof BroadcastChannel>"u"?Ps:BroadcastChannel,Dt=e=>Re(ge,e,()=>{const s=Te(),i=new Fs(e);return i.onmessage=n=>s.forEach(a=>a(n.data,"broadcastchannel")),{bc:i,subs:s}}),Bs=(e,s)=>(Dt(e).subs.add(s),s),Hs=(e,s)=>{const i=Dt(e),n=i.subs.delete(s);return n&&i.subs.size===0&&(i.bc.close(),ge.delete(e)),n},z=(e,s,i=null)=>{const n=Dt(e);n.bc.postMessage(s),n.subs.forEach(a=>a(s,i))},Vs=0,Ws=(e,s,i)=>{switch(Q(e)){case Vs:i(s,zt(e))}},js=e=>Fe(e,(s,i)=>"".concat(encodeURIComponent(i),"=").concat(encodeURIComponent(s))).join("&"),B=0,be=3,q=1,Ks=2,et=[];et[B]=(e,s,i,n,a)=>{x(e,B);const r=Ls(s,e,i.doc,i);n&&r===Tt&&!i.synced&&(i.synced=!0)},et[be]=(e,s,i,n,a)=>{x(e,q),H(e,st(i.awareness,Array.from(i.awareness.getStates().keys())))},et[q]=(e,s,i,n,a)=>{fs(i.awareness,Nt(s),i)},et[Ks]=(e,s,i,n,a)=>{Ws(s,i.doc,(r,c)=>zs(i,c))};const Bt=3e4,zs=(e,s)=>console.warn("Permission denied to access ".concat(e.url,".\n").concat(s)),ye=(e,s,i)=>{const n=Jt(s),a=O(),r=Q(n),c=e.messageHandlers[r];return c?c(a,n,e,i,r):console.error("Unable to compute message"),a},ke=e=>{if(e.shouldConnect&&e.ws===null){const s=new e._WS(e.url);s.binaryType="arraybuffer",e.ws=s,e.wsconnecting=!0,e.wsconnected=!1,e.synced=!1,s.onmessage=i=>{e.wsLastMessageReceived=K();const n=ye(e,new Uint8Array(i.data),!0);ee(n)>1&&s.send(S(n))},s.onerror=i=>{e.emit("connection-error",[i,e])},s.onclose=i=>{e.emit("connection-close",[i,e]),e.ws=null,e.wsconnecting=!1,e.wsconnected?(e.wsconnected=!1,e.synced=!1,$t(e.awareness,Array.from(e.awareness.getStates().keys()).filter(n=>n!==e.doc.clientID),e),e.emit("status",[{status:"disconnected"}])):e.wsUnsuccessfulReconnects++,setTimeout(ke,Be(He(2,e.wsUnsuccessfulReconnects)*100,e.maxBackoffTime),e)},s.onopen=()=>{e.wsLastMessageReceived=K(),e.wsconnecting=!1,e.wsconnected=!0,e.wsUnsuccessfulReconnects=0,e.emit("status",[{status:"connected"}]);const i=O();if(x(i,B),kt(i,e.doc),s.send(S(i)),e.awareness.getLocalState()!==null){const n=O();x(n,q),H(n,st(e.awareness,[e.doc.clientID])),s.send(S(n))}},e.emit("status",[{status:"connecting"}])}},yt=(e,s)=>{const i=e.ws;e.wsconnected&&i&&i.readyState===i.OPEN&&i.send(s),e.bcconnected&&z(e.bcChannel,s,e)};class hn extends jt{constructor(s,i,n,{connect:a=!0,awareness:r=new _s(n),params:c={},WebSocketPolyfill:g=WebSocket,resyncInterval:f=-1,maxBackoffTime:D=2500,disableBc:b=!1}={}){for(super();s[s.length-1]==="/";)s=s.slice(0,s.length-1);this.serverUrl=s,this.bcChannel=s+"/"+i,this.maxBackoffTime=D,this.params=c,this.roomname=i,this.doc=n,this._WS=g,this.awareness=r,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.disableBc=b,this.wsUnsuccessfulReconnects=0,this.messageHandlers=et.slice(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=a,this._resyncInterval=0,f>0&&(this._resyncInterval=setInterval(()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){const l=O();x(l,B),kt(l,n),this.ws.send(S(l))}},f)),this._bcSubscriber=(l,h)=>{if(h!==this){const m=ye(this,new Uint8Array(l),!1);ee(m)>1&&z(this.bcChannel,S(m),this)}},this._updateHandler=(l,h)=>{if(h!==this){const m=O();x(m,B),fe(m,l),yt(this,S(m))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:l,updated:h,removed:m},E)=>{const N=l.concat(h).concat(m),M=O();x(M,q),H(M,st(r,N)),yt(this,S(M))},this._exitHandler=()=>{$t(this.awareness,[n.clientID],"app closed")},Pt&&typeof ht<"u"&&ht.on("exit",this._exitHandler),r.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval(()=>{this.wsconnected&&Bt<K()-this.wsLastMessageReceived&&this.ws.close()},Bt/10),a&&this.connect()}get url(){const s=js(this.params);return this.serverUrl+"/"+this.roomname+(s.length===0?"":"?"+s)}get synced(){return this._synced}set synced(s){this._synced!==s&&(this._synced=s,this.emit("synced",[s]),this.emit("sync",[s]))}destroy(){this._resyncInterval!==0&&clearInterval(this._resyncInterval),clearInterval(this._checkInterval),this.disconnect(),Pt&&typeof ht<"u"&&ht.off("exit",this._exitHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){if(this.disableBc)return;this.bcconnected||(Bs(this.bcChannel,this._bcSubscriber),this.bcconnected=!0);const s=O();x(s,B),kt(s,this.doc),z(this.bcChannel,S(s),this);const i=O();x(i,B),ve(i,this.doc),z(this.bcChannel,S(i),this);const n=O();x(n,be),z(this.bcChannel,S(n),this);const a=O();x(a,q),H(a,st(this.awareness,[this.doc.clientID])),z(this.bcChannel,S(a),this)}disconnectBc(){const s=O();x(s,q),H(s,st(this.awareness,[this.doc.clientID],new Map)),yt(this,S(s)),this.bcconnected&&(Hs(this.bcChannel,this._bcSubscriber),this.bcconnected=!1)}disconnect(){this.shouldConnect=!1,this.disconnectBc(),this.ws!==null&&this.ws.close()}connect(){this.shouldConnect=!0,!this.wsconnected&&this.ws===null&&(ke(this),this.connectBc())}}function dn(e){const s=Ot(e);return Rt(s)}function un(e,s,i){const n=ue(s);te(e,n,i)}function pn(e,s){const i=ue(s),n=Ve(i),a=Xt(e);if(qs(n,a))return;const r=O();x(r,B);const c=Ot(e,n);return fe(r,c),S(r)}function Js(e){return e.map(s=>Rt(s)).filter(s=>s<"AQ")}function Qs(e){return e.map(s=>Rt(s)).findLast(s=>s>"AQ")||""}function qs(e,s){return e.length===s.length&&e.every((i,n)=>s[n]===i)}function Ys(e){return{all:e=e||new Map,on:function(s,i){var n=e.get(s);n?n.push(i):e.set(s,[i])},off:function(s,i){var n=e.get(s);n&&(i?n.splice(n.indexOf(i)>>>0,1):e.set(s,[]))},emit:function(s,i){var n=e.get(s);n&&n.slice().map(function(a){a(i)}),(n=e.get("*"))&&n.slice().map(function(a){a(s,i)})}}}class Zs extends Error{constructor(s="Close has already been called on the connection",...i){super(s,...i)}}var U,ut,xe;class Gs{constructor(s={}){u(this,ut);u(this,U);d(this,U,s)}open({fileId:s,baseVersionEtag:i}){return se.put(v(this,ut,xe).call(this,"session/".concat(s,"/create")),{fileId:s,baseVersionEtag:i,filePath:o(this,U).filePath,token:o(this,U).shareToken,guestName:o(this,U).guestName,forceRecreate:o(this,U).forceRecreate}).then(n=>new we(n,o(this,U)))}}U=new WeakMap,ut=new WeakSet,xe=function(s){const i=!!o(this,U).shareToken;return dt(s,i)};var it,At,Y,k,I,pt,nt,L,_,V,P,J;class we{constructor(s,i){u(this,_);u(this,it);u(this,At);u(this,Y);u(this,k);u(this,I);u(this,pt);u(this,nt);u(this,L);const{document:n,session:a,lock:r,readOnly:c,content:g,documentState:f}=s.data;d(this,k,n),d(this,I,a),d(this,pt,r),d(this,nt,c),d(this,it,g),d(this,Y,f),d(this,L,i),this.isPublic=!!i.shareToken,this.closed=!1}get session(){return o(this,I)}get document(){return o(this,k)}get docStateVersion(){return o(this,Y)?o(this,k).lastSavedVersion:0}get state(){return{document:{...o(this,k),readOnly:o(this,nt)},session:o(this,I),documentSource:o(this,it)||"",documentState:o(this,Y)}}get isClosed(){return this.closed}sync({version:s}){return v(this,_,P).call(this,v(this,_,J).call(this,"session/".concat(o(this,k).id,"/sync")),{...o(this,_,V),filePath:o(this,L).filePath,baseVersionEtag:o(this,k).baseVersionEtag,version:s})}save({version:s,autosaveContent:i,documentState:n,force:a,manualSave:r}){return v(this,_,P).call(this,v(this,_,J).call(this,"session/".concat(o(this,k).id,"/save")),{...o(this,_,V),filePath:o(this,L).filePath,baseVersionEtag:o(this,k).baseVersionEtag,version:s,autosaveContent:i,documentState:n,force:a,manualSave:r})}push({steps:s,version:i,awareness:n}){return v(this,_,P).call(this,v(this,_,J).call(this,"session/".concat(o(this,k).id,"/push")),{...o(this,_,V),filePath:o(this,L).filePath,baseVersionEtag:o(this,k).baseVersionEtag,steps:s,version:i,awareness:n})}update(s){return v(this,_,P).call(this,v(this,_,J).call(this,"session/".concat(o(this,k).id,"/session")),{...o(this,_,V),guestName:s}).then(({data:i})=>{d(this,I,i)})}uploadAttachment(s){const i=new FormData;i.append("file",s);const n=dt("attachment/upload")+"?documentId="+encodeURIComponent(o(this,k).id)+"&sessionId="+encodeURIComponent(o(this,I).id)+"&sessionToken="+encodeURIComponent(o(this,I).token)+"&shareToken="+encodeURIComponent(o(this,L).shareToken||"");return v(this,_,P).call(this,n,i,{headers:{"Content-Type":"multipart/form-data"}})}insertAttachmentFile(s){return v(this,_,P).call(this,dt("attachment/filepath"),{documentId:o(this,k).id,sessionId:o(this,I).id,sessionToken:o(this,I).token,filePath:s})}close(){return v(this,_,P).call(this,v(this,_,J).call(this,"session/".concat(o(this,k).id,"/close")),o(this,_,V)).then(()=>{this.closed=!0})}setBaseVersionEtag(s){o(this,k).baseVersionEtag=s}}it=new WeakMap,At=new WeakMap,Y=new WeakMap,k=new WeakMap,I=new WeakMap,pt=new WeakMap,nt=new WeakMap,L=new WeakMap,_=new WeakSet,V=function(){return{documentId:o(this,k).id,sessionId:o(this,I).id,sessionToken:o(this,I).token,token:o(this,L).shareToken}},P=function(...s){return this.closed?Promise.reject(new Zs):se.post(...s)},J=function(s){const i=!!o(this,_,V).token;return dt(s,i)};function dt(e,s=!1){const i=ie("/apps/text");return s?"".concat(i,"/public/").concat(e):"".concat(i,"/").concat(e)}const Ht=300,Xs=5e3,ti=5e3,ei=3e4,Ce=6e4,si=5,ii=Ce*1.5;var w,at,Z,T,W,G,j;class ni{constructor(s,i){u(this,w);u(this,at);u(this,Z);u(this,T);u(this,W);u(this,G);u(this,j);d(this,w,s),d(this,at,i),d(this,T,Ht),d(this,W,0),d(this,Z,0)}connect(){if(this.fetcher>0){console.error("Trying to connect, but already connected");return}d(this,j,!1),this.fetcher=setInterval(this._fetchSteps.bind(this),50),document.addEventListener("visibilitychange",this.visibilitychange.bind(this))}async _fetchSteps(){if(o(this,G))return;const s=Date.now();if(!(o(this,Z)>s-o(this,T))){if(!this.fetcher){console.error("No inverval but triggered");return}d(this,G,!0),y.debug("[PollingBackend] Fetching steps",o(this,w).version),await o(this,at).sync({version:o(this,w).version}).then(this._handleResponse.bind(this),this._handleError.bind(this)),d(this,Z,Date.now()),d(this,G,!1)}}_handleResponse({data:s}){const{document:i,sessions:n}=s;if(d(this,W,0),o(this,w).emit("change",{document:i,sessions:n}),o(this,w)._receiveSteps(s),s.steps.length===0){if(o(this,j)||d(this,j,!0),o(this,w).checkIdle())return;const a=Date.now()-ii,r=n.filter(c=>c.lastContact*1e3>a);o(this,w).isReadOnly?this.maximumReadOnlyTimer():r.length<2?this.maximumRefetchTimer():this.increaseRefetchTimer(),o(this,w).emit("stateChange",{initialLoading:!0});return}o(this,j)&&this.resetRefetchTimer()}_handleError(s){!s.response||s.code==="ECONNABORTED"?Lt(this,W)._++>=si?(y.error("[PollingBackend:fetchSteps] Network error when fetching steps, emitting CONNECTION_FAILED"),o(this,w).emit("error",{type:A.CONNECTION_FAILED,data:{}})):y.error("[PollingBackend:fetchSteps] Network error when fetching steps, retry ".concat(o(this,W))):s.response.status===409?(this._handleResponse(s.response),y.error("Conflict during file save, please resolve"),o(this,w).emit("error",{type:A.SAVE_COLLISSION,data:{outsideChange:s.response.data.outsideChange}})):s.response.status===412?(o(this,w).emit("error",{type:A.LOAD_ERROR,data:s.response}),this.disconnect()):s.response.status===403?(o(this,w).emit("error",{type:A.SOURCE_NOT_FOUND,data:{}}),this.disconnect()):s.response.status===404?(o(this,w).emit("error",{type:A.SOURCE_NOT_FOUND,data:{}}),this.disconnect()):s.response.status===503?(this.increaseRefetchTimer(),o(this,w).emit("error",{type:A.CONNECTION_FAILED,data:{}}),y.error("Failed to fetch steps due to unavailable service",{error:s})):(this.disconnect(),o(this,w).emit("error",{type:A.CONNECTION_FAILED,data:{}}),y.error("Failed to fetch steps due to other reason",{error:s}))}disconnect(){clearInterval(this.fetcher),this.fetcher=0,document.removeEventListener("visibilitychange",this.visibilitychange.bind(this))}resetRefetchTimer(){d(this,T,Ht)}increaseRefetchTimer(){d(this,T,Math.min(o(this,T)*2,Xs))}maximumRefetchTimer(){d(this,T,ti)}maximumReadOnlyTimer(){d(this,T,ei)}visibilitychange(){document.visibilityState==="hidden"?d(this,T,Ce):this.resetRefetchTimer()}}w=new WeakMap,at=new WeakMap,Z=new WeakMap,T=new WeakMap,W=new WeakMap,G=new WeakMap,j=new WeakMap;const ai=1440,oi=3e4,mn=60,ri=90,A={SAVE_COLLISSION:0,PUSH_FAILURE:1,LOAD_ERROR:2,CONNECTION_FAILED:3,SOURCE_NOT_FOUND:4,PUSH_FORBIDDEN:5};var F,p;class vn{constructor({baseVersionEtag:s,serialize:i,getDocumentState:n,...a}){u(this,F);u(this,p);return this._bus=Ys(),this.serialize=i,this.getDocumentState=n,this._api=new Gs(a),d(this,p,null),this.stepClientIDs=[],this.lastStepPush=Date.now(),this.version=null,this.baseVersionEtag=s,this.sending=!1,d(this,F,null),this.autosave=ne(this._autosave.bind(this),oi),this}get isReadOnly(){return o(this,p).state.document.readOnly}get guestName(){return o(this,p).session.guestName}async open({fileId:s,initialSession:i}){const n=i?Promise.resolve(new we({data:i},{})):this._api.open({fileId:s,baseVersionEtag:this.baseVersionEtag}).catch(a=>this._emitError(a));d(this,p,await n),o(this,p)&&(this.backend=new ni(this,o(this,p)),this.version=o(this,p).docStateVersion,this.baseVersionEtag=o(this,p).document.baseVersionEtag,this.emit("opened",{...o(this,p).state,version:this.version}),this.emit("loaded",{...o(this,p).state,version:this.version}))}startSync(){this.backend.connect()}syncUp(){this.backend.resetRefetchTimer()}_emitError(s){!s.response||s.code==="ECONNABORTED"?this.emit("error",{type:A.CONNECTION_FAILED,data:{}}):this.emit("error",{type:A.LOAD_ERROR,data:s.response})}updateSession(s){return o(this,p).isPublic?o(this,p).update(s).catch(i=>(y.error("Failed to update the session",{error:i}),Promise.reject(i))):Promise.reject(new Error)}sendSteps(s){if(!o(this,F))return new Promise((i,n)=>{d(this,F,setInterval(()=>{o(this,p)&&!this.sending&&this.sendStepsNow(s).then(i).catch(n)},200))})}sendStepsNow(s){this.sending=!0,clearInterval(o(this,F)),d(this,F,null);const i=s();return i.steps.length>0&&this.emit("stateChange",{dirty:!0}),o(this,p).push(i).then(n=>{this.sending=!1,this.emit("sync",{steps:[],document:o(this,p).document,version:this.version})}).catch(n=>{var c;const{response:a,code:r}=n;throw this.sending=!1,(!a||r==="ECONNABORTED")&&this.emit("error",{type:A.CONNECTION_FAILED,data:{}}),(a==null?void 0:a.status)===412?this.emit("error",{type:A.LOAD_ERROR,data:a}):(a==null?void 0:a.status)===403&&(i.document||(y.error("failed to write to document - not allowed"),this.emit("error",{type:A.PUSH_FORBIDDEN,data:{}})),((c=a.data.document)==null?void 0:c.currentVersion)===this.version&&(this.emit("error",{type:A.PUSH_FAILURE,data:{}}),OC.Notification.showTemporary("Changes could not be sent yet"))),new Error("Failed to apply steps. Retry!",{cause:n})})}_receiveSteps({steps:s,document:i,sessions:n}){const a=[...n.filter(r=>r.lastContact>Math.floor(Date.now()/1e3)-ri).filter(r=>r.lastAwarenessMessage).map(r=>({step:r.lastAwarenessMessage,clientId:r.clientId}))];for(let r=0;r<s.length;r++){const c=s[r].data;if(this.version<s[r].version&&(this.version=s[r].version),!Array.isArray(c)){y.error("Invalid step data, skipping step",{step:s[r]});continue}c.forEach(g=>{a.push({step:g,clientID:s[r].sessionId})})}this.lastStepPush=Date.now(),this.emit("sync",{steps:a,document:o(this,p).document,version:this.version})}checkIdle(){return(Date.now()-this.lastStepPush)/1e3/60>ai?(y.debug("[SyncService] Document is idle for ".concat(this.IDLE_TIMEOUT," minutes, suspending connection")),this.emit("idle"),!0):!1}_getContent(){return this.serialize()}async save({force:s=!1,manualSave:i=!0}={}){y.debug("[SyncService] saving",arguments[0]);try{const n=await o(this,p).save({version:this.version,autosaveContent:this._getContent(),documentState:this.getDocumentState(),force:s,manualSave:i});this.emit("stateChange",{dirty:!1}),o(this,p).document.lastSavedVersionTime=Date.now()/1e3,y.debug("[SyncService] saved",n);const{document:a,sessions:r}=n.data;this.emit("save",{document:a,sessions:r}),this.autosave.clear()}catch(n){throw y.error("Failed to save document.",{error:n}),n}}forceSave(){return this.save({force:!0})}_autosave(){return this.save({manualSave:!1}).catch(s=>{y.error("Failed to autosave document.",{error:s})})}async sendRemainingSteps(s){var r;if(s.length===0)return;let i=[];const n=Js(s),a=Qs(s);return(r=this.sendStepsNow(()=>{const c={steps:n,awareness:a,version:this.version};return i=[...s],y.debug("sending final steps ",c),c}))==null?void 0:r.then(()=>{s.splice(0,s.length,...s.filter(c=>!i.includes(c)))},c=>y.error(c))}async close(){var s;if(this.autosave.clear(),(s=this.backend)==null||s.disconnect(),!(!o(this,p)||o(this,p).isClosed))return o(this,p).close().catch(i=>{y.info("Failed to close connection.",{e:i})})}uploadAttachment(s){return o(this,p).uploadAttachment(s)}insertAttachmentFile(s){return o(this,p).insertAttachmentFile(s)}on(s,i){return this._bus.on(s,i),this}off(s,i){return this._bus.off(s,i),this}emit(s,i){this._bus.emit(s,i)}}F=new WeakMap,p=new WeakMap;var xt={exports:{}};(function(e,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;function i(b){"@babel/helpers - typeof";return i=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(l){return typeof l}:function(l){return l&&typeof Symbol=="function"&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l},i(b)}var n=47,a=46,r=function(b){var l=i(b);if(l!=="string")throw new TypeError("Expected a string, got a ".concat(l))},c=function(b,l){for(var h="",m=0,E=-1,N=0,M,$=0;$<=b.length;++$){if($<b.length)M=b.charCodeAt($);else{if(M===n)break;M=n}if(M===n){if(!(E===$-1||N===1))if(E!==$-1&&N===2){if(h.length<2||m!==2||h.charCodeAt(h.length-1)!==a||h.charCodeAt(h.length-2)!==a){if(h.length>2){var _t=h.lastIndexOf("/");if(_t!==h.length-1){_t===-1?(h="",m=0):(h=h.slice(0,_t),m=h.length-1-h.lastIndexOf("/")),E=$,N=0;continue}}else if(h.length===2||h.length===1){h="",m=0,E=$,N=0;continue}}l&&(h.length>0?h+="/..":h="..",m=2)}else h.length>0?h+="/"+b.slice(E+1,$):h=b.slice(E+1,$),m=$-E-1;E=$,N=0}else M===a&&N!==-1?++N:N=-1}return h},g=function(b){try{return decodeURIComponent(b)}catch{return b}},f=function(b){r(b);var l=b;if(l.length===0)return".";var h=l.charCodeAt(0)===n,m=l.charCodeAt(l.length-1)===n;return l=g(l),l=c(l,!h),l.length===0&&!h&&(l="."),l.length>0&&m&&(l+="/"),h?"/"+l:l},D=f;s.default=D,e.exports=s.default})(xt,xt.exports);var ci=xt.exports;const li=ts(ci),hi=e=>ae.dispatch("text/setAttachmentList",e),Vt=ae.getters["text/findAttachment"];var ot,X,tt,rt,ct,lt,C,wt,Ct,Et,Ee,St;class _n{constructor({session:s,user:i,shareToken:n,currentDirectory:a,fileId:r}){u(this,C);u(this,ot);u(this,X);u(this,tt);u(this,rt);u(this,ct);u(this,lt);d(this,ot,s),d(this,X,i),d(this,tt,n),d(this,rt,a),d(this,ct,r!=null?r:s.documentId),d(this,lt,v(this,C,wt).call(this))}async resolve(s,i=!0){let n;const a=/^\.attachments\.\d+\//;if(s.match(a)){const r=decodeURIComponent(s.replace(a,"").split("?")[0]);if(await o(this,lt),n=Vt(r),i&&!n&&(await v(this,C,wt).call(this),n=Vt(r)),n)return n}return di(s)?{isImage:!0,name:v(this,C,Ct).call(this,s),previewUrl:s,fullUrl:s}:{isImage:!0,name:v(this,C,Ct).call(this,s),previewUrl:v(this,C,Et).call(this,s),fullUrl:v(this,C,Et).call(this,s)}}}ot=new WeakMap,X=new WeakMap,tt=new WeakMap,rt=new WeakMap,ct=new WeakMap,lt=new WeakMap,C=new WeakSet,wt=async function(){return hi({documentId:o(this,ct),session:o(this,ot),shareToken:o(this,tt)})},Ct=function(s){return s.split("/").pop()},Et=function(s){if(o(this,X)){const r=o(this,X).uid,c=v(this,C,St).call(this,s).split("/").map(encodeURIComponent).join("/");return Xe("dav/files/".concat(r).concat(c))}const i=v(this,C,St).call(this,s).split("/"),n=i.pop(),a=i.join("/");return ie("/s/{token}/download?path={dirname}&files={basename}",{token:o(this,tt),basename:n,dirname:a})},Ee=function(s){return decodeURI(s.split("?")[0])},St=function(s){const i=[o(this,rt),v(this,C,Ee).call(this,s)].join("/");return li(i)};function di(e){return e.startsWith("http://")||e.startsWith("https://")||e.startsWith("data:")}const ui=mt({name:"NcActionButton",components:{NextcloudVueNcActionButton:Mt,Help:We}});var pi=function(){var e=this,s=e._self._c;return e._self._setupProxy,s("NextcloudVueNcActionButton",e._g({attrs:{"close-after-click":"","data-text-action-entry":"formatting-help"},scopedSlots:e._u([{key:"icon",fn:function(){return[s("Help")]},proxy:!0}])},e.$listeners),[e._v(" "+e._s(e.t("text","Formatting help"))+" ")])},mi=[],vi=R(ui,pi,mi,!1,null,null,null,null);const _i=vi.exports,fi=mt({name:"CharacterCount",components:{AlphabeticalVariant:je,NcActionText:ss},mixins:[vt],props:{visible:Boolean},data:()=>({wordCount:0,charCount:0}),computed:{countString(){return"".concat(Ft("text","%n word","%n words",this.wordCount),", ").concat(Ft("text","%n char","%n chars",this.charCount))}},watch:{visible:"refresh"},created(){this.refresh()},methods:{refresh(){this.wordCount=this.$editor.storage.characterCount.words(),this.charCount=this.$editor.storage.characterCount.characters()}}});var gi=function(){var e=this,s=e._self._c;return e._self._setupProxy,s("NcActionText",{attrs:{"data-text-action-entry":"character-count"},scopedSlots:e._u([{key:"icon",fn:function(){return[s("AlphabeticalVariant")]},proxy:!0},{key:"default",fn:function(){return[e._v(" "+e._s(e.countString)+" ")]},proxy:!0}])})},bi=[],yi=R(fi,gi,bi,!1,null,null,null,null);const ki=yi.exports;function xi(){var e;return((e=navigator==null?void 0:navigator.userAgentData)==null?void 0:e.mobile)!==void 0?navigator.userAgentData.mobile:[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/playbook/i,/silk/i,/BlackBerry/i,/Windows Phone/i].some(s=>navigator.userAgent.match(s))}const wi={name:"HelpModal",components:{NcDialog:is},data(){return{formatted:{bold:!0,italic:!0,strikethrough:!0,heading1:!0,heading6:!0,unorderdList:!0,orderedList:!0,checkList:!0,blockQuote:!0,codeBlock:!0}}},computed:{isFormatted(){return e=>this.formatted[e]},isMobileCached(){return this.isMobilePlatform()}},methods:{toggleFormatted(e){this.formatted[e]=!this.formatted[e]},isMobilePlatform:xi}};var Ci=function(){var e=this,s=e._self._c;return s("NcDialog",{attrs:{size:"normal","data-text-el":"formatting-help",name:e.t("text","Formatting and shortcuts"),"close-on-click-outside":!0},on:{closing:function(i){return e.$emit("close")}}},[s("h2",[e._v(e._s(e.t("text","Formatting and shortcuts")))]),s("p",[e._v(e._s(e.t("text","Speed up your writing with simple shortcuts.")))]),e.isMobileCached?s("p",[e._v(" "+e._s(e.t("text","Just type the Markdown syntax from below."))+" ")]):s("p",[e._v(" "+e._s(e.t("text","Just type the Markdown syntax or use keyboard shortcuts from below."))+" ")]),s("table",[s("thead",[s("tr",[s("th",[e._v(e._s(e.t("text","Style")))]),s("th",[e._v(e._s(e.t("text","Syntax")))]),e.isMobileCached?e._e():s("th",[e._v(" "+e._s(e.t("text","Keyboard shortcuts"))+" ")])])]),s("tbody",[s("tr",[s("td",[e._v(e._s(e.t("text","New paragraph")))]),s("td",[s("kbd",[e._v(e._s(e.t("text","Enter")))])]),e.isMobileCached?e._e():s("td")]),s("tr",[s("td",[e._v(e._s(e.t("text","Hard line break")))]),s("td",[s("kbd",[e._v(e._s(e.t("text","Enter")))]),e._v(" "+e._s(e.t("text","followed by"))+" "),s("kbd",[e._v(e._s(e.t("text","Backspace")))])]),e.isMobileCached?e._e():s("td",[s("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),s("kbd",[e._v(e._s(e.t("text","Enter")))])])]),s("tr",[s("td",[e._v(e._s(e.t("text","Bold")))]),s("td",[s("code",[e._v("**"+e._s(e.t("text","Bold text"))+"**")])]),e.isMobileCached?e._e():s("td",[s("kbd",[e._v(e._s(e.t("text","Ctrl")))]),e._v(" + "),s("kbd",[e._v("B")])])]),s("tr",[s("td",[e._v(e._s(e.t("text","Italic")))]),s("td",[s("code",[e._v("*"+e._s(e.t("text","Italicized text"))+"*")])]),e.isMobileCached?e._e():s("td",[s("kbd",[e._v(e._s(e.t("text","Ctrl")))]),e._v(" + "),s("kbd",[e._v("I")])])]),s("tr",[s("td",[e._v(e._s(e.t("text","Strikethrough")))]),s("td",[s("code",[e._v("~~"+e._s(e.t("text","Mistaken text"))+"~~")])]),e.isMobileCached?e._e():s("td",[s("kbd",[e._v(e._s(e.t("text","Ctrl")))]),e._v(" + "),s("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),s("kbd",[e._v("S")])])]),s("tr",[s("td",[e._v(e._s(e.t("text","Underline")))]),s("td",[s("code",[e._v("__"+e._s(e.t("text","Underlined text"))+"__")])]),e.isMobileCached?e._e():s("td",[s("kbd",[e._v(e._s(e.t("text","Ctrl")))]),e._v(" + "),s("kbd",[e._v("U")])])]),s("tr",[s("td",{staticClass:"ellipsis_top"},[e._v(" "+e._s(e.t("text","Heading 1"))+" ")]),s("td",{staticClass:"ellipsis_top"},[s("code",[e._v("# "+e._s(e.t("text","Heading level 1")))])]),e.isMobileCached?e._e():s("td",{staticClass:"ellipsis_top"},[s("kbd",[e._v(e._s(e.t("text","Ctrl")))]),e._v(" + "),s("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),s("kbd",[e._v("1")])])]),s("tr",[s("td",{staticClass:"noborder ellipsis"},[e._v(" … ")]),s("td",{staticClass:"noborder ellipsis"},[e._v(" … ")]),e.isMobileCached?e._e():s("td",{staticClass:"ellipsis noborder"},[e._v(" … ")])]),s("tr",[s("td",{staticClass:"noborder ellipsis_bottom"},[e._v(" "+e._s(e.t("text","Heading 6"))+" ")]),s("td",{staticClass:"noborder ellipsis_bottom"},[s("code",[e._v("###### "+e._s(e.t("text","Heading level 6")))])]),e.isMobileCached?e._e():s("td",{staticClass:"noborder ellipsis_bottom"},[s("kbd",[e._v(e._s(e.t("text","Ctrl")))]),e._v(" + "),s("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),s("kbd",[e._v("6")])])]),s("tr",[s("td",[e._v(e._s(e.t("text","Unordered list")))]),s("td",[s("code",[e._v("* "+e._s(e.t("text","An item")))])]),e.isMobileCached?e._e():s("td",[s("kbd",[e._v(e._s(e.t("text","Ctrl")))]),e._v(" + "),s("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),s("kbd",[e._v("8")])])]),s("tr",[s("td",[e._v(e._s(e.t("text","Ordered list")))]),s("td",[s("code",[e._v("1. "+e._s(e.t("text","First item")))])]),e.isMobileCached?e._e():s("td",[s("kbd",[e._v(e._s(e.t("text","Ctrl")))]),e._v(" + "),s("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),s("kbd",[e._v("7")])])]),s("tr",[s("td",[e._v(e._s(e.t("text","Checklist")))]),s("td",[s("code",[e._v("* [] "+e._s(e.t("text","To-Do item")))])]),e.isMobileCached?e._e():s("td")]),s("tr",[s("td",[e._v(e._s(e.t("text","Blockquote")))]),s("td",[s("code",[e._v("> "+e._s(e.t("text","Quoted text")))])]),e.isMobileCached?e._e():s("td",[s("kbd",[e._v(e._s(e.t("text","Ctrl")))]),e._v(" + "),s("kbd",[e._v(">")])])]),s("tr",[s("td",[e._v(e._s(e.t("text","Code block")))]),s("td",[s("code",[e._v("``` "+e._s(e.t("text","Some code")))])]),e.isMobileCached?e._e():s("td")]),s("tr",[s("td",[e._v(e._s(e.t("text","Link")))]),s("td",[s("code",[e._v("[Title](https://example.org)")])]),e.isMobileCached?e._e():s("td")]),s("tr",[s("td",[e._v(e._s(e.t("text","Insert emoji")))]),s("td",[s("code",[e._v(":"+e._s(e.t("text","emoji")))])]),e.isMobileCached?e._e():s("td")]),s("tr",[s("td",[e._v(e._s(e.t("text","Mention someone")))]),s("td",[s("code",[e._v("@"+e._s(e.t("text","name")))])]),e.isMobileCached?e._e():s("td")]),s("tr",[s("td",[e._v(e._s(e.t("text","Smart picker")))]),s("td",[s("code",[e._v("/"+e._s(e.t("text","something")))])]),e.isMobileCached?e._e():s("td")])])]),s("table",{attrs:{vif:"!isMobileCached"}},[s("thead",[s("tr",[s("th",[e._v(e._s(e.t("text","Action")))]),s("th",[e._v(e._s(e.t("text","Keyboard shortcuts")))])])]),s("tbody",[s("tr",[s("td",[e._v(e._s(e.t("text","Undo")))]),s("td",[s("kbd",[e._v(e._s(e.t("text","Ctrl")))]),e._v(" + "),s("kbd",[e._v("Z")])])]),s("tr",[s("td",[e._v(e._s(e.t("text","Redo")))]),s("td",[s("kbd",[e._v(e._s(e.t("text","Ctrl")))]),e._v(" + "),s("kbd",[e._v("Y")])])]),s("tr",[s("td",[e._v(e._s(e.t("text","Toggle outline")))]),s("td",[s("kbd",[e._v(e._s(e.t("text","Ctrl")))]),e._v(" + "),s("kbd",[e._v(e._s(e.t("text","Alt")))]),e._v(" + "),s("kbd",[e._v("H")])])])])])])},Ei=[],Si=R(wi,Ci,Ei,!1,null,"bdf077d8",null,null);const Ai=Si.exports,Ii={name:"MenuBar",components:{ActionFormattingHelp:_i,ActionList:le,ActionSingle:he,HelpModal:Ai,NcActionSeparator:Qt,NcActionButton:Mt,CharacterCount:ki,TranslateVariant:Ke},extends:de,mixins:[vt,ls,re,ce],provide(){const e={};return Object.defineProperties(e,{[Qe]:{get:()=>this.randomID}}),e},props:{isHidden:{type:Boolean,default:!1}},setup(){const e=Se(),{width:s}=os(e);return{menubar:e,width:s}},data(){return{entries:[...ze],randomID:"menu-bar-".concat(Math.ceil(Math.random()*1e4+500).toString(16)),displayHelp:!1,isReady:!1,canTranslate:cs("text","translation_languages",[]).length>0,resize:null}},computed:{visibleEntries(){return this.entries.filter(({priority:e})=>e===void 0||e<=this.iconsLimit)},hiddenEntries(){const e=this.entries.filter(({priority:i})=>i!==void 0&&i>this.iconsLimit),s=e.reduce((i,n,a)=>{var c;const r=(c=n.children)!=null?c:[n];if(r.length>1){const g=i.length&&!i.at(-1).isSeparator?[{key:"separator-before-".concat(n.id),isSeparator:!0}]:[],f=a!==e.length-1?[{key:"separator-after-".concat(n.id),isSeparator:!0}]:[];return[...i,...g,...r,...f]}return[...i,...r]},[]);return{key:"remain",label:this.t("text","Remaining actions"),icon:Je,children:s}},iconWidth(){var s;const e=(s=this.menubar&&getComputedStyle(this.menubar))==null?void 0:s.getPropertyValue("--default-clickable-area");return parseInt(e)||34},iconsLimit(){const e=this.width-4,s=this.$isMobile?this.iconWidth:this.iconWidth+2;return Math.floor(e/s)-1}},mounted(){this.$nextTick(()=>{this.isReady=!0,this.$emit("update:loaded",!0)})},methods:{showHelp(){this.displayHelp=!0},hideHelp(){this.displayHelp=!1},showTranslate(){const{from:e,to:s}=this.$editor.view.state.selection;let i=this.$editor.view.state.doc.textBetween(e,s," ");i.trim().length||(this.$editor.commands.selectAll(),i=this.$editor.view.state.doc.textContent),console.debug("translation click",this.$editor.view.state.selection,i),oe("text:translate-modal:show",{content:i})}}};var Oi=function(){var e=this,s=e._self._c;return s("div",{staticClass:"text-menubar",class:{"text-menubar--ready":e.isReady,"text-menubar--hide":e.isHidden,"text-menubar--is-workspace":e.$isRichWorkspace},attrs:{id:e.randomID,"data-text-el":"menubar",role:"region","aria-label":e.t("text","Editor actions")}},[e.displayHelp?s("HelpModal",{on:{close:e.hideHelp}}):e._e(),e.$isRichEditor?s("div",{ref:"menubar",staticClass:"text-menubar__entries",attrs:{role:"toolbar","aria-label":e.t("text","Formatting menu bar")},on:{keydown:[function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"left",37,i.key,["Left","ArrowLeft"])||"button"in i&&i.button!==0?null:(i.stopPropagation(),e.handleToolbarNavigation.apply(null,arguments))},function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"right",39,i.key,["Right","ArrowRight"])||"button"in i&&i.button!==2?null:(i.stopPropagation(),e.handleToolbarNavigation.apply(null,arguments))}]}},[e._l(e.visibleEntries,function(i,n){return s(i.component?i.component:i.children?"ActionList":"ActionSingle",{key:i.key,ref:"menuEntries",refInFor:!0,tag:"component",attrs:{"action-entry":i,"can-be-focussed":e.activeMenuEntry===n},on:{disabled:function(a){return e.disableMenuEntry(i.key,a)},click:function(a){e.activeMenuEntry=n}}})}),s("ActionList",{ref:"remainingEntries",attrs:{"action-entry":e.hiddenEntries,"can-be-focussed":e.activeMenuEntry===e.visibleEntries.length,"force-enabled":!0},on:{click:function(i){e.activeMenuEntry="remain"}},scopedSlots:e._u([{key:"lastAction",fn:function({visible:i}){return[e.canTranslate?s("NcActionButton",{attrs:{"close-after-click":""},on:{click:e.showTranslate},scopedSlots:e._u([{key:"icon",fn:function(){return[s("TranslateVariant")]},proxy:!0}],null,!0)},[e._v(" "+e._s(e.t("text","Translate"))+" ")]):e._e(),s("ActionFormattingHelp",{on:{click:e.showHelp}}),s("NcActionSeparator"),s("CharacterCount",e._b({},"CharacterCount",{visible:i},!1))]}}],null,!1,2316723924)})],2):e._e(),s("div",{staticClass:"text-menubar__slot"},[e._t("default")],2)],1)},Ni=[],Mi=R(Ii,Oi,Ni,!1,null,"adb1028b",null,null);const fn=Mi.exports,$i={name:"ContentContainer",components:{EditorContent:qe,EditorOutline:Ye},mixins:[vt,Yt],computed:{showOutline(){return this.$outlineState.visible}}};var Ri=function(){var e=this,s=e._self._c;return s("div",{staticClass:"content-wrapper text-editor__content-wrapper",class:{"--show-outline":e.showOutline},attrs:{"data-text-el":"editor-content-wrapper"}},[e.showOutline?s("div",{staticClass:"text-editor__content-wrapper__left"},[s("EditorOutline")],1):e._e(),e._t("default"),s("EditorContent",{staticClass:"editor__content text-editor__content",attrs:{role:"document",editor:e.$editor}}),s("div",{staticClass:"text-editor__content-wrapper__right"})],2)},Ti=[],Di=R($i,Ri,Ti,!1,null,"a3b97a85",null,null);const gn=Di.exports,Wt=e=>e.split("/").slice(0,-1).join("/"),Ui={name:"MediaHandler",mixins:[vt,hs,ds],provide(){const e={};return Object.defineProperties(e,{[us]:{get:()=>this.showAttachmentPrompt},[ps]:{get:()=>this.chooseLocalFile},[ms]:{get:()=>this.state}}),e},data(){return{lastFilePath:null,draggedOver:!1,state:{isUploadingAttachments:!1}}},computed:{initialFilePath(){var e,s,i;return(i=this.lastFilePath)!=null?i:Wt((s=(e=this.$file)==null?void 0:e.relativePath)!=null?s:"/")}},methods:{setDraggedOver(e){this.draggedOver=e},onPaste(e){this.uploadAttachmentFiles(e.detail.files)},onEditorDrop(e){this.uploadAttachmentFiles(e.detail.files,e.detail.position),this.draggedOver=!1},onAttachmentUploadFilePicked(e){this.uploadAttachmentFiles(e.target.files),e.target.value=""},chooseLocalFile(){this.$refs.attachmentFileInput.click()},async uploadAttachmentFiles(e,s=null){if(!e)return;this.state.isUploadingAttachments=!0;const i=[...e].map(n=>this.uploadAttachmentFile(n,s));return Promise.all(i).catch(n=>{var a,r;y.error("Uploading multiple images failed",{error:n}),gt(((r=(a=n==null?void 0:n.response)==null?void 0:a.data)==null?void 0:r.error)||n.message)}).then(()=>{this.state.isUploadingAttachments=!1})},async uploadAttachmentFile(e,s=null){return this.state.isUploadingAttachments=!0,this.$syncService.uploadAttachment(e).then(i=>{var n,a,r;this.insertAttachment((n=i.data)==null?void 0:n.name,(a=i.data)==null?void 0:a.id,e.type,s,(r=i.data)==null?void 0:r.dirname)}).catch(i=>{var n,a;y.error("Uploading image failed",{error:i}),gt((a=(n=i==null?void 0:i.response)==null?void 0:n.data)==null?void 0:a.error)}).then(()=>{this.state.isUploadingAttachments=!1})},showAttachmentPrompt(){rs()&&OC.dialogs.filepicker(t("text","Insert an attachment"),e=>{this.insertFromPath(e)},!1,[],!0,void 0,this.initialFilePath)},insertFromPath(e){return this.lastFilePath=Wt(e),this.state.isUploadingAttachments=!0,this.$syncService.insertAttachmentFile(e).then(s=>{var i,n,a,r;this.insertAttachment((i=s.data)==null?void 0:i.name,(n=s.data)==null?void 0:n.id,(a=s.data)==null?void 0:a.mimetype,null,(r=s.data)==null?void 0:r.dirname)}).catch(s=>{var i,n;y.error("Failed to insert image path",{error:s}),gt(((n=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:n.error)||s.message)}).then(()=>{this.state.isUploadingAttachments=!1})},insertAttachment(e,s,i,n=null,a=""){const r=a+"/"+encodeURIComponent(e).replace(/[!'()*]/g,f=>"%"+f.charCodeAt(0).toString(16).toUpperCase()),c=e.replaceAll(/[[\]]/g,"");(n?this.$editor.chain().focus(n):this.$editor.chain()).setImage({src:r,alt:c}).run();const g=this.$editor.view.state.selection;g.empty||this.$editor.commands.focus(g.to),this.$editor.commands.scrollIntoView(),oe("text:image-node:add",null)}}};var Li=function(){var e=this,s=e._self._c;return s("div",{staticClass:"editor editor-media-handler",class:{draggedOver:e.draggedOver},attrs:{"data-text-el":"editor-media-handler"},on:{"image-paste":e.onPaste,dragover:function(i){return i.preventDefault(),i.stopPropagation(),e.setDraggedOver(!0)},dragleave:function(i){return i.preventDefault(),i.stopPropagation(),e.setDraggedOver(!1)},"file-drop":e.onEditorDrop}},[s("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"attachmentFileInput",attrs:{"data-text-el":"attachment-file-input",type:"file",accept:"*/*",multiple:""},on:{change:e.onAttachmentUploadFilePicked}}),e._t("default")],2)},Pi=[],Fi=R(Ui,Li,Pi,!1,null,null,null,null);const Bi=Fi.exports,Hi={name:"MainContainer",components:{MediaHandler:Bi},mixins:[vs]};var Vi=function(){var e=this,s=e._self._c;return s("div",{staticClass:"editor"},[e.$editorUpload?s("MediaHandler",{staticClass:"text-editor__main"},[e._t("default")],2):e._t("default")],2)},Wi=[],ji=R(Hi,Vi,Wi,!1,null,"f2d30048",null,null);const bn=ji.exports,Ki={name:"Wrapper",mixins:[qt,re,ce],provide(){const e={};return Object.defineProperties(e,{[Ze]:{get:()=>this.outline},[Ge]:{get:()=>({toggle:this.outlineToggle})}}),e},props:{syncError:{type:Object,default:null},hasConnectionIssue:{type:Boolean,default:!1},contentLoaded:{type:Boolean,default:!0},showOutlineOutside:{type:Boolean,default:!1}},data:()=>({outline:{visible:!1,enable:!1}}),computed:{...es({viewWidth:e=>e.text.viewWidth}),hasSyncCollission(){return this.syncError&&this.syncError.type===A.SAVE_COLLISSION},showOutline(){return this.isAbleToShowOutline?this.outline.visible:!1},isAbleToShowOutline(){return this.$isRichWorkspace?!1:this.viewWidth>1265}},watch:{showOutlineOutside(){this.outline.visible=this.showOutlineOutside}},mounted(){this.outline.enable=this.isAbleToShowOutline,this.$watch(()=>this.isAbleToShowOutline,e=>{Object.assign(this.outline,{enable:e})}),document.addEventListener("keydown",this.handleKeyDown)},beforeDestroy(){document.removeEventListener("keydown",this.handleKeyDown)},methods:{outlineToggle(){this.outline.visible=!this.outline.visible,this.$emit("outline-toggled",this.outline.visible)},handleKeyDown(e){e.ctrlKey&&e.altKey&&e.key==="h"&&this.outlineToggle()}}};var zi=function(){var e=this,s=e._self._c;return s("div",{staticClass:"text-editor__wrapper",class:{"has-conflicts":e.hasSyncCollission,"is-rich-workspace":e.$isRichWorkspace,"is-rich-editor":e.$isRichEditor}},[e._t("default")],2)},Ji=[],Qi=R(Ki,zi,Ji,!1,null,"b579724b",null,null);const yn=Qi.exports;export{_n as A,gn as C,A as E,ai as I,bn as M,ln as R,vn as S,hn as W,Qs as a,yn as b,fn as c,ue as d,dn as e,un as f,Js as g,pn as h,ri as i,mn as j};
