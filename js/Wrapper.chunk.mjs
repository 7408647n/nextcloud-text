/*! third party licenses: js/vendor.LICENSE.txt */
var q=e=>{throw TypeError(e)};var T=(e,i,n)=>i.has(e)||q("Cannot "+n);var f=(e,i,n)=>(T(e,i,"read from private field"),n?n.call(e):i.get(e)),w=(e,i,n)=>i.has(e)?q("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(e):i.set(e,n),g=(e,i,n,s)=>(T(e,i,"write to private field"),s?s.call(e,n):i.set(e,n),n),p=(e,i,n)=>(T(e,i,"access private method"),n);import{d as N,r as _t}from"./vue.runtime.esm.chunk.mjs";import{ad as W,a7 as G,ae as X,af as tt,ag as pt,ah as ft,ai as mt,aj as vt,ak as yt,al as bt,am as wt,an as gt,ao as xt,ap as kt,aq as Ct,ar as Et,as as At,at as Mt}from"./RichText.chunk.mjs";import{n as _}from"./_plugin-vue2_normalizer.chunk.mjs";import{d as $t,U as St,_ as Ot}from"./index.chunk3.mjs";import{a as j,c as z,g as Nt}from"./emoji-picker.chunk.mjs";import{d as It,s as et,m as Pt}from"./index.chunk.mjs";import{N as K,f as Tt,g as Bt,d as J,h as Ft}from"./NcUserBubble-DMjZyrGY.chunk.mjs";import{b as Ut,N as Ht,u as Lt,s as B}from"./NcNoteCard-BLPU1den.chunk.mjs";import{a as Dt,e as it,l as Rt}from"./modulepreload-polyfill.chunk.mjs";import{l as nt}from"./index.chunk4.mjs";import{u as I,e as Wt,c as st,g as ot,h as jt,d as Kt,A as Vt,m as qt,n as zt,o as Jt}from"./MediaHandler.provider.chunk.mjs";import{l as F}from"./logger.chunk.mjs";const Qt={name:"NcActionButton",components:{NextcloudVueNcActionButton:K},extends:W,mounted(){this.$editor.on("transaction",()=>this.updateState())},methods:{runAction(){var i;const{actionEntry:e}=this;e.click?e.click(this):(i=e.action(this.$editor.chain().focus()))==null||i.run(),this.$nextTick(()=>{this.$emit("trigged",{...e})})}}};var Yt=function(){var e=this,i=e._self._c;return i("NextcloudVueNcActionButton",e._g({staticClass:"entry-single-action entry-action entry-action-item",class:e.state.class,attrs:{disabled:e.state.disabled,"aria-keyshortcuts":e.keyshortcuts||void 0,"data-text-action-entry":e.actionEntry.key,type:e.state.type,"model-value":e.state.type!=="button"?e.state.active:void 0,"close-after-click":""},on:{click:e.runAction},scopedSlots:e._u([{key:"icon",fn:function(){return[i(e.icon,{tag:"component"})]},proxy:!0}])},e.$listeners),[e._v(" "+e._s(e.label)+" ")])},Zt=[],Gt=_(Qt,Yt,Zt,!1,null,null,null,null);const Xt=Gt.exports,te={name:"ActionList",components:{NcActions:Ut,NcActionSeparator:G,ActionListItem:Xt},extends:W,mixins:[X,tt,pt],props:{forceEnabled:{type:Boolean,default:!1}},data:()=>({visible:!1,hasEnabledChild:!0}),computed:{currentChild(){const{state:e,$editor:i,actionEntry:{children:n}}=this;return e.active?n.find(s=>ft(s,i)):null},icon(){return this.currentChild?this.currentChild.icon:this.actionEntry.icon},iconKey(){return"".concat(this.actionEntry.key,"/").concat(this.activeKey)},activeKey(){var e;return(e=this.currentChild)==null?void 0:e.key},children(){return this.actionEntry.children.filter(({visible:e})=>e===void 0?!0:typeof e=="function"?e(this):e)},labelWithSelected(){return this.currentChild?t("text",'{menuItemName}, "{selectedSubMenuItemName}" is selected',{menuItemName:this.actionEntry.label,selectedSubMenuItemName:this.currentChild.label}):this.actionEntry.label},isEnabled(){return this.forceEnabled||this.hasEnabledChild}},mounted(){this.$_updateState=It(this.checkStateOfChildren.bind(this),50),this.$editor.on("update",this.$_updateState),this.$editor.on("selectionUpdate",this.$_updateState)},beforeDestroy(){this.$editor.off("update",this.$_updateState),this.$editor.off("selectionUpdate",this.$_updateState)},methods:{onOpenChange(e){this.visible=e},runAction(){},onTrigger(e){e!=null&&e.click||(this.$editor.chain().focus().run(),this.$emit("trigged",e))},checkStateOfChildren(){this.hasEnabledChild=this.children.some(e=>this.isChildEnabled(e))},isChildEnabled(e){return!e.isSeparator&&!mt(e,this.$editor).disabled}}};var ee=function(){var e=this,i=e._self._c;return i("NcActions",e._b({staticClass:"entry-list-action entry-action",attrs:{title:e.tooltip,container:e.menuIDSelector,"aria-label":e.labelWithSelected,type:e.state.active?"primary":"tertiary","force-menu":!0,"data-text-action-entry":e.actionEntry.key,"data-text-action-active":e.activeKey,disabled:!e.isEnabled},on:{"update:open":e.onOpenChange},scopedSlots:e._u([{key:"icon",fn:function(){return[i(e.icon,{key:e.iconKey,tag:"component"})]},proxy:!0}])},"NcActions",e.state,!1),[e._l(e.children,function(n){var s;return[n.isSeparator?i("NcActionSeparator",{key:"child-".concat(n.key)}):i("ActionListItem",e._g({key:"child-".concat(n.key),attrs:{active:((s=e.currentChild)==null?void 0:s.key)===n.key,"is-item":"","action-entry":n},on:{trigged:e.onTrigger}},e.$listeners))]}),e._t("lastAction",null,null,{visible:e.visible})],2)},ie=[],ne=_(te,ee,ie,!1,null,null,null,null);const at=ne.exports,se={name:"ActionSingle",components:{NcButton:Ht},extends:W,props:{isItem:{type:Boolean,default:!1}},mounted(){this.$editor.on("transaction",()=>this.updateState())},methods:{runAction(){var i;const{actionEntry:e}=this;e.click?e.click(this):(i=e.action(this.$editor.chain().focus()))==null||i.run(),this.$nextTick(()=>{this.$emit("trigged",{...e})})}}};var oe=function(){var e=this,i=e._self._c;return i("NcButton",e._g({staticClass:"entry-single-action entry-action",class:e.state.class,attrs:{disabled:e.state.disabled,"aria-keyshortcuts":e.keyshortcuts||void 0,"data-text-action-entry":e.actionEntry.key,"aria-label":e.label,title:e.tooltip,type:"tertiary",pressed:e.state.type!=="button"?e.state.active:void 0},on:{click:e.runAction},scopedSlots:e._u([{key:"icon",fn:function(){return[i(e.icon,{tag:"component"})]},proxy:!0},e.actionEntry.forceLabel?{key:"default",fn:function(){return[e._v(" "+e._s(e.label)+" ")]},proxy:!0}:null],null,!0)},e.$listeners))},ae=[],re=_(se,oe,ae,!1,null,null,null,null);const rt=re.exports,lt=N({data(){return{activeMenuEntry:0,entries:[]}},computed:{visibleEntries(){return this.entries}},watch:{visibleEntries(){this.$nextTick(()=>{var e;(this.activeMenuEntry>this.visibleEntries.length||(e=this.visibleEntries[this.activeMenuEntry])!=null&&e.disabled)&&this.setNextMenuEntry()})}},methods:{disableMenuEntry(e,i){const n=this.visibleEntries.findIndex(({key:s})=>s===e);this.visibleEntries[n].disabled=i,i===!1&&this.activeMenuEntry===n&&this.$nextTick(()=>this.setNextMenuEntry())},setNextMenuEntry(){const e=this.visibleEntries.length+(this.$refs.remainingEntries?1:0);do this.activeMenuEntry=(this.activeMenuEntry+1)%e;while(this.activeMenuEntry<this.visibleEntries.length&&this.visibleEntries[this.activeMenuEntry].disabled)},setPreviousMenuEntry(){const e=this.visibleEntries.length+(this.$refs.remainingEntries?1:0);do{const i=this.activeMenuEntry-1;this.activeMenuEntry=(i%e+e)%e}while(this.activeMenuEntry<this.visibleEntries.length&&this.visibleEntries[this.activeMenuEntry].disabled)},handleToolbarNavigation(e){var i,n;e.key==="ArrowRight"?this.setNextMenuEntry():e.key==="ArrowLeft"&&this.setPreviousMenuEntry(),this.activeMenuEntry===this.visibleEntries.length?(n=(i=this.$refs.remainingEntries)==null?void 0:i.focusButton)==null||n.call(i):[...this.$refs.menuEntries].sort((s,o)=>this.visibleEntries.findIndex(({key:a})=>a===s.$vnode.data.key)-this.visibleEntries.findIndex(({key:a})=>a===o.$vnode.data.key))[this.activeMenuEntry].focusButton()}}}),le=N({name:"ReadonlyBar",components:{ActionList:at,ActionSingle:rt},extends:lt,data(){return{entries:vt}}});var de=function(){var e=this,i=e._self._c;return e._self._setupProxy,i("div",{staticClass:"text-readonly-bar",attrs:{"data-text-el":"readonly-bar"}},[i("div",{ref:"menubar",staticClass:"text-readonly-bar__entries",attrs:{role:"toolbar","aria-label":e.t("text","Editor actions")}},e._l(e.visibleEntries,function(n,s){return i(n.component?n.component:n.children?"ActionList":"ActionSingle",{key:n.key,ref:"menuEntries",refInFor:!0,tag:"component",attrs:{"action-entry":n,"can-be-focussed":e.activeMenuEntry===s},on:{disabled:function(o){return e.disableMenuEntry(n.key,o)}}})}),1),i("div",{staticClass:"text-menubar__slot"},[e._t("default")],2)])},ce=[],ue=_(le,de,ce,!1,null,"c35c5130",null,null);const gi=ue.exports;function he(e){return{all:e=e||new Map,on:function(i,n){var s=e.get(i);s?s.push(n):e.set(i,[n])},off:function(i,n){var s=e.get(i);s&&(n?s.splice(s.indexOf(n)>>>0,1):e.set(i,[]))},emit:function(i,n){var s=e.get(i);s&&s.slice().map(function(o){o(n)}),(s=e.get("*"))&&s.slice().map(function(o){o(i,n)})}}}var A={};const _e=j(Tt),pe=j($t),fe=j(Dt);var me=z&&z.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(A,"__esModule",{value:!0});var dt=A.listen=A.getSupportedTypes=void 0;const ct=_e,ve=me(pe),Q=fe;function ye(){const e=(0,ct.getCapabilities)();return e.notify_push?e.notify_push.type:[]}A.getSupportedTypes=ye;function be(e,i,n={}){return we(n),window._notify_push_listeners[e]||(window._notify_push_listeners[e]=[]),window._notify_push_listeners[e].push(i),window._notify_push_ws!==null&&typeof window._notify_push_ws=="object"?window._notify_push_ws.send("listen "+e):V(n),window._notify_push_available}dt=A.listen=be;function we(e={}){typeof window._notify_push_listeners>"u"&&(window._notify_push_listeners={},window._notify_push_ws=null,window._notify_push_online=!0,window._notify_push_available=!1,window._notify_push_error_count=0,(0,Q.subscribe)("networkOffline",()=>{window._notify_push_online=!1,window._notify_push_ws=null}),(0,Q.subscribe)("networkOnline",()=>{window._notify_push_error_count=0,window._notify_push_online=!0,V(e)}))}async function V(e={}){if(window._notify_push_ws)return!0;window._notify_push_ws=!0;const i=(0,ct.getCapabilities)();if(!i.notify_push)return window._notify_push_available=!1,window._notify_push_ws=null,!1;window._notify_push_available=!0;let n;return e.credentials||(n=(await ve.default.post(i.notify_push.endpoints.pre_auth)).data),window._notify_push_ws=new WebSocket(i.notify_push.endpoints.websocket),window._notify_push_ws.onopen=()=>{if(typeof window._notify_push_ws=="object"&&window._notify_push_ws){n?(window._notify_push_ws.send(""),window._notify_push_ws.send(n)):e.credentials&&(window._notify_push_ws.send(e.credentials.username),window._notify_push_ws.send(e.credentials.password));for(let s in window._notify_push_listeners)window._notify_push_ws.send("listen "+s)}},window._notify_push_ws.onmessage=s=>{if(s.data==="authenticated")window._notify_push_error_count=0;else{const o=s.data.indexOf(" ");let[a,u]=o>0?[s.data.slice(0,o),s.data.slice(o+1)]:[s.data,null];if(u&&(u=JSON.parse(u)),window._notify_push_listeners[a])for(let m of window._notify_push_listeners[a])m(a,u)}},window._notify_push_ws.onerror=window._notify_push_ws.onclose=()=>{window._notify_push_ws=null,window._notify_push_error_count+=1,setTimeout(()=>{window._notify_push_online&&V(e)},1e3*window._notify_push_error_count)},!0}if(!window._nc_text_notify){const e=nt("text","notify_push",!1)?dt("text_steps",(i,n)=>{var s;(s=window._nc_text_notify)==null||s.emit("notify_push",{messageType:i,messageBody:n})}):void 0;window._nc_text_notify=e?he():null}const xi=()=>window._nc_text_notify;var U={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;function n(c){"@babel/helpers - typeof";return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(l){return typeof l}:function(l){return l&&typeof Symbol=="function"&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l},n(c)}var s=47,o=46,a=function(c){var l=n(c);if(l!=="string")throw new TypeError("Expected a string, got a ".concat(l))},u=function(c,l){for(var r="",v=0,y=-1,b=0,E,h=0;h<=c.length;++h){if(h<c.length)E=c.charCodeAt(h);else{if(E===s)break;E=s}if(E===s){if(!(y===h-1||b===1))if(y!==h-1&&b===2){if(r.length<2||v!==2||r.charCodeAt(r.length-1)!==o||r.charCodeAt(r.length-2)!==o){if(r.length>2){var P=r.lastIndexOf("/");if(P!==r.length-1){P===-1?(r="",v=0):(r=r.slice(0,P),v=r.length-1-r.lastIndexOf("/")),y=h,b=0;continue}}else if(r.length===2||r.length===1){r="",v=0,y=h,b=0;continue}}l&&(r.length>0?r+="/..":r="..",v=2)}else r.length>0?r+="/"+c.slice(y+1,h):r=c.slice(y+1,h),v=h-y-1;y=h,b=0}else E===o&&b!==-1?++b:b=-1}return r},m=function(c){try{return decodeURIComponent(c)}catch{return c}},C=function(c){a(c);var l=c;if(l.length===0)return".";var r=l.charCodeAt(0)===s,v=l.charCodeAt(l.length-1)===s;return l=m(l),l=u(l,!r),l.length===0&&!r&&(l="."),l.length>0&&v&&(l+="/"),r?"/"+l:l},ht=C;i.default=ht,e.exports=i.default})(U,U.exports);var ge=U.exports;const xe=Nt(ge),ke=e=>et.dispatch("text/setAttachmentList",e),Y=et.getters["text/findAttachment"];var M,x,k,$,S,O,d,H,L,D,ut,R;class ki{constructor({session:i,user:n,shareToken:s,currentDirectory:o,fileId:a}){w(this,d);w(this,M);w(this,x);w(this,k);w(this,$);w(this,S);w(this,O);g(this,M,i),g(this,x,n),g(this,k,s),g(this,$,o),g(this,S,a!=null?a:i.documentId),g(this,O,p(this,d,H).call(this))}async resolve(i,n=!0){let s;const o=/^\.attachments\.\d+\//;if(i.match(o)){const a=decodeURIComponent(i.replace(o,"").split("?")[0]);if(await f(this,O),s=Y(a),n&&!s&&(await p(this,d,H).call(this),s=Y(a)),s)return s}return Ce(i)?{isImage:!0,name:p(this,d,L).call(this,i),previewUrl:i,fullUrl:i}:{isImage:!0,name:p(this,d,L).call(this,i),previewUrl:p(this,d,D).call(this,i),fullUrl:p(this,d,D).call(this,i)}}}M=new WeakMap,x=new WeakMap,k=new WeakMap,$=new WeakMap,S=new WeakMap,O=new WeakMap,d=new WeakSet,H=async function(){return ke({documentId:f(this,S),session:f(this,M),shareToken:f(this,k)})},L=function(i){return i.split("/").pop()},D=function(i){if(f(this,x)){const a=f(this,x).uid,u=p(this,d,R).call(this,i).split("/").map(encodeURIComponent).join("/");return St("dav/files/".concat(a).concat(u))}const n=p(this,d,R).call(this,i).split("/"),s=n.pop(),o=n.join("/");return Ot("/s/{token}/download?path={dirname}&files={basename}",{token:f(this,k),basename:s,dirname:o})},ut=function(i){return decodeURI(i.split("?")[0])},R=function(i){const n=[f(this,$),p(this,d,ut).call(this,i)].join("/");return xe(n)};function Ce(e){return e.startsWith("http://")||e.startsWith("https://")||e.startsWith("data:")}const Ee=N({name:"NcActionButton",components:{NextcloudVueNcActionButton:K,Help:yt}});var Ae=function(){var e=this,i=e._self._c;return e._self._setupProxy,i("NextcloudVueNcActionButton",e._g({attrs:{"close-after-click":"","data-text-action-entry":"formatting-help"},scopedSlots:e._u([{key:"icon",fn:function(){return[i("Help")]},proxy:!0}])},e.$listeners),[e._v(" "+e._s(e.t("text","Formatting help"))+" ")])},Me=[],$e=_(Ee,Ae,Me,!1,null,null,null,null);const Se=$e.exports,Oe=N({name:"CharacterCount",components:{AlphabeticalVariant:bt,NcActionText:Bt},mixins:[I],props:{visible:Boolean},data:()=>({wordCount:0,charCount:0}),computed:{countString(){return"".concat(J("text","%n word","%n words",this.wordCount),", ").concat(J("text","%n char","%n chars",this.charCount))}},watch:{visible:"refresh"},created(){this.refresh()},methods:{refresh(){this.wordCount=this.$editor.storage.characterCount.words(),this.charCount=this.$editor.storage.characterCount.characters()}}});var Ne=function(){var e=this,i=e._self._c;return e._self._setupProxy,i("NcActionText",{attrs:{"data-text-action-entry":"character-count"},scopedSlots:e._u([{key:"icon",fn:function(){return[i("AlphabeticalVariant")]},proxy:!0},{key:"default",fn:function(){return[e._v(" "+e._s(e.countString)+" ")]},proxy:!0}])})},Ie=[],Pe=_(Oe,Ne,Ie,!1,null,null,null,null);const Te=Pe.exports;function Be(){var e;return((e=navigator==null?void 0:navigator.userAgentData)==null?void 0:e.mobile)!==void 0?navigator.userAgentData.mobile:[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/playbook/i,/silk/i,/BlackBerry/i,/Windows Phone/i].some(i=>navigator.userAgent.match(i))}const Fe={name:"HelpModal",components:{NcDialog:Ft},data(){return{formatted:{bold:!0,italic:!0,strikethrough:!0,heading1:!0,heading6:!0,unorderdList:!0,orderedList:!0,checkList:!0,blockQuote:!0,codeBlock:!0}}},computed:{isFormatted(){return e=>this.formatted[e]},isMobileCached(){return this.isMobilePlatform()}},methods:{toggleFormatted(e){this.formatted[e]=!this.formatted[e]},isMobilePlatform:Be}};var Ue=function(){var e=this,i=e._self._c;return i("NcDialog",{attrs:{size:"normal","data-text-el":"formatting-help",name:e.t("text","Formatting and shortcuts"),"close-on-click-outside":!0},on:{closing:function(n){return e.$emit("close")}}},[i("h2",[e._v(e._s(e.t("text","Formatting and shortcuts")))]),i("p",[e._v(e._s(e.t("text","Speed up your writing with simple shortcuts.")))]),e.isMobileCached?i("p",[e._v(" "+e._s(e.t("text","Just type the Markdown syntax from below."))+" ")]):i("p",[e._v(" "+e._s(e.t("text","Just type the Markdown syntax or use keyboard shortcuts from below."))+" ")]),i("table",[i("thead",[i("tr",[i("th",[e._v(e._s(e.t("text","Style")))]),i("th",[e._v(e._s(e.t("text","Syntax")))]),e.isMobileCached?e._e():i("th",[e._v(" "+e._s(e.t("text","Keyboard shortcuts"))+" ")])])]),i("tbody",[i("tr",[i("td",[e._v(e._s(e.t("text","New paragraph")))]),i("td",[i("kbd",[e._v(e._s(e.t("text","Enter")))])]),e.isMobileCached?e._e():i("td")]),i("tr",[i("td",[e._v(e._s(e.t("text","Hard line break")))]),i("td",[i("kbd",[e._v(e._s(e.t("text","Enter")))]),e._v(" "+e._s(e.t("text","followed by"))+" "),i("kbd",[e._v(e._s(e.t("text","Backspace")))])]),e.isMobileCached?e._e():i("td",[i("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),i("kbd",[e._v(e._s(e.t("text","Enter")))])])]),i("tr",[i("td",[e._v(e._s(e.t("text","Bold")))]),i("td",[i("code",[e._v("**"+e._s(e.t("text","Bold text"))+"**")])]),e.isMobileCached?e._e():i("td",[i("kbd",[e._v(e._s(e.t("text","Ctrl")))]),e._v(" + "),i("kbd",[e._v("B")])])]),i("tr",[i("td",[e._v(e._s(e.t("text","Italic")))]),i("td",[i("code",[e._v("*"+e._s(e.t("text","Italicized text"))+"*")])]),e.isMobileCached?e._e():i("td",[i("kbd",[e._v(e._s(e.t("text","Ctrl")))]),e._v(" + "),i("kbd",[e._v("I")])])]),i("tr",[i("td",[e._v(e._s(e.t("text","Strikethrough")))]),i("td",[i("code",[e._v("~~"+e._s(e.t("text","Mistaken text"))+"~~")])]),e.isMobileCached?e._e():i("td",[i("kbd",[e._v(e._s(e.t("text","Ctrl")))]),e._v(" + "),i("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),i("kbd",[e._v("S")])])]),i("tr",[i("td",[e._v(e._s(e.t("text","Underline")))]),i("td",[i("code",[e._v("__"+e._s(e.t("text","Underlined text"))+"__")])]),e.isMobileCached?e._e():i("td",[i("kbd",[e._v(e._s(e.t("text","Ctrl")))]),e._v(" + "),i("kbd",[e._v("U")])])]),i("tr",[i("td",{staticClass:"ellipsis_top"},[e._v(" "+e._s(e.t("text","Heading 1"))+" ")]),i("td",{staticClass:"ellipsis_top"},[i("code",[e._v("# "+e._s(e.t("text","Heading level 1")))])]),e.isMobileCached?e._e():i("td",{staticClass:"ellipsis_top"},[i("kbd",[e._v(e._s(e.t("text","Ctrl")))]),e._v(" + "),i("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),i("kbd",[e._v("1")])])]),i("tr",[i("td",{staticClass:"noborder ellipsis"},[e._v(" … ")]),i("td",{staticClass:"noborder ellipsis"},[e._v(" … ")]),e.isMobileCached?e._e():i("td",{staticClass:"ellipsis noborder"},[e._v(" … ")])]),i("tr",[i("td",{staticClass:"noborder ellipsis_bottom"},[e._v(" "+e._s(e.t("text","Heading 6"))+" ")]),i("td",{staticClass:"noborder ellipsis_bottom"},[i("code",[e._v("###### "+e._s(e.t("text","Heading level 6")))])]),e.isMobileCached?e._e():i("td",{staticClass:"noborder ellipsis_bottom"},[i("kbd",[e._v(e._s(e.t("text","Ctrl")))]),e._v(" + "),i("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),i("kbd",[e._v("6")])])]),i("tr",[i("td",[e._v(e._s(e.t("text","Unordered list")))]),i("td",[i("code",[e._v("* "+e._s(e.t("text","An item")))])]),e.isMobileCached?e._e():i("td",[i("kbd",[e._v(e._s(e.t("text","Ctrl")))]),e._v(" + "),i("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),i("kbd",[e._v("8")])])]),i("tr",[i("td",[e._v(e._s(e.t("text","Ordered list")))]),i("td",[i("code",[e._v("1. "+e._s(e.t("text","First item")))])]),e.isMobileCached?e._e():i("td",[i("kbd",[e._v(e._s(e.t("text","Ctrl")))]),e._v(" + "),i("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),i("kbd",[e._v("7")])])]),i("tr",[i("td",[e._v(e._s(e.t("text","Checklist")))]),i("td",[i("code",[e._v("* [] "+e._s(e.t("text","To-Do item")))])]),e.isMobileCached?e._e():i("td")]),i("tr",[i("td",[e._v(e._s(e.t("text","Blockquote")))]),i("td",[i("code",[e._v("> "+e._s(e.t("text","Quoted text")))])]),e.isMobileCached?e._e():i("td",[i("kbd",[e._v(e._s(e.t("text","Ctrl")))]),e._v(" + "),i("kbd",[e._v(">")])])]),i("tr",[i("td",[e._v(e._s(e.t("text","Code block")))]),i("td",[i("code",[e._v("``` "+e._s(e.t("text","Some code")))])]),e.isMobileCached?e._e():i("td")]),i("tr",[i("td",[e._v(e._s(e.t("text","Link")))]),i("td",[i("code",[e._v("[Title](https://example.org)")])]),e.isMobileCached?e._e():i("td")]),i("tr",[i("td",[e._v(e._s(e.t("text","Insert emoji")))]),i("td",[i("code",[e._v(":"+e._s(e.t("text","emoji")))])]),e.isMobileCached?e._e():i("td")]),i("tr",[i("td",[e._v(e._s(e.t("text","Mention someone")))]),i("td",[i("code",[e._v("@"+e._s(e.t("text","name")))])]),e.isMobileCached?e._e():i("td")]),i("tr",[i("td",[e._v(e._s(e.t("text","Smart picker")))]),i("td",[i("code",[e._v("/"+e._s(e.t("text","something")))])]),e.isMobileCached?e._e():i("td")])])]),i("table",{attrs:{vif:"!isMobileCached"}},[i("thead",[i("tr",[i("th",[e._v(e._s(e.t("text","Action")))]),i("th",[e._v(e._s(e.t("text","Keyboard shortcuts")))])])]),i("tbody",[i("tr",[i("td",[e._v(e._s(e.t("text","Undo")))]),i("td",[i("kbd",[e._v(e._s(e.t("text","Ctrl")))]),e._v(" + "),i("kbd",[e._v("Z")])])]),i("tr",[i("td",[e._v(e._s(e.t("text","Redo")))]),i("td",[i("kbd",[e._v(e._s(e.t("text","Ctrl")))]),e._v(" + "),i("kbd",[e._v("Y")])])]),i("tr",[i("td",[e._v(e._s(e.t("text","Toggle outline")))]),i("td",[i("kbd",[e._v(e._s(e.t("text","Ctrl")))]),e._v(" + "),i("kbd",[e._v(e._s(e.t("text","Alt")))]),e._v(" + "),i("kbd",[e._v("H")])])])])])])},He=[],Le=_(Fe,Ue,He,!1,null,"bdf077d8",null,null);const De=Le.exports,Re={name:"MenuBar",components:{ActionFormattingHelp:Se,ActionList:at,ActionSingle:rt,HelpModal:De,NcActionSeparator:G,NcActionButton:K,CharacterCount:Te,TranslateVariant:wt},extends:lt,mixins:[I,Wt,st,ot],provide(){const e={};return Object.defineProperties(e,{[kt]:{get:()=>this.randomID}}),e},props:{isHidden:{type:Boolean,default:!1}},setup(){const e=_t(),{width:i}=Lt(e);return{menubar:e,width:i}},data(){return{entries:[...gt],randomID:"menu-bar-".concat(Math.ceil(Math.random()*1e4+500).toString(16)),displayHelp:!1,isReady:!1,canTranslate:nt("text","translation_languages",[]).length>0,resize:null}},computed:{visibleEntries(){return this.entries.filter(({priority:e})=>e===void 0||e<=this.iconsLimit)},hiddenEntries(){const e=this.entries.filter(({priority:n})=>n!==void 0&&n>this.iconsLimit),i=e.reduce((n,s,o)=>{var u;const a=(u=s.children)!=null?u:[s];if(a.length>1){const m=n.length&&!n.at(-1).isSeparator?[{key:"separator-before-".concat(s.id),isSeparator:!0}]:[],C=o!==e.length-1?[{key:"separator-after-".concat(s.id),isSeparator:!0}]:[];return[...n,...m,...a,...C]}return[...n,...a]},[]);return{key:"remain",label:this.t("text","Remaining actions"),icon:xt,children:i}},iconWidth(){var i;const e=(i=this.menubar&&getComputedStyle(this.menubar))==null?void 0:i.getPropertyValue("--default-clickable-area");return parseInt(e)||34},iconsLimit(){const e=this.width-4,i=this.$isMobile?this.iconWidth:this.iconWidth+2;return Math.floor(e/i)-1}},mounted(){this.$nextTick(()=>{this.isReady=!0,this.$emit("update:loaded",!0)})},methods:{showHelp(){this.displayHelp=!0},hideHelp(){this.displayHelp=!1},showTranslate(){const{from:e,to:i}=this.$editor.view.state.selection;let n=this.$editor.view.state.doc.textBetween(e,i," ");n.trim().length||(this.$editor.commands.selectAll(),n=this.$editor.view.state.doc.textContent),console.debug("translation click",this.$editor.view.state.selection,n),it("text:translate-modal:show",{content:n})}}};var We=function(){var e=this,i=e._self._c;return i("div",{staticClass:"text-menubar",class:{"text-menubar--ready":e.isReady,"text-menubar--hide":e.isHidden,"text-menubar--is-workspace":e.$isRichWorkspace},attrs:{id:e.randomID,"data-text-el":"menubar",role:"region","aria-label":e.t("text","Editor actions")}},[e.displayHelp?i("HelpModal",{on:{close:e.hideHelp}}):e._e(),e.$isRichEditor?i("div",{ref:"menubar",staticClass:"text-menubar__entries",attrs:{role:"toolbar","aria-label":e.t("text","Formatting menu bar")},on:{keydown:[function(n){return!n.type.indexOf("key")&&e._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&n.button!==0?null:(n.stopPropagation(),e.handleToolbarNavigation.apply(null,arguments))},function(n){return!n.type.indexOf("key")&&e._k(n.keyCode,"right",39,n.key,["Right","ArrowRight"])||"button"in n&&n.button!==2?null:(n.stopPropagation(),e.handleToolbarNavigation.apply(null,arguments))}]}},[e._l(e.visibleEntries,function(n,s){return i(n.component?n.component:n.children?"ActionList":"ActionSingle",{key:n.key,ref:"menuEntries",refInFor:!0,tag:"component",attrs:{"action-entry":n,"can-be-focussed":e.activeMenuEntry===s},on:{disabled:function(o){return e.disableMenuEntry(n.key,o)},click:function(o){e.activeMenuEntry=s}}})}),i("ActionList",{ref:"remainingEntries",attrs:{"action-entry":e.hiddenEntries,"can-be-focussed":e.activeMenuEntry===e.visibleEntries.length,"force-enabled":!0},on:{click:function(n){e.activeMenuEntry="remain"}},scopedSlots:e._u([{key:"lastAction",fn:function({visible:n}){return[e.canTranslate?i("NcActionButton",{attrs:{"close-after-click":""},on:{click:e.showTranslate},scopedSlots:e._u([{key:"icon",fn:function(){return[i("TranslateVariant")]},proxy:!0}],null,!0)},[e._v(" "+e._s(e.t("text","Translate"))+" ")]):e._e(),i("ActionFormattingHelp",{on:{click:e.showHelp}}),i("NcActionSeparator"),i("CharacterCount",e._b({},"CharacterCount",{visible:n},!1))]}}],null,!1,2316723924)})],2):e._e(),i("div",{staticClass:"text-menubar__slot"},[e._t("default")],2)],1)},je=[],Ke=_(Re,We,je,!1,null,"adb1028b",null,null);const Ci=Ke.exports,Ve={name:"ContentContainer",components:{EditorContent:Ct,EditorOutline:Et},mixins:[I,tt],computed:{showOutline(){return this.$outlineState.visible}}};var qe=function(){var e=this,i=e._self._c;return i("div",{staticClass:"content-wrapper text-editor__content-wrapper",class:{"--show-outline":e.showOutline},attrs:{"data-text-el":"editor-content-wrapper"}},[e.showOutline?i("div",{staticClass:"text-editor__content-wrapper__left"},[i("EditorOutline")],1):e._e(),e._t("default"),i("EditorContent",{staticClass:"editor__content text-editor__content",attrs:{role:"document",editor:e.$editor}}),i("div",{staticClass:"text-editor__content-wrapper__right"})],2)},ze=[],Je=_(Ve,qe,ze,!1,null,"a3b97a85",null,null);const Ei=Je.exports,Z=e=>e.split("/").slice(0,-1).join("/"),Qe={name:"MediaHandler",mixins:[I,jt,Kt],provide(){const e={};return Object.defineProperties(e,{[Vt]:{get:()=>this.showAttachmentPrompt},[qt]:{get:()=>this.chooseLocalFile},[zt]:{get:()=>this.state}}),e},data(){return{lastFilePath:null,draggedOver:!1,state:{isUploadingAttachments:!1}}},computed:{initialFilePath(){var e,i,n;return(n=this.lastFilePath)!=null?n:Z((i=(e=this.$file)==null?void 0:e.relativePath)!=null?i:"/")}},methods:{setDraggedOver(e){this.draggedOver=e},onPaste(e){this.uploadAttachmentFiles(e.detail.files)},onEditorDrop(e){this.uploadAttachmentFiles(e.detail.files,e.detail.position),this.draggedOver=!1},onAttachmentUploadFilePicked(e){this.uploadAttachmentFiles(e.target.files),e.target.value=""},chooseLocalFile(){this.$refs.attachmentFileInput.click()},async uploadAttachmentFiles(e,i=null){if(!e)return;this.state.isUploadingAttachments=!0;const n=[...e].map(s=>this.uploadAttachmentFile(s,i));return Promise.all(n).catch(s=>{var o,a;F.error("Uploading multiple images failed",{error:s}),B(((a=(o=s==null?void 0:s.response)==null?void 0:o.data)==null?void 0:a.error)||s.message)}).then(()=>{this.state.isUploadingAttachments=!1})},async uploadAttachmentFile(e,i=null){return this.state.isUploadingAttachments=!0,this.$syncService.uploadAttachment(e).then(n=>{var s,o,a;this.insertAttachment((s=n.data)==null?void 0:s.name,(o=n.data)==null?void 0:o.id,e.type,i,(a=n.data)==null?void 0:a.dirname)}).catch(n=>{var s,o;F.error("Uploading image failed",{error:n}),B((o=(s=n==null?void 0:n.response)==null?void 0:s.data)==null?void 0:o.error)}).then(()=>{this.state.isUploadingAttachments=!1})},showAttachmentPrompt(){Rt()&&OC.dialogs.filepicker(t("text","Insert an attachment"),e=>{this.insertFromPath(e)},!1,[],!0,void 0,this.initialFilePath)},insertFromPath(e){return this.lastFilePath=Z(e),this.state.isUploadingAttachments=!0,this.$syncService.insertAttachmentFile(e).then(i=>{var n,s,o,a;this.insertAttachment((n=i.data)==null?void 0:n.name,(s=i.data)==null?void 0:s.id,(o=i.data)==null?void 0:o.mimetype,null,(a=i.data)==null?void 0:a.dirname)}).catch(i=>{var n,s;F.error("Failed to insert image path",{error:i}),B(((s=(n=i==null?void 0:i.response)==null?void 0:n.data)==null?void 0:s.error)||i.message)}).then(()=>{this.state.isUploadingAttachments=!1})},insertAttachment(e,i,n,s=null,o=""){const a=o+"/"+encodeURIComponent(e).replace(/[!'()*]/g,C=>"%"+C.charCodeAt(0).toString(16).toUpperCase()),u=e.replaceAll(/[[\]]/g,"");(s?this.$editor.chain().focus(s):this.$editor.chain()).setImage({src:a,alt:u}).run();const m=this.$editor.view.state.selection;m.empty||this.$editor.commands.focus(m.to),this.$editor.commands.scrollIntoView(),it("text:image-node:add",null)}}};var Ye=function(){var e=this,i=e._self._c;return i("div",{staticClass:"editor editor-media-handler",class:{draggedOver:e.draggedOver},attrs:{"data-text-el":"editor-media-handler"},on:{"image-paste":e.onPaste,dragover:function(n){return n.preventDefault(),n.stopPropagation(),e.setDraggedOver(!0)},dragleave:function(n){return n.preventDefault(),n.stopPropagation(),e.setDraggedOver(!1)},"file-drop":e.onEditorDrop}},[i("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"attachmentFileInput",attrs:{"data-text-el":"attachment-file-input",type:"file",accept:"*/*",multiple:""},on:{change:e.onAttachmentUploadFilePicked}}),e._t("default")],2)},Ze=[],Ge=_(Qe,Ye,Ze,!1,null,null,null,null);const Xe=Ge.exports,ti={name:"MainContainer",components:{MediaHandler:Xe},mixins:[Jt]};var ei=function(){var e=this,i=e._self._c;return i("div",{staticClass:"editor"},[e.$editorUpload?i("MediaHandler",{staticClass:"text-editor__main"},[e._t("default")],2):e._t("default")],2)},ii=[],ni=_(ti,ei,ii,!1,null,"f2d30048",null,null);const Ai=ni.exports,si={name:"Wrapper",mixins:[X,st,ot],provide(){const e={};return Object.defineProperties(e,{[At]:{get:()=>this.outline},[Mt]:{get:()=>({toggle:this.outlineToggle})}}),e},props:{isResolvingConflict:{type:Boolean,require:!0},hasConnectionIssue:{type:Boolean,default:!1},contentLoaded:{type:Boolean,default:!0},showOutlineOutside:{type:Boolean,default:!1}},data:()=>({outline:{visible:!1,enable:!1}}),computed:{...Pt({viewWidth:e=>e.text.viewWidth}),showOutline(){return this.isAbleToShowOutline?this.outline.visible:!1},isAbleToShowOutline(){return this.$isRichWorkspace?!1:this.viewWidth>1265}},watch:{showOutlineOutside(){this.outline.visible=this.showOutlineOutside}},mounted(){this.outline.enable=this.isAbleToShowOutline,this.$watch(()=>this.isAbleToShowOutline,e=>{Object.assign(this.outline,{enable:e})}),document.addEventListener("keydown",this.handleKeyDown)},beforeDestroy(){document.removeEventListener("keydown",this.handleKeyDown)},methods:{outlineToggle(){this.outline.visible=!this.outline.visible,this.$emit("outline-toggled",this.outline.visible)},handleKeyDown(e){e.ctrlKey&&e.altKey&&e.key==="h"&&this.outlineToggle()}}};var oi=function(){var e=this,i=e._self._c;return i("div",{staticClass:"text-editor__wrapper",class:{"has-conflicts":e.isResolvingConflict,"is-rich-workspace":e.$isRichWorkspace,"is-rich-editor":e.$isRichEditor}},[e._t("default")],2)},ai=[],ri=_(si,oi,ai,!1,null,"e2418976",null,null);const Mi=ri.exports;export{ki as A,Ei as C,Ai as M,gi as R,Mi as W,Ci as a,xi as g,he as m};
