const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=[window.OC.filePath('text', '', 'js/PublicFilesEditor-F3fcW2Nx.chunk.mjs'),window.OC.filePath('text', '', 'js/modulepreload-polyfill-Cp76Uzro.chunk.mjs'),window.OC.filePath('text', '', 'js/_plugin-vue2_normalizer-Khmm4uCx.chunk.mjs'),window.OC.filePath('text', '', 'js/vue.runtime.esm-8l0cPn1o.chunk.mjs'),window.OC.filePath('text', '', 'js/index-C9LeCMoi.chunk.mjs'),window.OC.filePath('text', '', 'js/index-DfiDB3im.chunk.mjs'),window.OC.filePath('text', '', 'js/emoji-picker-_ZUJ6YnW.chunk.mjs'),window.OC.filePath('text', '', 'js/index-HQWwoT4K.chunk.mjs'),window.OC.filePath('text', '', 'css/index-DG0nQhh6.chunk.css'),window.OC.filePath('text', '', 'css/_plugin-vue2_normalizer-qC8o6FCo.chunk.css'),window.OC.filePath('text', '', 'js/RichWorkspace-B_VioIui.chunk.mjs'),window.OC.filePath('text', '', 'js/Editor.singleton-VVe-92YE.chunk.mjs'),window.OC.filePath('text', '', 'js/RichTextReader-nvJX-i9s.chunk.mjs'),window.OC.filePath('text', '', 'js/BaseReader-CRfm7wZO.chunk.mjs'),window.OC.filePath('text', '', 'js/RichText-Bu5ZBYmA.chunk.mjs'),window.OC.filePath('text', '', 'js/MediaHandler.provider-C6D-wsfU.chunk.mjs'),window.OC.filePath('text', '', 'js/logger-Csk1_XRx.chunk.mjs'),window.OC.filePath('text', '', 'js/_plugin-vue2_normalizer--qmvqNVe-BvLuO0O2.chunk.mjs'),window.OC.filePath('text', '', 'css/RichText-Deqv3M8R.chunk.css'),window.OC.filePath('text', '', 'css/BaseReader-CsLFhfbT.chunk.css'),window.OC.filePath('text', '', 'css/RichTextReader-D2xIwO7d.chunk.css'),window.OC.filePath('text', '', 'css/RichWorkspace-BfZwJ3rL.chunk.css')])))=>i.map(i=>d[i]);
import{_ as f}from"./modulepreload-polyfill-Cp76Uzro.chunk.mjs";import{p as O,s as E,a as F}from"./_plugin-vue2_normalizer--qmvqNVe-BvLuO0O2.chunk.mjs";import{a as h,e as g}from"./index-HQWwoT4K.chunk.mjs";import{g as v,h as b,c as I}from"./index-C9LeCMoi.chunk.mjs";import{H as k,b as R,N,F as P,P as _}from"./index-BbYtONsg.chunk.mjs";import{l as x}from"./index-DfiDB3im.chunk.mjs";import{b as u}from"./mime-CuxkK4Yj.chunk.mjs";import"./emoji-picker-_ZUJ6YnW.chunk.mjs";import"./vue.runtime.esm-8l0cPn1o.chunk.mjs";const T='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-text" viewBox="0 0 24 24"><path d="M21,6V8H3V6H21M3,18H12V16H3V18M3,13H21V11H3V13Z" /></svg>',w="Edit with text app",q=()=>{const i={attach(e){const o=e.fileList;o.id!=="files"&&o.id!=="files.public"||e.addMenuEntry({id:"file",displayName:t("text","New text file"),templateName:t("text","New text file")+"."+x("text","default_file_extension"),iconClass:"icon-filetype-text",fileType:"file",actionLabel:t("text","Create new text file"),actionHandler(s){o.createFile(s).then(function(n,l){const a=new OCA.Files.FileInfoModel(l);typeof OCA.Viewer<"u"?OCA.Files.fileActions.triggerAction("view",a,o):typeof OCA.Viewer>"u"&&OCA.Files.fileActions.triggerAction(w,a,o)})}})}};OC.Plugins.register("OCA.Files.NewFileMenu",i)},B=()=>{const i=v(),e=document.querySelector("#preview table.files-filestable");if(!i||!e){const o=document.createElement("div");o.id="text-viewer-fallback",document.body.appendChild(o);const s=n=>OCA.Files.fileActions.register(n,w,OC.PERMISSION_UPDATE|OC.PERMISSION_READ,b("core","actions/rename"),l=>{const a=window.FileList.findFile(l);Promise.all([f(()=>import("./vue.runtime.esm-8l0cPn1o.chunk.mjs").then(r=>r.x),[],import.meta.url),f(()=>import("./PublicFilesEditor-F3fcW2Nx.chunk.mjs"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]),import.meta.url)]).then(r=>{const c=window.FileList.getCurrentDirectory()+"/"+l,m=r[0].default;m.prototype.t=window.t,m.prototype.n=window.n,m.prototype.OCA=window.OCA;const A=r[1].default;new m({render:function(y){const C=this;return y(A,{props:{fileId:a?a.id:null,active:!0,shareToken:i,relativePath:c,mimeType:a.mimetype},on:{close:function(){C.$destroy()}}})}}).$mount(o)})},t("text","Edit"));for(let n=0;n<u.length;n++)s(u[n]),OCA.Files.fileActions.setDefault(u[n],w)}};let p=!1;const Z=()=>{const i=t("text","Readme")+"."+x("text","default_file_extension");R({id:"rich-workspace-init",displayName:t("text","Add folder description"),category:N.Other,enabled(e){return Number(e.attributes["rich-workspace-file"])?!1:(e.permissions&_.CREATE)!==0},iconSvgInline:T,async handler(e,o){const s=o.map(c=>c.basename);if(s.includes(i)){E(t("text",'"{name}" already exist!',{name:i}));return}const n=e.encodedSource+"/"+encodeURIComponent(i),l=await I({method:"PUT",url:n,headers:{Overwrite:"F"}}),a=parseInt(l.headers["oc-fileid"]),r=new P({source:e.source+"/"+i,id:a,mtime:new Date,mime:"text/markdown",owner:h()?.uid||null,permissions:_.ALL,root:e?.root||"/files/"+h()?.uid});F(t("text",'Created "{name}"',{name:i})),s.length===0&&(p=r),g("files:node:created",r)}})};let d=null;const j=new k({id:"workspace",order:10,enabled(i,e){return e.id==="files"||e.id==="favorites"},async render(i,e,o){d&&(d.$destroy(),d=null);const s=!!e.attributes["rich-workspace-file"]||!!p,n=p?O.dirname(p.path):e.path,l=p?"":e.attributes["rich-workspace"];p=!1;const{default:a}=await f(async()=>{const{default:r}=await import("./RichWorkspace-B_VioIui.chunk.mjs");return{default:r}},__vite__mapDeps([10,4,5,3,6,7,8,11,1,12,13,14,2,9,15,16,17,18,19,20,21]),import.meta.url);f(()=>import("./vue.runtime.esm-8l0cPn1o.chunk.mjs").then(r=>r.x),[],import.meta.url).then(r=>{i.id="files-workspace-wrapper";const c=r.default;c.prototype.t=window.t,c.prototype.n=window.n,c.prototype.OCA=window.OCA;const m=c.extend(a);d=new m({propsData:{path:n,hasRichWorkspace:s,content:l}}).$mount(i)})},updated(i,e){if(p=!1,!d){console.warn("No vue instance found for FilesWorkspaceHeader");return}const o=!!i.attributes["rich-workspace-file"];d.path=i.path,d.hasRichWorkspace=o,d.content=i.attributes["rich-workspace"]}});export{w as FILE_ACTION_IDENTIFIER,j as FilesWorkspaceHeader,Z as addMenuRichWorkspace,B as registerFileActionFallback,q as registerFileCreate};
//# sourceMappingURL=files-AfNuudQe.chunk.mjs.map
