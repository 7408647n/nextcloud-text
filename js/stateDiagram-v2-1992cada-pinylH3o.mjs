/*! third party licenses: js/vendor.LICENSE.txt */
import{p as K,d as M,s as Q,D as I,a as U,S as X,b as Y,c as Z}from"./styles-0784dbeb-BBKR0DtB.mjs";import{G as tt}from"./graph-DxMSb3Yx.mjs";import{al as p,ag as S,ak as k,aD as et,am as st,ao as v}from"./RichText-zNmEthNt.mjs";import{r as ot}from"./index-01f381cb-B0laMlFL.mjs";import"./NcNoteCard-e7-Bxio8-D0g8rzVg.mjs";import"./layout-DNvdHJ2J.mjs";import"./NcTextArea-XCi8a16Y-BMFOXSaX.mjs";import"./vue.runtime.esm-ZT8iQ3G4.mjs";import"./index-vg7q3Iku.mjs";import"./index-BAt6szDS.mjs";import"./modulepreload-polyfill-CtIajbZu.mjs";import"./index-Y_Oyg-XB.mjs";import"./index-Ubm2itxG.mjs";import"./index-D2vurPhW.mjs";import"./MediaHandler.provider-OHfqkW9k.mjs";import"./logger-C7d0ySTj.mjs";import"./_plugin-vue2_normalizer-BWKvF6pj.mjs";import"./clone-BXknuVUX.mjs";import"./edges-066a5561-F4Qi1osg.mjs";import"./createText-ca0c5216-Bg9CtbGj.mjs";import"./line-Co9fE4no.mjs";import"./array-CNYCUCI1.mjs";import"./path-D16fQfbf.mjs";const w="rect",A="rectWithTitle",at="start",rt="end",it="divider",nt="roundedWithTitle",dt="note",ct="noteGroup",h="statediagram",lt="state",pt="".concat(h,"-").concat(lt),P="transition",bt="note",gt="note-edge",mt="".concat(P," ").concat(gt),ht="".concat(h,"-").concat(bt),ut="cluster",yt="".concat(h,"-").concat(ut),ft="cluster-alt",$t="".concat(h,"-").concat(ft),W="parent",j="note",xt="state",R="----",wt="".concat(R).concat(j),z="".concat(R).concat(W),O="fill:none",_="fill: #333",q="c",F="text",H="normal";let T={},l=0;const Tt=function(t){const a=Object.keys(t);for(const e of a)t[e]},St=function(t,a){return a.db.extract(a.db.getRootDocV2()),a.db.getClasses()};function Dt(t){return t==null?"":t.classes?t.classes.join(" "):""}function B(t="",a=0,e="",r=R){const i=e!==null&&e.length>0?"".concat(r).concat(e):"";return"".concat(xt,"-").concat(t).concat(i,"-").concat(a)}const x=(t,a,e,r,i,n)=>{const s=e.id,u=Dt(r[s]);if(s!=="root"){let g=w;e.start===!0&&(g=at),e.start===!1&&(g=rt),e.type!==I&&(g=e.type),T[s]||(T[s]={id:s,shape:g,description:v.sanitizeText(s,S()),classes:"".concat(u," ").concat(pt)});const o=T[s];e.description&&(Array.isArray(o.description)?(o.shape=A,o.description.push(e.description)):o.description.length>0?(o.shape=A,o.description===s?o.description=[e.description]:o.description=[o.description,e.description]):(o.shape=w,o.description=e.description),o.description=v.sanitizeTextOrArray(o.description,S())),o.description.length===1&&o.shape===A&&(o.shape=w),!o.type&&e.doc&&(p.info("Setting cluster for ",s,E(e)),o.type="group",o.dir=E(e),o.shape=e.type===U?it:nt,o.classes=o.classes+" "+yt+" "+(n?$t:""));const m={labelStyle:"",shape:o.shape,labelText:o.description,classes:o.classes,style:"",id:s,dir:o.dir,domId:B(s,l),type:o.type,padding:15};if(m.centerLabel=!0,e.note){const d={labelStyle:"",shape:dt,labelText:e.note.text,classes:ht,style:"",id:s+wt+"-"+l,domId:B(s,l,j),type:o.type,padding:15},c={labelStyle:"",shape:ct,labelText:e.note.text,classes:o.classes,style:"",id:s+z,domId:B(s,l,W),type:"group",padding:0};l++;const y=s+z;t.setNode(y,c),t.setNode(d.id,d),t.setNode(s,m),t.setParent(s,y),t.setParent(d.id,y);let b=s,f=d.id;e.note.position==="left of"&&(b=d.id,f=s),t.setEdge(b,f,{arrowhead:"none",arrowType:"",style:O,labelStyle:"",classes:mt,arrowheadStyle:_,labelpos:q,labelType:F,thickness:H})}else t.setNode(s,m)}a&&a.id!=="root"&&(p.trace("Setting node ",s," to be child of its parent ",a.id),t.setParent(s,a.id)),e.doc&&(p.trace("Adding nodes children "),kt(t,e,e.doc,r,i,!n))},kt=(t,a,e,r,i,n)=>{p.trace("items",e),e.forEach(s=>{switch(s.stmt){case Y:x(t,a,s,r,i,n);break;case I:x(t,a,s,r,i,n);break;case X:{x(t,a,s.state1,r,i,n),x(t,a,s.state2,r,i,n);const u={id:"edge"+l,arrowhead:"normal",arrowTypeEnd:"arrow_barb",style:O,labelStyle:"",label:v.sanitizeText(s.description,S()),arrowheadStyle:_,labelpos:q,labelType:F,thickness:H,classes:P};t.setEdge(s.state1.id,s.state2.id,u,l),l++}break}})},E=(t,a=Z)=>{let e=a;if(t.doc)for(let r=0;r<t.doc.length;r++){const i=t.doc[r];i.stmt==="dir"&&(e=i.value)}return e},At=async function(t,a,e,r){p.info("Drawing state diagram (v2)",a),T={},r.db.getDirection();const{securityLevel:i,state:n}=S(),s=n.nodeSpacing||50,u=n.rankSpacing||50;p.info(r.db.getRootDocV2()),r.db.extract(r.db.getRootDocV2()),p.info(r.db.getRootDocV2());const g=r.db.getStates(),o=new tt({multigraph:!0,compound:!0}).setGraph({rankdir:E(r.db.getRootDocV2()),nodesep:s,ranksep:u,marginx:8,marginy:8}).setDefaultEdgeLabel(function(){return{}});x(o,void 0,r.db.getRootDocV2(),g,r.db,!0);let m;i==="sandbox"&&(m=k("#i"+a));const d=i==="sandbox"?k(m.nodes()[0].contentDocument.body):k("body"),c=d.select('[id="'.concat(a,'"]')),y=d.select("#"+a+" g");await ot(y,o,["barb"],h,a);const b=8;et.insertTitle(c,"statediagramTitleText",n.titleTopMargin,r.db.getDiagramTitle());const f=c.node().getBBox(),N=f.width+b*2,V=f.height+b*2;c.attr("class",h);const C=c.node().getBBox();st(c,V,N,n.useMaxWidth);const G="".concat(C.x-b," ").concat(C.y-b," ").concat(N," ").concat(V);p.debug("viewBox ".concat(G)),c.attr("viewBox",G);const J=document.querySelectorAll('[id="'+a+'"] .edgeLabel .label');for(const D of J){const L=D.getBBox(),$=document.createElementNS("http://www.w3.org/2000/svg",w);$.setAttribute("rx",0),$.setAttribute("ry",0),$.setAttribute("width",L.width),$.setAttribute("height",L.height),D.insertBefore($,D.firstChild)}},Bt={setConf:Tt,getClasses:St,draw:At},Xt={parser:K,db:M,renderer:Bt,styles:Q,init:t=>{t.state||(t.state={}),t.state.arrowMarkerAbsolute=t.arrowMarkerAbsolute,M.clear()}};export{Xt as diagram};
