{"version":3,"file":"SessionList-Chlm3Wpd.mjs","sources":["../src/components/Editor/SessionList.vue"],"sourcesContent":["<!--\n  - @copyright Copyright (c) 2019 Julius Härtl <jus@bitgrid.net>\n  -\n  - @author Julius Härtl <jus@bitgrid.net>\n  -\n  - @license GNU AGPL version 3 or any later version\n  -\n  - This program is free software: you can redistribute it and/or modify\n  - it under the terms of the GNU Affero General Public License as\n  - published by the Free Software Foundation, either version 3 of the\n  - License, or (at your option) any later version.\n  -\n  - This program is distributed in the hope that it will be useful,\n  - but WITHOUT ANY WARRANTY; without even the implied warranty of\n  - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n  - GNU Affero General Public License for more details.\n  -\n  - You should have received a copy of the GNU Affero General Public License\n  - along with this program. If not, see <http://www.gnu.org/licenses/>.\n  -\n  -->\n\n<template>\n\t<NcPopover class=\"session-list\" placement=\"bottom\">\n\t\t<template #trigger=\"{ attrs }\">\n\t\t\t<div>\n\t\t\t\t<button :title=\"label\"\n\t\t\t\t\t:aria-label=\"label\"\n\t\t\t\t\tclass=\"avatar-list\"\n\t\t\t\t\tv-bind=\"attrs\">\n\t\t\t\t\t<div class=\"avatardiv icon-group\" />\n\t\t\t\t\t<AvatarWrapper v-for=\"session in sessionsVisible\"\n\t\t\t\t\t\t:key=\"session.id\"\n\t\t\t\t\t\t:session=\"session\"\n\t\t\t\t\t\t:size=\"40\" />\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</template>\n\t\t<template #default>\n\t\t\t<div class=\"session-menu\">\n\t\t\t\t<slot name=\"lastSaved\" />\n\t\t\t\t<ul>\n\t\t\t\t\t<slot />\n\t\t\t\t\t<li v-for=\"session in participantsPopover\"\n\t\t\t\t\t\t:key=\"session.id\"\n\t\t\t\t\t\t:style=\"avatarStyle(session)\">\n\t\t\t\t\t\t<AvatarWrapper :session=\"session\" :size=\"36\" />\n\t\t\t\t\t\t<span class=\"session-label\">\n\t\t\t\t\t\t\t{{ session.userId ? session.displayName : (session.guestName ? session.guestName : t('text', 'Guest')) }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span v-if=\"session.userId === null\" class=\"guest-label\">({{ t('text', 'guest') }})</span>\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t\t<!-- disable for now as this broke during the y.js migration\n\t\t\t\t<input id=\"toggle-color-annotations\"\n\t\t\t\t\tv-model=\"showAuthorAnnotations\"\n\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\tclass=\"checkbox\">\n\t\t\t\t<label for=\"toggle-color-annotations\">{{ t('text', 'Show author colors') }}</label>\n\t\t\t\t<p class=\"hint\">\n\t\t\t\t\t{{ t('text', 'Author colors are only shown until everyone has closed the document.') }}\n\t\t\t\t</p>\n\t\t\t\t-->\n\t\t\t</div>\n\t\t</template>\n\t</NcPopover>\n</template>\n\n<script>\nimport { NcPopover } from '@nextcloud/vue'\nimport AvatarWrapper from './AvatarWrapper.vue'\nimport { mapActions, mapState } from 'vuex'\nimport store from '../../mixins/store.js'\nimport { COLLABORATOR_IDLE_TIME, COLLABORATOR_DISCONNECT_TIME } from '../../services/SyncService.js'\n\nexport default {\n\tname: 'SessionList',\n\tcomponents: {\n\t\tAvatarWrapper,\n\t\tNcPopover,\n\t},\n\tmixins: [store],\n\tprops: {\n\t\tsessions: {\n\t\t\ttype: Object,\n\t\t\tdefault: () => { return {} },\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tmyName: '',\n\t\t}\n\t},\n\tcomputed: {\n\t\t...mapState({\n\t\t\tstoreShowAuthorAnnotations: (state) => state.text.showAuthorAnnotations,\n\t\t}),\n\n\t\tlabel() {\n\t\t\treturn t('text', 'Active people')\n\t\t},\n\t\tshowAuthorAnnotations: {\n\t\t\tget() {\n\t\t\t\treturn this.storeShowAuthorAnnotations\n\t\t\t},\n\t\t\tset(value) {\n\t\t\t\tthis.setShowAuthorAnnotations(value)\n\t\t\t},\n\t\t},\n\t\tparticipantsPopover() {\n\t\t\tif (this.currentSession?.guestName) {\n\t\t\t\treturn this.participantsWithoutCurrent\n\t\t\t}\n\t\t\treturn this.participants\n\t\t},\n\t\tparticipantsWithoutCurrent() {\n\t\t\treturn this.participants.filter((session) => !session.isCurrent)\n\t\t},\n\t\tparticipants() {\n\t\t\treturn Object.values(this.sessions).filter((session) =>\n\t\t\t\tsession.lastContact > Date.now() / 1000 - COLLABORATOR_DISCONNECT_TIME\n\t\t\t\t\t&& (session.userId !== null || session.guestName !== null),\n\t\t\t).sort((a, b) => a.lastContact < b.lastContact)\n\t\t},\n\t\tcurrentSession() {\n\t\t\treturn Object.values(this.sessions).find((session) => session.isCurrent)\n\t\t},\n\t\tavatarStyle() {\n\t\t\treturn (session) => {\n\t\t\t\treturn {\n\t\t\t\t\topacity: session.lastContact > Date.now() / 1000 - COLLABORATOR_IDLE_TIME ? 1 : 0.5,\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tsessionsVisible() {\n\t\t\treturn this.participantsWithoutCurrent.slice(0, 3)\n\t\t},\n\t},\n\n\tmethods: {\n\t\t...mapActions('text', [\n\t\t\t'setShowAuthorAnnotations',\n\t\t]),\n\t},\n}\n</script>\n\n<style scoped lang=\"scss\">\n\t.session-list {\n\t\theight: 44px;\n\t}\n\t.avatar-list {\n\t\tborder: none;\n\t\tbackground-color: var(--color-main-background);\n\t\tpadding: 0;\n\t\tmargin: 0;\n\t\tpadding-left: 3px;\n\t\tdisplay: inline-flex;\n\t\tflex-direction: row-reverse;\n\n\t\t.avatar-wrapper {\n\t\t\tmargin: 0 -18px 0 0;\n\t\t\tz-index: 1;\n\t\t\tborder-radius: 50%;\n\t\t\toverflow: hidden;\n\t\t\tbox-sizing: content-box !important;\n\t\t\theight: 36px;\n\t\t\twidth: 36px;\n\t\t}\n\n\t\t.icon-more, .icon-group, .icon-settings-dark {\n\t\t\twidth: 44px;\n\t\t\theight: 44px;\n\t\t\tmargin: 0 3px 0 0;\n\n\t\t\t&:hover {\n\t\t\t\tbackground-color: var(--color-background-hover);\n\t\t\t}\n\t\t}\n\t}\n\n\t.session-menu {\n\t\tmax-width: 280px;\n\t\tpadding-top: 6px;\n\t\tpadding-bottom: 6px;\n\n\t\tul li {\n\t\t\talign-items: center;\n\t\t\tdisplay: flex;\n\t\t\tpadding: 6px;\n\n\t\t\t.avatar-wrapper {\n\t\t\t\theight: 36px;\n\t\t\t\twidth: 36px;\n\t\t\t\tmargin-right: 6px;\n\t\t\t}\n\n\t\t\t.session-label {\n\t\t\t\tpadding-right: 3px;\n\t\t\t}\n\t\t\t.guest-label {\n\t\t\t\tpadding-left: 3px;\n\t\t\t\tcolor: var(--color-text-maxcontrast);\n\t\t\t}\n\t\t}\n\t}\n\n\tlabel {\n\t\tdisplay: block;\n\t\tmargin: 8px;\n\t}\n\n\t.hint {\n\t\tmargin: 8px;\n\t\tcolor: var(--color-text-maxcontrast);\n\t}\n</style>\n"],"names":["_sfc_main","AvatarWrapper","NcPopover","store","mapState","state","value","_a","session","COLLABORATOR_DISCONNECT_TIME","a","b","COLLABORATOR_IDLE_TIME","mapActions"],"mappings":";6mBA2EA,MAAAA,EAAA,CACA,KAAA,cACA,WAAA,CACA,cAAAC,EACA,UAAAC,CACA,EACA,OAAA,CAAAC,CAAA,EACA,MAAA,CACA,SAAA,CACA,KAAA,OACA,QAAA,KAAA,GACA,CACA,EACA,MAAA,CACA,MAAA,CACA,OAAA,EACA,CACA,EACA,SAAA,CACA,GAAAC,EAAA,CACA,2BAAAC,GAAAA,EAAA,KAAA,qBACA,CAAA,EAEA,OAAA,CACA,OAAA,EAAA,OAAA,eAAA,CACA,EACA,sBAAA,CACA,KAAA,CACA,OAAA,KAAA,0BACA,EACA,IAAAC,EAAA,CACA,KAAA,yBAAAA,CAAA,CACA,CACA,EACA,qBAAA,OACA,OAAAC,EAAA,KAAA,iBAAA,MAAAA,EAAA,UACA,KAAA,2BAEA,KAAA,YACA,EACA,4BAAA,CACA,OAAA,KAAA,aAAA,OAAAC,GAAA,CAAAA,EAAA,SAAA,CACA,EACA,cAAA,CACA,OAAA,OAAA,OAAA,KAAA,QAAA,EAAA,OAAAA,GACAA,EAAA,YAAA,KAAA,IAAA,EAAA,IAAAC,IACAD,EAAA,SAAA,MAAAA,EAAA,YAAA,KACA,EAAA,KAAA,CAAAE,EAAAC,IAAAD,EAAA,YAAAC,EAAA,WAAA,CACA,EACA,gBAAA,CACA,OAAA,OAAA,OAAA,KAAA,QAAA,EAAA,KAAAH,GAAAA,EAAA,SAAA,CACA,EACA,aAAA,CACA,OAAAA,IACA,CACA,QAAAA,EAAA,YAAA,KAAA,IAAA,EAAA,IAAAI,EAAA,EAAA,EACA,EAEA,EACA,iBAAA,CACA,OAAA,KAAA,2BAAA,MAAA,EAAA,CAAA,CACA,CACA,EAEA,QAAA,CACA,GAAAC,EAAA,OAAA,CACA,0BACA,CAAA,CACA,CACA"}