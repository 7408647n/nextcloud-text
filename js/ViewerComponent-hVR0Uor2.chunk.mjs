import{V as i}from"./vue.runtime.esm-csNk-d35.chunk.mjs";import{t as s,c as a,b as l}from"./index-CXP1mBob.chunk.mjs";import{g as m,c}from"./NcNoteCard-BxDD8sro.chunk.mjs";import{d as u}from"./EditorOutline-Ba5jNQ9w.chunk.mjs";import{P as n}from"./PlainTextReader-Dm70D_n2.chunk.mjs";import r from"./MarkdownContentEditor-CIXIn065.chunk.mjs";import{g as p,a as f}from"./dav-Co9y-hkg-DZiouPvv.chunk.mjs";import{g as h}from"./Editor.singleton-CuNdfVKu.chunk.mjs";import{n as g}from"./_plugin-vue2_normalizer-XSZyZ-Zg.chunk.mjs";import"./emoji-picker-DwlFXcXb.chunk.mjs";import"./index-9ZwhZZFX.chunk.mjs";import"./index-DfiDB3im.chunk.mjs";import"./modulepreload-polyfill-CBWYtosv.chunk.mjs";import"./NcCheckboxRadioSwitch-VeztTzpz-D5zBCI1m.chunk.mjs";import"./logger-Bm2noG4q.chunk.mjs";import"./MediaHandler.provider-DdpLVxy8.chunk.mjs";import"./BaseReader-DscVEKy2.chunk.mjs";import"./Wrapper-qX4KT5lB.chunk.mjs";import"./NcDialog-CKgpZOiy-CKuAUdSt.chunk.mjs";i.prototype.t=s,i.prototype.n=l;const y={name:"ViewerComponent",components:{NcButton:i.extend(c),PencilIcon:i.extend(u),PlainTextReader:i.extend(n),MarkdownContentEditor:i.extend(r),Editor:h},provide(){return{isEmbedded:this.isEmbedded}},props:{filename:{type:String,default:null},fileid:{type:Number,default:null},active:{type:Boolean,default:!1},autofocus:{type:Boolean,default:!0},shareToken:{type:String,default:()=>m()},mime:{type:String,default:null},showOutlineOutside:{type:Boolean,default:!1},permissions:{type:String,default:""},source:{type:String,default:void 0},isEmbedded:{type:Boolean,default:!1}},data(){return{content:"",hasToggledInteractiveEmbedding:!1}},computed:{useSourceView(){return this.source&&(this.fileVersion||!this.fileid||this.isEmbedded||this.isEncrypted)&&!this.hasToggledInteractiveEmbedding},isEncrypted(){return this.$attrs.e2EeIsEncrypted||!1},isMarkdown(){return this.mime==="text/markdown"||this.mime==="text/x-web-markdown"},readerComponent(){return this.isMarkdown?r:n}},watch:{source(){this.loadFileContent()}},mounted(){this.loadFileContent()},methods:{t:s,async loadFileContent(){if(this.useSourceView)if(this.isEncrypted)this.content=await this.fetchDecryptedContent(),this.contentLoaded=!0;else{const t=await a.get(this.source);this.content=t.data,this.contentLoaded=!0}this.$emit("update:loaded",!0)},toggleEdit(){this.hasToggledInteractiveEmbedding=!0},async fetchDecryptedContent(){const t=await p().getFileContents(`${f()}${this.filename}`,{details:!0}),e=new Blob([t.data],{type:t.headers["content-type"]}),o=new FileReader;return o.readAsText(e),new Promise(d=>{o.onload=()=>{d(o.result)}})}}};var w=function(){var t=this,e=t._self._c;return t.useSourceView?e("div",{staticClass:"text-editor source-viewer",attrs:{id:"editor-container","data-text-el":"editor-container"}},[e(t.readerComponent,{tag:"Component",attrs:{content:t.content,"file-id":t.fileid,"read-only":!0,"show-menu-bar":!1}}),t.isEmbedded?e("NcButton",{staticClass:"toggle-interactive",on:{click:t.toggleEdit},scopedSlots:t._u([{key:"icon",fn:function(){return[e("PencilIcon")]},proxy:!0}],null,!1,411976917)},[t._v(" "+t._s(t.t("text","Edit"))+" ")]):t._e()],1):e("Editor",{class:{"text-editor--embedding":t.isEmbedded},attrs:{"file-id":t.fileid,"relative-path":t.filename,active:t.active||t.isEmbedded,autofocus:t.autofocus,"share-token":t.shareToken,mime:t.mime,"show-outline-outside":t.showOutlineOutside}})},E=[],x=g(y,w,E,!1,null,"03a9e24a");const A=x.exports;export{A as default};
//# sourceMappingURL=ViewerComponent-hVR0Uor2.chunk.mjs.map
