/*! third party licenses: js/vendor.LICENSE.txt */
import{m as ie,c as ae,i as se,a as oe,p as de}from"./chunk-D7TMHCYL-C8jsEckH.chunk.mjs";import{c as le,a as $,s as ce}from"./chunk-BAVOGKFW-BK5E_RrY.chunk.mjs";import{c as ge,u as he,s as fe,i as pe,p as j,a as _,b as O}from"./chunk-DGPT5PPI-BpMHwOH1.chunk.mjs";import{_ as f,l as i,d as b,j as k,u as ue,aa as we,ab as H,ac as W,ad as z,v as ye,e as q,ae as J,A as B,D as be}from"./mermaid.core-0kqJzeij.chunk.mjs";import{G as K}from"./graph-CNHk7XeV.chunk.mjs";import{l as me}from"./layout-Cb4XOrj9.chunk.mjs";import{w as N}from"./json-v_2RcB6K.chunk.mjs";import"./modulepreload-polyfill-DMTabKmO.chunk.mjs";import"./emoji-picker-SoWZqoso.chunk.mjs";import"./NcNoteCard-CImn6F9p-9zf-u00P.chunk.mjs";import"./vue.runtime.esm-DaLNuXGQ.chunk.mjs";import"./_baseUniq-h5A9VGTV.chunk.mjs";import"./_basePickBy-C8MYhUMS.chunk.mjs";import"./clone-DAF9r9hI.chunk.mjs";var h={},v={},Q={},xe=f(()=>{v={},Q={},h={}},"clear"),L=f((t,e)=>(i.trace("In isDescendant",e," ",t," = ",v[e].includes(t)),!!v[e].includes(t)),"isDescendant"),ve=f((t,e)=>(i.info("Descendants of ",e," is ",v[e]),i.info("Edge is ",t),t.v===e||t.w===e?!1:v[e]?v[e].includes(t.v)||L(t.v,e)||L(t.w,e)||v[e].includes(t.w):(i.debug("Tilt, ",e,",not in descendants"),!1)),"edgeInCluster"),U=f((t,e,n,o)=>{i.warn("Copying children of ",t,"root",o,"data",e.node(t),o);const r=e.children(t)||[];t!==o&&r.push(t),i.warn("Copying (nodes) clusterId",t,"nodes",r),r.forEach(a=>{if(e.children(a).length>0)U(a,e,n,o);else{const s=e.node(a);i.info("cp ",a," to ",o," with parent ",t),n.setNode(a,s),o!==e.parent(a)&&(i.warn("Setting parent",a,e.parent(a)),n.setParent(a,e.parent(a))),t!==o&&a!==t?(i.debug("Setting parent",a,t),n.setParent(a,t)):(i.info("In copy ",t,"root",o,"data",e.node(t),o),i.debug("Not Setting parent for node=",a,"cluster!==rootId",t!==o,"node!==clusterId",a!==t));const g=e.edges(a);i.debug("Copying Edges",g),g.forEach(c=>{i.info("Edge",c);const p=e.edge(c.v,c.w,c.name);i.info("Edge data",p,o);try{ve(c,o)?(i.info("Copying as ",c.v,c.w,p,c.name),n.setEdge(c.v,c.w,p,c.name),i.info("newGraph edges ",n.edges(),n.edge(n.edges()[0]))):i.info("Skipping copy of edge ",c.v,"-->",c.w," rootId: ",o," clusterId:",t)}catch(w){i.error(w)}})}i.debug("Removing node",a),e.removeNode(a)})},"copy"),V=f((t,e)=>{const n=e.children(t);let o=[...n];for(const r of n)Q[r]=t,o=[...o,...V(r,e)];return o},"extractDescendants"),X=f((t,e)=>{i.trace("Searching",t);const n=e.children(t);if(i.trace("Searching children of id ",t,n),n.length<1)return i.trace("This is a valid node",t),t;for(const o of n){const r=X(o,e);if(r)return i.trace("Found replacement for",t," => ",r),r}},"findNonClusterChild"),D=f(t=>!h[t]||!h[t].externalConnections?t:h[t]?h[t].id:t,"getAnchorId"),Ne=f((t,e)=>{if(!t||e>10){i.debug("Opting out, no graph ");return}else i.debug("Opting in, graph ");t.nodes().forEach(function(n){t.children(n).length>0&&(i.warn("Cluster identified",n," Replacement id in edges: ",X(n,t)),v[n]=V(n,t),h[n]={id:X(n,t),clusterData:t.node(n)})}),t.nodes().forEach(function(n){const o=t.children(n),r=t.edges();o.length>0?(i.debug("Cluster identified",n,v),r.forEach(a=>{if(a.v!==n&&a.w!==n){const s=L(a.v,n),g=L(a.w,n);s^g&&(i.warn("Edge: ",a," leaves cluster ",n),i.warn("Descendants of XXX ",n,": ",v[n]),h[n].externalConnections=!0)}})):i.debug("Not a cluster ",n,v)});for(let n of Object.keys(h)){const o=h[n].id,r=t.parent(o);r!==n&&h[r]&&!h[r].externalConnections&&(h[n].id=r)}t.edges().forEach(function(n){const o=t.edge(n);i.warn("Edge "+n.v+" -> "+n.w+": "+JSON.stringify(n)),i.warn("Edge "+n.v+" -> "+n.w+": "+JSON.stringify(t.edge(n)));let r=n.v,a=n.w;if(i.warn("Fix XXX",h,"ids:",n.v,n.w,"Translating: ",h[n.v]," --- ",h[n.w]),h[n.v]&&h[n.w]&&h[n.v]===h[n.w]){i.warn("Fixing and trixing link to self - removing XXX",n.v,n.w,n.name),i.warn("Fixing and trixing - removing XXX",n.v,n.w,n.name),r=D(n.v),a=D(n.w),t.removeEdge(n.v,n.w,n.name);const s=n.w+"---"+n.v;t.setNode(s,{domId:s,id:s,labelStyle:"",labelText:o.label,padding:0,shape:"labelRect",style:""});const g=structuredClone(o),c=structuredClone(o);g.label="",g.arrowTypeEnd="none",c.label="",g.fromCluster=n.v,c.toCluster=n.v,t.setEdge(r,s,g,n.name+"-cyclic-special"),t.setEdge(s,a,c,n.name+"-cyclic-special")}else if(h[n.v]||h[n.w]){if(i.warn("Fixing and trixing - removing XXX",n.v,n.w,n.name),r=D(n.v),a=D(n.w),t.removeEdge(n.v,n.w,n.name),r!==n.v){const s=t.parent(r);h[s].externalConnections=!0,o.fromCluster=n.v}if(a!==n.w){const s=t.parent(a);h[s].externalConnections=!0,o.toCluster=n.w}i.warn("Fix Replacing with XXX",r,a,n.name),t.setEdge(r,a,o,n.name)}}),i.warn("Adjusted Graph",N(t)),Y(t,0),i.trace(h)},"adjustClustersAndEdges"),Y=f((t,e)=>{var r,a;if(i.warn("extractor - ",e,N(t),t.children("D")),e>10){i.error("Bailing out");return}let n=t.nodes(),o=!1;for(const s of n){const g=t.children(s);o=o||g.length>0}if(!o){i.debug("Done, no node has children",t.nodes());return}i.debug("Nodes = ",n,e);for(const s of n)if(i.debug("Extracting node",s,h,h[s]&&!h[s].externalConnections,!t.parent(s),t.node(s),t.children("D")," Depth ",e),!h[s])i.debug("Not a cluster",s,e);else if(!h[s].externalConnections&&t.children(s)&&t.children(s).length>0){i.warn("Cluster without external connections, without a parent and with children",s,e);let g=t.graph().rankdir==="TB"?"LR":"TB";(a=(r=h[s])==null?void 0:r.clusterData)!=null&&a.dir&&(g=h[s].clusterData.dir,i.warn("Fixing dir",h[s].clusterData.dir,g));const c=new K({multigraph:!0,compound:!0}).setGraph({rankdir:g,nodesep:50,ranksep:50,marginx:8,marginy:8}).setDefaultEdgeLabel(function(){return{}});i.warn("Old graph before copy",N(t)),U(s,t,c,s),t.setNode(s,{clusterNode:!0,id:s,clusterData:h[s].clusterData,labelText:h[s].labelText,graph:c}),i.warn("New graph after copy node: (",s,")",N(c)),i.debug("Old graph after copy",N(t))}else i.warn("Cluster ** ",s," **not meeting the criteria !externalConnections:",!h[s].externalConnections," no parent: ",!t.parent(s)," children ",t.children(s)&&t.children(s).length>0,t.children("D"),e),i.debug(h);n=t.nodes(),i.warn("New list of nodes",n);for(const s of n){const g=t.node(s);i.warn(" Now next level",s,g),g.clusterNode&&Y(g.graph,e+1)}},"extractor"),Z=f((t,e)=>{if(e.length===0)return[];let n=Object.assign(e);return e.forEach(o=>{const r=t.children(o),a=Z(t,r);n=[...n,...a]}),n},"sorter"),Se=f(t=>Z(t,t.children()),"sortNodesByHierarchy"),Ee=f((t,e)=>{i.info("Creating subgraph rect for ",e.id,e);const n=b(),o=t.insert("g").attr("class","cluster"+(e.class?" "+e.class:"")).attr("id",e.id),r=o.insert("rect",":first-child"),a=B(n.flowchart.htmlLabels),s=o.insert("g").attr("class","cluster-label"),g=e.labelType==="markdown"?be(s,e.labelText,{style:e.labelStyle,useHtmlLabels:a},n):s.node().appendChild(_(e.labelText,e.labelStyle,void 0,!0));let c=g.getBBox();if(B(n.flowchart.htmlLabels)){const d=g.children[0],l=k(g);c=d.getBoundingClientRect(),l.attr("width",c.width),l.attr("height",c.height)}const p=0*e.padding,w=p/2,u=e.width<=c.width+p?c.width+p:e.width;e.width<=c.width+p?e.diff=(c.width-e.width)/2-e.padding/2:e.diff=-e.padding/2,i.trace("Data ",e,JSON.stringify(e)),r.attr("style",e.style).attr("rx",e.rx).attr("ry",e.ry).attr("x",e.x-u/2).attr("y",e.y-e.height/2-w).attr("width",u).attr("height",e.height+p);const{subGraphTitleTopMargin:m}=J(n);a?s.attr("transform","translate(".concat(e.x-c.width/2,", ").concat(e.y-e.height/2+m,")")):s.attr("transform","translate(".concat(e.x,", ").concat(e.y-e.height/2+m,")"));const y=r.node().getBBox();return e.width=y.width,e.height=y.height,e.intersect=function(d){return O(e,d)},o},"rect"),Te=f((t,e)=>{const n=t.insert("g").attr("class","note-cluster").attr("id",e.id),o=n.insert("rect",":first-child"),r=0*e.padding,a=r/2;o.attr("rx",e.rx).attr("ry",e.ry).attr("x",e.x-e.width/2-a).attr("y",e.y-e.height/2-a).attr("width",e.width+r).attr("height",e.height+r).attr("fill","none");const s=o.node().getBBox();return e.width=s.width,e.height=s.height,e.intersect=function(g){return O(e,g)},n},"noteGroup"),Ce=f((t,e)=>{const n=b(),o=t.insert("g").attr("class",e.classes).attr("id",e.id),r=o.insert("rect",":first-child"),a=o.insert("g").attr("class","cluster-label"),s=o.append("rect"),g=a.node().appendChild(_(e.labelText,e.labelStyle,void 0,!0));let c=g.getBBox();if(B(n.flowchart.htmlLabels)){const d=g.children[0],l=k(g);c=d.getBoundingClientRect(),l.attr("width",c.width),l.attr("height",c.height)}c=g.getBBox();const p=0*e.padding,w=p/2,u=e.width<=c.width+e.padding?c.width+e.padding:e.width;e.width<=c.width+e.padding?e.diff=(c.width+e.padding*0-e.width)/2:e.diff=-e.padding/2,r.attr("class","outer").attr("x",e.x-u/2-w).attr("y",e.y-e.height/2-w).attr("width",u+p).attr("height",e.height+p),s.attr("class","inner").attr("x",e.x-u/2-w).attr("y",e.y-e.height/2-w+c.height-1).attr("width",u+p).attr("height",e.height+p-c.height-3);const{subGraphTitleTopMargin:m}=J(n);a.attr("transform","translate(".concat(e.x-c.width/2,", ").concat(e.y-e.height/2-e.padding/3+(B(n.flowchart.htmlLabels)?5:3)+m,")"));const y=r.node().getBBox();return e.height=y.height,e.intersect=function(d){return O(e,d)},o},"roundedWithTitle"),ke=f((t,e)=>{const n=t.insert("g").attr("class",e.classes).attr("id",e.id),o=n.insert("rect",":first-child"),r=0*e.padding,a=r/2;o.attr("class","divider").attr("x",e.x-e.width/2-a).attr("y",e.y-e.height/2).attr("width",e.width+r).attr("height",e.height+r);const s=o.node().getBBox();return e.width=s.width,e.height=s.height,e.diff=-e.padding/2,e.intersect=function(g){return O(e,g)},n},"divider"),Xe={rect:Ee,roundedWithTitle:Ce,noteGroup:Te,divider:ke},ee={},De=f((t,e)=>{i.trace("Inserting cluster");const n=e.shape||"rect";ee[e.id]=Xe[n](t,e)},"insertCluster"),Be=f(()=>{ee={}},"clear"),te=f(async(t,e,n,o,r,a)=>{i.info("Graph in recursive render: XXX",N(e),r);const s=e.graph().rankdir;i.trace("Dir in recursive render - dir:",s);const g=t.insert("g").attr("class","root");e.nodes()?i.info("Recursive render XXX",e.nodes()):i.info("No nodes found for",e),e.edges().length>0&&i.trace("Recursive edges",e.edge(e.edges()[0]));const c=g.insert("g").attr("class","clusters"),p=g.insert("g").attr("class","edgePaths"),w=g.insert("g").attr("class","edgeLabels"),u=g.insert("g").attr("class","nodes");await Promise.all(e.nodes().map(async function(d){const l=e.node(d);if(r!==void 0){const x=JSON.parse(JSON.stringify(r.clusterData));i.info("Setting data for cluster XXX (",d,") ",x,r),e.setNode(r.id,x),e.parent(d)||(i.trace("Setting parent",d,r.id),e.setParent(d,r.id,x))}if(i.info("(Insert) Node XXX"+d+": "+JSON.stringify(e.node(d))),l==null?void 0:l.clusterNode){i.info("Cluster identified",d,l.width,e.node(d));const{ranksep:x,nodesep:S}=e.graph();l.graph.setGraph({...l.graph.graph(),ranksep:x,nodesep:S});const T=await te(u,l.graph,n,o,e.node(d),a),E=T.elem;he(l,E),l.diff=T.diff||0,i.info("Node bounds (abc123)",d,l,l.width,l.x,l.y),fe(E,l),i.warn("Recursive render complete ",E,l)}else e.children(d).length>0?(i.info("Cluster - the non recursive path XXX",d,l.id,l,e),i.info(X(l.id,e)),h[l.id]={id:X(l.id,e),node:l}):(i.info("Node - the non recursive path",d,l.id,l),await pe(u,e.node(d),s))})),e.edges().forEach(async function(d){const l=e.edge(d.v,d.w,d.name);i.info("Edge "+d.v+" -> "+d.w+": "+JSON.stringify(d)),i.info("Edge "+d.v+" -> "+d.w+": ",d," ",JSON.stringify(e.edge(d))),i.info("Fix",h,"ids:",d.v,d.w,"Translating: ",h[d.v],h[d.w]),await se(w,l)}),e.edges().forEach(function(d){i.info("Edge "+d.v+" -> "+d.w+": "+JSON.stringify(d))}),i.info("Graph before layout:",JSON.stringify(N(e))),i.info("#############################################"),i.info("###                Layout                 ###"),i.info("#############################################"),i.info(e),me(e),i.info("Graph after layout:",JSON.stringify(N(e)));let m=0;const{subGraphTitleTotalMargin:y}=J(a);return Se(e).forEach(function(d){const l=e.node(d);i.info("Position "+d+": "+JSON.stringify(e.node(d))),i.info("Position "+d+": ("+l.x,","+l.y,") width: ",l.width," height: ",l.height),l!=null&&l.clusterNode?(l.y+=y,j(l)):e.children(d).length>0?(l.height+=y,De(c,l),h[l.id].node=l):(l.y+=y/2,j(l))}),e.edges().forEach(function(d){const l=e.edge(d);i.info("Edge "+d.v+" -> "+d.w+": "+JSON.stringify(l),l),l.points.forEach(S=>S.y+=y/2);const x=oe(p,d,l,h,n,e,o);de(l,x)}),e.nodes().forEach(function(d){const l=e.node(d);i.info(d,l.type,l.diff),l.type==="group"&&(m=l.diff)}),{elem:g,diff:m}},"recursiveRender"),Le=f(async(t,e,n,o,r)=>{ie(t,n,o,r),ge(),ae(),Be(),xe(),i.warn("Graph at first:",JSON.stringify(N(e))),Ne(e),i.warn("Graph after:",JSON.stringify(N(e)));const a=b();await te(t,e,o,r,void 0,a)},"render"),A=f(t=>q.sanitizeText(t,b()),"sanitizeText"),R={dividerMargin:10,padding:5,textHeight:10,curve:void 0},Oe=f(function(t,e,n,o){i.info("keys:",[...t.keys()]),i.info(t),t.forEach(function(r){var s,g,c;const a={shape:"rect",id:r.id,domId:r.domId,labelText:A(r.id),labelStyle:"",style:"fill: none; stroke: black",padding:(c=(s=b().flowchart)==null?void 0:s.padding)!=null?c:(g=b().class)==null?void 0:g.padding};e.setNode(r.id,a),ne(r.classes,e,n,o,r.id),i.info("setNode",a)})},"addNamespaces"),ne=f(function(t,e,n,o,r){i.info("keys:",[...t.keys()]),i.info(t),[...t.values()].filter(a=>a.parent===r).forEach(function(a){var u,m,y,d;const s=a.cssClasses.join(" "),g=H(a.styles),c=(u=a.label)!=null?u:a.id,p=0,w={labelStyle:g.labelStyle,shape:"class_box",labelText:A(c),classData:a,rx:p,ry:p,class:s,style:g.style,id:a.id,domId:a.domId,tooltip:o.db.getTooltip(a.id,r)||"",haveCallback:a.haveCallback,link:a.link,width:a.type==="group"?500:void 0,type:a.type,padding:(d=(m=b().flowchart)==null?void 0:m.padding)!=null?d:(y=b().class)==null?void 0:y.padding};e.setNode(a.id,w),r&&e.setParent(a.id,r),i.info("setNode",w)})},"addClasses"),Ie=f(function(t,e,n,o){i.info(t),t.forEach(function(r,a){var d,l,x;const s=r,g="",c={labelStyle:"",style:""},p=s.text,w=0,u={labelStyle:c.labelStyle,shape:"note",labelText:A(p),noteData:s,rx:w,ry:w,class:g,style:c.style,id:s.id,domId:s.id,tooltip:"",type:"note",padding:(x=(d=b().flowchart)==null?void 0:d.padding)!=null?x:(l=b().class)==null?void 0:l.padding};if(e.setNode(s.id,u),i.info("setNode",u),!s.class||!o.has(s.class))return;const m=n+a,y={id:"edgeNote".concat(m),classes:"relation",pattern:"dotted",arrowhead:"none",startLabelRight:"",endLabelLeft:"",arrowTypeStart:"none",arrowTypeEnd:"none",style:"fill:none",labelStyle:"",curve:W(R.curve,z)};e.setEdge(s.id,s.class,y,m)})},"addNotes"),Re=f(function(t,e){const n=b().flowchart;let o=0;t.forEach(function(r){var s,g;o++;const a={classes:"relation",pattern:r.relation.lineType==1?"dashed":"solid",id:ye(r.id1,r.id2,{prefix:"id",counter:o}),arrowhead:r.type==="arrow_open"?"none":"normal",startLabelRight:r.relationTitle1==="none"?"":r.relationTitle1,endLabelLeft:r.relationTitle2==="none"?"":r.relationTitle2,arrowTypeStart:G(r.relation.type1),arrowTypeEnd:G(r.relation.type2),style:"fill:none",labelStyle:"",curve:W(n==null?void 0:n.curve,z)};if(i.info(a,r),r.style!==void 0){const c=H(r.style);a.style=c.style,a.labelStyle=c.labelStyle}r.text=r.title,r.text===void 0?r.style!==void 0&&(a.arrowheadStyle="fill: #333"):(a.arrowheadStyle="fill: #333",a.labelpos="c",((g=(s=b().flowchart)==null?void 0:s.htmlLabels)!=null?g:b().htmlLabels)?(a.labelType="html",a.label='<span class="edgeLabel">'+r.text+"</span>"):(a.labelType="text",a.label=r.text.replace(q.lineBreakRegex,"\n"),r.style===void 0&&(a.style=a.style||"stroke: #333; stroke-width: 1.5px;fill:none"),a.labelStyle=a.labelStyle.replace("color:","fill:"))),e.setEdge(r.id1,r.id2,a,o)})},"addRelations"),Ge=f(function(t){R={...R,...t}},"setConf"),Je=f(async function(t,e,n,o){var S,T,E,M;i.info("Drawing class - ",e);const r=(S=b().flowchart)!=null?S:b().class,a=b().securityLevel;i.info("config:",r);const s=(T=r==null?void 0:r.nodeSpacing)!=null?T:50,g=(E=r==null?void 0:r.rankSpacing)!=null?E:50,c=new K({multigraph:!0,compound:!0}).setGraph({rankdir:o.db.getDirection(),nodesep:s,ranksep:g,marginx:8,marginy:8}).setDefaultEdgeLabel(function(){return{}}),p=o.db.getNamespaces(),w=o.db.getClasses(),u=o.db.getRelations(),m=o.db.getNotes();i.info(u),Oe(p,c,e,o),ne(w,c,e,o),Re(u,c),Ie(m,c,u.length+1,w);let y;a==="sandbox"&&(y=k("#i"+e));const d=a==="sandbox"?k(y.nodes()[0].contentDocument.body):k("body"),l=d.select('[id="'.concat(e,'"]')),x=d.select("#"+e+" g");if(await Le(x,c,["aggregation","extension","composition","dependency","lollipop"],"classDiagram",e),ue.insertTitle(l,"classTitleText",(M=r==null?void 0:r.titleTopMargin)!=null?M:5,o.db.getDiagramTitle()),we(c,l,r==null?void 0:r.diagramPadding,r==null?void 0:r.useMaxWidth),!(r!=null&&r.htmlLabels)){const P=a==="sandbox"?y.nodes()[0].contentDocument:document,re=P.querySelectorAll('[id="'+e+'"] .edgeLabel .label');for(const I of re){const F=I.getBBox(),C=P.createElementNS("http://www.w3.org/2000/svg","rect");C.setAttribute("rx",0),C.setAttribute("ry",0),C.setAttribute("width",F.width),C.setAttribute("height",F.height),I.insertBefore(C,I.firstChild)}}},"draw");function G(t){let e;switch(t){case 0:e="aggregation";break;case 1:e="extension";break;case 2:e="composition";break;case 3:e="dependency";break;case 4:e="lollipop";break;default:e="none"}return e}f(G,"getArrowMarker");var Ae={setConf:Ge,draw:Je},Ye={parser:le,db:$,renderer:Ae,styles:ce,init:f(t=>{t.class||(t.class={}),t.class.arrowMarkerAbsolute=t.arrowMarkerAbsolute,$.clear()},"init")};export{Ye as diagram};
