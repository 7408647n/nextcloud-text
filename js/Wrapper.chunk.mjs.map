{"version":3,"file":"Wrapper.chunk.mjs","sources":["../node_modules/y-protocols/awareness.js","../src/components/Menu/ActionListItem.vue","../src/components/Menu/ActionList.vue","../src/components/Menu/ActionSingle.vue","../src/components/Menu/ToolBarLogic.js","../src/components/Menu/ReadonlyBar.vue","../src/helpers/base64.ts","../node_modules/y-protocols/sync.js","../node_modules/lib0/broadcastchannel.js","../node_modules/y-protocols/auth.js","../node_modules/lib0/url.js","../node_modules/y-websocket/src/y-websocket.js","../src/helpers/yjs.js","../node_modules/mitt/dist/mitt.mjs","../src/services/SessionApi.js","../src/services/PollingBackend.js","../src/services/SyncService.js","../node_modules/path-normalize/lib/index.js","../src/services/AttachmentResolver.js","../src/components/Menu/ActionFormattingHelp.vue","../src/components/Menu/CharacterCount.vue","../src/helpers/platform.js","../src/components/HelpModal.vue","../src/components/Menu/MenuBar.vue","../src/components/Editor/ContentContainer.vue","../src/components/Editor/MediaHandler.vue","../src/components/Editor/MainContainer.vue","../src/components/Editor/Wrapper.vue"],"sourcesContent":["/**\n * @module awareness-protocol\n */\n\nimport * as encoding from 'lib0/encoding'\nimport * as decoding from 'lib0/decoding'\nimport * as time from 'lib0/time'\nimport * as math from 'lib0/math'\nimport { Observable } from 'lib0/observable'\nimport * as f from 'lib0/function'\nimport * as Y from 'yjs' // eslint-disable-line\n\nexport const outdatedTimeout = 30000\n\n/**\n * @typedef {Object} MetaClientState\n * @property {number} MetaClientState.clock\n * @property {number} MetaClientState.lastUpdated unix timestamp\n */\n\n/**\n * The Awareness class implements a simple shared state protocol that can be used for non-persistent data like awareness information\n * (cursor, username, status, ..). Each client can update its own local state and listen to state changes of\n * remote clients. Every client may set a state of a remote peer to `null` to mark the client as offline.\n *\n * Each client is identified by a unique client id (something we borrow from `doc.clientID`). A client can override\n * its own state by propagating a message with an increasing timestamp (`clock`). If such a message is received, it is\n * applied if the known state of that client is older than the new state (`clock < newClock`). If a client thinks that\n * a remote client is offline, it may propagate a message with\n * `{ clock: currentClientClock, state: null, client: remoteClient }`. If such a\n * message is received, and the known clock of that client equals the received clock, it will override the state with `null`.\n *\n * Before a client disconnects, it should propagate a `null` state with an updated clock.\n *\n * Awareness states must be updated every 30 seconds. Otherwise the Awareness instance will delete the client state.\n *\n * @extends {Observable<string>}\n */\nexport class Awareness extends Observable {\n  /**\n   * @param {Y.Doc} doc\n   */\n  constructor (doc) {\n    super()\n    this.doc = doc\n    /**\n     * @type {number}\n     */\n    this.clientID = doc.clientID\n    /**\n     * Maps from client id to client state\n     * @type {Map<number, Object<string, any>>}\n     */\n    this.states = new Map()\n    /**\n     * @type {Map<number, MetaClientState>}\n     */\n    this.meta = new Map()\n    this._checkInterval = /** @type {any} */ (setInterval(() => {\n      const now = time.getUnixTime()\n      if (this.getLocalState() !== null && (outdatedTimeout / 2 <= now - /** @type {{lastUpdated:number}} */ (this.meta.get(this.clientID)).lastUpdated)) {\n        // renew local clock\n        this.setLocalState(this.getLocalState())\n      }\n      /**\n       * @type {Array<number>}\n       */\n      const remove = []\n      this.meta.forEach((meta, clientid) => {\n        if (clientid !== this.clientID && outdatedTimeout <= now - meta.lastUpdated && this.states.has(clientid)) {\n          remove.push(clientid)\n        }\n      })\n      if (remove.length > 0) {\n        removeAwarenessStates(this, remove, 'timeout')\n      }\n    }, math.floor(outdatedTimeout / 10)))\n    doc.on('destroy', () => {\n      this.destroy()\n    })\n    this.setLocalState({})\n  }\n\n  destroy () {\n    this.emit('destroy', [this])\n    this.setLocalState(null)\n    super.destroy()\n    clearInterval(this._checkInterval)\n  }\n\n  /**\n   * @return {Object<string,any>|null}\n   */\n  getLocalState () {\n    return this.states.get(this.clientID) || null\n  }\n\n  /**\n   * @param {Object<string,any>|null} state\n   */\n  setLocalState (state) {\n    const clientID = this.clientID\n    const currLocalMeta = this.meta.get(clientID)\n    const clock = currLocalMeta === undefined ? 0 : currLocalMeta.clock + 1\n    const prevState = this.states.get(clientID)\n    if (state === null) {\n      this.states.delete(clientID)\n    } else {\n      this.states.set(clientID, state)\n    }\n    this.meta.set(clientID, {\n      clock,\n      lastUpdated: time.getUnixTime()\n    })\n    const added = []\n    const updated = []\n    const filteredUpdated = []\n    const removed = []\n    if (state === null) {\n      removed.push(clientID)\n    } else if (prevState == null) {\n      if (state != null) {\n        added.push(clientID)\n      }\n    } else {\n      updated.push(clientID)\n      if (!f.equalityDeep(prevState, state)) {\n        filteredUpdated.push(clientID)\n      }\n    }\n    if (added.length > 0 || filteredUpdated.length > 0 || removed.length > 0) {\n      this.emit('change', [{ added, updated: filteredUpdated, removed }, 'local'])\n    }\n    this.emit('update', [{ added, updated, removed }, 'local'])\n  }\n\n  /**\n   * @param {string} field\n   * @param {any} value\n   */\n  setLocalStateField (field, value) {\n    const state = this.getLocalState()\n    if (state !== null) {\n      this.setLocalState({\n        ...state,\n        [field]: value\n      })\n    }\n  }\n\n  /**\n   * @return {Map<number,Object<string,any>>}\n   */\n  getStates () {\n    return this.states\n  }\n}\n\n/**\n * Mark (remote) clients as inactive and remove them from the list of active peers.\n * This change will be propagated to remote clients.\n *\n * @param {Awareness} awareness\n * @param {Array<number>} clients\n * @param {any} origin\n */\nexport const removeAwarenessStates = (awareness, clients, origin) => {\n  const removed = []\n  for (let i = 0; i < clients.length; i++) {\n    const clientID = clients[i]\n    if (awareness.states.has(clientID)) {\n      awareness.states.delete(clientID)\n      if (clientID === awareness.clientID) {\n        const curMeta = /** @type {MetaClientState} */ (awareness.meta.get(clientID))\n        awareness.meta.set(clientID, {\n          clock: curMeta.clock + 1,\n          lastUpdated: time.getUnixTime()\n        })\n      }\n      removed.push(clientID)\n    }\n  }\n  if (removed.length > 0) {\n    awareness.emit('change', [{ added: [], updated: [], removed }, origin])\n    awareness.emit('update', [{ added: [], updated: [], removed }, origin])\n  }\n}\n\n/**\n * @param {Awareness} awareness\n * @param {Array<number>} clients\n * @return {Uint8Array}\n */\nexport const encodeAwarenessUpdate = (awareness, clients, states = awareness.states) => {\n  const len = clients.length\n  const encoder = encoding.createEncoder()\n  encoding.writeVarUint(encoder, len)\n  for (let i = 0; i < len; i++) {\n    const clientID = clients[i]\n    const state = states.get(clientID) || null\n    const clock = /** @type {MetaClientState} */ (awareness.meta.get(clientID)).clock\n    encoding.writeVarUint(encoder, clientID)\n    encoding.writeVarUint(encoder, clock)\n    encoding.writeVarString(encoder, JSON.stringify(state))\n  }\n  return encoding.toUint8Array(encoder)\n}\n\n/**\n * Modify the content of an awareness update before re-encoding it to an awareness update.\n *\n * This might be useful when you have a central server that wants to ensure that clients\n * cant hijack somebody elses identity.\n *\n * @param {Uint8Array} update\n * @param {function(any):any} modify\n * @return {Uint8Array}\n */\nexport const modifyAwarenessUpdate = (update, modify) => {\n  const decoder = decoding.createDecoder(update)\n  const encoder = encoding.createEncoder()\n  const len = decoding.readVarUint(decoder)\n  encoding.writeVarUint(encoder, len)\n  for (let i = 0; i < len; i++) {\n    const clientID = decoding.readVarUint(decoder)\n    const clock = decoding.readVarUint(decoder)\n    const state = JSON.parse(decoding.readVarString(decoder))\n    const modifiedState = modify(state)\n    encoding.writeVarUint(encoder, clientID)\n    encoding.writeVarUint(encoder, clock)\n    encoding.writeVarString(encoder, JSON.stringify(modifiedState))\n  }\n  return encoding.toUint8Array(encoder)\n}\n\n/**\n * @param {Awareness} awareness\n * @param {Uint8Array} update\n * @param {any} origin This will be added to the emitted change event\n */\nexport const applyAwarenessUpdate = (awareness, update, origin) => {\n  const decoder = decoding.createDecoder(update)\n  const timestamp = time.getUnixTime()\n  const added = []\n  const updated = []\n  const filteredUpdated = []\n  const removed = []\n  const len = decoding.readVarUint(decoder)\n  for (let i = 0; i < len; i++) {\n    const clientID = decoding.readVarUint(decoder)\n    let clock = decoding.readVarUint(decoder)\n    const state = JSON.parse(decoding.readVarString(decoder))\n    const clientMeta = awareness.meta.get(clientID)\n    const prevState = awareness.states.get(clientID)\n    const currClock = clientMeta === undefined ? 0 : clientMeta.clock\n    if (currClock < clock || (currClock === clock && state === null && awareness.states.has(clientID))) {\n      if (state === null) {\n        // never let a remote client remove this local state\n        if (clientID === awareness.clientID && awareness.getLocalState() != null) {\n          // remote client removed the local state. Do not remote state. Broadcast a message indicating\n          // that this client still exists by increasing the clock\n          clock++\n        } else {\n          awareness.states.delete(clientID)\n        }\n      } else {\n        awareness.states.set(clientID, state)\n      }\n      awareness.meta.set(clientID, {\n        clock,\n        lastUpdated: timestamp\n      })\n      if (clientMeta === undefined && state !== null) {\n        added.push(clientID)\n      } else if (clientMeta !== undefined && state === null) {\n        removed.push(clientID)\n      } else if (state !== null) {\n        if (!f.equalityDeep(state, prevState)) {\n          filteredUpdated.push(clientID)\n        }\n        updated.push(clientID)\n      }\n    }\n  }\n  if (added.length > 0 || filteredUpdated.length > 0 || removed.length > 0) {\n    awareness.emit('change', [{\n      added, updated: filteredUpdated, removed\n    }, origin])\n  }\n  if (added.length > 0 || updated.length > 0 || removed.length > 0) {\n    awareness.emit('update', [{\n      added, updated, removed\n    }, origin])\n  }\n}\n","<!--\n  - SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<NextcloudVueNcActionButton class=\"entry-single-action entry-action entry-action-item\"\n\t\t:class=\"state.class\"\n\t\t:disabled=\"state.disabled\"\n\t\t:aria-keyshortcuts=\"keyshortcuts || undefined\"\n\t\t:data-text-action-entry=\"actionEntry.key\"\n\t\t:type=\"state.type\"\n\t\t:model-value=\"state.type !== 'button' ? state.active : undefined\"\n\t\tclose-after-click\n\t\tv-on=\"$listeners\"\n\t\t@click=\"runAction\">\n\t\t<template #icon>\n\t\t\t<component :is=\"icon\" />\n\t\t</template>\n\t\t{{ label }}\n\t</NextcloudVueNcActionButton>\n</template>\n\n<script>\nimport { NcActionButton as NextcloudVueNcActionButton } from '@nextcloud/vue'\nimport { BaseActionEntry } from './BaseActionEntry.js'\n\nexport default {\n\t// This component is used as a direct child of NcActions.\n\t// Even if it actually renders NcActionButton, NcActions cannot see it due to rendering limitations in Vue.\n\t// Though it works in general, NcActions doesn't handle it correctly. See NcActions docs for details.\n\t// Hotfix - rename the component to NcActionButton because it represents and renders it.\n\t// eslint-disable-next-line vue/match-component-file-name\n\tname: 'NcActionButton',\n\n\tcomponents: {\n\t\tNextcloudVueNcActionButton,\n\t},\n\n\textends: BaseActionEntry,\n\n\tmounted() {\n\t\tthis.$editor.on('transaction', () => this.updateState())\n\t},\n\n\tmethods: {\n\t\trunAction() {\n\t\t\tconst { actionEntry } = this\n\n\t\t\tif (actionEntry.click) {\n\t\t\t\tactionEntry.click(this)\n\t\t\t} else {\n\t\t\t\t// Some actions run themselves.\n\t\t\t\t// others still need to have .run() called upon them.\n\t\t\t\tactionEntry.action(this.$editor.chain().focus())?.run()\n\t\t\t}\n\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.$emit('trigged', { ...actionEntry })\n\t\t\t})\n\t\t},\n\t},\n}\n</script>\n","<!--\n  - SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<NcActions :title=\"tooltip\"\n\t\tclass=\"entry-list-action entry-action\"\n\t\tv-bind=\"state\"\n\t\t:container=\"menuIDSelector\"\n\t\t:aria-label=\"labelWithSelected\"\n\t\t:type=\"state.active ? 'primary': 'tertiary'\"\n\t\t:force-menu=\"true\"\n\t\t:data-text-action-entry=\"actionEntry.key\"\n\t\t:data-text-action-active=\"activeKey\"\n\t\t:disabled=\"!isEnabled\"\n\t\t@update:open=\"onOpenChange\">\n\t\t<template #icon>\n\t\t\t<component :is=\"icon\" :key=\"iconKey\" />\n\t\t</template>\n\t\t<template v-for=\"child in children\">\n\t\t\t<NcActionSeparator v-if=\"child.isSeparator\" :key=\"`child-${child.key}`\" />\n\t\t\t<ActionListItem v-else\n\t\t\t\t:key=\"`child-${child.key}`\"\n\t\t\t\t:active=\"currentChild?.key === child.key\"\n\t\t\t\tis-item\n\t\t\t\t:action-entry=\"child\"\n\t\t\t\tv-on=\"$listeners\"\n\t\t\t\t@trigged=\"onTrigger\" />\n\t\t</template>\n\t\t<slot v-bind=\"{ visible }\" name=\"lastAction\" />\n\t</NcActions>\n</template>\n\n<script>\nimport { NcActions, NcActionSeparator } from '@nextcloud/vue'\nimport { BaseActionEntry } from './BaseActionEntry.js'\nimport ActionListItem from './ActionListItem.vue'\nimport { getActionState, getIsActive } from './utils.js'\nimport { useOutlineStateMixin } from '../Editor/Wrapper.provider.js'\nimport useStore from '../../mixins/store.js'\nimport { useMenuIDMixin } from './MenuBar.provider.js'\nimport debounce from 'debounce'\n\nexport default {\n\tname: 'ActionList',\n\tcomponents: {\n\t\tNcActions,\n\t\tNcActionSeparator,\n\t\tActionListItem,\n\t},\n\textends: BaseActionEntry,\n\tmixins: [useStore, useOutlineStateMixin, useMenuIDMixin],\n\tprops: {\n\t\tforceEnabled: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata: () => ({\n\t\tvisible: false,\n\t\thasEnabledChild: true,\n\t}),\n\tcomputed: {\n\t\tcurrentChild() {\n\t\t\tconst {\n\t\t\t\tstate,\n\t\t\t\t$editor,\n\t\t\t\tactionEntry: { children },\n\t\t\t} = this\n\n\t\t\tif (!state.active) {\n\t\t\t\treturn null\n\t\t\t}\n\n\t\t\treturn children.find(child => {\n\t\t\t\treturn getIsActive(child, $editor)\n\t\t\t})\n\t\t},\n\t\ticon() {\n\t\t\tif (this.currentChild) {\n\t\t\t\treturn this.currentChild.icon\n\t\t\t}\n\n\t\t\treturn this.actionEntry.icon\n\t\t},\n\t\ticonKey() {\n\t\t\treturn `${this.actionEntry.key}/${this.activeKey}`\n\t\t},\n\t\tactiveKey() {\n\t\t\treturn this.currentChild?.key\n\t\t},\n\t\tchildren() {\n\t\t\treturn this.actionEntry.children.filter(({ visible }) => {\n\t\t\t\tif (visible === undefined) {\n\t\t\t\t\treturn true\n\t\t\t\t}\n\n\t\t\t\treturn typeof visible === 'function'\n\t\t\t\t\t? visible(this)\n\t\t\t\t\t: visible\n\t\t\t})\n\t\t},\n\t\tlabelWithSelected() {\n\t\t\tif (this.currentChild) {\n\t\t\t\t// TRANSLATORS: examples - Headings, \"Heading 1\" is selected - Callouts, \"Info\" is selected\n\t\t\t\treturn t('text', '{menuItemName}, \"{selectedSubMenuItemName}\" is selected', {\n\t\t\t\t\tmenuItemName: this.actionEntry.label,\n\t\t\t\t\tselectedSubMenuItemName: this.currentChild.label,\n\t\t\t\t})\n\t\t\t}\n\n\t\t\treturn this.actionEntry.label\n\t\t},\n\t\tisEnabled() {\n\t\t\treturn this.forceEnabled || this.hasEnabledChild\n\t\t},\n\t},\n\tmounted() {\n\t\tthis.$_updateState = debounce(this.checkStateOfChildren.bind(this), 50)\n\t\tthis.$editor.on('update', this.$_updateState)\n\t\tthis.$editor.on('selectionUpdate', this.$_updateState)\n\t},\n\tbeforeDestroy() {\n\t\tthis.$editor.off('update', this.$_updateState)\n\t\tthis.$editor.off('selectionUpdate', this.$_updateState)\n\t},\n\tmethods: {\n\t\tonOpenChange(val) {\n\t\t\tthis.visible = val\n\t\t},\n\t\trunAction() {\n\t\t\t// nothing todo\n\t\t},\n\t\tonTrigger(entry) {\n\t\t\tif (entry?.click) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\tthis.$editor.chain().focus().run()\n\t\t\tthis.$emit('trigged', entry)\n\t\t},\n\t\tcheckStateOfChildren() {\n\t\t\tthis.hasEnabledChild = this.children.some(child => this.isChildEnabled(child))\n\t\t},\n\t\tisChildEnabled(child) {\n\t\t\treturn !child.isSeparator\n\t\t\t\t&& !getActionState(child, this.$editor).disabled\n\t\t},\n\t},\n}\n</script>\n","<!--\n  - SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<NcButton class=\"entry-single-action entry-action\"\n\t\t:class=\"state.class\"\n\t\t:disabled=\"state.disabled\"\n\t\t:aria-keyshortcuts=\"keyshortcuts || undefined\"\n\t\t:data-text-action-entry=\"actionEntry.key\"\n\t\t:aria-label=\"label\"\n\t\t:title=\"tooltip\"\n\t\ttype=\"tertiary\"\n\t\t:pressed=\"state.type !== 'button' ? state.active : undefined\"\n\t\tv-on=\"$listeners\"\n\t\t@click=\"runAction\">\n\t\t<template #icon>\n\t\t\t<component :is=\"icon\" />\n\t\t</template>\n\n\t\t<template v-if=\"actionEntry.forceLabel\" #default>\n\t\t\t{{ label }}\n\t\t</template>\n\t</NcButton>\n</template>\n\n<script>\nimport { NcButton } from '@nextcloud/vue'\nimport { BaseActionEntry } from './BaseActionEntry.js'\n\nexport default {\n\tname: 'ActionSingle',\n\n\tcomponents: {\n\t\tNcButton,\n\t},\n\n\textends: BaseActionEntry,\n\n\tprops: {\n\t\tisItem: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\n\tmounted() {\n\t\tthis.$editor.on('transaction', () => this.updateState())\n\t},\n\n\tmethods: {\n\t\trunAction() {\n\t\t\tconst { actionEntry } = this\n\n\t\t\tif (actionEntry.click) {\n\t\t\t\tactionEntry.click(this)\n\t\t\t} else {\n\t\t\t\t// Some actions run themselves.\n\t\t\t\t// others still need to have .run() called upon them.\n\t\t\t\tactionEntry.action(this.$editor.chain().focus())?.run()\n\t\t\t}\n\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.$emit('trigged', { ...actionEntry })\n\t\t\t})\n\t\t},\n\t},\n}\n</script>\n","/**\n * SPDX-FileCopyrightText: 2023 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { defineComponent } from 'vue'\n\nexport default defineComponent({\n\tdata() {\n\t\treturn {\n\t\t\t/** Current menu entry that has focus */\n\t\t\tactiveMenuEntry: 0,\n\t\t\tentries: [],\n\t\t}\n\t},\n\tcomputed: {\n\t\tvisibleEntries() {\n\t\t\treturn this.entries\n\t\t},\n\t},\n\twatch: {\n\t\tvisibleEntries() {\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tif (this.activeMenuEntry > this.visibleEntries.length || this.visibleEntries[this.activeMenuEntry]?.disabled) {\n\t\t\t\t\tthis.setNextMenuEntry()\n\t\t\t\t}\n\t\t\t})\n\t\t},\n\t},\n\tmethods: {\n\t\t/**\n\t\t * Update the disabled state of an menu entry\n\t\t * @param {string} menuKey The key of the menu entry that changed\n\t\t * @param {boolean} state The new disabled state\n\t\t */\n\t\tdisableMenuEntry(menuKey, state) {\n\t\t\tconst index = this.visibleEntries.findIndex(({ key }) => key === menuKey)\n\t\t\tthis.visibleEntries[index].disabled = state\n\t\t\tif (state === false && this.activeMenuEntry === index) {\n\t\t\t\tthis.$nextTick(() => this.setNextMenuEntry())\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Set the active menu entry to the next one (or reset to first)\n\t\t */\n\t\tsetNextMenuEntry() {\n\t\t\t// refs is not reactive so we must check this every time\n\t\t\tconst modulo = this.visibleEntries.length + (this.$refs.remainingEntries ? 1 : 0)\n\n\t\t\tdo {\n\t\t\t\tthis.activeMenuEntry = (this.activeMenuEntry + 1) % modulo\n\t\t\t} while (this.activeMenuEntry < this.visibleEntries.length && this.visibleEntries[this.activeMenuEntry].disabled)\n\t\t},\n\t\t/**\n\t\t * Set the active menu entry to the previous one (or reset to last entry (remaining actions))\n\t\t */\n\t\tsetPreviousMenuEntry() {\n\t\t\t// refs is not reactive so we must check this every time\n\t\t\tconst modulo = this.visibleEntries.length + (this.$refs.remainingEntries ? 1 : 0)\n\n\t\t\tdo {\n\t\t\t\tconst index = this.activeMenuEntry - 1\n\t\t\t\tthis.activeMenuEntry = ((index % modulo) + modulo) % modulo // needed as JS does not work with negative modulos\n\t\t\t} while (this.activeMenuEntry < this.visibleEntries.length && this.visibleEntries[this.activeMenuEntry].disabled)\n\t\t},\n\n\t\t/**\n\t\t * Handle navigation in toolbar\n\t\t * @param {KeyboardEvent} event The keydown event\n\t\t */\n\t\thandleToolbarNavigation(event) {\n\t\t\tif (event.key === 'ArrowRight') {\n\t\t\t\tthis.setNextMenuEntry()\n\t\t\t} else if (event.key === 'ArrowLeft') {\n\t\t\t\tthis.setPreviousMenuEntry()\n\t\t\t}\n\n\t\t\tif (this.activeMenuEntry === this.visibleEntries.length) {\n\t\t\t\tthis.$refs.remainingEntries?.focusButton?.()\n\t\t\t} else {\n\t\t\t\t// The ref is in no order (ordered by the time they needed to mount), so we need to order them like they are shown on the menu\n\t\t\t\tconst entries = [...this.$refs.menuEntries].sort((a, b) => this.visibleEntries.findIndex(({ key }) => key === a.$vnode.data.key) - this.visibleEntries.findIndex(({ key }) => key === b.$vnode.data.key))\n\t\t\t\tentries[this.activeMenuEntry].focusButton()\n\t\t\t}\n\t\t},\n\t},\n})\n","<!--\n  - SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<div data-text-el=\"readonly-bar\" class=\"text-readonly-bar\">\n\t\t<div ref=\"menubar\"\n\t\t\trole=\"toolbar\"\n\t\t\tclass=\"text-readonly-bar__entries\"\n\t\t\t:aria-label=\"t('text', 'Editor actions')\">\n\t\t\t<component :is=\"actionEntry.component ? actionEntry.component : (actionEntry.children ? 'ActionList' : 'ActionSingle')\"\n\t\t\t\tv-for=\"(actionEntry, index) in visibleEntries\"\n\t\t\t\tref=\"menuEntries\"\n\t\t\t\t:key=\"actionEntry.key\"\n\t\t\t\t:action-entry=\"actionEntry\"\n\t\t\t\t:can-be-focussed=\"activeMenuEntry === index\"\n\t\t\t\t@disabled=\"disableMenuEntry(actionEntry.key, $event)\" />\n\t\t</div>\n\t\t<div class=\"text-menubar__slot\">\n\t\t\t<slot />\n\t\t</div>\n\t</div>\n</template>\n\n<script>\nimport { defineComponent } from 'vue'\nimport { ReadonlyEntries as entries } from './entries.js'\n\nimport ActionList from './ActionList.vue'\nimport ActionSingle from './ActionSingle.vue'\nimport ToolBarLogic from './ToolBarLogic.js'\n\nexport default defineComponent({\n\tname: 'ReadonlyBar',\n\tcomponents: {\n\t\tActionList,\n\t\tActionSingle,\n\t},\n\textends: ToolBarLogic,\n\tdata() {\n\t\treturn {\n\t\t\tentries,\n\t\t}\n\t},\n})\n</script>\n\n<style scoped>\n.text-readonly-bar {\n\tdisplay: flex;\n}\n.text-readonly-bar__entries {\n\tdisplay: flex;\n\tflex-grow: 1;\n}\n</style>\n","/**\n * SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\n/*\n * This helper provides Base64 encoding and decoding for ArrayBuffers.\n *\n * We use lib0/buffer for now as it's a dependency of y.js\n * and does not add new dependencies.\n *\n */\n\nimport { toBase64, fromBase64 } from 'lib0/buffer'\n\n/**\n *\n * @param {ArrayBuffer} data - binary data to encode\n */\nexport function encodeArrayBuffer(data: ArrayBuffer): string {\n\tconst view = new Uint8Array(data)\n\treturn toBase64(view)\n}\n\n/**\n *\n * @param {string} encoded - base64 encoded string to decode\n */\nexport function decodeArrayBuffer(encoded: string): ArrayBuffer {\n\treturn fromBase64(encoded)\n}\n","/**\n * @module sync-protocol\n */\n\nimport * as encoding from 'lib0/encoding'\nimport * as decoding from 'lib0/decoding'\nimport * as Y from 'yjs'\n\n/**\n * @typedef {Map<number, number>} StateMap\n */\n\n/**\n * Core Yjs defines two message types:\n * • YjsSyncStep1: Includes the State Set of the sending client. When received, the client should reply with YjsSyncStep2.\n * • YjsSyncStep2: Includes all missing structs and the complete delete set. When received, the client is assured that it\n *   received all information from the remote client.\n *\n * In a peer-to-peer network, you may want to introduce a SyncDone message type. Both parties should initiate the connection\n * with SyncStep1. When a client received SyncStep2, it should reply with SyncDone. When the local client received both\n * SyncStep2 and SyncDone, it is assured that it is synced to the remote client.\n *\n * In a client-server model, you want to handle this differently: The client should initiate the connection with SyncStep1.\n * When the server receives SyncStep1, it should reply with SyncStep2 immediately followed by SyncStep1. The client replies\n * with SyncStep2 when it receives SyncStep1. Optionally the server may send a SyncDone after it received SyncStep2, so the\n * client knows that the sync is finished.  There are two reasons for this more elaborated sync model: 1. This protocol can\n * easily be implemented on top of http and websockets. 2. The server should only reply to requests, and not initiate them.\n * Therefore it is necessary that the client initiates the sync.\n *\n * Construction of a message:\n * [messageType : varUint, message definition..]\n *\n * Note: A message does not include information about the room name. This must to be handled by the upper layer protocol!\n *\n * stringify[messageType] stringifies a message definition (messageType is already read from the bufffer)\n */\n\nexport const messageYjsSyncStep1 = 0\nexport const messageYjsSyncStep2 = 1\nexport const messageYjsUpdate = 2\n\n/**\n * Create a sync step 1 message based on the state of the current shared document.\n *\n * @param {encoding.Encoder} encoder\n * @param {Y.Doc} doc\n */\nexport const writeSyncStep1 = (encoder, doc) => {\n  encoding.writeVarUint(encoder, messageYjsSyncStep1)\n  const sv = Y.encodeStateVector(doc)\n  encoding.writeVarUint8Array(encoder, sv)\n}\n\n/**\n * @param {encoding.Encoder} encoder\n * @param {Y.Doc} doc\n * @param {Uint8Array} [encodedStateVector]\n */\nexport const writeSyncStep2 = (encoder, doc, encodedStateVector) => {\n  encoding.writeVarUint(encoder, messageYjsSyncStep2)\n  encoding.writeVarUint8Array(encoder, Y.encodeStateAsUpdate(doc, encodedStateVector))\n}\n\n/**\n * Read SyncStep1 message and reply with SyncStep2.\n *\n * @param {decoding.Decoder} decoder The reply to the received message\n * @param {encoding.Encoder} encoder The received message\n * @param {Y.Doc} doc\n */\nexport const readSyncStep1 = (decoder, encoder, doc) =>\n  writeSyncStep2(encoder, doc, decoding.readVarUint8Array(decoder))\n\n/**\n * Read and apply Structs and then DeleteStore to a y instance.\n *\n * @param {decoding.Decoder} decoder\n * @param {Y.Doc} doc\n * @param {any} transactionOrigin\n */\nexport const readSyncStep2 = (decoder, doc, transactionOrigin) => {\n  try {\n    Y.applyUpdate(doc, decoding.readVarUint8Array(decoder), transactionOrigin)\n  } catch (error) {\n    // This catches errors that are thrown by event handlers\n    console.error('Caught error while handling a Yjs update', error)\n  }\n}\n\n/**\n * @param {encoding.Encoder} encoder\n * @param {Uint8Array} update\n */\nexport const writeUpdate = (encoder, update) => {\n  encoding.writeVarUint(encoder, messageYjsUpdate)\n  encoding.writeVarUint8Array(encoder, update)\n}\n\n/**\n * Read and apply Structs and then DeleteStore to a y instance.\n *\n * @param {decoding.Decoder} decoder\n * @param {Y.Doc} doc\n * @param {any} transactionOrigin\n */\nexport const readUpdate = readSyncStep2\n\n/**\n * @param {decoding.Decoder} decoder A message received from another client\n * @param {encoding.Encoder} encoder The reply message. Does not need to be sent if empty.\n * @param {Y.Doc} doc\n * @param {any} transactionOrigin\n */\nexport const readSyncMessage = (decoder, encoder, doc, transactionOrigin) => {\n  const messageType = decoding.readVarUint(decoder)\n  switch (messageType) {\n    case messageYjsSyncStep1:\n      readSyncStep1(decoder, encoder, doc)\n      break\n    case messageYjsSyncStep2:\n      readSyncStep2(decoder, doc, transactionOrigin)\n      break\n    case messageYjsUpdate:\n      readUpdate(decoder, doc, transactionOrigin)\n      break\n    default:\n      throw new Error('Unknown message type')\n  }\n  return messageType\n}\n","/* eslint-env browser */\n\n/**\n * Helpers for cross-tab communication using broadcastchannel with LocalStorage fallback.\n *\n * ```js\n * // In browser window A:\n * broadcastchannel.subscribe('my events', data => console.log(data))\n * broadcastchannel.publish('my events', 'Hello world!') // => A: 'Hello world!' fires synchronously in same tab\n *\n * // In browser window B:\n * broadcastchannel.publish('my events', 'hello from tab B') // => A: 'hello from tab B'\n * ```\n *\n * @module broadcastchannel\n */\n\n// @todo before next major: use Uint8Array instead as buffer object\n\nimport * as map from './map.js'\nimport * as set from './set.js'\nimport * as buffer from './buffer.js'\nimport * as storage from './storage.js'\n\n/**\n * @typedef {Object} Channel\n * @property {Set<function(any, any):any>} Channel.subs\n * @property {any} Channel.bc\n */\n\n/**\n * @type {Map<string, Channel>}\n */\nconst channels = new Map()\n\n/* c8 ignore start */\nclass LocalStoragePolyfill {\n  /**\n   * @param {string} room\n   */\n  constructor (room) {\n    this.room = room\n    /**\n     * @type {null|function({data:ArrayBuffer}):void}\n     */\n    this.onmessage = null\n    /**\n     * @param {any} e\n     */\n    this._onChange = e => e.key === room && this.onmessage !== null && this.onmessage({ data: buffer.fromBase64(e.newValue || '') })\n    storage.onChange(this._onChange)\n  }\n\n  /**\n   * @param {ArrayBuffer} buf\n   */\n  postMessage (buf) {\n    storage.varStorage.setItem(this.room, buffer.toBase64(buffer.createUint8ArrayFromArrayBuffer(buf)))\n  }\n\n  close () {\n    storage.offChange(this._onChange)\n  }\n}\n/* c8 ignore stop */\n\n// Use BroadcastChannel or Polyfill\n/* c8 ignore next */\nconst BC = typeof BroadcastChannel === 'undefined' ? LocalStoragePolyfill : BroadcastChannel\n\n/**\n * @param {string} room\n * @return {Channel}\n */\nconst getChannel = room =>\n  map.setIfUndefined(channels, room, () => {\n    const subs = set.create()\n    const bc = new BC(room)\n    /**\n     * @param {{data:ArrayBuffer}} e\n     */\n    /* c8 ignore next */\n    bc.onmessage = e => subs.forEach(sub => sub(e.data, 'broadcastchannel'))\n    return {\n      bc, subs\n    }\n  })\n\n/**\n * Subscribe to global `publish` events.\n *\n * @function\n * @param {string} room\n * @param {function(any, any):any} f\n */\nexport const subscribe = (room, f) => {\n  getChannel(room).subs.add(f)\n  return f\n}\n\n/**\n * Unsubscribe from `publish` global events.\n *\n * @function\n * @param {string} room\n * @param {function(any, any):any} f\n */\nexport const unsubscribe = (room, f) => {\n  const channel = getChannel(room)\n  const unsubscribed = channel.subs.delete(f)\n  if (unsubscribed && channel.subs.size === 0) {\n    channel.bc.close()\n    channels.delete(room)\n  }\n  return unsubscribed\n}\n\n/**\n * Publish data to all subscribers (including subscribers on this tab)\n *\n * @function\n * @param {string} room\n * @param {any} data\n * @param {any} [origin]\n */\nexport const publish = (room, data, origin = null) => {\n  const c = getChannel(room)\n  c.bc.postMessage(data)\n  c.subs.forEach(sub => sub(data, origin))\n}\n","\nimport * as Y from 'yjs' // eslint-disable-line\nimport * as encoding from 'lib0/encoding'\nimport * as decoding from 'lib0/decoding'\n\nexport const messagePermissionDenied = 0\n\n/**\n * @param {encoding.Encoder} encoder\n * @param {string} reason\n */\nexport const writePermissionDenied = (encoder, reason) => {\n  encoding.writeVarUint(encoder, messagePermissionDenied)\n  encoding.writeVarString(encoder, reason)\n}\n\n/**\n * @callback PermissionDeniedHandler\n * @param {any} y\n * @param {string} reason\n */\n\n/**\n *\n * @param {decoding.Decoder} decoder\n * @param {Y.Doc} y\n * @param {PermissionDeniedHandler} permissionDeniedHandler\n */\nexport const readAuthMessage = (decoder, y, permissionDeniedHandler) => {\n  switch (decoding.readVarUint(decoder)) {\n    case messagePermissionDenied: permissionDeniedHandler(y, decoding.readVarString(decoder))\n  }\n}\n","/**\n * Utility module to work with urls.\n *\n * @module url\n */\n\nimport * as object from './object.js'\n\n/**\n * Parse query parameters from an url.\n *\n * @param {string} url\n * @return {Object<string,string>}\n */\nexport const decodeQueryParams = url => {\n  /**\n   * @type {Object<string,string>}\n   */\n  const query = {}\n  const urlQuerySplit = url.split('?')\n  const pairs = urlQuerySplit[urlQuerySplit.length - 1].split('&')\n  for (let i = 0; i < pairs.length; i++) {\n    const item = pairs[i]\n    if (item.length > 0) {\n      const pair = item.split('=')\n      query[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1] || '')\n    }\n  }\n  return query\n}\n\n/**\n * @param {Object<string,string>} params\n * @return {string}\n */\nexport const encodeQueryParams = params =>\n  object.map(params, (val, key) => `${encodeURIComponent(key)}=${encodeURIComponent(val)}`).join('&')\n","/**\n * @module provider/websocket\n */\n\n/* eslint-env browser */\n\nimport * as Y from 'yjs' // eslint-disable-line\nimport * as bc from 'lib0/broadcastchannel'\nimport * as time from 'lib0/time'\nimport * as encoding from 'lib0/encoding'\nimport * as decoding from 'lib0/decoding'\nimport * as syncProtocol from 'y-protocols/sync'\nimport * as authProtocol from 'y-protocols/auth'\nimport * as awarenessProtocol from 'y-protocols/awareness'\nimport { Observable } from 'lib0/observable'\nimport * as math from 'lib0/math'\nimport * as url from 'lib0/url'\nimport * as env from 'lib0/environment'\n\nexport const messageSync = 0\nexport const messageQueryAwareness = 3\nexport const messageAwareness = 1\nexport const messageAuth = 2\n\n/**\n *                       encoder,          decoder,          provider,          emitSynced, messageType\n * @type {Array<function(encoding.Encoder, decoding.Decoder, WebsocketProvider, boolean,    number):void>}\n */\nconst messageHandlers = []\n\nmessageHandlers[messageSync] = (\n  encoder,\n  decoder,\n  provider,\n  emitSynced,\n  _messageType\n) => {\n  encoding.writeVarUint(encoder, messageSync)\n  const syncMessageType = syncProtocol.readSyncMessage(\n    decoder,\n    encoder,\n    provider.doc,\n    provider\n  )\n  if (\n    emitSynced && syncMessageType === syncProtocol.messageYjsSyncStep2 &&\n    !provider.synced\n  ) {\n    provider.synced = true\n  }\n}\n\nmessageHandlers[messageQueryAwareness] = (\n  encoder,\n  _decoder,\n  provider,\n  _emitSynced,\n  _messageType\n) => {\n  encoding.writeVarUint(encoder, messageAwareness)\n  encoding.writeVarUint8Array(\n    encoder,\n    awarenessProtocol.encodeAwarenessUpdate(\n      provider.awareness,\n      Array.from(provider.awareness.getStates().keys())\n    )\n  )\n}\n\nmessageHandlers[messageAwareness] = (\n  _encoder,\n  decoder,\n  provider,\n  _emitSynced,\n  _messageType\n) => {\n  awarenessProtocol.applyAwarenessUpdate(\n    provider.awareness,\n    decoding.readVarUint8Array(decoder),\n    provider\n  )\n}\n\nmessageHandlers[messageAuth] = (\n  _encoder,\n  decoder,\n  provider,\n  _emitSynced,\n  _messageType\n) => {\n  authProtocol.readAuthMessage(\n    decoder,\n    provider.doc,\n    (_ydoc, reason) => permissionDeniedHandler(provider, reason)\n  )\n}\n\n// @todo - this should depend on awareness.outdatedTime\nconst messageReconnectTimeout = 30000\n\n/**\n * @param {WebsocketProvider} provider\n * @param {string} reason\n */\nconst permissionDeniedHandler = (provider, reason) =>\n  console.warn(`Permission denied to access ${provider.url}.\\n${reason}`)\n\n/**\n * @param {WebsocketProvider} provider\n * @param {Uint8Array} buf\n * @param {boolean} emitSynced\n * @return {encoding.Encoder}\n */\nconst readMessage = (provider, buf, emitSynced) => {\n  const decoder = decoding.createDecoder(buf)\n  const encoder = encoding.createEncoder()\n  const messageType = decoding.readVarUint(decoder)\n  const messageHandler = provider.messageHandlers[messageType]\n  if (/** @type {any} */ (messageHandler)) {\n    messageHandler(encoder, decoder, provider, emitSynced, messageType)\n  } else {\n    console.error('Unable to compute message')\n  }\n  return encoder\n}\n\n/**\n * @param {WebsocketProvider} provider\n */\nconst setupWS = (provider) => {\n  if (provider.shouldConnect && provider.ws === null) {\n    const websocket = new provider._WS(provider.url)\n    websocket.binaryType = 'arraybuffer'\n    provider.ws = websocket\n    provider.wsconnecting = true\n    provider.wsconnected = false\n    provider.synced = false\n\n    websocket.onmessage = (event) => {\n      provider.wsLastMessageReceived = time.getUnixTime()\n      const encoder = readMessage(provider, new Uint8Array(event.data), true)\n      if (encoding.length(encoder) > 1) {\n        websocket.send(encoding.toUint8Array(encoder))\n      }\n    }\n    websocket.onerror = (event) => {\n      provider.emit('connection-error', [event, provider])\n    }\n    websocket.onclose = (event) => {\n      provider.emit('connection-close', [event, provider])\n      provider.ws = null\n      provider.wsconnecting = false\n      if (provider.wsconnected) {\n        provider.wsconnected = false\n        provider.synced = false\n        // update awareness (all users except local left)\n        awarenessProtocol.removeAwarenessStates(\n          provider.awareness,\n          Array.from(provider.awareness.getStates().keys()).filter((client) =>\n            client !== provider.doc.clientID\n          ),\n          provider\n        )\n        provider.emit('status', [{\n          status: 'disconnected'\n        }])\n      } else {\n        provider.wsUnsuccessfulReconnects++\n      }\n      // Start with no reconnect timeout and increase timeout by\n      // using exponential backoff starting with 100ms\n      setTimeout(\n        setupWS,\n        math.min(\n          math.pow(2, provider.wsUnsuccessfulReconnects) * 100,\n          provider.maxBackoffTime\n        ),\n        provider\n      )\n    }\n    websocket.onopen = () => {\n      provider.wsLastMessageReceived = time.getUnixTime()\n      provider.wsconnecting = false\n      provider.wsconnected = true\n      provider.wsUnsuccessfulReconnects = 0\n      provider.emit('status', [{\n        status: 'connected'\n      }])\n      // always send sync step 1 when connected\n      const encoder = encoding.createEncoder()\n      encoding.writeVarUint(encoder, messageSync)\n      syncProtocol.writeSyncStep1(encoder, provider.doc)\n      websocket.send(encoding.toUint8Array(encoder))\n      // broadcast local awareness state\n      if (provider.awareness.getLocalState() !== null) {\n        const encoderAwarenessState = encoding.createEncoder()\n        encoding.writeVarUint(encoderAwarenessState, messageAwareness)\n        encoding.writeVarUint8Array(\n          encoderAwarenessState,\n          awarenessProtocol.encodeAwarenessUpdate(provider.awareness, [\n            provider.doc.clientID\n          ])\n        )\n        websocket.send(encoding.toUint8Array(encoderAwarenessState))\n      }\n    }\n    provider.emit('status', [{\n      status: 'connecting'\n    }])\n  }\n}\n\n/**\n * @param {WebsocketProvider} provider\n * @param {ArrayBuffer} buf\n */\nconst broadcastMessage = (provider, buf) => {\n  const ws = provider.ws\n  if (provider.wsconnected && ws && ws.readyState === ws.OPEN) {\n    ws.send(buf)\n  }\n  if (provider.bcconnected) {\n    bc.publish(provider.bcChannel, buf, provider)\n  }\n}\n\n/**\n * Websocket Provider for Yjs. Creates a websocket connection to sync the shared document.\n * The document name is attached to the provided url. I.e. the following example\n * creates a websocket connection to http://localhost:1234/my-document-name\n *\n * @example\n *   import * as Y from 'yjs'\n *   import { WebsocketProvider } from 'y-websocket'\n *   const doc = new Y.Doc()\n *   const provider = new WebsocketProvider('http://localhost:1234', 'my-document-name', doc)\n *\n * @extends {Observable<string>}\n */\nexport class WebsocketProvider extends Observable {\n  /**\n   * @param {string} serverUrl\n   * @param {string} roomname\n   * @param {Y.Doc} doc\n   * @param {object} opts\n   * @param {boolean} [opts.connect]\n   * @param {awarenessProtocol.Awareness} [opts.awareness]\n   * @param {Object<string,string>} [opts.params] specify url parameters\n   * @param {typeof WebSocket} [opts.WebSocketPolyfill] Optionall provide a WebSocket polyfill\n   * @param {number} [opts.resyncInterval] Request server state every `resyncInterval` milliseconds\n   * @param {number} [opts.maxBackoffTime] Maximum amount of time to wait before trying to reconnect (we try to reconnect using exponential backoff)\n   * @param {boolean} [opts.disableBc] Disable cross-tab BroadcastChannel communication\n   */\n  constructor (serverUrl, roomname, doc, {\n    connect = true,\n    awareness = new awarenessProtocol.Awareness(doc),\n    params = {},\n    WebSocketPolyfill = WebSocket,\n    resyncInterval = -1,\n    maxBackoffTime = 2500,\n    disableBc = false\n  } = {}) {\n    super()\n    // ensure that url is always ends with /\n    while (serverUrl[serverUrl.length - 1] === '/') {\n      serverUrl = serverUrl.slice(0, serverUrl.length - 1)\n    }\n    this.serverUrl = serverUrl\n    this.bcChannel = serverUrl + '/' + roomname\n    this.maxBackoffTime = maxBackoffTime\n    /**\n     * The specified url parameters. This can be safely updated. The changed parameters will be used\n     * when a new connection is established.\n     * @type {Object<string,string>}\n     */\n    this.params = params\n    this.roomname = roomname\n    this.doc = doc\n    this._WS = WebSocketPolyfill\n    this.awareness = awareness\n    this.wsconnected = false\n    this.wsconnecting = false\n    this.bcconnected = false\n    this.disableBc = disableBc\n    this.wsUnsuccessfulReconnects = 0\n    this.messageHandlers = messageHandlers.slice()\n    /**\n     * @type {boolean}\n     */\n    this._synced = false\n    /**\n     * @type {WebSocket?}\n     */\n    this.ws = null\n    this.wsLastMessageReceived = 0\n    /**\n     * Whether to connect to other peers or not\n     * @type {boolean}\n     */\n    this.shouldConnect = connect\n\n    /**\n     * @type {number}\n     */\n    this._resyncInterval = 0\n    if (resyncInterval > 0) {\n      this._resyncInterval = /** @type {any} */ (setInterval(() => {\n        if (this.ws && this.ws.readyState === WebSocket.OPEN) {\n          // resend sync step 1\n          const encoder = encoding.createEncoder()\n          encoding.writeVarUint(encoder, messageSync)\n          syncProtocol.writeSyncStep1(encoder, doc)\n          this.ws.send(encoding.toUint8Array(encoder))\n        }\n      }, resyncInterval))\n    }\n\n    /**\n     * @param {ArrayBuffer} data\n     * @param {any} origin\n     */\n    this._bcSubscriber = (data, origin) => {\n      if (origin !== this) {\n        const encoder = readMessage(this, new Uint8Array(data), false)\n        if (encoding.length(encoder) > 1) {\n          bc.publish(this.bcChannel, encoding.toUint8Array(encoder), this)\n        }\n      }\n    }\n    /**\n     * Listens to Yjs updates and sends them to remote peers (ws and broadcastchannel)\n     * @param {Uint8Array} update\n     * @param {any} origin\n     */\n    this._updateHandler = (update, origin) => {\n      if (origin !== this) {\n        const encoder = encoding.createEncoder()\n        encoding.writeVarUint(encoder, messageSync)\n        syncProtocol.writeUpdate(encoder, update)\n        broadcastMessage(this, encoding.toUint8Array(encoder))\n      }\n    }\n    this.doc.on('update', this._updateHandler)\n    /**\n     * @param {any} changed\n     * @param {any} _origin\n     */\n    this._awarenessUpdateHandler = ({ added, updated, removed }, _origin) => {\n      const changedClients = added.concat(updated).concat(removed)\n      const encoder = encoding.createEncoder()\n      encoding.writeVarUint(encoder, messageAwareness)\n      encoding.writeVarUint8Array(\n        encoder,\n        awarenessProtocol.encodeAwarenessUpdate(awareness, changedClients)\n      )\n      broadcastMessage(this, encoding.toUint8Array(encoder))\n    }\n    this._exitHandler = () => {\n      awarenessProtocol.removeAwarenessStates(\n        this.awareness,\n        [doc.clientID],\n        'app closed'\n      )\n    }\n    if (env.isNode && typeof process !== 'undefined') {\n      process.on('exit', this._exitHandler)\n    }\n    awareness.on('update', this._awarenessUpdateHandler)\n    this._checkInterval = /** @type {any} */ (setInterval(() => {\n      if (\n        this.wsconnected &&\n        messageReconnectTimeout <\n          time.getUnixTime() - this.wsLastMessageReceived\n      ) {\n        // no message received in a long time - not even your own awareness\n        // updates (which are updated every 15 seconds)\n        /** @type {WebSocket} */ (this.ws).close()\n      }\n    }, messageReconnectTimeout / 10))\n    if (connect) {\n      this.connect()\n    }\n  }\n\n  get url () {\n    const encodedParams = url.encodeQueryParams(this.params)\n    return this.serverUrl + '/' + this.roomname +\n      (encodedParams.length === 0 ? '' : '?' + encodedParams)\n  }\n\n  /**\n   * @type {boolean}\n   */\n  get synced () {\n    return this._synced\n  }\n\n  set synced (state) {\n    if (this._synced !== state) {\n      this._synced = state\n      this.emit('synced', [state])\n      this.emit('sync', [state])\n    }\n  }\n\n  destroy () {\n    if (this._resyncInterval !== 0) {\n      clearInterval(this._resyncInterval)\n    }\n    clearInterval(this._checkInterval)\n    this.disconnect()\n    if (env.isNode && typeof process !== 'undefined') {\n      process.off('exit', this._exitHandler)\n    }\n    this.awareness.off('update', this._awarenessUpdateHandler)\n    this.doc.off('update', this._updateHandler)\n    super.destroy()\n  }\n\n  connectBc () {\n    if (this.disableBc) {\n      return\n    }\n    if (!this.bcconnected) {\n      bc.subscribe(this.bcChannel, this._bcSubscriber)\n      this.bcconnected = true\n    }\n    // send sync step1 to bc\n    // write sync step 1\n    const encoderSync = encoding.createEncoder()\n    encoding.writeVarUint(encoderSync, messageSync)\n    syncProtocol.writeSyncStep1(encoderSync, this.doc)\n    bc.publish(this.bcChannel, encoding.toUint8Array(encoderSync), this)\n    // broadcast local state\n    const encoderState = encoding.createEncoder()\n    encoding.writeVarUint(encoderState, messageSync)\n    syncProtocol.writeSyncStep2(encoderState, this.doc)\n    bc.publish(this.bcChannel, encoding.toUint8Array(encoderState), this)\n    // write queryAwareness\n    const encoderAwarenessQuery = encoding.createEncoder()\n    encoding.writeVarUint(encoderAwarenessQuery, messageQueryAwareness)\n    bc.publish(\n      this.bcChannel,\n      encoding.toUint8Array(encoderAwarenessQuery),\n      this\n    )\n    // broadcast local awareness state\n    const encoderAwarenessState = encoding.createEncoder()\n    encoding.writeVarUint(encoderAwarenessState, messageAwareness)\n    encoding.writeVarUint8Array(\n      encoderAwarenessState,\n      awarenessProtocol.encodeAwarenessUpdate(this.awareness, [\n        this.doc.clientID\n      ])\n    )\n    bc.publish(\n      this.bcChannel,\n      encoding.toUint8Array(encoderAwarenessState),\n      this\n    )\n  }\n\n  disconnectBc () {\n    // broadcast message with local awareness state set to null (indicating disconnect)\n    const encoder = encoding.createEncoder()\n    encoding.writeVarUint(encoder, messageAwareness)\n    encoding.writeVarUint8Array(\n      encoder,\n      awarenessProtocol.encodeAwarenessUpdate(this.awareness, [\n        this.doc.clientID\n      ], new Map())\n    )\n    broadcastMessage(this, encoding.toUint8Array(encoder))\n    if (this.bcconnected) {\n      bc.unsubscribe(this.bcChannel, this._bcSubscriber)\n      this.bcconnected = false\n    }\n  }\n\n  disconnect () {\n    this.shouldConnect = false\n    this.disconnectBc()\n    if (this.ws !== null) {\n      this.ws.close()\n    }\n  }\n\n  connect () {\n    this.shouldConnect = true\n    if (!this.wsconnected && this.ws === null) {\n      setupWS(this)\n      this.connectBc()\n    }\n  }\n}\n","/**\n * SPDX-FileCopyrightText: 2023 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { encodeArrayBuffer, decodeArrayBuffer } from '../helpers/base64.ts'\nimport * as Y from 'yjs'\nimport * as decoding from 'lib0/decoding.js'\nimport * as encoding from 'lib0/encoding.js'\nimport * as syncProtocol from 'y-protocols/sync'\nimport { messageSync } from 'y-websocket'\n\n/**\n * Get Document state encode as base64.\n *\n * Used to store yjs state on the server.\n * @param {Y.Doc} ydoc - encode state of this doc\n * @return {string}\n */\nexport function getDocumentState(ydoc) {\n\tconst update = Y.encodeStateAsUpdate(ydoc)\n\treturn encodeArrayBuffer(update)\n}\n\n/**\n *\n * @param {Y.Doc} ydoc - apply state to this doc\n * @param {string} documentState - base64 encoded doc state\n * @param {object} origin - initiator object e.g. WebsocketProvider\n */\nexport function applyDocumentState(ydoc, documentState, origin) {\n\tconst update = decodeArrayBuffer(documentState)\n\tY.applyUpdate(ydoc, update, origin)\n}\n\n/**\n * Update message for everything in ydoc that is not in encodedBaseUpdate\n *\n * @param {Y.Doc} ydoc - encode state of this doc\n * @param {string} encodedBaseUpdate - base64 encoded doc update to build upon\n * @return {Uint8Array|undefined}\n */\nexport function getUpdateMessage(ydoc, encodedBaseUpdate) {\n\tconst baseUpdate = decodeArrayBuffer(encodedBaseUpdate)\n\tconst baseStateVector = Y.encodeStateVectorFromUpdate(baseUpdate)\n\tconst docStateVector = Y.encodeStateVector(ydoc)\n\tif (sameState(baseStateVector, docStateVector)) {\n\t\t// no additional state in the ydoc - early return\n\t\treturn\n\t}\n\tconst encoder = encoding.createEncoder()\n\tencoding.writeVarUint(encoder, messageSync)\n\tconst update = Y.encodeStateAsUpdate(ydoc, baseStateVector)\n\tsyncProtocol.writeUpdate(encoder, update)\n\treturn encoding.toUint8Array(encoder)\n}\n\n/**\n * Apply an updated message to the ydoc.\n *\n * Only used in tests right now.\n * @param {Y.Doc} ydoc - encode state of this doc\n * @param {Uint8Array} updateMessage - y-websocket sync message with update\n * @param {object} origin - initiator object e.g. WebsocketProvider\n */\nexport function applyUpdateMessage(ydoc, updateMessage, origin = 'origin') {\n\tconst decoder = decoding.createDecoder(updateMessage)\n\tconst messageType = decoding.readVarUint(decoder)\n\tif (messageType !== messageSync) {\n\t\tconsole.error('y.js update message with invalid type', messageType)\n\t\treturn\n\t}\n\t// There are no responses to updates - so this is a dummy.\n\tconst encoder = encoding.createEncoder()\n\tsyncProtocol.readSyncMessage(\n\t\tdecoder,\n\t\tencoder,\n\t\tydoc,\n\t\torigin,\n\t)\n}\n\n/**\n * Get the steps for sending to the server\n *\n * @param {object[]} queue - queue for the outgoing steps\n */\nexport function getSteps(queue) {\n\treturn queue.map(s => encodeArrayBuffer(s))\n\t\t.filter(s => s < 'AQ')\n}\n\n/**\n * Encode the latest awareness message for sending\n *\n * @param {object[]} queue - queue for the outgoing steps\n */\nexport function getAwareness(queue) {\n\treturn queue.map(s => encodeArrayBuffer(s))\n\t\t.findLast(s => s > 'AQ') || ''\n}\n\n/**\n * Log y.js messages with their type and initiator call stack\n *\n * @param {string} step - Y.js message\n */\nexport function logStep(step) {\n\t// Create error for stack trace\n\tconst err = new Error()\n\n\tconst decoder = decoding.createDecoder(step)\n\n\tconst messageType = decoding.readVarUint(decoder)\n\tconst subType = decoding.readVarUint(decoder)\n\n\tconst encodedStep = encodeArrayBuffer(step)\n\tswitch (messageType) {\n\tcase 0:\n\t\tconsole.debug('y.js message sync', subType, encodedStep, err.stack)\n\t\tbreak\n\tcase 3:\n\t\tconsole.debug('y.js message awareness_query', encodedStep, err.stack)\n\t\tbreak\n\tcase 1:\n\t\tconsole.debug('y.js message awareness', encodedStep, err.stack)\n\t\tbreak\n\t}\n}\n\n/**\n * Helper function to check if two state vectors have the same state\n * @param {Array} arr - state vector to compare\n * @param {Array} other - state vector to compare against\n */\nfunction sameState(arr, other) {\n\treturn arr.length === other.length\n\t\t&& arr.every((value, index) => other[index] === value)\n}\n","export default function(n){return{all:n=n||new Map,on:function(t,e){var i=n.get(t);i?i.push(e):n.set(t,[e])},off:function(t,e){var i=n.get(t);i&&(e?i.splice(i.indexOf(e)>>>0,1):n.set(t,[]))},emit:function(t,e){var i=n.get(t);i&&i.slice().map(function(n){n(e)}),(i=n.get(\"*\"))&&i.slice().map(function(n){n(t,e)})}}}\n//# sourceMappingURL=mitt.mjs.map\n","/**\n * SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\nimport axios from '@nextcloud/axios'\nimport { generateUrl } from '@nextcloud/router'\n\nexport class ConnectionClosedError extends Error {\n\n\tconstructor(message = 'Close has already been called on the connection', ...rest) {\n\t\tsuper(message, ...rest)\n\t}\n\n}\n\nclass SessionApi {\n\n\t#options\n\n\tconstructor(options = {}) {\n\t\tthis.#options = options\n\t}\n\n\topen({ fileId, baseVersionEtag }) {\n\t\treturn axios.put(this.#url(`session/${fileId}/create`), {\n\t\t\tfileId,\n\t\t\tbaseVersionEtag,\n\t\t\tfilePath: this.#options.filePath,\n\t\t\ttoken: this.#options.shareToken,\n\t\t\tguestName: this.#options.guestName,\n\t\t\tforceRecreate: this.#options.forceRecreate,\n\t\t}).then(response => new Connection(response, this.#options))\n\t}\n\n\t#url(endpoint) {\n\t\tconst isPublic = !!this.#options.shareToken\n\t\treturn _endpointUrl(endpoint, isPublic)\n\t}\n\n}\n\nexport class Connection {\n\n\t#content\n\t#closed\n\t#documentState\n\t#document\n\t#session\n\t#lock\n\t#readOnly\n\t#options\n\n\tconstructor(response, options) {\n\t\tconst { document, session, lock, readOnly, content, documentState } = response.data\n\t\tthis.#document = document\n\t\tthis.#session = session\n\t\tthis.#lock = lock\n\t\tthis.#readOnly = readOnly\n\t\tthis.#content = content\n\t\tthis.#documentState = documentState\n\t\tthis.#options = options\n\t\tthis.isPublic = !!options.shareToken\n\t\tthis.closed = false\n\t}\n\n\tget session() {\n\t\treturn this.#session\n\t}\n\n\tget document() {\n\t\treturn this.#document\n\t}\n\n\tget docStateVersion() {\n\t\treturn this.#documentState ? this.#document.lastSavedVersion : 0\n\t}\n\n\tget state() {\n\t\treturn {\n\t\t\tdocument: { ...this.#document, readOnly: this.#readOnly },\n\t\t\tsession: this.#session,\n\t\t\tdocumentSource: this.#content || '',\n\t\t\tdocumentState: this.#documentState,\n\t\t}\n\t}\n\n\tget isClosed() {\n\t\treturn this.closed\n\t}\n\n\tget #defaultParams() {\n\t\treturn {\n\t\t\tdocumentId: this.#document.id,\n\t\t\tsessionId: this.#session.id,\n\t\t\tsessionToken: this.#session.token,\n\t\t\ttoken: this.#options.shareToken,\n\t\t}\n\t}\n\n\tsync({ version }) {\n\t\treturn this.#post(this.#url(`session/${this.#document.id}/sync`), {\n\t\t\t...this.#defaultParams,\n\t\t\tfilePath: this.#options.filePath,\n\t\t\tbaseVersionEtag: this.#document.baseVersionEtag,\n\t\t\tversion,\n\t\t})\n\t}\n\n\tsave({ version, autosaveContent, documentState, force, manualSave }) {\n\t\treturn this.#post(this.#url(`session/${this.#document.id}/save`), {\n\t\t\t...this.#defaultParams,\n\t\t\tfilePath: this.#options.filePath,\n\t\t\tbaseVersionEtag: this.#document.baseVersionEtag,\n\t\t\tversion,\n\t\t\tautosaveContent,\n\t\t\tdocumentState,\n\t\t\tforce,\n\t\t\tmanualSave,\n\t\t})\n\t}\n\n\tpush({ steps, version, awareness }) {\n\t\treturn this.#post(this.#url(`session/${this.#document.id}/push`), {\n\t\t\t...this.#defaultParams,\n\t\t\tfilePath: this.#options.filePath,\n\t\t\tbaseVersionEtag: this.#document.baseVersionEtag,\n\t\t\tsteps,\n\t\t\tversion,\n\t\t\tawareness,\n\t\t})\n\t}\n\n\t// TODO: maybe return a new connection here so connections have immutable state\n\tupdate(guestName) {\n\t\treturn this.#post(this.#url(`session/${this.#document.id}/session`), {\n\t\t\t...this.#defaultParams,\n\t\t\tguestName,\n\t\t}).then(({ data }) => {\n\t\t\tthis.#session = data\n\t\t})\n\t}\n\n\tuploadAttachment(file) {\n\t\tconst formData = new FormData()\n\t\tformData.append('file', file)\n\t\tconst url = _endpointUrl('attachment/upload')\n\t\t\t+ '?documentId=' + encodeURIComponent(this.#document.id)\n\t\t\t+ '&sessionId=' + encodeURIComponent(this.#session.id)\n\t\t\t+ '&sessionToken=' + encodeURIComponent(this.#session.token)\n\t\t\t+ '&shareToken=' + encodeURIComponent(this.#options.shareToken || '')\n\t\treturn this.#post(url, formData, {\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'multipart/form-data',\n\t\t\t},\n\t\t})\n\t}\n\n\tinsertAttachmentFile(filePath) {\n\t\treturn this.#post(_endpointUrl('attachment/filepath'), {\n\t\t\tdocumentId: this.#document.id,\n\t\t\tsessionId: this.#session.id,\n\t\t\tsessionToken: this.#session.token,\n\t\t\tfilePath,\n\t\t})\n\t}\n\n\tclose() {\n\t\treturn this.#post(\n\t\t\tthis.#url(`session/${this.#document.id}/close`),\n\t\t\tthis.#defaultParams,\n\t\t).then(() => {\n\t\t\tthis.closed = true\n\t\t})\n\t}\n\n\t// To be used in Cypress tests only\n\tsetBaseVersionEtag(baseVersionEtag) {\n\t\tthis.#document.baseVersionEtag = baseVersionEtag\n\t}\n\n\t#post(...args) {\n\t\tif (this.closed) {\n\t\t\treturn Promise.reject(new ConnectionClosedError())\n\t\t}\n\t\treturn axios.post(...args)\n\t}\n\n\t#url(endpoint) {\n\t\tconst isPublic = !!this.#defaultParams.token\n\t\treturn _endpointUrl(endpoint, isPublic)\n\t}\n\n}\n\n/**\n *\n * @param {string} endpoint - endpoint of the url inside apps/text\n * @param {boolean} isPublic - public url or not\n */\nfunction _endpointUrl(endpoint, isPublic = false) {\n\tconst _baseUrl = generateUrl('/apps/text')\n\tif (isPublic) {\n\t\treturn `${_baseUrl}/public/${endpoint}`\n\t}\n\treturn `${_baseUrl}/${endpoint}`\n}\n\nexport default SessionApi\n","/**\n * SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\nimport { logger } from '../helpers/logger.js'\nimport { SyncService, ERROR_TYPE } from './SyncService.js'\nimport { Connection } from './SessionApi.js'\n\n/**\n * Minimum inverval to refetch the document changes\n *\n * @type {number} time in ms\n */\nconst FETCH_INTERVAL = 300\n\n/**\n * Maximum interval between refetches of document state if multiple users have joined\n *\n * @type {number} time in ms\n */\nconst FETCH_INTERVAL_MAX = 5000\n\n/**\n * Interval to check for changes when there is only one user joined\n *\n * @type {number} time in ms\n */\nconst FETCH_INTERVAL_SINGLE_EDITOR = 5000\n\n/**\n * Interval to check for changes for read only users\n * @type {number}\n */\nconst FETCH_INTERVAL_READ_ONLY = 30000\n\n/**\n * Interval to fetch for changes when a browser window is considered invisible by the\n * page visibility API https://developer.mozilla.org/de/docs/Web/API/Page_Visibility_API\n *\n * @type {number} time in ms\n */\nconst FETCH_INTERVAL_INVISIBLE = 60000\n\n/* Maximum number of retries for fetching before emitting a connection error */\nconst MAX_RETRY_FETCH_COUNT = 5\n\n/**\n * Timeout for sessions to be marked as disconnected\n * Make sure that this is higher than any FETCH_INTERVAL_ values\n */\nconst COLLABORATOR_DISCONNECT_TIME = FETCH_INTERVAL_INVISIBLE * 1.5\n\nclass PollingBackend {\n\n\t/** @type {SyncService} */\n\t#syncService\n\t/** @type {Connection} */\n\t#connection\n\n\t#lastPoll\n\t#fetchInterval\n\t#fetchRetryCounter\n\t#pollActive\n\t#initialLoadingFinished\n\n\tconstructor(syncService, connection) {\n\t\tthis.#syncService = syncService\n\t\tthis.#connection = connection\n\t\tthis.#fetchInterval = FETCH_INTERVAL\n\t\tthis.#fetchRetryCounter = 0\n\t\tthis.#lastPoll = 0\n\t}\n\n\tconnect() {\n\t\tif (this.fetcher > 0) {\n\t\t\tconsole.error('Trying to connect, but already connected')\n\t\t\treturn\n\t\t}\n\t\tthis.#initialLoadingFinished = false\n\t\tthis.fetcher = setInterval(this._fetchSteps.bind(this), 50)\n\t\tdocument.addEventListener('visibilitychange', this.visibilitychange.bind(this))\n\t}\n\n\t/**\n\t * This method is only called though the timer\n\t */\n\tasync _fetchSteps() {\n\t\tif (this.#pollActive) {\n\t\t\treturn\n\t\t}\n\n\t\tconst now = Date.now()\n\n\t\tif (this.#lastPoll > (now - this.#fetchInterval)) {\n\t\t\treturn\n\t\t}\n\n\t\tif (!this.fetcher) {\n\t\t\tconsole.error('No inverval but triggered')\n\t\t\treturn\n\t\t}\n\n\t\tthis.#pollActive = true\n\n\t\tlogger.debug('[PollingBackend] Fetching steps', this.#syncService.version)\n\t\tawait this.#connection.sync({\n\t\t\tversion: this.#syncService.version,\n\t\t}).then(this._handleResponse.bind(this), this._handleError.bind(this))\n\t\tthis.#lastPoll = Date.now()\n\t\tthis.#pollActive = false\n\t}\n\n\t_handleResponse({ data }) {\n\t\tconst { document, sessions } = data\n\t\tthis.#fetchRetryCounter = 0\n\n\t\tthis.#syncService.emit('change', { document, sessions })\n\t\tthis.#syncService._receiveSteps(data)\n\n\t\tif (data.steps.length === 0) {\n\t\t\tif (!this.#initialLoadingFinished) {\n\t\t\t\tthis.#initialLoadingFinished = true\n\t\t\t}\n\t\t\tif (this.#syncService.checkIdle()) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\tconst disconnect = Date.now() - COLLABORATOR_DISCONNECT_TIME\n\t\t\tconst alive = sessions.filter((s) => s.lastContact * 1000 > disconnect)\n\t\t\tif (this.#syncService.isReadOnly) {\n\t\t\t\tthis.maximumReadOnlyTimer()\n\t\t\t} else if (alive.length < 2) {\n\t\t\t\tthis.maximumRefetchTimer()\n\t\t\t} else {\n\t\t\t\tthis.increaseRefetchTimer()\n\t\t\t}\n\t\t\tthis.#syncService.emit('stateChange', { initialLoading: true })\n\t\t\treturn\n\t\t}\n\n\t\tif (this.#initialLoadingFinished) {\n\t\t\tthis.resetRefetchTimer()\n\t\t}\n\t}\n\n\t_handleError(e) {\n\t\tif (!e.response || e.code === 'ECONNABORTED') {\n\t\t\tif (this.#fetchRetryCounter++ >= MAX_RETRY_FETCH_COUNT) {\n\t\t\t\tlogger.error('[PollingBackend:fetchSteps] Network error when fetching steps, emitting CONNECTION_FAILED')\n\t\t\t\tthis.#syncService.emit('error', { type: ERROR_TYPE.CONNECTION_FAILED, data: {} })\n\n\t\t\t} else {\n\t\t\t\tlogger.error(`[PollingBackend:fetchSteps] Network error when fetching steps, retry ${this.#fetchRetryCounter}`)\n\t\t\t}\n\t\t} else if (e.response.status === 409) {\n\t\t\t// Still apply the steps to update our version of the document\n\t\t\tthis._handleResponse(e.response)\n\t\t\tlogger.error('Conflict during file save, please resolve')\n\t\t\tthis.#syncService.emit('error', {\n\t\t\t\ttype: ERROR_TYPE.SAVE_COLLISSION,\n\t\t\t\tdata: {\n\t\t\t\t\toutsideChange: e.response.data.outsideChange,\n\t\t\t\t},\n\t\t\t})\n\t\t} else if (e.response.status === 412) {\n\t\t\tthis.#syncService.emit('error', { type: ERROR_TYPE.LOAD_ERROR, data: e.response })\n\t\t\tthis.disconnect()\n\t\t} else if (e.response.status === 403) {\n\t\t\tthis.#syncService.emit('error', { type: ERROR_TYPE.SOURCE_NOT_FOUND, data: {} })\n\t\t\tthis.disconnect()\n\t\t} else if (e.response.status === 404) {\n\t\t\tthis.#syncService.emit('error', { type: ERROR_TYPE.SOURCE_NOT_FOUND, data: {} })\n\t\t\tthis.disconnect()\n\t\t} else if (e.response.status === 503) {\n\t\t\tthis.increaseRefetchTimer()\n\t\t\tthis.#syncService.emit('error', { type: ERROR_TYPE.CONNECTION_FAILED, data: {} })\n\t\t\tlogger.error('Failed to fetch steps due to unavailable service', { error: e })\n\t\t} else {\n\t\t\tthis.disconnect()\n\t\t\tthis.#syncService.emit('error', { type: ERROR_TYPE.CONNECTION_FAILED, data: {} })\n\t\t\tlogger.error('Failed to fetch steps due to other reason', { error: e })\n\t\t}\n\n\t}\n\n\tdisconnect() {\n\t\tclearInterval(this.fetcher)\n\t\tthis.fetcher = 0\n\t\tdocument.removeEventListener('visibilitychange', this.visibilitychange.bind(this))\n\t}\n\n\tresetRefetchTimer() {\n\t\tthis.#fetchInterval = FETCH_INTERVAL\n\n\t}\n\n\tincreaseRefetchTimer() {\n\t\tthis.#fetchInterval = Math.min(this.#fetchInterval * 2, FETCH_INTERVAL_MAX)\n\t}\n\n\tmaximumRefetchTimer() {\n\t\tthis.#fetchInterval = FETCH_INTERVAL_SINGLE_EDITOR\n\t}\n\n\tmaximumReadOnlyTimer() {\n\t\tthis.#fetchInterval = FETCH_INTERVAL_READ_ONLY\n\t}\n\n\tvisibilitychange() {\n\t\tif (document.visibilityState === 'hidden') {\n\t\t\tthis.#fetchInterval = FETCH_INTERVAL_INVISIBLE\n\t\t} else {\n\t\t\tthis.resetRefetchTimer()\n\t\t}\n\t}\n\n}\n\nexport default PollingBackend\n","/**\n * SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\n/* eslint-disable jsdoc/valid-types */\n\nimport mitt from 'mitt'\nimport debounce from 'debounce'\n\nimport PollingBackend from './PollingBackend.js'\nimport SessionApi, { Connection } from './SessionApi.js'\nimport { getSteps, getAwareness } from '../helpers/yjs.js'\nimport { logger } from '../helpers/logger.js'\n\n/**\n * Timeout after which the editor will consider a document without changes being synced as idle\n * The session will be terminated and the document will stay open in read-only mode with a button to reconnect if needed\n *\n * @type {number}\n */\nconst IDLE_TIMEOUT = 1440\n\n/**\n * Interval to save the serialized document and the document state\n *\n * @type {number} time in ms\n */\nconst AUTOSAVE_INTERVAL = 30000\n\nconst COLLABORATOR_IDLE_TIME = 60\n\nconst COLLABORATOR_DISCONNECT_TIME = 90\n\nconst ERROR_TYPE = {\n\t/**\n\t * Failed to save collaborative document due to external change\n\t * collission needs to be resolved manually\n\t */\n\tSAVE_COLLISSION: 0,\n\t/**\n\t * Failed to push changes for MAX_REBASE_RETRY times\n\t */\n\tPUSH_FAILURE: 1,\n\n\tLOAD_ERROR: 2,\n\n\tCONNECTION_FAILED: 3,\n\n\tSOURCE_NOT_FOUND: 4,\n\n\tPUSH_FORBIDDEN: 5,\n}\n\nclass SyncService {\n\n\t#sendIntervalId\n\t#connection\n\n\tconstructor({ baseVersionEtag, serialize, getDocumentState, ...options }) {\n\t\t/** @type {import('mitt').Emitter<import('./SyncService').EventTypes>} _bus */\n\t\tthis._bus = mitt()\n\n\t\tthis.serialize = serialize\n\t\tthis.getDocumentState = getDocumentState\n\t\tthis._api = new SessionApi(options)\n\t\tthis.#connection = null\n\n\t\tthis.stepClientIDs = []\n\n\t\tthis.lastStepPush = Date.now()\n\n\t\tthis.version = null\n\t\tthis.baseVersionEtag = baseVersionEtag\n\t\tthis.sending = false\n\t\tthis.#sendIntervalId = null\n\n\t\tthis.autosave = debounce(this._autosave.bind(this), AUTOSAVE_INTERVAL)\n\n\t\treturn this\n\t}\n\n\tget isReadOnly() {\n\t\treturn this.#connection.state.document.readOnly\n\t}\n\n\tget guestName() {\n\t\treturn this.#connection.session.guestName\n\t}\n\n\tasync open({ fileId, initialSession }) {\n\t\tif (this.#connection && !this.#connection.isClosed) {\n\t\t\t// We're already connected.\n\t\t\treturn\n\t\t}\n\t\tconst connect = initialSession\n\t\t\t? Promise.resolve(new Connection({ data: initialSession }, {}))\n\t\t\t: this._api.open({ fileId, baseVersionEtag: this.baseVersionEtag })\n\t\t\t\t.catch(error => this._emitError(error))\n\t\tthis.#connection = await connect\n\t\tif (!this.#connection) {\n\t\t\t// Error was already emitted in connect\n\t\t\treturn\n\t\t}\n\t\tthis.backend = new PollingBackend(this, this.#connection)\n\t\tthis.version = this.#connection.docStateVersion\n\t\tthis.baseVersionEtag = this.#connection.document.baseVersionEtag\n\t\tthis.emit('opened', {\n\t\t\t...this.#connection.state,\n\t\t\tversion: this.version,\n\t\t})\n\t\tthis.emit('loaded', {\n\t\t\t...this.#connection.state,\n\t\t\tversion: this.version,\n\t\t})\n\t}\n\n\tstartSync() {\n\t\tthis.backend.connect()\n\t}\n\n\tsyncUp() {\n\t\tthis.backend.resetRefetchTimer()\n\t}\n\n\t_emitError(error) {\n\t\tif (!error.response || error.code === 'ECONNABORTED') {\n\t\t\tthis.emit('error', { type: ERROR_TYPE.CONNECTION_FAILED, data: {} })\n\t\t} else {\n\t\t\tthis.emit('error', { type: ERROR_TYPE.LOAD_ERROR, data: error.response })\n\t\t}\n\t}\n\n\tupdateSession(guestName) {\n\t\tif (!this.#connection.isPublic) {\n\t\t\treturn Promise.reject(new Error())\n\t\t}\n\t\treturn this.#connection.update(guestName)\n\t\t\t.catch((error) => {\n\t\t\t\tlogger.error('Failed to update the session', { error })\n\t\t\t\treturn Promise.reject(error)\n\t\t\t})\n\t}\n\n\tsendSteps(getSendable) {\n\t\t// If already waiting to send, do nothing.\n\t\tif (this.#sendIntervalId) {\n\t\t\treturn\n\t\t}\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.#sendIntervalId = setInterval(() => {\n\t\t\t\tif (this.#connection && !this.sending) {\n\t\t\t\t\tthis.sendStepsNow(getSendable).then(resolve).catch(reject)\n\t\t\t\t}\n\t\t\t}, 200)\n\t\t})\n\t}\n\n\tsendStepsNow(getSendable) {\n\t\tthis.sending = true\n\t\tclearInterval(this.#sendIntervalId)\n\t\tthis.#sendIntervalId = null\n\t\tconst data = getSendable()\n\t\tif (data.steps.length > 0) {\n\t\t\tthis.emit('stateChange', { dirty: true })\n\t\t}\n\t\treturn this.#connection.push(data)\n\t\t\t.then((response) => {\n\t\t\t\tthis.sending = false\n\t\t\t\tthis.emit('sync', {\n\t\t\t\t\tsteps: [],\n\t\t\t\t\tdocument: this.#connection.document,\n\t\t\t\t\tversion: this.version,\n\t\t\t\t})\n\t\t\t}).catch(err => {\n\t\t\t\tconst { response, code } = err\n\t\t\t\tthis.sending = false\n\t\t\t\tif (!response || code === 'ECONNABORTED') {\n\t\t\t\t\tthis.emit('error', { type: ERROR_TYPE.CONNECTION_FAILED, data: {} })\n\t\t\t\t}\n\t\t\t\tif (response?.status === 412) {\n\t\t\t\t\tthis.emit('error', { type: ERROR_TYPE.LOAD_ERROR, data: response })\n\t\t\t\t} else if (response?.status === 403) {\n\t\t\t\t\tif (!data.document) {\n\t\t\t\t\t\t// either the session is invalid or the document is read only.\n\t\t\t\t\t\tlogger.error('failed to write to document - not allowed')\n\t\t\t\t\t\tthis.emit('error', { type: ERROR_TYPE.PUSH_FORBIDDEN, data: {} })\n\t\t\t\t\t}\n\t\t\t\t\t// Only emit conflict event if we have synced until the latest version\n\t\t\t\t\tif (response.data.document?.currentVersion === this.version) {\n\t\t\t\t\t\tthis.emit('error', { type: ERROR_TYPE.PUSH_FAILURE, data: {} })\n\t\t\t\t\t\tOC.Notification.showTemporary('Changes could not be sent yet')\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthrow new Error('Failed to apply steps. Retry!', { cause: err })\n\t\t\t})\n\t}\n\n\t_receiveSteps({ steps, document, sessions }) {\n\t\tconst awareness = sessions\n\t\t\t.filter(s => s.lastContact > (Math.floor(Date.now() / 1000) - COLLABORATOR_DISCONNECT_TIME))\n\t\t\t.filter(s => s.lastAwarenessMessage)\n\t\t\t.map(s => {\n\t\t\t\treturn { step: s.lastAwarenessMessage, clientId: s.clientId }\n\t\t\t})\n\t\tconst newSteps = [...awareness]\n\t\tfor (let i = 0; i < steps.length; i++) {\n\t\t\tconst singleSteps = steps[i].data\n\t\t\tif (this.version < steps[i].version) {\n\t\t\t\tthis.version = steps[i].version\n\t\t\t}\n\t\t\tif (!Array.isArray(singleSteps)) {\n\t\t\t\tlogger.error('Invalid step data, skipping step', { step: steps[i] })\n\t\t\t\t// TODO: recover\n\t\t\t\tcontinue\n\t\t\t}\n\t\t\tsingleSteps.forEach(step => {\n\t\t\t\tnewSteps.push({\n\t\t\t\t\tstep,\n\t\t\t\t\tclientID: steps[i].sessionId,\n\t\t\t\t})\n\t\t\t})\n\t\t}\n\t\tthis.lastStepPush = Date.now()\n\t\tthis.emit('sync', {\n\t\t\tsteps: newSteps,\n\t\t\t// TODO: do we actually need to dig into the connection here?\n\t\t\tdocument: this.#connection.document,\n\t\t\tversion: this.version,\n\t\t})\n\t}\n\n\tcheckIdle() {\n\t\tconst lastPushMinutesAgo = (Date.now() - this.lastStepPush) / 1000 / 60\n\t\tif (lastPushMinutesAgo > IDLE_TIMEOUT) {\n\t\t\tlogger.debug(`[SyncService] Document is idle for ${this.IDLE_TIMEOUT} minutes, suspending connection`)\n\t\t\tthis.emit('idle')\n\t\t\treturn true\n\t\t}\n\t\treturn false\n\t}\n\n\t_getContent() {\n\t\treturn this.serialize()\n\t}\n\n\tasync save({ force = false, manualSave = true } = {}) {\n\t\tlogger.debug('[SyncService] saving', arguments[0])\n\t\ttry {\n\t\t\tconst response = await this.#connection.save({\n\t\t\t\tversion: this.version,\n\t\t\t\tautosaveContent: this._getContent(),\n\t\t\t\tdocumentState: this.getDocumentState(),\n\t\t\t\tforce,\n\t\t\t\tmanualSave,\n\t\t\t})\n\t\t\tthis.emit('stateChange', { dirty: false })\n\t\t\tthis.#connection.document.lastSavedVersionTime = Date.now() / 1000\n\t\t\tlogger.debug('[SyncService] saved', response)\n\t\t\tconst { document, sessions } = response.data\n\t\t\tthis.emit('save', { document, sessions })\n\t\t\tthis.autosave.clear()\n\t\t} catch (e) {\n\t\t\tlogger.error('Failed to save document.', { error: e })\n\t\t\tthrow e\n\t\t}\n\t}\n\n\tforceSave() {\n\t\treturn this.save({ force: true })\n\t}\n\n\t_autosave() {\n\t\treturn this.save({ manualSave: false }).catch((error) => {\n\t\t\tlogger.error('Failed to autosave document.', { error })\n\t\t})\n\t}\n\n\tasync sendRemainingSteps(queue) {\n\t\tif (queue.length === 0) {\n\t\t\treturn\n\t\t}\n\t\tlet outbox = []\n\t\tconst steps = getSteps(queue)\n\t\tconst awareness = getAwareness(queue)\n\t\treturn this.sendStepsNow(() => {\n\t\t\tconst data = { steps, awareness, version: this.version }\n\t\t\toutbox = [...queue]\n\t\t\tlogger.debug('sending final steps ', data)\n\t\t\treturn data\n\t\t})?.then(() => {\n\t\t\t// only keep the steps that were not send yet\n\t\t\tqueue.splice(0,\n\t\t\t\tqueue.length,\n\t\t\t\t...queue.filter(s => !outbox.includes(s)),\n\t\t\t)\n\t\t}, err => logger.error(err))\n\t}\n\n\tasync close() {\n\t\t// Make sure to leave no pending requests behind.\n\t\tthis.autosave.clear()\n\t\tthis.backend?.disconnect()\n\t\tif (!this.#connection || this.#connection.isClosed) {\n\t\t\treturn\n\t\t}\n\t\treturn this.#connection.close()\n\t\t\t// Log and ignore possible network issues.\n\t\t\t.catch(e => {\n\t\t\t\tlogger.info('Failed to close connection.', { e })\n\t\t\t})\n\t}\n\n\tuploadAttachment(file) {\n\t\treturn this.#connection.uploadAttachment(file)\n\t}\n\n\tinsertAttachmentFile(filePath) {\n\t\treturn this.#connection.insertAttachmentFile(filePath)\n\t}\n\n\ton(event, callback) {\n\t\tthis._bus.on(event, callback)\n\t\treturn this\n\t}\n\n\toff(event, callback) {\n\t\tthis._bus.off(event, callback)\n\t\treturn this\n\t}\n\n\temit(event, data) {\n\t\tthis._bus.emit(event, data)\n\t}\n\n}\n\nexport default SyncService\nexport { SyncService, ERROR_TYPE, IDLE_TIMEOUT, COLLABORATOR_IDLE_TIME, COLLABORATOR_DISCONNECT_TIME }\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n/* eslint-disable max-depth, max-statements, complexity, max-lines-per-function */\nvar SLASH = 47;\nvar DOT = 46;\nvar assertPath = function assertPath(path) {\n  var t = _typeof(path);\n  if (t !== 'string') {\n    throw new TypeError(\"Expected a string, got a \".concat(t));\n  }\n};\n\n// this function is directly from node source\nvar posixNormalize = function posixNormalize(path, allowAboveRoot) {\n  var res = '';\n  var lastSegmentLength = 0;\n  var lastSlash = -1;\n  var dots = 0;\n  var code;\n  for (var i = 0; i <= path.length; ++i) {\n    if (i < path.length) {\n      code = path.charCodeAt(i);\n    } else if (code === SLASH) {\n      break;\n    } else {\n      code = SLASH;\n    }\n    if (code === SLASH) {\n      if (lastSlash === i - 1 || dots === 1) {\n        // NOOP\n      } else if (lastSlash !== i - 1 && dots === 2) {\n        if (res.length < 2 || lastSegmentLength !== 2 || res.charCodeAt(res.length - 1) !== DOT || res.charCodeAt(res.length - 2) !== DOT) {\n          if (res.length > 2) {\n            var lastSlashIndex = res.lastIndexOf('/');\n            if (lastSlashIndex !== res.length - 1) {\n              if (lastSlashIndex === -1) {\n                res = '';\n                lastSegmentLength = 0;\n              } else {\n                res = res.slice(0, lastSlashIndex);\n                lastSegmentLength = res.length - 1 - res.lastIndexOf('/');\n              }\n              lastSlash = i;\n              dots = 0;\n              continue;\n            }\n          } else if (res.length === 2 || res.length === 1) {\n            res = '';\n            lastSegmentLength = 0;\n            lastSlash = i;\n            dots = 0;\n            continue;\n          }\n        }\n        if (allowAboveRoot) {\n          if (res.length > 0) {\n            res += '/..';\n          } else {\n            res = '..';\n          }\n          lastSegmentLength = 2;\n        }\n      } else {\n        if (res.length > 0) {\n          res += '/' + path.slice(lastSlash + 1, i);\n        } else {\n          res = path.slice(lastSlash + 1, i);\n        }\n        lastSegmentLength = i - lastSlash - 1;\n      }\n      lastSlash = i;\n      dots = 0;\n    } else if (code === DOT && dots !== -1) {\n      ++dots;\n    } else {\n      dots = -1;\n    }\n  }\n  return res;\n};\nvar decode = function decode(s) {\n  try {\n    return decodeURIComponent(s);\n  } catch (_unused) {\n    return s;\n  }\n};\nvar normalize = function normalize(p) {\n  assertPath(p);\n  var path = p;\n  if (path.length === 0) {\n    return '.';\n  }\n  var isAbsolute = path.charCodeAt(0) === SLASH;\n  var trailingSeparator = path.charCodeAt(path.length - 1) === SLASH;\n  path = decode(path);\n  path = posixNormalize(path, !isAbsolute);\n  if (path.length === 0 && !isAbsolute) {\n    path = '.';\n  }\n  if (path.length > 0 && trailingSeparator) {\n    path += '/';\n  }\n  if (isAbsolute) {\n    return '/' + path;\n  }\n  return path;\n};\nvar _default = normalize;\nexports[\"default\"] = _default;\nmodule.exports = exports.default;\n","/**\n * SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { generateUrl, generateRemoteUrl } from '@nextcloud/router'\nimport pathNormalize from 'path-normalize'\n\nimport store from '../store/index.js'\n\nconst setAttachmentList = (val) => store.dispatch('text/setAttachmentList', val)\nconst findAttachment = store.getters['text/findAttachment']\n\nexport default class AttachmentResolver {\n\n\t#session\n\t#user\n\t#shareToken\n\t#currentDirectory\n\t#documentId\n\t#initAttachmentListPromise\n\n\tconstructor({ session, user, shareToken, currentDirectory, fileId }) {\n\t\tthis.#session = session\n\t\tthis.#user = user\n\t\tthis.#shareToken = shareToken\n\t\tthis.#currentDirectory = currentDirectory\n\t\tthis.#documentId = fileId ?? session.documentId\n\t\tthis.#initAttachmentListPromise = this.#updateAttachmentList()\n\t}\n\n\tasync #updateAttachmentList() {\n\t\treturn setAttachmentList({ documentId: this.#documentId, session: this.#session, shareToken: this.#shareToken })\n\t}\n\n\t/*\n\t * Resolve a given image/attachment src.\n\t * @param { string } src - the original src in the node.\n\t * @param { bool } fallback - fetch again attachmentsList if not found | defaul = true\n\t */\n\tasync resolve(src, fallback = true) {\n\t\tlet attachment\n\n\t\t// Native attachment\n\t\tconst directoryRegexp = /^\\.attachments\\.\\d+\\//\n\t\tif (src.match(directoryRegexp)) {\n\t\t\tconst imageFileName = decodeURIComponent(src.replace(directoryRegexp, '').split('?')[0])\n\n\t\t\t// Wait until attachment list got fetched (initialized by constructor)\n\t\t\tawait this.#initAttachmentListPromise\n\t\t\tattachment = findAttachment(imageFileName)\n\n\t\t\tif (fallback && !attachment) {\n\t\t\t\t// Update attachments list. Needed if attachments gets added to the session\n\t\t\t\tawait this.#updateAttachmentList()\n\t\t\t\tattachment = findAttachment(imageFileName)\n\t\t\t}\n\n\t\t\tif (attachment) {\n\t\t\t\treturn attachment\n\t\t\t}\n\n\t\t}\n\n\t\t// Direct URLs\n\t\tif (isDirectUrl(src)) {\n\t\t\treturn {\n\t\t\t\tisImage: true,\n\t\t\t\tname: this.#name(src),\n\t\t\t\tpreviewUrl: src,\n\t\t\t\tfullUrl: src,\n\t\t\t}\n\t\t}\n\n\t\t// Fallback: Return DAV url (e.g. for relative paths to images)\n\t\treturn {\n\t\t\tisImage: true,\n\t\t\tname: this.#name(src),\n\t\t\tpreviewUrl: this.#davUrl(src),\n\t\t\tfullUrl: this.#davUrl(src),\n\t\t}\n\t}\n\n\t#name(src) {\n\t\treturn src.split('/').pop()\n\t}\n\n\t#davUrl(src) {\n\t\tif (this.#user) {\n\t\t\tconst uid = this.#user.uid\n\t\t\tconst encoded = this.#filePath(src).split('/').map(encodeURIComponent).join('/')\n\t\t\treturn generateRemoteUrl(`dav/files/${uid}${encoded}`)\n\t\t}\n\n\t\tconst path = this.#filePath(src).split('/')\n\t\tconst basename = path.pop()\n\t\tconst dirname = path.join('/')\n\n\t\treturn generateUrl('/s/{token}/download?path={dirname}&files={basename}', {\n\t\t\ttoken: this.#shareToken,\n\t\t\tbasename,\n\t\t\tdirname,\n\t\t})\n\t}\n\n\t/**\n\t * Return the relativePath to a file specified in the url\n\t *\n\t * @param {string} src - url to extract path from\n\t */\n\t#relativePath(src) {\n\t\treturn decodeURI(src.split('?')[0])\n\t}\n\n\t#filePath(src) {\n\t\tconst f = [\n\t\t\tthis.#currentDirectory,\n\t\t\tthis.#relativePath(src),\n\t\t].join('/')\n\n\t\treturn pathNormalize(f)\n\t}\n\n}\n\n/**\n * Check if src is a direct URL.\n * Full URLs only work for images on the same Nextcloud instance (due to CORS restrictions).\n *\n * @param {string} src - the url to check\n */\nfunction isDirectUrl(src) {\n\treturn src.startsWith('http://')\n\t\t|| src.startsWith('https://')\n\t\t|| src.startsWith('data:')\n}\n","<!--\n  - SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n<template>\n\t<NextcloudVueNcActionButton close-after-click\n\t\tdata-text-action-entry=\"formatting-help\"\n\t\tv-on=\"$listeners\">\n\t\t<template #icon>\n\t\t\t<Help />\n\t\t</template>\n\t\t{{ t('text', 'Formatting help') }}\n\t</NextcloudVueNcActionButton>\n</template>\n\n<script>\nimport { defineComponent } from 'vue'\nimport { NcActionButton as NextcloudVueNcActionButton } from '@nextcloud/vue'\nimport { Help } from '../icons.js'\n\nexport default defineComponent({\n\t// This component is used as a direct child of NcActions.\n\t// Even if it actually renders NcActionButton, NcActions cannot see it due to rendering limitations in Vue.\n\t// Though it works in general, NcActions doesn't handle it correctly. See NcActions docs for details.\n\t// Hotfix - rename the component to NcActionButton because it represents and renders it.\n\t// eslint-disable-next-line vue/match-component-file-name\n\tname: 'NcActionButton',\n\tcomponents: {\n\t\tNextcloudVueNcActionButton,\n\t\tHelp,\n\t},\n})\n</script>\n","<!--\n  - SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<NcActionText data-text-action-entry=\"character-count\">\n\t\t<template #icon>\n\t\t\t<AlphabeticalVariant />\n\t\t</template>\n\t\t<template #default>\n\t\t\t{{ countString }}\n\t\t</template>\n\t</NcActionText>\n</template>\n\n<script>\nimport { defineComponent } from 'vue'\nimport { translatePlural as n } from '@nextcloud/l10n'\nimport { NcActionText } from '@nextcloud/vue'\nimport { AlphabeticalVariant } from '../icons.js'\nimport { useEditorMixin } from '../Editor.provider.js'\n\nexport default defineComponent({\n\tname: 'CharacterCount',\n\tcomponents: {\n\t\tAlphabeticalVariant,\n\t\tNcActionText,\n\t},\n\tmixins: [useEditorMixin],\n\tprops: {\n\t\tvisible: Boolean,\n\t},\n\tdata: () => ({\n\t\twordCount: 0,\n\t\tcharCount: 0,\n\t}),\n\tcomputed: {\n\t\tcountString() {\n\t\t\treturn `${n('text', '%n word', '%n words', this.wordCount)}, ${n('text', '%n char', '%n chars', this.charCount)}`\n\t\t},\n\t},\n\twatch: {\n\t\tvisible: 'refresh',\n\t},\n\tcreated() {\n\t\tthis.refresh()\n\t},\n\tmethods: {\n\t\trefresh() {\n\t\t\t// characterCount is not reactive so we need this workaround\n\t\t\tthis.wordCount = this.$editor.storage.characterCount.words()\n\t\t\tthis.charCount = this.$editor.storage.characterCount.characters()\n\t\t},\n\t},\n})\n</script>\n","/**\n * SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\n/**\n * Check if current platform is a mobile device\n *\n * @return {boolean} whether the platform is a mobile device\n */\nexport function isMobilePlatform() {\n\t// Use client hints if already available\n\tif (navigator?.userAgentData?.mobile !== undefined) return navigator.userAgentData.mobile\n\n\t// use regex to match userAgent (required for Safari and Firefox in 2022)\n\tconst mobileDevices = [\n\t\t/Android/i,\n\t\t/webOS/i,\n\t\t/iPhone/i,\n\t\t/iPad/i,\n\t\t/iPod/i,\n\t\t/playbook/i,\n\t\t/silk/i,\n\t\t/BlackBerry/i,\n\t\t/Windows Phone/i,\n\t]\n\n\treturn mobileDevices.some(regex => navigator.userAgent.match(regex))\n}\n","<!--\n  - SPDX-FileCopyrightText: 2021 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<NcDialog size=\"normal\"\n\t\tdata-text-el=\"formatting-help\"\n\t\t:name=\"t('text', 'Formatting and shortcuts')\"\n\t\t:close-on-click-outside=\"true\"\n\t\t@closing=\"$emit('close')\">\n\t\t<h2>{{ t('text', 'Formatting and shortcuts') }}</h2>\n\t\t<p>{{ t('text', 'Speed up your writing with simple shortcuts.') }}</p>\n\t\t<p v-if=\"!isMobileCached\">\n\t\t\t{{ t('text', 'Just type the Markdown syntax or use keyboard shortcuts from below.') }}\n\t\t</p>\n\t\t<p v-else>\n\t\t\t{{ t('text', 'Just type the Markdown syntax from below.') }}\n\t\t</p>\n\n\t\t<table>\n\t\t\t<thead>\n\t\t\t\t<tr>\n\t\t\t\t\t<th>{{ t('text', 'Style') }}</th>\n\t\t\t\t\t<th>{{ t('text', 'Syntax') }}</th>\n\t\t\t\t\t<th v-if=\"!isMobileCached\">\n\t\t\t\t\t\t{{ t('text', 'Keyboard shortcuts') }}\n\t\t\t\t\t</th>\n\t\t\t\t</tr>\n\t\t\t</thead>\n\t\t\t<tbody>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>{{ t('text', 'New paragraph') }}</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<kbd>{{ t('text', 'Enter') }}</kbd>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td v-if=\"!isMobileCached\" />\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>{{ t('text', 'Hard line break') }}</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<kbd>{{ t('text', 'Enter') }}</kbd>\n\t\t\t\t\t\t{{ t('text', 'followed by') }}\n\t\t\t\t\t\t<kbd>{{ t('text', 'Backspace') }}</kbd>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td v-if=\"!isMobileCached\">\n\t\t\t\t\t\t<kbd>{{ t('text', 'Shift') }}</kbd>\n\t\t\t\t\t\t+\n\t\t\t\t\t\t<kbd>{{ t('text', 'Enter') }}</kbd>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>{{ t('text', 'Bold') }}</td>\n\t\t\t\t\t<td><code>**{{ t('text', 'Bold text') }}**</code></td>\n\t\t\t\t\t<td v-if=\"!isMobileCached\">\n\t\t\t\t\t\t<kbd>{{ t('text', 'Ctrl') }}</kbd>\n\t\t\t\t\t\t+\n\t\t\t\t\t\t<kbd>B</kbd>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>{{ t('text', 'Italic') }}</td>\n\t\t\t\t\t<td><code>*{{ t('text', 'Italicized text') }}*</code></td>\n\t\t\t\t\t<td v-if=\"!isMobileCached\">\n\t\t\t\t\t\t<kbd>{{ t('text', 'Ctrl') }}</kbd>\n\t\t\t\t\t\t+\n\t\t\t\t\t\t<kbd>I</kbd>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>{{ t('text', 'Strikethrough') }}</td>\n\t\t\t\t\t<td><code>~~{{ t('text', 'Mistaken text') }}~~</code></td>\n\t\t\t\t\t<td v-if=\"!isMobileCached\">\n\t\t\t\t\t\t<kbd>{{ t('text', 'Ctrl') }}</kbd>\n\t\t\t\t\t\t+\n\t\t\t\t\t\t<kbd>{{ t('text', 'Shift') }}</kbd>\n\t\t\t\t\t\t+\n\t\t\t\t\t\t<kbd>S</kbd>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>{{ t('text', 'Underline') }}</td>\n\t\t\t\t\t<td><code>__{{ t('text', 'Underlined text') }}__</code></td>\n\t\t\t\t\t<td v-if=\"!isMobileCached\">\n\t\t\t\t\t\t<kbd>{{ t('text', 'Ctrl') }}</kbd>\n\t\t\t\t\t\t+\n\t\t\t\t\t\t<kbd>U</kbd>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td class=\"ellipsis_top\">\n\t\t\t\t\t\t{{ t('text', 'Heading 1') }}\n\t\t\t\t\t</td>\n\t\t\t\t\t<td class=\"ellipsis_top\">\n\t\t\t\t\t\t<code># {{ t('text', 'Heading level 1') }}</code>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td v-if=\"!isMobileCached\" class=\"ellipsis_top\">\n\t\t\t\t\t\t<kbd>{{ t('text', 'Ctrl') }}</kbd>\n\t\t\t\t\t\t+\n\t\t\t\t\t\t<kbd>{{ t('text', 'Shift') }}</kbd>\n\t\t\t\t\t\t+\n\t\t\t\t\t\t<kbd>1</kbd>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td class=\"noborder ellipsis\">\n\t\t\t\t\t\t…\n\t\t\t\t\t</td>\n\t\t\t\t\t<td class=\"noborder ellipsis\">\n\t\t\t\t\t\t…\n\t\t\t\t\t</td>\n\t\t\t\t\t<td v-if=\"!isMobileCached\" class=\"ellipsis noborder\">\n\t\t\t\t\t\t…\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td class=\"noborder ellipsis_bottom\">\n\t\t\t\t\t\t{{ t('text', 'Heading 6') }}\n\t\t\t\t\t</td>\n\t\t\t\t\t<td class=\"noborder ellipsis_bottom\">\n\t\t\t\t\t\t<code>###### {{ t('text', 'Heading level 6') }}</code>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td v-if=\"!isMobileCached\" class=\"noborder ellipsis_bottom\">\n\t\t\t\t\t\t<kbd>{{ t('text', 'Ctrl') }}</kbd>\n\t\t\t\t\t\t+\n\t\t\t\t\t\t<kbd>{{ t('text', 'Shift') }}</kbd>\n\t\t\t\t\t\t+\n\t\t\t\t\t\t<kbd>6</kbd>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>{{ t('text', 'Unordered list') }}</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<code>* {{ t('text', 'An item') }}</code>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td v-if=\"!isMobileCached\">\n\t\t\t\t\t\t<kbd>{{ t('text', 'Ctrl') }}</kbd>\n\t\t\t\t\t\t+\n\t\t\t\t\t\t<kbd>{{ t('text', 'Shift') }}</kbd>\n\t\t\t\t\t\t+\n\t\t\t\t\t\t<kbd>8</kbd>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>{{ t('text', 'Ordered list') }}</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<code>1. {{ t('text', 'First item') }}</code>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td v-if=\"!isMobileCached\">\n\t\t\t\t\t\t<kbd>{{ t('text', 'Ctrl') }}</kbd>\n\t\t\t\t\t\t+\n\t\t\t\t\t\t<kbd>{{ t('text', 'Shift') }}</kbd>\n\t\t\t\t\t\t+\n\t\t\t\t\t\t<kbd>7</kbd>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>{{ t('text', 'Checklist') }}</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<code>* [] {{ t('text', 'To-Do item') }}</code>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td v-if=\"!isMobileCached\" />\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>{{ t('text', 'Blockquote') }}</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<code>> {{ t('text', 'Quoted text') }}</code>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td v-if=\"!isMobileCached\">\n\t\t\t\t\t\t<kbd>{{ t('text', 'Ctrl') }}</kbd>\n\t\t\t\t\t\t+\n\t\t\t\t\t\t<kbd>></kbd>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>{{ t('text', 'Code block') }}</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<code>``` {{ t('text', 'Some code') }}</code>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td v-if=\"!isMobileCached\" />\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>{{ t('text', 'Link') }}</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<code>[Title](https://example.org)</code>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td v-if=\"!isMobileCached\" />\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>{{ t('text', 'Insert emoji') }}</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<code>:{{ t('text', 'emoji') }}</code>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td v-if=\"!isMobileCached\" />\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>{{ t('text', 'Mention someone') }}</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<code>@{{ t('text', 'name') }}</code>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td v-if=\"!isMobileCached\" />\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>{{ t('text', 'Smart picker') }}</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<code>/{{ t('text', 'something') }}</code>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td v-if=\"!isMobileCached\" />\n\t\t\t\t</tr>\n\t\t\t</tbody>\n\t\t</table>\n\n\t\t<table vif=\"!isMobileCached\">\n\t\t\t<thead>\n\t\t\t\t<tr>\n\t\t\t\t\t<th>{{ t('text', 'Action') }}</th>\n\t\t\t\t\t<th>{{ t('text', 'Keyboard shortcuts') }}</th>\n\t\t\t\t</tr>\n\t\t\t</thead>\n\t\t\t<tbody>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>{{ t('text', 'Undo') }}</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<kbd>{{ t('text', 'Ctrl') }}</kbd>\n\t\t\t\t\t\t+\n\t\t\t\t\t\t<kbd>Z</kbd>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>{{ t('text', 'Redo') }}</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<kbd>{{ t('text', 'Ctrl') }}</kbd>\n\t\t\t\t\t\t+\n\t\t\t\t\t\t<kbd>Y</kbd>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>{{ t('text', 'Toggle outline') }}</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<kbd>{{ t('text', 'Ctrl') }}</kbd>\n\t\t\t\t\t\t+\n\t\t\t\t\t\t<kbd>{{ t('text', 'Alt') }}</kbd>\n\t\t\t\t\t\t+\n\t\t\t\t\t\t<kbd>H</kbd>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</tbody>\n\t\t</table>\n\t</NcDialog>\n</template>\n\n<script>\nimport { NcDialog } from '@nextcloud/vue'\nimport { isMobilePlatform } from '../helpers/platform.js'\n\nexport default {\n\tname: 'HelpModal',\n\tcomponents: {\n\t\tNcDialog,\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tformatted: {\n\t\t\t\tbold: true,\n\t\t\t\titalic: true,\n\t\t\t\tstrikethrough: true,\n\t\t\t\theading1: true,\n\t\t\t\theading6: true,\n\t\t\t\tunorderdList: true,\n\t\t\t\torderedList: true,\n\t\t\t\tcheckList: true,\n\t\t\t\tblockQuote: true,\n\t\t\t\tcodeBlock: true,\n\t\t\t},\n\t\t}\n\t},\n\tcomputed: {\n\t\tisFormatted() {\n\t\t\treturn (style) => this.formatted[style]\n\t\t},\n\t\t// Cache the output of `isMobilePlatform()`\n\t\tisMobileCached() {\n\t\t\treturn this.isMobilePlatform()\n\t\t},\n\t},\n\tmethods: {\n\t\ttoggleFormatted(style) {\n\t\t\tthis.formatted[style] = !this.formatted[style]\n\t\t},\n\t\tisMobilePlatform,\n\t},\n}\n</script>\n\n<style lang=\"scss\" scoped>\n\ttable {\n\t\tmargin-top: 24px;\n\t\tborder-collapse: collapse;\n\n\t\ttbody tr {\n\t\t\t&:hover, &:focus, &:active {\n\t\t\t\tbackground-color: transparent !important;\n\t\t\t}\n\t\t}\n\n\t\tthead tr {\n\t\t\tborder: none;\n\t\t}\n\n\t\tth {\n\t\t\tfont-weight: bold;\n\t\t\tpadding: .75rem 1rem .75rem 0;\n\t\t\tborder-bottom: 2px solid var(--color-background-darker);\n\t\t}\n\n\t\ttd {\n\t\t\tpadding: .75rem 1rem .75rem 0;\n\t\t\tborder-top: 1px solid var(--color-background-dark);\n\t\t\tborder-bottom: unset;\n\n\t\t\t&.noborder {\n\t\t\t\tborder-top: unset;\n\t\t\t}\n\n\t\t\t&.ellipsis_top {\n\t\t\t\tpadding-bottom: 0;\n\t\t\t}\n\n\t\t\t&.ellipsis {\n\t\t\t\tpadding-top: 0;\n\t\t\t\tpadding-bottom: 0;\n\t\t\t}\n\n\t\t\t&.ellipsis_bottom {\n\t\t\t\tpadding-top: 0;\n\t\t\t}\n\t\t}\n\n\t\tkbd {\n\t\t\tfont-size: smaller;\n\t\t}\n\n\t\tcode {\n\t\t\tpadding: .2em .4em;\n\t\t\tfont-size: 90%;\n\t\t\tbackground-color: var(--color-background-dark);\n\t\t\tborder-radius: 6px;\n\t\t}\n\t}\n\n\t@import '../css/prosemirror';\n\n\tdiv.ProseMirror {\n\t\tdisplay: inline;\n\t\tmargin-top: unset;\n\t\tposition: unset;\n\t\tpadding: unset;\n\t\tline-height: unset;\n\n\t\th1, h6 {\n\t\t\tdisplay: inline;\n\t\t\tpadding: 0;\n\t\t\tmargin: 0;\n\t\t}\n\t}\n</style>\n","<!--\n  - SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<div :id=\"randomID\"\n\t\tclass=\"text-menubar\"\n\t\tdata-text-el=\"menubar\"\n\t\trole=\"region\"\n\t\t:aria-label=\"t('text', 'Editor actions')\"\n\t\t:class=\"{\n\t\t\t'text-menubar--ready': isReady,\n\t\t\t'text-menubar--hide': isHidden,\n\t\t\t'text-menubar--is-workspace': $isRichWorkspace\n\t\t}\">\n\t\t<HelpModal v-if=\"displayHelp\" @close=\"hideHelp\" />\n\n\t\t<div v-if=\"$isRichEditor\"\n\t\t\tref=\"menubar\"\n\t\t\trole=\"toolbar\"\n\t\t\tclass=\"text-menubar__entries\"\n\t\t\t:aria-label=\"t('text', 'Formatting menu bar')\"\n\t\t\t@keydown.left.stop=\"handleToolbarNavigation\"\n\t\t\t@keydown.right.stop=\"handleToolbarNavigation\">\n\t\t\t<!-- The visible inline actions -->\n\t\t\t<component :is=\"actionEntry.component ? actionEntry.component : (actionEntry.children ? 'ActionList' : 'ActionSingle')\"\n\t\t\t\tv-for=\"(actionEntry, index) in visibleEntries\"\n\t\t\t\tref=\"menuEntries\"\n\t\t\t\t:key=\"actionEntry.key\"\n\t\t\t\t:action-entry=\"actionEntry\"\n\t\t\t\t:can-be-focussed=\"activeMenuEntry === index\"\n\t\t\t\t@disabled=\"disableMenuEntry(actionEntry.key, $event)\"\n\t\t\t\t@click=\"activeMenuEntry = index\" />\n\n\t\t\t<!-- The remaining actions -->\n\t\t\t<ActionList ref=\"remainingEntries\"\n\t\t\t\t:action-entry=\"hiddenEntries\"\n\t\t\t\t:can-be-focussed=\"activeMenuEntry === visibleEntries.length\"\n\t\t\t\t:force-enabled=\"true\"\n\t\t\t\t@click=\"activeMenuEntry = 'remain'\">\n\t\t\t\t<template #lastAction=\"{ visible }\">\n\t\t\t\t\t<NcActionButton v-if=\"canTranslate\" close-after-click @click=\"showTranslate\">\n\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t<TranslateVariant />\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t{{ t('text', 'Translate') }}\n\t\t\t\t\t</NcActionButton>\n\t\t\t\t\t<ActionFormattingHelp @click=\"showHelp\" />\n\t\t\t\t\t<NcActionSeparator />\n\t\t\t\t\t<CharacterCount v-bind=\"{ visible }\" />\n\t\t\t\t</template>\n\t\t\t</ActionList>\n\t\t</div>\n\t\t<div class=\"text-menubar__slot\">\n\t\t\t<slot />\n\t\t</div>\n\t</div>\n</template>\n\n<script>\nimport { ref } from 'vue'\nimport { NcActionSeparator, NcActionButton } from '@nextcloud/vue'\nimport { loadState } from '@nextcloud/initial-state'\nimport { useElementSize } from '@vueuse/core'\nimport { emit } from '@nextcloud/event-bus'\n\nimport ActionFormattingHelp from './ActionFormattingHelp.vue'\nimport ActionList from './ActionList.vue'\nimport ActionSingle from './ActionSingle.vue'\nimport CharacterCount from './CharacterCount.vue'\nimport HelpModal from '../HelpModal.vue'\nimport ToolBarLogic from './ToolBarLogic.js'\nimport actionsFullEntries from './entries.js'\nimport { MENU_ID } from './MenuBar.provider.js'\nimport { DotsHorizontal, TranslateVariant } from '../icons.js'\nimport {\n\tuseEditorMixin,\n\tuseIsMobileMixin,\n\tuseIsRichEditorMixin,\n\tuseIsRichWorkspaceMixin,\n} from '../Editor.provider.js'\n\nexport default {\n\tname: 'MenuBar',\n\tcomponents: {\n\t\tActionFormattingHelp,\n\t\tActionList,\n\t\tActionSingle,\n\t\tHelpModal,\n\t\tNcActionSeparator,\n\t\tNcActionButton,\n\t\tCharacterCount,\n\t\tTranslateVariant,\n\t},\n\textends: ToolBarLogic,\n\tmixins: [\n\t\tuseEditorMixin,\n\t\tuseIsMobileMixin,\n\t\tuseIsRichEditorMixin,\n\t\tuseIsRichWorkspaceMixin,\n\t],\n\tprovide() {\n\t\tconst val = {}\n\n\t\tObject.defineProperties(val, {\n\t\t\t[MENU_ID]: {\n\t\t\t\tget: () => this.randomID,\n\t\t\t},\n\t\t})\n\n\t\treturn val\n\t},\n\tprops: {\n\t\tisHidden: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\n\tsetup() {\n\t\tconst menubar = ref()\n\t\tconst { width } = useElementSize(menubar)\n\t\treturn { menubar, width }\n\t},\n\n\tdata() {\n\t\treturn {\n\t\t\tentries: [...actionsFullEntries],\n\t\t\trandomID: `menu-bar-${(Math.ceil((Math.random() * 10000) + 500)).toString(16)}`,\n\t\t\tdisplayHelp: false,\n\t\t\tisReady: false,\n\t\t\tcanTranslate: loadState('text', 'translation_languages', []).length > 0,\n\t\t\tresize: null,\n\t\t}\n\t},\n\tcomputed: {\n\t\tvisibleEntries() {\n\t\t\tconst list = this.entries.filter(({ priority }) => {\n\t\t\t\t// if entry has no priority, we assume it always will be visible\n\t\t\t\treturn priority === undefined || priority <= this.iconsLimit\n\t\t\t})\n\n\t\t\treturn list\n\t\t},\n\t\thiddenEntries() {\n\t\t\tconst remainingEntries = this.entries.filter(({ priority }) => {\n\t\t\t\t// reverse logic from visibleEntries\n\t\t\t\treturn priority !== undefined && priority > this.iconsLimit\n\t\t\t})\n\t\t\tconst entries = remainingEntries.reduce((acc, entry, index) => {\n\t\t\t\t// If entry has children, merge them into list. Otherwise keep entry itself.\n\t\t\t\tconst children = entry.children ?? [entry]\n\t\t\t\t// If this block has menu entries, it should be separated for better visibility and a11y (menu item radio grouping)\n\t\t\t\tif (children.length > 1) {\n\t\t\t\t\tconst hasPreviousItem = acc.length && !acc.at(-1).isSeparator\n\t\t\t\t\tconst separatorBefore = hasPreviousItem ? [{ key: `separator-before-${entry.id}`, isSeparator: true }] : []\n\n\t\t\t\t\tconst hasNextItem = index !== remainingEntries.length - 1\n\t\t\t\t\tconst separatorAfter = hasNextItem ? [{ key: `separator-after-${entry.id}`, isSeparator: true }] : []\n\n\t\t\t\t\treturn [...acc, ...separatorBefore, ...children, ...separatorAfter]\n\t\t\t\t}\n\t\t\t\treturn [...acc, ...children]\n\t\t\t}, [])\n\n\t\t\treturn {\n\t\t\t\tkey: 'remain',\n\t\t\t\tlabel: this.t('text', 'Remaining actions'),\n\t\t\t\ticon: DotsHorizontal,\n\t\t\t\tchildren: entries,\n\t\t\t}\n\t\t},\n\t\ticonWidth() {\n\t\t\tconst style = this.menubar && getComputedStyle(this.menubar)\n\t\t\tconst clickableArea = style?.getPropertyValue('--default-clickable-area')\n\t\t\treturn parseInt(clickableArea) || 34\n\t\t},\n\t\ticonsLimit() {\n\t\t\t// leave some buffer - this is necessary so the bar does not wrap during resizing\n\t\t\tconst spaceToFill = this.width - 4\n\t\t\tconst spacePerSlot = this.$isMobile\n\t\t\t\t? this.iconWidth\n\t\t\t\t: this.iconWidth + 2\n\t\t\tconst slots = Math.floor(spaceToFill / spacePerSlot)\n\t\t\t// Leave one slot empty for the three dot menu\n\t\t\treturn slots - 1\n\t\t},\n\t},\n\tmounted() {\n\t\tthis.$nextTick(() => {\n\t\t\tthis.isReady = true\n\t\t\tthis.$emit('update:loaded', true)\n\t\t})\n\t},\n\tmethods: {\n\n\t\tshowHelp() {\n\t\t\tthis.displayHelp = true\n\t\t},\n\n\t\thideHelp() {\n\t\t\tthis.displayHelp = false\n\t\t},\n\t\tshowTranslate() {\n\t\t\tconst { from, to } = this.$editor.view.state.selection\n\t\t\tlet selectedText = this.$editor.view.state.doc.textBetween(from, to, ' ')\n\n\t\t\tif (!selectedText.trim().length) {\n\t\t\t\tthis.$editor.commands.selectAll()\n\t\t\t\tselectedText = this.$editor.view.state.doc.textContent\n\t\t\t}\n\n\t\t\tconsole.debug('translation click', this.$editor.view.state.selection, selectedText)\n\t\t\temit('text:translate-modal:show', { content: selectedText })\n\t\t},\n\t},\n}\n</script>\n\n<style scoped lang=\"scss\">\n\t.text-menubar {\n\t\t--background-blur: blur(10px);\n\t\tposition: sticky;\n\t\ttop: 0;\n\t\tz-index: 10021; // above modal-header so menubar is always on top\n\t\tbackground-color: var(--color-main-background-translucent);\n\t\tbackdrop-filter: var(--background-blur);\n\t\tmax-height: var(--default-clickable-area); // important for mobile so that the buttons are always inside the container\n\t\tpadding-top:3px;\n\t\tpadding-bottom: 3px;\n\n\t\tvisibility: hidden;\n\n\t\tdisplay: flex;\n\t\tjustify-content: flex-end;\n\t\talign-items: center;\n\n\t\t&.text-menubar--ready:not(.text-menubar--hide) {\n\t\t\tvisibility: visible;\n\t\t\tanimation-name: fadeInDown;\n\t\t\tanimation-duration: 0.3s;\n\t\t}\n\n\t\t&.text-menubar--hide {\n\t\t\topacity: 0;\n\t\t\ttransition: visibility 0.2s 0.4s, opacity 0.2s 0.4s;\n\t\t}\n\t\t.text-menubar__entries {\n\t\t\tdisplay: flex;\n\t\t\tflex-grow: 1;\n\t\t\tmargin-left: max(0px, calc((100% - var(--text-editor-max-width)) / 2));\n\t\t}\n\n\t\t.text-menubar__slot {\n\t\t\tjustify-content: flex-end;\n\t\t\tdisplay: flex;\n\t\t\tmin-width: max(0px, min(100px, (100% - var(--text-editor-max-width)) / 2));\n\t\t}\n\n\t\t&.text-menubar--is-workspace {\n\t\t\t.text-menubar__entries {\n\t\t\t\tmargin-left: 0;\n\t\t\t}\n\t\t}\n\n\t\t@media (max-width: 660px) {\n\t\t\t.text-menubar__entries {\n\t\t\t\tmargin-left: 0;\n\t\t\t}\n\t\t}\n\t}\n</style>\n","<!--\n  - SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<div data-text-el=\"editor-content-wrapper\"\n\t\tclass=\"content-wrapper text-editor__content-wrapper\"\n\t\t:class=\"{\n\t\t\t'--show-outline': showOutline\n\t\t}\">\n\t\t<div v-if=\"showOutline\" class=\"text-editor__content-wrapper__left\">\n\t\t\t<EditorOutline />\n\t\t</div>\n\t\t<slot />\n\t\t<EditorContent role=\"document\"\n\t\t\tclass=\"editor__content text-editor__content\"\n\t\t\t:editor=\"$editor\" />\n\t\t<div class=\"text-editor__content-wrapper__right\" />\n\t</div>\n</template>\n\n<script>\nimport { EditorContent } from '@tiptap/vue-2'\nimport { useEditorMixin } from '../Editor.provider.js'\nimport { useOutlineStateMixin } from './Wrapper.provider.js'\nimport EditorOutline from './EditorOutline.vue'\n\nexport default {\n\tname: 'ContentContainer',\n\tcomponents: {\n\t\tEditorContent,\n\t\tEditorOutline,\n\t},\n\tmixins: [useEditorMixin, useOutlineStateMixin],\n\tcomputed: {\n\t\tshowOutline() {\n\t\t\treturn this.$outlineState.visible\n\t\t},\n\t},\n}\n</script>\n\n<style scoped lang=\"scss\">\n\t.editor__content {\n\t\tmax-width: min(var(--text-editor-max-width), calc(100vw - 16px));\n\t\tmargin: auto;\n\t\tposition: relative;\n\t\twidth: 100%;\n\t}\n\n\t.ie {\n\t\t.editor__content:deep(.ProseMirror) {\n\t\t\tpadding-top: 50px;\n\t\t}\n\t}\n\n\t.text-editor__content-wrapper {\n\t\t--side-width: calc((100% - var(--text-editor-max-width)) / 2);\n\t\tdisplay: grid;\n\t\tgrid-template-columns: 1fr auto;\n\t\t&.--show-outline {\n\t\t\tgrid-template-columns: var(--side-width) auto var(--side-width);\n\t\t}\n\t\t.text-editor__content-wrapper__left,\n\t\t.text-editor__content-wrapper__right {\n\t\t\theight: 100%;\n\t\t\tposition: relative;\n\t\t}\n\t}\n\n\t.is-rich-workspace {\n\t\t.text-editor__content-wrapper {\n\t\t\t--side-width: var(--text-editor-max-width);\n\t\t\tgrid-template-columns: var(--side-width) auto;\n\t\t\t.text-editor__content-wrapper__left,\n\t\t\t.text-editor__content-wrapper__right {\n\t\t\t\tdisplay: none;\n\t\t\t}\n\t\t}\n\t}\n</style>\n","<!--\n  - SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<div class=\"editor editor-media-handler\"\n\t\tdata-text-el=\"editor-media-handler\"\n\t\t:class=\"{ draggedOver }\"\n\t\t@image-paste=\"onPaste\"\n\t\t@dragover.prevent.stop=\"setDraggedOver(true)\"\n\t\t@dragleave.prevent.stop=\"setDraggedOver(false)\"\n\t\t@file-drop=\"onEditorDrop\">\n\t\t<input v-show=\"false\"\n\t\t\tref=\"attachmentFileInput\"\n\t\t\tdata-text-el=\"attachment-file-input\"\n\t\t\ttype=\"file\"\n\t\t\taccept=\"*/*\"\n\t\t\tmultiple\n\t\t\t@change=\"onAttachmentUploadFilePicked\">\n\t\t<slot />\n\t</div>\n</template>\n\n<script>\nimport { getCurrentUser } from '@nextcloud/auth'\nimport { showError } from '@nextcloud/dialogs'\nimport { emit } from '@nextcloud/event-bus'\nimport { logger } from '../../helpers/logger.js'\n\nimport {\n\tuseEditorMixin,\n\tuseFileMixin,\n\tuseSyncServiceMixin,\n} from '../Editor.provider.js'\n\nimport {\n\tACTION_ATTACHMENT_PROMPT,\n\tACTION_CHOOSE_LOCAL_ATTACHMENT,\n\tSTATE_UPLOADING,\n} from './MediaHandler.provider.js'\n\nconst getDir = (val) => val.split('/').slice(0, -1).join('/')\n\nexport default {\n\tname: 'MediaHandler',\n\tmixins: [useEditorMixin, useFileMixin, useSyncServiceMixin],\n\tprovide() {\n\t\tconst val = {}\n\n\t\tObject.defineProperties(val, {\n\t\t\t[ACTION_ATTACHMENT_PROMPT]: {\n\t\t\t\tget: () => this.showAttachmentPrompt,\n\t\t\t},\n\t\t\t[ACTION_CHOOSE_LOCAL_ATTACHMENT]: {\n\t\t\t\tget: () => this.chooseLocalFile,\n\t\t\t},\n\t\t\t[STATE_UPLOADING]: {\n\t\t\t\tget: () => this.state,\n\t\t\t},\n\t\t})\n\n\t\treturn val\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tlastFilePath: null,\n\t\t\tdraggedOver: false,\n\t\t\t// make it reactive to be used inject/provide\n\t\t\tstate: {\n\t\t\t\tisUploadingAttachments: false,\n\t\t\t},\n\t\t}\n\t},\n\tcomputed: {\n\t\tinitialFilePath() {\n\t\t\treturn this.lastFilePath ?? getDir(this.$file?.relativePath ?? '/')\n\t\t},\n\t},\n\tmethods: {\n\t\tsetDraggedOver(val) {\n\t\t\tthis.draggedOver = val\n\t\t},\n\t\tonPaste(e) {\n\t\t\tthis.uploadAttachmentFiles(e.detail.files)\n\t\t},\n\t\tonEditorDrop(e) {\n\t\t\tthis.uploadAttachmentFiles(e.detail.files, e.detail.position)\n\t\t\tthis.draggedOver = false\n\t\t},\n\t\tonAttachmentUploadFilePicked(event) {\n\t\t\tthis.uploadAttachmentFiles(event.target.files)\n\t\t\t// Clear input to ensure that the change event will be emitted if\n\t\t\t// the same file is picked again.\n\t\t\tevent.target.value = ''\n\t\t},\n\t\tchooseLocalFile() {\n\t\t\tthis.$refs.attachmentFileInput.click()\n\t\t},\n\t\tasync uploadAttachmentFiles(files, position = null) {\n\t\t\tif (!files) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tthis.state.isUploadingAttachments = true\n\n\t\t\tconst uploadPromises = [...files].map((file) => {\n\t\t\t\treturn this.uploadAttachmentFile(file, position)\n\t\t\t})\n\n\t\t\treturn Promise.all(uploadPromises)\n\t\t\t\t.catch(error => {\n\t\t\t\t\tlogger.error('Uploading multiple images failed', { error })\n\t\t\t\t\tshowError(error?.response?.data?.error || error.message)\n\t\t\t\t})\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.state.isUploadingAttachments = false\n\t\t\t\t})\n\t\t},\n\t\tasync uploadAttachmentFile(file, position = null) {\n\t\t\tthis.state.isUploadingAttachments = true\n\n\t\t\treturn this.$syncService.uploadAttachment(file)\n\t\t\t\t.then((response) => {\n\t\t\t\t\tthis.insertAttachment(\n\t\t\t\t\t\tresponse.data?.name, response.data?.id, file.type,\n\t\t\t\t\t\tposition, response.data?.dirname,\n\t\t\t\t\t)\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tlogger.error('Uploading image failed', { error })\n\t\t\t\t\tshowError(error?.response?.data?.error)\n\t\t\t\t})\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.state.isUploadingAttachments = false\n\t\t\t\t})\n\t\t},\n\t\tshowAttachmentPrompt() {\n\t\t\tconst currentUser = getCurrentUser()\n\t\t\tif (!currentUser) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tOC.dialogs.filepicker(t('text', 'Insert an attachment'), (filePath) => {\n\t\t\t\tthis.insertFromPath(filePath)\n\t\t\t}, false, [], true, undefined, this.initialFilePath)\n\t\t},\n\t\tinsertFromPath(filePath) {\n\t\t\tthis.lastFilePath = getDir(filePath)\n\n\t\t\tthis.state.isUploadingAttachments = true\n\n\t\t\treturn this.$syncService.insertAttachmentFile(filePath).then((response) => {\n\t\t\t\tthis.insertAttachment(\n\t\t\t\t\tresponse.data?.name, response.data?.id, response.data?.mimetype,\n\t\t\t\t\tnull, response.data?.dirname,\n\t\t\t\t)\n\t\t\t}).catch((error) => {\n\t\t\t\tlogger.error('Failed to insert image path', { error })\n\t\t\t\tshowError(error?.response?.data?.error || error.message)\n\t\t\t}).then(() => {\n\t\t\t\tthis.state.isUploadingAttachments = false\n\t\t\t})\n\t\t},\n\t\tinsertAttachment(name, fileId, mimeType, position = null, dirname = '') {\n\t\t\t// inspired by the fixedEncodeURIComponent function suggested in\n\t\t\t// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent\n\t\t\tconst src = dirname + '/'\n\t\t\t\t+ encodeURIComponent(name).replace(/[!'()*]/g, (c) => {\n\t\t\t\t\treturn '%' + c.charCodeAt(0).toString(16).toUpperCase()\n\t\t\t\t})\n\t\t\t// simply get rid of brackets to make sure link text is valid\n\t\t\t// as it does not need to be unique and matching the real file name\n\t\t\tconst alt = name.replaceAll(/[[\\]]/g, '')\n\n\t\t\tconst chain = position\n\t\t\t\t? this.$editor.chain().focus(position)\n\t\t\t\t: this.$editor.chain()\n\n\t\t\tchain.setImage({ src, alt }).run()\n\n\t\t\tconst selection = this.$editor.view.state.selection\n\t\t\tif (!selection.empty) {\n\t\t\t\t// If inserted image is first element, it is selected and would get overwritten by\n\t\t\t\t// subsequent editor inserts (see tiptap#3355). So unselect the image by placing\n\t\t\t\t// the cursor at the end of the selection.\n\t\t\t\tthis.$editor.commands.focus(selection.to)\n\t\t\t}\n\n\t\t\t// Scroll image into view\n\t\t\tthis.$editor.commands.scrollIntoView()\n\n\t\t\temit('text:image-node:add', null)\n\t\t},\n\t},\n}\n</script>\n","<!--\n  - SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<div class=\"editor\">\n\t\t<MediaHandler v-if=\"$editorUpload\" class=\"text-editor__main\">\n\t\t\t<slot />\n\t\t</MediaHandler>\n\t\t<slot v-else />\n\t</div>\n</template>\n\n<script>\nimport MediaHandler from './MediaHandler.vue'\nimport { useEditorUpload } from '../Editor.provider.js'\n\nexport default {\n\tname: 'MainContainer',\n\tcomponents: {\n\t\tMediaHandler,\n\t},\n\tmixins: [\n\t\tuseEditorUpload,\n\t],\n}\n</script>\n\n<style scoped lang=\"scss\">\n\t.text-editor__main, .editor {\n\t\tbackground: var(--color-main-background);\n\t\tcolor: var(--color-main-text);\n\t\tbackground-clip: padding-box;\n\t\tborder-radius: var(--border-radius);\n\t\tpadding: 0;\n\t\tposition: relative;\n\t\twidth: 100%;\n\t}\n</style>\n","<!--\n  - SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<div class=\"text-editor__wrapper\"\n\t\t:class=\"{\n\t\t\t'has-conflicts': hasSyncCollission,\n\t\t\t'is-rich-workspace': $isRichWorkspace,\n\t\t\t'is-rich-editor': $isRichEditor,\n\t\t}\">\n\t\t<slot />\n\t</div>\n</template>\n\n<script>\nimport { ERROR_TYPE } from './../../services/SyncService.js'\nimport { useIsRichEditorMixin, useIsRichWorkspaceMixin } from './../Editor.provider.js'\nimport { OUTLINE_STATE, OUTLINE_ACTIONS } from './Wrapper.provider.js'\nimport useStore from '../../mixins/store.js'\nimport { mapState } from 'vuex'\n\nexport default {\n\tname: 'Wrapper',\n\tmixins: [useStore, useIsRichEditorMixin, useIsRichWorkspaceMixin],\n\tprovide() {\n\t\tconst val = {}\n\n\t\tObject.defineProperties(val, {\n\t\t\t[OUTLINE_STATE]: {\n\t\t\t\tget: () => this.outline,\n\t\t\t},\n\t\t\t[OUTLINE_ACTIONS]: {\n\t\t\t\tget: () => ({\n\t\t\t\t\ttoggle: this.outlineToggle,\n\t\t\t\t}),\n\t\t\t},\n\t\t})\n\n\t\treturn val\n\t},\n\n\tprops: {\n\t\tsyncError: {\n\t\t\ttype: Object,\n\t\t\tdefault: null,\n\t\t},\n\t\thasConnectionIssue: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tcontentLoaded: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t\tshowOutlineOutside: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\n\tdata: () => ({\n\t\toutline: {\n\t\t\tvisible: false,\n\t\t\tenable: false,\n\t\t},\n\t}),\n\n\tcomputed: {\n\t\t...mapState({\n\t\t\tviewWidth: (state) => state.text.viewWidth,\n\t\t}),\n\n\t\thasSyncCollission() {\n\t\t\treturn this.syncError && this.syncError.type === ERROR_TYPE.SAVE_COLLISSION\n\t\t},\n\t\tshowOutline() {\n\t\t\treturn this.isAbleToShowOutline\n\t\t\t\t? this.outline.visible\n\t\t\t\t: false\n\t\t},\n\t\tisAbleToShowOutline() {\n\t\t\tif (this.$isRichWorkspace) {\n\t\t\t\treturn false\n\t\t\t}\n\n\t\t\treturn this.viewWidth > 1265\n\t\t},\n\t},\n\n\twatch: {\n\t\t'showOutlineOutside'() {\n\t\t\tthis.outline.visible = this.showOutlineOutside\n\t\t},\n\t},\n\n\tmounted() {\n\t\tthis.outline.enable = this.isAbleToShowOutline\n\n\t\tthis.$watch(\n\t\t\t() => this.isAbleToShowOutline,\n\t\t\t(enable) => {\n\t\t\t\t// make outline state reactive through the provider\n\t\t\t\tObject.assign(this.outline, { enable })\n\t\t\t},\n\t\t)\n\n\t\tdocument.addEventListener('keydown', this.handleKeyDown)\n\t},\n\tbeforeDestroy() {\n\t\tdocument.removeEventListener('keydown', this.handleKeyDown)\n\t},\n\tmethods: {\n\t\toutlineToggle() {\n\t\t\tthis.outline.visible = !this.outline.visible\n\t\t\tthis.$emit('outline-toggled', this.outline.visible)\n\t\t},\n\t\thandleKeyDown(event) {\n\t\t\tif (event.ctrlKey && event.altKey && event.key === 'h') {\n\t\t\t\tthis.outlineToggle()\n\t\t\t}\n\t\t},\n\t},\n\n}\n</script>\n\n<style scoped lang=\"scss\">\n\n\t.text-editor__wrapper {\n\t\tdisplay: flex;\n\t\twidth: 100%;\n\t\theight: 100%;\n\n\t\t.ProseMirror {\n\t\t\tmargin-top: 0 !important;\n\t\t}\n\t}\n\n</style>\n"],"names":["outdatedTimeout","Awareness","Observable","doc","now","time.getUnixTime","remove","meta","clientid","removeAwarenessStates","math.floor","state","clientID","currLocalMeta","clock","prevState","added","updated","filteredUpdated","removed","f.equalityDeep","field","value","awareness","clients","origin","i","curMeta","encodeAwarenessUpdate","states","len","encoder","encoding.createEncoder","encoding.writeVarUint","encoding.writeVarString","encoding.toUint8Array","applyAwarenessUpdate","update","decoder","decoding.createDecoder","timestamp","decoding.readVarUint","decoding.readVarString","clientMeta","currClock","_sfc_main","NextcloudVueNcActionButton","BaseActionEntry","actionEntry","NcActions","NcActionSeparator","ActionListItem","useStore","useOutlineStateMixin","useMenuIDMixin","$editor","children","child","getIsActive","_a","visible","debounce","val","entry","getActionState","NcButton","ToolBarLogic","defineComponent","menuKey","index","key","modulo","event","_b","a","b","ActionList","ActionSingle","entries","encodeArrayBuffer","data","view","toBase64","decodeArrayBuffer","encoded","fromBase64","messageYjsSyncStep1","messageYjsSyncStep2","messageYjsUpdate","writeSyncStep1","sv","Y.encodeStateVector","encoding.writeVarUint8Array","writeSyncStep2","encodedStateVector","Y.encodeStateAsUpdate","readSyncStep1","decoding.readVarUint8Array","readSyncStep2","transactionOrigin","Y.applyUpdate","error","writeUpdate","readUpdate","readSyncMessage","messageType","channels","LocalStoragePolyfill","room","e","buffer.fromBase64","storage.onChange","buf","storage.varStorage","buffer.toBase64","buffer.createUint8ArrayFromArrayBuffer","storage.offChange","BC","getChannel","map.setIfUndefined","subs","set.create","bc","sub","subscribe","f","unsubscribe","channel","unsubscribed","publish","c","messagePermissionDenied","readAuthMessage","y","permissionDeniedHandler","encodeQueryParams","params","object.map","messageSync","messageQueryAwareness","messageAwareness","messageAuth","messageHandlers","provider","emitSynced","_messageType","syncMessageType","syncProtocol.readSyncMessage","syncProtocol.messageYjsSyncStep2","_decoder","_emitSynced","awarenessProtocol.encodeAwarenessUpdate","_encoder","awarenessProtocol.applyAwarenessUpdate","authProtocol.readAuthMessage","_ydoc","reason","messageReconnectTimeout","readMessage","messageHandler","setupWS","websocket","encoding.length","awarenessProtocol.removeAwarenessStates","client","math.min","math.pow","syncProtocol.writeSyncStep1","encoderAwarenessState","broadcastMessage","ws","bc.publish","WebsocketProvider","serverUrl","roomname","connect","awarenessProtocol.Awareness","WebSocketPolyfill","resyncInterval","maxBackoffTime","disableBc","syncProtocol.writeUpdate","_origin","changedClients","env.isNode","process","encodedParams","url.encodeQueryParams","bc.subscribe","encoderSync","encoderState","syncProtocol.writeSyncStep2","encoderAwarenessQuery","bc.unsubscribe","getDocumentState","ydoc","applyDocumentState","documentState","getUpdateMessage","encodedBaseUpdate","baseUpdate","baseStateVector","Y.encodeStateVectorFromUpdate","docStateVector","sameState","getSteps","queue","s","getAwareness","arr","other","mitt","n","t","ConnectionClosedError","message","rest","SessionApi","options","__privateAdd","_gs_instances","#options","__privateSet","fileId","baseVersionEtag","axios","__privateMethod","#url","__privateGet","response","Connection","endpoint","isPublic","_endpointUrl","_Dt_instances","#content","#closed","#documentState","#document","#session","#lock","#readOnly","document","session","lock","readOnly","content","version","#post","#defaultParams","autosaveContent","force","manualSave","steps","guestName","file","formData","url","filePath","args","_baseUrl","generateUrl","FETCH_INTERVAL","FETCH_INTERVAL_MAX","FETCH_INTERVAL_SINGLE_EDITOR","FETCH_INTERVAL_READ_ONLY","FETCH_INTERVAL_INVISIBLE","MAX_RETRY_FETCH_COUNT","COLLABORATOR_DISCONNECT_TIME","PollingBackend","syncService","connection","#syncService","#connection","#lastPoll","#fetchInterval","#fetchRetryCounter","#pollActive","#initialLoadingFinished","logger","sessions","disconnect","alive","__privateWrapper","ERROR_TYPE","IDLE_TIMEOUT","AUTOSAVE_INTERVAL","COLLABORATOR_IDLE_TIME","SyncService","serialize","#sendIntervalId","initialSession","getSendable","resolve","reject","err","code","newSteps","singleSteps","step","outbox","callback","exports","_typeof","obj","SLASH","DOT","assertPath","path","posixNormalize","allowAboveRoot","res","lastSegmentLength","lastSlash","dots","lastSlashIndex","decode","normalize","p","isAbsolute","trailingSeparator","_default","module","setAttachmentList","store","findAttachment","AttachmentResolver","user","shareToken","currentDirectory","_Os_instances","#user","#shareToken","#currentDirectory","#documentId","#initAttachmentListPromise","#updateAttachmentList","src","fallback","attachment","directoryRegexp","imageFileName","isDirectUrl","#name","#davUrl","uid","#filePath","generateRemoteUrl","basename","dirname","#relativePath","pathNormalize","Help","AlphabeticalVariant","NcActionText","useEditorMixin","isMobilePlatform","regex","NcDialog","style","ActionFormattingHelp","HelpModal","NcActionButton","CharacterCount","TranslateVariant","useIsMobileMixin","useIsRichEditorMixin","useIsRichWorkspaceMixin","MENU_ID","menubar","ref","width","useElementSize","actionsFullEntries","loadState","priority","remainingEntries","acc","separatorBefore","separatorAfter","DotsHorizontal","clickableArea","spaceToFill","spacePerSlot","from","to","selectedText","emit","EditorContent","EditorOutline","getDir","useFileMixin","useSyncServiceMixin","ACTION_ATTACHMENT_PROMPT","ACTION_CHOOSE_LOCAL_ATTACHMENT","STATE_UPLOADING","_c","files","position","uploadPromises","showError","getCurrentUser","name","mimeType","alt","selection","MediaHandler","useEditorUpload","OUTLINE_STATE","OUTLINE_ACTIONS","mapState","enable"],"mappings":";yjDAYO,MAAMA,GAAkB,IA0BxB,MAAMC,WAAkBC,EAAW,CAIxC,YAAaC,EAAK,CAChB,MAAO,EACP,KAAK,IAAMA,EAIX,KAAK,SAAWA,EAAI,SAKpB,KAAK,OAAS,IAAI,IAIlB,KAAK,KAAO,IAAI,IAChB,KAAK,eAAqC,YAAY,IAAM,CAC1D,MAAMC,EAAMC,EAAkB,EAC1B,KAAK,cAAe,IAAK,MAASL,GAAkB,GAAKI,EAA2C,KAAK,KAAK,IAAI,KAAK,QAAQ,EAAG,aAEpI,KAAK,cAAc,KAAK,eAAe,EAKzC,MAAME,EAAS,CAAE,EACjB,KAAK,KAAK,QAAQ,CAACC,EAAMC,IAAa,CAChCA,IAAa,KAAK,UAAYR,IAAmBI,EAAMG,EAAK,aAAe,KAAK,OAAO,IAAIC,CAAQ,GACrGF,EAAO,KAAKE,CAAQ,CAE9B,CAAO,EACGF,EAAO,OAAS,GAClBG,GAAsB,KAAMH,EAAQ,SAAS,CAEhD,EAAEI,GAAWV,GAAkB,EAAE,CAAC,EACnCG,EAAI,GAAG,UAAW,IAAM,CACtB,KAAK,QAAS,CACpB,CAAK,EACD,KAAK,cAAc,EAAE,CACtB,CAED,SAAW,CACT,KAAK,KAAK,UAAW,CAAC,IAAI,CAAC,EAC3B,KAAK,cAAc,IAAI,EACvB,MAAM,QAAS,EACf,cAAc,KAAK,cAAc,CAClC,CAKD,eAAiB,CACf,OAAO,KAAK,OAAO,IAAI,KAAK,QAAQ,GAAK,IAC1C,CAKD,cAAeQ,EAAO,CACpB,MAAMC,EAAW,KAAK,SAChBC,EAAgB,KAAK,KAAK,IAAID,CAAQ,EACtCE,EAAQD,IAAkB,OAAY,EAAIA,EAAc,MAAQ,EAChEE,EAAY,KAAK,OAAO,IAAIH,CAAQ,EACtCD,IAAU,KACZ,KAAK,OAAO,OAAOC,CAAQ,EAE3B,KAAK,OAAO,IAAIA,EAAUD,CAAK,EAEjC,KAAK,KAAK,IAAIC,EAAU,CACtB,MAAAE,EACA,YAAaT,EAAkB,CACrC,CAAK,EACD,MAAMW,EAAQ,CAAE,EACVC,EAAU,CAAE,EACZC,EAAkB,CAAE,EACpBC,EAAU,CAAE,EACdR,IAAU,KACZQ,EAAQ,KAAKP,CAAQ,EACZG,GAAa,KAClBJ,GAAS,MACXK,EAAM,KAAKJ,CAAQ,GAGrBK,EAAQ,KAAKL,CAAQ,EAChBQ,GAAeL,EAAWJ,CAAK,GAClCO,EAAgB,KAAKN,CAAQ,IAG7BI,EAAM,OAAS,GAAKE,EAAgB,OAAS,GAAKC,EAAQ,OAAS,IACrE,KAAK,KAAK,SAAU,CAAC,CAAE,MAAAH,EAAO,QAASE,EAAiB,QAAAC,GAAW,OAAO,CAAC,EAE7E,KAAK,KAAK,SAAU,CAAC,CAAE,MAAAH,EAAO,QAAAC,EAAS,QAAAE,GAAW,OAAO,CAAC,CAC3D,CAMD,mBAAoBE,EAAOC,EAAO,CAChC,MAAMX,EAAQ,KAAK,cAAe,EAC9BA,IAAU,MACZ,KAAK,cAAc,CACjB,GAAGA,EACH,CAACU,CAAK,EAAGC,CACjB,CAAO,CAEJ,CAKD,WAAa,CACX,OAAO,KAAK,MACb,CACH,CAUO,MAAMb,GAAwB,CAACc,EAAWC,EAASC,IAAW,CACnE,MAAMN,EAAU,CAAE,EAClB,QAASO,EAAI,EAAGA,EAAIF,EAAQ,OAAQE,IAAK,CACvC,MAAMd,EAAWY,EAAQE,CAAC,EAC1B,GAAIH,EAAU,OAAO,IAAIX,CAAQ,EAAG,CAElC,GADAW,EAAU,OAAO,OAAOX,CAAQ,EAC5BA,IAAaW,EAAU,SAAU,CACnC,MAAMI,EAA0CJ,EAAU,KAAK,IAAIX,CAAQ,EAC3EW,EAAU,KAAK,IAAIX,EAAU,CAC3B,MAAOe,EAAQ,MAAQ,EACvB,YAAatB,EAAkB,CACzC,CAAS,CACF,CACDc,EAAQ,KAAKP,CAAQ,CACtB,CACF,CACGO,EAAQ,OAAS,IACnBI,EAAU,KAAK,SAAU,CAAC,CAAE,MAAO,GAAI,QAAS,CAAE,EAAE,QAAAJ,CAAS,EAAEM,CAAM,CAAC,EACtEF,EAAU,KAAK,SAAU,CAAC,CAAE,MAAO,GAAI,QAAS,CAAE,EAAE,QAAAJ,CAAS,EAAEM,CAAM,CAAC,EAE1E,EAOaG,GAAwB,CAACL,EAAWC,EAASK,EAASN,EAAU,SAAW,CACtF,MAAMO,EAAMN,EAAQ,OACdO,EAAUC,EAAwB,EACxCC,EAAsBF,EAASD,CAAG,EAClC,QAASJ,EAAI,EAAGA,EAAII,EAAKJ,IAAK,CAC5B,MAAMd,EAAWY,EAAQE,CAAC,EACpBf,EAAQkB,EAAO,IAAIjB,CAAQ,GAAK,KAChCE,EAAwCS,EAAU,KAAK,IAAIX,CAAQ,EAAG,MAC5EqB,EAAsBF,EAASnB,CAAQ,EACvCqB,EAAsBF,EAASjB,CAAK,EACpCoB,GAAwBH,EAAS,KAAK,UAAUpB,CAAK,CAAC,CACvD,CACD,OAAOwB,EAAsBJ,CAAO,CACtC,EAkCaK,GAAuB,CAACb,EAAWc,EAAQZ,IAAW,CACjE,MAAMa,EAAUC,GAAuBF,CAAM,EACvCG,EAAYnC,EAAkB,EAC9BW,EAAQ,CAAE,EACVC,EAAU,CAAE,EACZC,EAAkB,CAAE,EACpBC,EAAU,CAAE,EACZW,EAAMW,EAAqBH,CAAO,EACxC,QAASZ,EAAI,EAAGA,EAAII,EAAKJ,IAAK,CAC5B,MAAMd,EAAW6B,EAAqBH,CAAO,EAC7C,IAAIxB,EAAQ2B,EAAqBH,CAAO,EACxC,MAAM3B,EAAQ,KAAK,MAAM+B,GAAuBJ,CAAO,CAAC,EAClDK,EAAapB,EAAU,KAAK,IAAIX,CAAQ,EACxCG,EAAYQ,EAAU,OAAO,IAAIX,CAAQ,EACzCgC,EAAYD,IAAe,OAAY,EAAIA,EAAW,OACxDC,EAAY9B,GAAU8B,IAAc9B,GAASH,IAAU,MAAQY,EAAU,OAAO,IAAIX,CAAQ,KAC1FD,IAAU,KAERC,IAAaW,EAAU,UAAYA,EAAU,cAAe,GAAI,KAGlET,IAEAS,EAAU,OAAO,OAAOX,CAAQ,EAGlCW,EAAU,OAAO,IAAIX,EAAUD,CAAK,EAEtCY,EAAU,KAAK,IAAIX,EAAU,CAC3B,MAAAE,EACA,YAAa0B,CACrB,CAAO,EACGG,IAAe,QAAahC,IAAU,KACxCK,EAAM,KAAKJ,CAAQ,EACV+B,IAAe,QAAahC,IAAU,KAC/CQ,EAAQ,KAAKP,CAAQ,EACZD,IAAU,OACdS,GAAeT,EAAOI,CAAS,GAClCG,EAAgB,KAAKN,CAAQ,EAE/BK,EAAQ,KAAKL,CAAQ,GAG1B,EACGI,EAAM,OAAS,GAAKE,EAAgB,OAAS,GAAKC,EAAQ,OAAS,IACrEI,EAAU,KAAK,SAAU,CAAC,CACxB,MAAAP,EAAO,QAASE,EAAiB,QAAAC,CAClC,EAAEM,CAAM,CAAC,GAERT,EAAM,OAAS,GAAKC,EAAQ,OAAS,GAAKE,EAAQ,OAAS,IAC7DI,EAAU,KAAK,SAAU,CAAC,CACxB,MAAAP,EAAO,QAAAC,EAAS,QAAAE,CACjB,EAAEM,CAAM,CAAC,CAEd,EC3QAoB,GAAA,CAMA,KAAA,iBAEA,WAAA,CACA,2BAAAC,EACA,EAEA,QAAAC,GAEA,SAAA,CACA,KAAA,QAAA,GAAA,cAAA,IAAA,KAAA,aAAA,CACA,EAEA,QAAA,CACA,WAAA,OACA,KAAA,CAAA,YAAAC,CAAA,EAAA,KAEAA,EAAA,MACAA,EAAA,MAAA,IAAA,GAIAA,EAAAA,EAAA,OAAA,KAAA,QAAA,MAAA,EAAA,MAAA,CAAA,IAAAA,MAAAA,EAAA,MAGA,KAAA,UAAA,IAAA,CACA,KAAA,MAAA,UAAA,CAAA,GAAAA,CAAA,CAAA,CACA,CAAA,CACA,CACA,CACA,6mBClBAH,GAAA,CACA,KAAA,aACA,WAAA,CACA,UAAAI,GACA,kBAAAC,GACA,eAAAC,EACA,EACA,QAAAJ,GACA,OAAA,CAAAK,GAAAC,GAAAC,EAAA,EACA,MAAA,CACA,aAAA,CACA,KAAA,QACA,QAAA,EACA,CACA,EACA,KAAA,KAAA,CACA,QAAA,GACA,gBAAA,EACA,GACA,SAAA,CACA,cAAA,CACA,KAAA,CACA,MAAA3C,EACA,QAAA4C,EACA,YAAA,CAAA,SAAAC,CAAA,CACA,EAAA,KAEA,OAAA7C,EAAA,OAIA6C,EAAA,KAAAC,GACAC,GAAAD,EAAAF,CAAA,CACA,EALA,IAMA,EACA,MAAA,CACA,OAAA,KAAA,aACA,KAAA,aAAA,KAGA,KAAA,YAAA,IACA,EACA,SAAA,CACA,MAAA,GAAA,YAAA,YAAA,IAAA,KAAA,YAAA,UACA,EACA,WAAA,OACA,OAAAI,EAAA,KAAA,eAAA,YAAAA,EAAA,GACA,EACA,UAAA,CACA,OAAA,KAAA,YAAA,SAAA,OAAA,CAAA,CAAA,QAAAC,KACAA,IAAA,OACA,GAGA,OAAAA,GAAA,WACAA,EAAA,IAAA,EACAA,CACA,CACA,EACA,mBAAA,CACA,OAAA,KAAA,aAEA,EAAA,OAAA,0DAAA,CACA,aAAA,KAAA,YAAA,MACA,wBAAA,KAAA,aAAA,KACA,CAAA,EAGA,KAAA,YAAA,KACA,EACA,WAAA,CACA,OAAA,KAAA,cAAA,KAAA,eACA,CACA,EACA,SAAA,CACA,KAAA,cAAAC,GAAA,KAAA,qBAAA,KAAA,IAAA,EAAA,EAAA,EACA,KAAA,QAAA,GAAA,SAAA,KAAA,aAAA,EACA,KAAA,QAAA,GAAA,kBAAA,KAAA,aAAA,CACA,EACA,eAAA,CACA,KAAA,QAAA,IAAA,SAAA,KAAA,aAAA,EACA,KAAA,QAAA,IAAA,kBAAA,KAAA,aAAA,CACA,EACA,QAAA,CACA,aAAAC,EAAA,CACA,KAAA,QAAAA,CACA,EACA,WAAA,CAEA,EACA,UAAAC,EAAA,CACAA,GAAAA,MAAAA,EAAA,QAGA,KAAA,QAAA,MAAA,EAAA,MAAA,EAAA,IAAA,EACA,KAAA,MAAA,UAAAA,CAAA,EACA,EACA,sBAAA,CACA,KAAA,gBAAA,KAAA,SAAA,KAAAN,GAAA,KAAA,eAAAA,CAAA,CAAA,CACA,EACA,eAAAA,EAAA,CACA,MAAA,CAAAA,EAAA,aACA,CAAAO,GAAAP,EAAA,KAAA,OAAA,EAAA,QACA,CACA,CACA,66BCtHAZ,GAAA,CACA,KAAA,eAEA,WAAA,CACA,SAAAoB,EACA,EAEA,QAAAlB,GAEA,MAAA,CACA,OAAA,CACA,KAAA,QACA,QAAA,EACA,CACA,EAEA,SAAA,CACA,KAAA,QAAA,GAAA,cAAA,IAAA,KAAA,aAAA,CACA,EAEA,QAAA,CACA,WAAA,OACA,KAAA,CAAA,YAAAC,CAAA,EAAA,KAEAA,EAAA,MACAA,EAAA,MAAA,IAAA,GAIAA,EAAAA,EAAA,OAAA,KAAA,QAAA,MAAA,EAAA,MAAA,CAAA,IAAAA,MAAAA,EAAA,MAGA,KAAA,UAAA,IAAA,CACA,KAAA,MAAA,UAAA,CAAA,GAAAA,CAAA,CAAA,CACA,CAAA,CACA,CACA,CACA,mqBC7DAkB,GAAeC,GAAgB,CAC9B,MAAO,CACN,MAAO,CAEN,gBAAiB,EACjB,QAAS,CAAE,CACX,CACD,EACD,SAAU,CACT,gBAAiB,CAChB,OAAO,KAAK,OACZ,CACD,EACD,MAAO,CACN,gBAAiB,CAChB,KAAK,UAAU,IAAM,QAChB,KAAK,gBAAkB,KAAK,eAAe,SAAUR,EAAA,KAAK,eAAe,KAAK,eAAe,IAAxC,MAAAA,EAA2C,WACnG,KAAK,iBAAkB,CAE5B,CAAI,CACD,CACD,EACD,QAAS,CAMR,iBAAiBS,EAASzD,EAAO,CAChC,MAAM0D,EAAQ,KAAK,eAAe,UAAU,CAAC,CAAE,IAAAC,CAAG,IAAOA,IAAQF,CAAO,EACxE,KAAK,eAAeC,CAAK,EAAE,SAAW1D,EAClCA,IAAU,IAAS,KAAK,kBAAoB0D,GAC/C,KAAK,UAAU,IAAM,KAAK,iBAAgB,CAAE,CAE7C,EAID,kBAAmB,CAElB,MAAME,EAAS,KAAK,eAAe,QAAU,KAAK,MAAM,iBAAmB,EAAI,GAE/E,GACC,KAAK,iBAAmB,KAAK,gBAAkB,GAAKA,QAC5C,KAAK,gBAAkB,KAAK,eAAe,QAAU,KAAK,eAAe,KAAK,eAAe,EAAE,SACxG,EAID,sBAAuB,CAEtB,MAAMA,EAAS,KAAK,eAAe,QAAU,KAAK,MAAM,iBAAmB,EAAI,GAE/E,EAAG,CACF,MAAMF,EAAQ,KAAK,gBAAkB,EACrC,KAAK,iBAAoBA,EAAQE,EAAUA,GAAUA,CACrD,OAAQ,KAAK,gBAAkB,KAAK,eAAe,QAAU,KAAK,eAAe,KAAK,eAAe,EAAE,SACxG,EAMD,wBAAwBC,EAAO,SAC1BA,EAAM,MAAQ,aACjB,KAAK,iBAAkB,EACbA,EAAM,MAAQ,aACxB,KAAK,qBAAsB,EAGxB,KAAK,kBAAoB,KAAK,eAAe,QAChDC,GAAAd,EAAA,KAAK,MAAM,mBAAX,YAAAA,EAA6B,cAA7B,MAAAc,EAAA,KAAAd,GAGgB,CAAC,GAAG,KAAK,MAAM,WAAW,EAAE,KAAK,CAACe,EAAGC,IAAM,KAAK,eAAe,UAAU,CAAC,CAAE,IAAAL,KAAUA,IAAQI,EAAE,OAAO,KAAK,GAAG,EAAI,KAAK,eAAe,UAAU,CAAC,CAAE,IAAAJ,CAAG,IAAOA,IAAQK,EAAE,OAAO,KAAK,GAAG,CAAC,EAChM,KAAK,eAAe,EAAE,YAAa,CAE5C,CACD,CACF,CAAC,ECrDD9B,GAAAsB,GAAA,CACA,KAAA,cACA,WAAA,CACA,WAAAS,GACA,aAAAC,EACA,EACA,QAAAX,GACA,MAAA,CACA,MAAA,CACA,QAAAY,EACA,CACA,CACA,CAAA,8sBC1BO,SAASC,GAAkBC,EAA2B,CACtD,MAAAC,EAAO,IAAI,WAAWD,CAAI,EAChC,OAAOE,GAASD,CAAI,CACrB,CAMO,SAASE,GAAkBC,EAA8B,CAC/D,OAAOC,GAAWD,CAAO,CAC1B,CCOO,MAAME,GAAsB,EACtBC,GAAsB,EACtBC,GAAmB,EAQnBC,GAAiB,CAAC1D,EAAS5B,IAAQ,CAC9C8B,EAAsBF,EAASuD,EAAmB,EAClD,MAAMI,EAAKC,GAAoBxF,CAAG,EAClCyF,EAA4B7D,EAAS2D,CAAE,CACzC,EAOaG,GAAiB,CAAC9D,EAAS5B,EAAK2F,IAAuB,CAClE7D,EAAsBF,EAASwD,EAAmB,EAClDK,EAA4B7D,EAASgE,GAAsB5F,EAAK2F,CAAkB,CAAC,CACrF,EASaE,GAAgB,CAAC1D,EAASP,EAAS5B,IAC9C0F,GAAe9D,EAAS5B,EAAK8F,GAA2B3D,CAAO,CAAC,EASrD4D,GAAgB,CAAC5D,EAASnC,EAAKgG,IAAsB,CAChE,GAAI,CACFC,GAAcjG,EAAK8F,GAA2B3D,CAAO,EAAG6D,CAAiB,CAC1E,OAAQE,EAAO,CAEd,QAAQ,MAAM,2CAA4CA,CAAK,CAChE,CACH,EAMaC,GAAc,CAACvE,EAASM,IAAW,CAC9CJ,EAAsBF,EAASyD,EAAgB,EAC/CI,EAA4B7D,EAASM,CAAM,CAC7C,EASakE,GAAaL,GAQbM,GAAkB,CAAClE,EAASP,EAAS5B,EAAKgG,IAAsB,CAC3E,MAAMM,EAAchE,EAAqBH,CAAO,EAChD,OAAQmE,EAAW,CACjB,KAAKnB,GACHU,GAAc1D,EAASP,EAAS5B,CAAG,EACnC,MACF,KAAKoF,GACHW,GAAc5D,EAASnC,EAAKgG,CAAiB,EAC7C,MACF,KAAKX,GACHe,GAAWjE,EAASnC,EAAKgG,CAAiB,EAC1C,MACF,QACE,MAAM,IAAI,MAAM,sBAAsB,CACzC,CACD,OAAOM,CACT,EChGMC,GAAW,IAAI,IAGrB,MAAMC,EAAqB,CAIzB,YAAaC,EAAM,CACjB,KAAK,KAAOA,EAIZ,KAAK,UAAY,KAIjB,KAAK,UAAYC,GAAKA,EAAE,MAAQD,GAAQ,KAAK,YAAc,MAAQ,KAAK,UAAU,CAAE,KAAME,GAAkBD,EAAE,UAAY,EAAE,EAAG,EAC/HE,GAAiB,KAAK,SAAS,CAChC,CAKD,YAAaC,EAAK,CAChBC,GAAmB,QAAQ,KAAK,KAAMC,GAAgBC,GAAuCH,CAAG,CAAC,CAAC,CACnG,CAED,OAAS,CACPI,GAAkB,KAAK,SAAS,CACjC,CACH,CAKA,MAAMC,GAAK,OAAO,iBAAqB,IAAcV,GAAuB,iBAMtEW,GAAaV,GACjBW,GAAmBb,GAAUE,EAAM,IAAM,CACvC,MAAMY,EAAOC,GAAY,EACnBC,EAAK,IAAIL,GAAGT,CAAI,EAKtB,OAAAc,EAAG,UAAYb,GAAKW,EAAK,QAAQG,GAAOA,EAAId,EAAE,KAAM,kBAAkB,CAAC,EAChE,CACL,GAAAa,EAAI,KAAAF,CACL,CACL,CAAG,EASUI,GAAY,CAAChB,EAAMiB,KAC9BP,GAAWV,CAAI,EAAE,KAAK,IAAIiB,CAAC,EACpBA,GAUIC,GAAc,CAAClB,EAAMiB,IAAM,CACtC,MAAME,EAAUT,GAAWV,CAAI,EACzBoB,EAAeD,EAAQ,KAAK,OAAOF,CAAC,EAC1C,OAAIG,GAAgBD,EAAQ,KAAK,OAAS,IACxCA,EAAQ,GAAG,MAAO,EAClBrB,GAAS,OAAOE,CAAI,GAEfoB,CACT,EAUaC,EAAU,CAACrB,EAAM5B,EAAMvD,EAAS,OAAS,CACpD,MAAMyG,EAAIZ,GAAWV,CAAI,EACzBsB,EAAE,GAAG,YAAYlD,CAAI,EACrBkD,EAAE,KAAK,QAAQP,GAAOA,EAAI3C,EAAMvD,CAAM,CAAC,CACzC,EC5Ha0G,GAA0B,EAuB1BC,GAAkB,CAAC9F,EAAS+F,EAAGC,IAA4B,CACtE,OAAQ7F,EAAqBH,CAAO,EAAC,CACnC,KAAK6F,GAAyBG,EAAwBD,EAAG3F,GAAuBJ,CAAO,CAAC,CACzF,CACH,ECGaiG,GAAoBC,GAC/BC,GAAWD,EAAQ,CAAC1E,EAAKQ,IAAQ,GAAG,0BAAmBA,CAAG,EAAC,KAAI,0BAAmBR,CAAG,EAAG,EAAE,KAAK,GAAG,ECjBvF4E,EAAc,EACdC,GAAwB,EACxBC,EAAmB,EACnBC,GAAc,EAMrBC,GAAkB,CAAE,EAE1BA,GAAgBJ,CAAW,EAAI,CAC7B3G,EACAO,EACAyG,EACAC,EACAC,IACG,CACHhH,EAAsBF,EAAS2G,CAAW,EAC1C,MAAMQ,EAAkBC,GACtB7G,EACAP,EACAgH,EAAS,IACTA,CACD,EAECC,GAAcE,IAAoBE,IAClC,CAACL,EAAS,SAEVA,EAAS,OAAS,GAEtB,EAEAD,GAAgBH,EAAqB,EAAI,CACvC5G,EACAsH,EACAN,EACAO,EACAL,IACG,CACHhH,EAAsBF,EAAS6G,CAAgB,EAC/ChD,EACE7D,EACAwH,GACER,EAAS,UACT,MAAM,KAAKA,EAAS,UAAU,UAAS,EAAG,MAAM,CACjD,CACF,CACH,EAEAD,GAAgBF,CAAgB,EAAI,CAClCY,EACAlH,EACAyG,EACAO,EACAL,IACG,CACHQ,GACEV,EAAS,UACT9C,GAA2B3D,CAAO,EAClCyG,CACD,CACH,EAEAD,GAAgBD,EAAW,EAAI,CAC7BW,EACAlH,EACAyG,EACAO,EACAL,IACG,CACHS,GACEpH,EACAyG,EAAS,IACT,CAACY,EAAOC,IAAWtB,GAAwBS,EAAUa,CAAM,CAC5D,CACH,EAGA,MAAMC,GAA0B,IAM1BvB,GAA0B,CAACS,EAAUa,IACzC,QAAQ,KAAK,+BAA+Bb,OAAAA,EAAS,IAAG,OAAMa,OAAAA,EAAQ,EAQlEE,GAAc,CAACf,EAAU/B,EAAKgC,IAAe,CACjD,MAAM1G,EAAUC,GAAuByE,CAAG,EACpCjF,EAAUC,EAAwB,EAClCyE,EAAchE,EAAqBH,CAAO,EAC1CyH,EAAiBhB,EAAS,gBAAgBtC,CAAW,EAC3D,OAAwBsD,EACtBA,EAAehI,EAASO,EAASyG,EAAUC,EAAYvC,CAAW,EAElE,QAAQ,MAAM,2BAA2B,EAEpC1E,CACT,EAKMiI,GAAWjB,GAAa,CAC5B,GAAIA,EAAS,eAAiBA,EAAS,KAAO,KAAM,CAClD,MAAMkB,EAAY,IAAIlB,EAAS,IAAIA,EAAS,GAAG,EAC/CkB,EAAU,WAAa,cACvBlB,EAAS,GAAKkB,EACdlB,EAAS,aAAe,GACxBA,EAAS,YAAc,GACvBA,EAAS,OAAS,GAElBkB,EAAU,UAAazF,GAAU,CAC/BuE,EAAS,sBAAwB1I,EAAkB,EACnD,MAAM0B,EAAU+H,GAAYf,EAAU,IAAI,WAAWvE,EAAM,IAAI,EAAG,EAAI,EAClE0F,GAAgBnI,CAAO,EAAI,GAC7BkI,EAAU,KAAK9H,EAAsBJ,CAAO,CAAC,CAEhD,EACDkI,EAAU,QAAWzF,GAAU,CAC7BuE,EAAS,KAAK,mBAAoB,CAACvE,EAAOuE,CAAQ,CAAC,CACpD,EACDkB,EAAU,QAAWzF,GAAU,CAC7BuE,EAAS,KAAK,mBAAoB,CAACvE,EAAOuE,CAAQ,CAAC,EACnDA,EAAS,GAAK,KACdA,EAAS,aAAe,GACpBA,EAAS,aACXA,EAAS,YAAc,GACvBA,EAAS,OAAS,GAElBoB,GACEpB,EAAS,UACT,MAAM,KAAKA,EAAS,UAAU,UAAW,EAAC,KAAM,CAAA,EAAE,OAAQqB,GACxDA,IAAWrB,EAAS,IAAI,QACzB,EACDA,CACD,EACDA,EAAS,KAAK,SAAU,CAAC,CACvB,OAAQ,cAClB,CAAS,CAAC,GAEFA,EAAS,2BAIX,WACEiB,GACAK,GACEC,GAAS,EAAGvB,EAAS,wBAAwB,EAAI,IACjDA,EAAS,cACV,EACDA,CACD,CACF,EACDkB,EAAU,OAAS,IAAM,CACvBlB,EAAS,sBAAwB1I,EAAkB,EACnD0I,EAAS,aAAe,GACxBA,EAAS,YAAc,GACvBA,EAAS,yBAA2B,EACpCA,EAAS,KAAK,SAAU,CAAC,CACvB,OAAQ,WAChB,CAAO,CAAC,EAEF,MAAMhH,EAAUC,EAAwB,EAKxC,GAJAC,EAAsBF,EAAS2G,CAAW,EAC1C6B,GAA4BxI,EAASgH,EAAS,GAAG,EACjDkB,EAAU,KAAK9H,EAAsBJ,CAAO,CAAC,EAEzCgH,EAAS,UAAU,cAAa,IAAO,KAAM,CAC/C,MAAMyB,EAAwBxI,EAAwB,EACtDC,EAAsBuI,EAAuB5B,CAAgB,EAC7DhD,EACE4E,EACAjB,GAAwCR,EAAS,UAAW,CAC1DA,EAAS,IAAI,QACzB,CAAW,CACF,EACDkB,EAAU,KAAK9H,EAAsBqI,CAAqB,CAAC,CAC5D,CACF,EACDzB,EAAS,KAAK,SAAU,CAAC,CACvB,OAAQ,YACd,CAAK,CAAC,CACH,CACH,EAMM0B,GAAmB,CAAC1B,EAAU/B,IAAQ,CAC1C,MAAM0D,EAAK3B,EAAS,GAChBA,EAAS,aAAe2B,GAAMA,EAAG,aAAeA,EAAG,MACrDA,EAAG,KAAK1D,CAAG,EAET+B,EAAS,aACX4B,EAAW5B,EAAS,UAAW/B,EAAK+B,CAAQ,CAEhD,EAeO,MAAM6B,WAA0B1K,EAAW,CAchD,YAAa2K,EAAWC,EAAU3K,EAAK,CACrC,QAAA4K,EAAU,GACV,UAAAxJ,EAAY,IAAIyJ,GAA4B7K,CAAG,EAC/C,OAAAqI,EAAS,CAAE,EACX,kBAAAyC,EAAoB,UACpB,eAAAC,EAAiB,GACjB,eAAAC,EAAiB,KACjB,UAAAC,EAAY,EACb,EAAG,GAAI,CAGN,IAFA,MAAO,EAEAP,EAAUA,EAAU,OAAS,CAAC,IAAM,KACzCA,EAAYA,EAAU,MAAM,EAAGA,EAAU,OAAS,CAAC,EAErD,KAAK,UAAYA,EACjB,KAAK,UAAYA,EAAY,IAAMC,EACnC,KAAK,eAAiBK,EAMtB,KAAK,OAAS3C,EACd,KAAK,SAAWsC,EAChB,KAAK,IAAM3K,EACX,KAAK,IAAM8K,EACX,KAAK,UAAY1J,EACjB,KAAK,YAAc,GACnB,KAAK,aAAe,GACpB,KAAK,YAAc,GACnB,KAAK,UAAY6J,EACjB,KAAK,yBAA2B,EAChC,KAAK,gBAAkBtC,GAAgB,MAAO,EAI9C,KAAK,QAAU,GAIf,KAAK,GAAK,KACV,KAAK,sBAAwB,EAK7B,KAAK,cAAgBiC,EAKrB,KAAK,gBAAkB,EACnBG,EAAiB,IACnB,KAAK,gBAAsC,YAAY,IAAM,CAC3D,GAAI,KAAK,IAAM,KAAK,GAAG,aAAe,UAAU,KAAM,CAEpD,MAAMnJ,EAAUC,EAAwB,EACxCC,EAAsBF,EAAS2G,CAAW,EAC1C6B,GAA4BxI,EAAS5B,CAAG,EACxC,KAAK,GAAG,KAAKgC,EAAsBJ,CAAO,CAAC,CAC5C,CACF,EAAEmJ,CAAc,GAOnB,KAAK,cAAgB,CAAClG,EAAMvD,IAAW,CACrC,GAAIA,IAAW,KAAM,CACnB,MAAMM,EAAU+H,GAAY,KAAM,IAAI,WAAW9E,CAAI,EAAG,EAAK,EACzDkF,GAAgBnI,CAAO,EAAI,GAC7B4I,EAAW,KAAK,UAAWxI,EAAsBJ,CAAO,EAAG,IAAI,CAElE,CACF,EAMD,KAAK,eAAiB,CAACM,EAAQZ,IAAW,CACxC,GAAIA,IAAW,KAAM,CACnB,MAAMM,EAAUC,EAAwB,EACxCC,EAAsBF,EAAS2G,CAAW,EAC1C2C,GAAyBtJ,EAASM,CAAM,EACxCoI,GAAiB,KAAMtI,EAAsBJ,CAAO,CAAC,CACtD,CACF,EACD,KAAK,IAAI,GAAG,SAAU,KAAK,cAAc,EAKzC,KAAK,wBAA0B,CAAC,CAAE,MAAAf,EAAO,QAAAC,EAAS,QAAAE,CAAS,EAAEmK,IAAY,CACvE,MAAMC,EAAiBvK,EAAM,OAAOC,CAAO,EAAE,OAAOE,CAAO,EACrDY,EAAUC,EAAwB,EACxCC,EAAsBF,EAAS6G,CAAgB,EAC/ChD,EACE7D,EACAwH,GAAwChI,EAAWgK,CAAc,CAClE,EACDd,GAAiB,KAAMtI,EAAsBJ,CAAO,CAAC,CACtD,EACD,KAAK,aAAe,IAAM,CACxBoI,GACE,KAAK,UACL,CAAChK,EAAI,QAAQ,EACb,YACD,CACF,EACGqL,IAAc,OAAOC,GAAY,KACnCA,GAAQ,GAAG,OAAQ,KAAK,YAAY,EAEtClK,EAAU,GAAG,SAAU,KAAK,uBAAuB,EACnD,KAAK,eAAqC,YAAY,IAAM,CAExD,KAAK,aACLsI,GACExJ,EAAgB,EAAK,KAAK,uBAIF,KAAK,GAAI,MAAO,CAElD,EAAOwJ,GAA0B,EAAE,EAC3BkB,GACF,KAAK,QAAS,CAEjB,CAED,IAAI,KAAO,CACT,MAAMW,EAAgBC,GAAsB,KAAK,MAAM,EACvD,OAAO,KAAK,UAAY,IAAM,KAAK,UAChCD,EAAc,SAAW,EAAI,GAAK,IAAMA,EAC5C,CAKD,IAAI,QAAU,CACZ,OAAO,KAAK,OACb,CAED,IAAI,OAAQ/K,EAAO,CACb,KAAK,UAAYA,IACnB,KAAK,QAAUA,EACf,KAAK,KAAK,SAAU,CAACA,CAAK,CAAC,EAC3B,KAAK,KAAK,OAAQ,CAACA,CAAK,CAAC,EAE5B,CAED,SAAW,CACL,KAAK,kBAAoB,GAC3B,cAAc,KAAK,eAAe,EAEpC,cAAc,KAAK,cAAc,EACjC,KAAK,WAAY,EACb6K,IAAc,OAAOC,GAAY,KACnCA,GAAQ,IAAI,OAAQ,KAAK,YAAY,EAEvC,KAAK,UAAU,IAAI,SAAU,KAAK,uBAAuB,EACzD,KAAK,IAAI,IAAI,SAAU,KAAK,cAAc,EAC1C,MAAM,QAAS,CAChB,CAED,WAAa,CACX,GAAI,KAAK,UACP,OAEG,KAAK,cACRG,GAAa,KAAK,UAAW,KAAK,aAAa,EAC/C,KAAK,YAAc,IAIrB,MAAMC,EAAc7J,EAAwB,EAC5CC,EAAsB4J,EAAanD,CAAW,EAC9C6B,GAA4BsB,EAAa,KAAK,GAAG,EACjDlB,EAAW,KAAK,UAAWxI,EAAsB0J,CAAW,EAAG,IAAI,EAEnE,MAAMC,EAAe9J,EAAwB,EAC7CC,EAAsB6J,EAAcpD,CAAW,EAC/CqD,GAA4BD,EAAc,KAAK,GAAG,EAClDnB,EAAW,KAAK,UAAWxI,EAAsB2J,CAAY,EAAG,IAAI,EAEpE,MAAME,EAAwBhK,EAAwB,EACtDC,EAAsB+J,EAAuBrD,EAAqB,EAClEgC,EACE,KAAK,UACLxI,EAAsB6J,CAAqB,EAC3C,IACD,EAED,MAAMxB,EAAwBxI,EAAwB,EACtDC,EAAsBuI,EAAuB5B,CAAgB,EAC7DhD,EACE4E,EACAjB,GAAwC,KAAK,UAAW,CACtD,KAAK,IAAI,QACjB,CAAO,CACF,EACDoB,EACE,KAAK,UACLxI,EAAsBqI,CAAqB,EAC3C,IACD,CACF,CAED,cAAgB,CAEd,MAAMzI,EAAUC,EAAwB,EACxCC,EAAsBF,EAAS6G,CAAgB,EAC/ChD,EACE7D,EACAwH,GAAwC,KAAK,UAAW,CACtD,KAAK,IAAI,QACjB,EAAS,IAAI,GAAK,CACb,EACDkB,GAAiB,KAAMtI,EAAsBJ,CAAO,CAAC,EACjD,KAAK,cACPkK,GAAe,KAAK,UAAW,KAAK,aAAa,EACjD,KAAK,YAAc,GAEtB,CAED,YAAc,CACZ,KAAK,cAAgB,GACrB,KAAK,aAAc,EACf,KAAK,KAAO,MACd,KAAK,GAAG,MAAO,CAElB,CAED,SAAW,CACT,KAAK,cAAgB,GACjB,CAAC,KAAK,aAAe,KAAK,KAAO,OACnCjC,GAAQ,IAAI,EACZ,KAAK,UAAW,EAEnB,CACH,CC3dO,SAASkC,GAAiBC,EAAM,CACtC,MAAM9J,EAAS0D,GAAsBoG,CAAI,EACzC,OAAOpH,GAAkB1C,CAAM,CAChC,CAQO,SAAS+J,GAAmBD,EAAME,EAAe5K,EAAQ,CAC/D,MAAMY,EAAS8C,GAAkBkH,CAAa,EAC9CjG,GAAc+F,EAAM9J,EAAQZ,CAAM,CACnC,CASO,SAAS6K,GAAiBH,EAAMI,EAAmB,CACzD,MAAMC,EAAarH,GAAkBoH,CAAiB,EAChDE,EAAkBC,GAA8BF,CAAU,EAC1DG,EAAiBhH,GAAoBwG,CAAI,EAC/C,GAAIS,GAAUH,EAAiBE,CAAc,EAE5C,OAED,MAAM5K,EAAUC,EAAwB,EACxCC,EAAsBF,EAAS2G,CAAW,EAC1C,MAAMrG,EAAS0D,GAAsBoG,EAAMM,CAAe,EAC1DpB,OAAAA,GAAyBtJ,EAASM,CAAM,EACjCF,EAAsBJ,CAAO,CACrC,CAgCO,SAAS8K,GAASC,EAAO,CAC/B,OAAOA,EAAM,IAAIC,GAAKhI,GAAkBgI,CAAC,CAAC,EACxC,OAAOA,GAAKA,EAAI,IAAI,CACvB,CAOO,SAASC,GAAaF,EAAO,CACnC,OAAOA,EAAM,IAAIC,GAAKhI,GAAkBgI,CAAC,CAAC,EACxC,SAASA,GAAKA,EAAI,IAAI,GAAK,EAC9B,CAmCA,SAASH,GAAUK,EAAKC,EAAO,CAC9B,OAAOD,EAAI,SAAWC,EAAM,QACxBD,EAAI,MAAM,CAAC3L,EAAO+C,IAAU6I,EAAM7I,CAAK,IAAM/C,CAAK,CACvD,CC1Ie,SAAA6L,GAASC,EAAE,CAAC,MAAM,CAAC,IAAIA,EAAEA,GAAG,IAAI,IAAI,GAAG,SAASC,EAAExG,EAAE,CAAC,IAAInF,EAAE0L,EAAE,IAAIC,CAAC,EAAE3L,EAAEA,EAAE,KAAKmF,CAAC,EAAEuG,EAAE,IAAIC,EAAE,CAACxG,CAAC,CAAC,CAAC,EAAE,IAAI,SAASwG,EAAExG,EAAE,CAAC,IAAInF,EAAE0L,EAAE,IAAIC,CAAC,EAAE3L,IAAImF,EAAEnF,EAAE,OAAOA,EAAE,QAAQmF,CAAC,IAAI,EAAE,CAAC,EAAEuG,EAAE,IAAIC,EAAE,EAAE,EAAE,EAAE,KAAK,SAASA,EAAExG,EAAE,CAAC,IAAInF,EAAE0L,EAAE,IAAIC,CAAC,EAAE3L,GAAGA,EAAE,QAAQ,IAAI,SAAS0L,EAAE,CAACA,EAAEvG,CAAC,CAAC,CAAC,GAAGnF,EAAE0L,EAAE,IAAI,GAAG,IAAI1L,EAAE,MAAO,EAAC,IAAI,SAAS0L,EAAE,CAACA,EAAEC,EAAExG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CCOlT,MAAMyG,WAA8B,KAAM,CAEhD,YAAYC,EAAU,qDAAsDC,EAAM,CACjF,MAAMD,EAAS,GAAGC,CAAI,CACtB,CAEF,aAEA,MAAMC,EAAW,CAIhB,YAAYC,EAAU,GAAI,CAJ3BC,EAAA,KAAAC,IAECC,EAAAA,KAAAA,GAGCC,EAAA,KAAKD,EAAWH,EAChB,CAED,KAAK,CAAE,OAAAK,EAAQ,gBAAAC,GAAmB,CACjC,OAAOC,GAAM,IAAIC,EAAA,KAAKC,GAAAA,IAAL,UAAU,WAAWJ,OAAAA,EAAM,YAAY,CACvD,OAAAA,EACA,gBAAAC,EACA,SAAUI,EAAA,KAAKP,GAAS,SACxB,MAAOO,EAAA,KAAKP,GAAS,WACrB,UAAWO,EAAA,KAAKP,GAAS,UACzB,cAAeO,EAAA,KAAKP,GAAS,aAChC,CAAG,EAAE,KAAKQ,GAAY,IAAIC,GAAWD,EAAUD,EAAA,KAAKP,EAAQ,CAAC,CAC3D,CAOF,CAtBCA,EAAAA,YAFDD,GAAA,YAmBCO,GAAKI,SAAAA,EAAU,CACd,MAAMC,EAAW,CAAC,CAACJ,EAAA,KAAKP,GAAS,WACjC,OAAOY,GAAaF,EAAUC,CAAQ,CACtC,kCAIK,MAAMF,EAAW,CAWvB,YAAYD,EAAUX,EAAS,CAXzBC,EAAA,KAAAe,GAENC,EAAAA,KAAAA,IACAC,EAAAA,KAAAA,IACAC,EAAAA,KAAAA,GACAC,EAAAA,KAAAA,GACAC,EAAAA,KAAAA,GACAC,EAAAA,KAAAA,IACAC,EAAAA,KAAAA,IACApB,EAAAA,KAAAA,GAGC,KAAM,CAAE,SAAAqB,EAAU,QAAAC,EAAS,KAAAC,EAAM,SAAAC,EAAU,QAAAC,EAAS,cAAAjD,GAAkBgC,EAAS,KAC/EP,EAAA,KAAKgB,EAAYI,GACjBpB,EAAA,KAAKiB,EAAWI,GAChBrB,EAAA,KAAKkB,GAAQI,GACbtB,EAAA,KAAKmB,GAAYI,GACjBvB,EAAA,KAAKa,GAAWW,GAChBxB,EAAA,KAAKe,EAAiBxC,GACtByB,EAAA,KAAKD,EAAWH,GAChB,KAAK,SAAW,CAAC,CAACA,EAAQ,WAC1B,KAAK,OAAS,EACd,CAED,IAAI,SAAU,CACb,OAAOU,EAAA,KAAKW,EACZ,CAED,IAAI,UAAW,CACd,OAAOX,EAAA,KAAKU,EACZ,CAED,IAAI,iBAAkB,CACrB,OAAOV,EAAA,KAAKS,GAAiBT,EAAA,KAAKU,GAAU,iBAAmB,CAC/D,CAED,IAAI,OAAQ,CACX,MAAO,CACN,SAAU,CAAE,GAAGV,EAAA,KAAKU,GAAW,SAAUV,EAAA,KAAKa,GAAW,EACzD,QAASb,EAAA,KAAKW,GACd,eAAgBX,EAAA,KAAKO,KAAY,GACjC,cAAeP,EAAA,KAAKS,EACpB,CACD,CAED,IAAI,UAAW,CACd,OAAO,KAAK,MACZ,CAWD,KAAK,CAAE,QAAAU,GAAW,CACjB,OAAOrB,EAAA,KAAKsB,EAAAA,GAAL,UAAWtB,EAAA,KAAKC,EAAAA,GAAL,UAAU,WAAW,OAAAC,EAAA,KAAKU,GAAU,GAAE,UAAU,CACjE,GAAGV,EAAA,KAAKqB,EAAAA,GACR,SAAUrB,EAAA,KAAKP,GAAS,SACxB,gBAAiBO,EAAA,KAAKU,GAAU,gBAChC,QAAAS,CACH,EACE,CAED,KAAK,CAAE,QAAAA,EAAS,gBAAAG,EAAiB,cAAArD,EAAe,MAAAsD,EAAO,WAAAC,GAAc,CACpE,OAAO1B,EAAA,KAAKsB,EAAAA,GAAL,UAAWtB,EAAA,KAAKC,EAAAA,GAAL,UAAU,WAAW,OAAAC,EAAA,KAAKU,GAAU,GAAE,UAAU,CACjE,GAAGV,EAAA,KAAKqB,EAAAA,GACR,SAAUrB,EAAA,KAAKP,GAAS,SACxB,gBAAiBO,EAAA,KAAKU,GAAU,gBAChC,QAAAS,EACA,gBAAAG,EACA,cAAArD,EACA,MAAAsD,EACA,WAAAC,CACH,EACE,CAED,KAAK,CAAE,MAAAC,EAAO,QAAAN,EAAS,UAAAhO,CAAS,EAAI,CACnC,OAAO2M,EAAA,KAAKsB,EAAAA,GAAL,UAAWtB,EAAA,KAAKC,EAAAA,GAAL,UAAU,WAAW,OAAAC,EAAA,KAAKU,GAAU,GAAE,UAAU,CACjE,GAAGV,EAAA,KAAKqB,EAAAA,GACR,SAAUrB,EAAA,KAAKP,GAAS,SACxB,gBAAiBO,EAAA,KAAKU,GAAU,gBAChC,MAAAe,EACA,QAAAN,EACA,UAAAhO,CACH,EACE,CAGD,OAAOuO,EAAW,CACjB,OAAO5B,EAAA,KAAKsB,EAAAA,GAAL,UAAWtB,EAAA,KAAKC,EAAAA,GAAL,UAAU,WAAW,OAAAC,EAAA,KAAKU,GAAU,GAAE,aAAa,CACpE,GAAGV,EAAA,KAAKqB,EAAAA,GACR,UAAAK,CACA,GAAE,KAAK,CAAC,CAAE,KAAA9K,KAAW,CACrB8I,EAAA,KAAKiB,EAAW/J,EACnB,CAAG,CACD,CAED,iBAAiB+K,EAAM,CACtB,MAAMC,EAAW,IAAI,SACrBA,EAAS,OAAO,OAAQD,CAAI,EAC5B,MAAME,EAAMxB,GAAa,mBAAmB,EACzC,eAAiB,mBAAmBL,EAAA,KAAKU,GAAU,EAAE,EACrD,cAAgB,mBAAmBV,EAAA,KAAKW,GAAS,EAAE,EACnD,iBAAmB,mBAAmBX,EAAA,KAAKW,GAAS,KAAK,EACzD,eAAiB,mBAAmBX,EAAA,KAAKP,GAAS,YAAc,EAAE,EACrE,OAAOK,EAAA,KAAKsB,EAAAA,GAAL,UAAWS,EAAKD,EAAU,CAChC,QAAS,CACR,eAAgB,qBAChB,CACJ,EACE,CAED,qBAAqBE,EAAU,CAC9B,OAAOhC,EAAA,KAAKsB,EAAAA,GAAL,UAAWf,GAAa,qBAAqB,EAAG,CACtD,WAAYL,EAAA,KAAKU,GAAU,GAC3B,UAAWV,EAAA,KAAKW,GAAS,GACzB,aAAcX,EAAA,KAAKW,GAAS,MAC5B,SAAAmB,CACH,EACE,CAED,OAAQ,CACP,OAAOhC,EAAA,KAAKsB,EAAAA,GAAL,UACNtB,EAAA,KAAKC,EAAAA,GAAL,UAAU,WAAW,OAAAC,EAAA,KAAKU,GAAU,GAAE,WACtCV,EAAA,KAAKqB,EAAAA,IACJ,KAAK,IAAM,CACZ,KAAK,OAAS,EACjB,CAAG,CACD,CAGD,mBAAmBzB,EAAiB,CACnCI,EAAA,KAAKU,GAAU,gBAAkBd,CACjC,CAcF,CArJCW,GAAAA,YACAC,GAAAA,YACAC,EAAAA,YACAC,EAAAA,YACAC,EAAAA,YACAC,GAAAA,YACAC,GAAAA,YACApB,EAAAA,YATMa,EAAA,YAiDFe,EAAAA,UAAiB,CACpB,MAAO,CACN,WAAYrB,EAAA,KAAKU,GAAU,GAC3B,UAAWV,EAAA,KAAKW,GAAS,GACzB,aAAcX,EAAA,KAAKW,GAAS,MAC5B,MAAOX,EAAA,KAAKP,GAAS,UACrB,CACD,EAmFD2B,EAAAA,YAASW,EAAM,CACd,OAAI,KAAK,OACD,QAAQ,OAAO,IAAI7C,EAAuB,EAE3CW,GAAM,KAAK,GAAGkC,CAAI,CACzB,EAEDhC,EAAAA,SAAKI,EAAU,CACd,MAAMC,EAAW,CAAC,CAACJ,EAAA,KAAKqB,EAAAA,GAAe,MACvC,OAAOhB,GAAaF,EAAUC,CAAQ,CACtC,EASF,SAASC,GAAaF,EAAUC,EAAW,GAAO,CACjD,MAAM4B,EAAWC,GAAY,YAAY,EACzC,OAAI7B,EACI,GAAG4B,OAAAA,EAAQ,YAAW7B,OAAAA,GAEvB,GAAG6B,OAAAA,EAAQ,KAAI7B,OAAAA,EACvB,CChMA,MAAM+B,GAAiB,IAOjBC,GAAqB,IAOrBC,GAA+B,IAM/BC,GAA2B,IAQ3BC,GAA2B,IAG3BC,GAAwB,EAMxBC,GAA+BF,GAA2B,uBAEhE,MAAMG,EAAe,CAapB,YAAYC,EAAaC,EAAY,CAVrCC,EAAAA,KAAAA,GAEAC,EAAAA,KAAAA,IAEAC,EAAAA,KAAAA,GACAC,EAAAA,KAAAA,GACAC,EAAAA,KAAAA,GACAC,EAAAA,KAAAA,GACAC,EAAAA,KAAAA,GAGCxD,EAAA,KAAKkD,EAAeF,GACpBhD,EAAA,KAAKmD,GAAcF,GACnBjD,EAAA,KAAKqD,EAAiBb,IACtBxC,EAAA,KAAKsD,EAAqB,GAC1BtD,EAAA,KAAKoD,EAAY,EACjB,CAED,SAAU,CACT,GAAI,KAAK,QAAU,EAAG,CACrB,QAAQ,MAAM,0CAA0C,EACxD,MACA,CACDpD,EAAA,KAAKwD,EAA0B,IAC/B,KAAK,QAAU,YAAY,KAAK,YAAY,KAAK,IAAI,EAAG,EAAE,EAC1D,SAAS,iBAAiB,mBAAoB,KAAK,iBAAiB,KAAK,IAAI,CAAC,CAC9E,CAKD,MAAM,aAAc,CACnB,GAAIlD,EAAA,KAAKiD,GACR,OAGD,MAAMjR,EAAM,KAAK,IAAK,EAEtB,GAAI,EAAK8Q,EAAAA,KAAAA,GAAa9Q,EAAMgO,EAAA,KAAK+C,IAIjC,CAAA,GAAI,CAAC,KAAK,QAAS,CAClB,QAAQ,MAAM,2BAA2B,EACzC,MACA,CAEDrD,EAAA,KAAKuD,EAAc,IAEnBE,EAAO,MAAM,kCAAmCnD,EAAA,KAAK4C,GAAa,OAAO,EACzE,MAAM5C,EAAA,KAAK6C,IAAY,KAAK,CAC3B,QAAS7C,EAAA,KAAK4C,GAAa,OAC3B,CAAA,EAAE,KAAK,KAAK,gBAAgB,KAAK,IAAI,EAAG,KAAK,aAAa,KAAK,IAAI,CAAC,EACrElD,EAAA,KAAKoD,EAAY,KAAK,IAAK,GAC3BpD,EAAA,KAAKuD,EAAc,GAAA,CACnB,CAED,gBAAgB,CAAE,KAAArM,GAAQ,CACzB,KAAM,CAAE,SAAAkK,EAAU,SAAAsC,CAAQ,EAAKxM,EAM/B,GALA8I,EAAA,KAAKsD,EAAqB,GAE1BhD,EAAA,KAAK4C,GAAa,KAAK,SAAU,CAAE,SAAA9B,EAAU,SAAAsC,EAAU,EACvDpD,EAAA,KAAK4C,GAAa,cAAchM,CAAI,EAEhCA,EAAK,MAAM,SAAW,EAAG,CAI5B,GAHKoJ,EAAA,KAAKkD,IACTxD,EAAA,KAAKwD,EAA0B,IAE5BlD,EAAA,KAAK4C,GAAa,YACrB,OAED,MAAMS,EAAa,KAAK,IAAG,EAAKb,GAC1Bc,EAAQF,EAAS,OAAQzE,GAAMA,EAAE,YAAc,IAAO0E,CAAU,EAClErD,EAAA,KAAK4C,GAAa,WACrB,KAAK,qBAAsB,EACjBU,EAAM,OAAS,EACzB,KAAK,oBAAqB,EAE1B,KAAK,qBAAsB,EAE5BtD,EAAA,KAAK4C,GAAa,KAAK,cAAe,CAAE,eAAgB,GAAM,EAC9D,MACA,CAEG5C,EAAA,KAAKkD,IACR,KAAK,kBAAmB,CAEzB,CAED,aAAazK,EAAG,CACX,CAACA,EAAE,UAAYA,EAAE,OAAS,eACzB8K,GAAA,KAAKP,GAAL,KAA6BT,IAChCY,EAAO,MAAM,2FAA2F,EACxGnD,EAAA,KAAK4C,GAAa,KAAK,QAAS,CAAE,KAAMY,EAAW,kBAAmB,KAAM,CAAA,EAAI,GAGhFL,EAAO,MAAM,wEAAwE,OAAAnD,EAAA,KAAKgD,GAAoB,EAErGvK,EAAE,SAAS,SAAW,KAEhC,KAAK,gBAAgBA,EAAE,QAAQ,EAC/B0K,EAAO,MAAM,2CAA2C,EACxDnD,EAAA,KAAK4C,GAAa,KAAK,QAAS,CAC/B,KAAMY,EAAW,gBACjB,KAAM,CACL,cAAe/K,EAAE,SAAS,KAAK,aAC/B,CACL,CAAI,GACSA,EAAE,SAAS,SAAW,KAChCuH,EAAA,KAAK4C,GAAa,KAAK,QAAS,CAAE,KAAMY,EAAW,WAAY,KAAM/K,EAAE,QAAQ,CAAE,EACjF,KAAK,WAAY,GACPA,EAAE,SAAS,SAAW,KAChCuH,EAAA,KAAK4C,GAAa,KAAK,QAAS,CAAE,KAAMY,EAAW,iBAAkB,KAAM,CAAA,EAAI,EAC/E,KAAK,WAAY,GACP/K,EAAE,SAAS,SAAW,KAChCuH,EAAA,KAAK4C,GAAa,KAAK,QAAS,CAAE,KAAMY,EAAW,iBAAkB,KAAM,CAAA,EAAI,EAC/E,KAAK,WAAY,GACP/K,EAAE,SAAS,SAAW,KAChC,KAAK,qBAAsB,EAC3BuH,EAAA,KAAK4C,GAAa,KAAK,QAAS,CAAE,KAAMY,EAAW,kBAAmB,KAAM,CAAA,EAAI,EAChFL,EAAO,MAAM,mDAAoD,CAAE,MAAO1K,CAAC,CAAE,IAE7E,KAAK,WAAY,EACjBuH,EAAA,KAAK4C,GAAa,KAAK,QAAS,CAAE,KAAMY,EAAW,kBAAmB,KAAM,CAAA,EAAI,EAChFL,EAAO,MAAM,4CAA6C,CAAE,MAAO1K,CAAC,CAAE,EAGvE,CAED,YAAa,CACZ,cAAc,KAAK,OAAO,EAC1B,KAAK,QAAU,EACf,SAAS,oBAAoB,mBAAoB,KAAK,iBAAiB,KAAK,IAAI,CAAC,CACjF,CAED,mBAAoB,CACnBiH,EAAA,KAAKqD,EAAiBb,GAEtB,CAED,sBAAuB,CACtBxC,EAAA,KAAKqD,EAAiB,KAAK,IAAI/C,EAAA,KAAK+C,GAAiB,EAAGZ,EAAkB,EAC1E,CAED,qBAAsB,CACrBzC,EAAA,KAAKqD,EAAiBX,GACtB,CAED,sBAAuB,CACtB1C,EAAA,KAAKqD,EAAiBV,GACtB,CAED,kBAAmB,CACd,SAAS,kBAAoB,SAChC3C,EAAA,KAAKqD,EAAiBT,IAEtB,KAAK,kBAAmB,CAEzB,CAEF,CAhKCM,EAAAA,YAEAC,GAAAA,YAEAC,EAAAA,YACAC,EAAAA,YACAC,EAAAA,YACAC,EAAAA,YACAC,EAAAA,YC1CI,MAACO,GAAe,KAOfC,GAAoB,IAEpBC,GAAyB,GAEzBnB,GAA+B,GAE/BgB,EAAa,CAKlB,gBAAiB,EAIjB,aAAc,EAEd,WAAY,EAEZ,kBAAmB,EAEnB,iBAAkB,EAElB,eAAgB,CACjB,UAEA,MAAMI,EAAY,CAKjB,YAAY,CAAE,gBAAAhE,EAAiB,UAAAiE,EAAW,iBAAA/F,EAAkB,GAAGwB,CAAO,EAAI,CAH1EwE,EAAAA,KAAAA,GACAjB,EAAAA,KAAAA,GAIC,OAAA,KAAK,KAAO9D,GAAM,EAElB,KAAK,UAAY8E,EACjB,KAAK,iBAAmB/F,EACxB,KAAK,KAAO,IAAIuB,GAAWC,CAAO,EAClCI,EAAA,KAAKmD,EAAc,MAEnB,KAAK,cAAgB,CAAE,EAEvB,KAAK,aAAe,KAAK,IAAK,EAE9B,KAAK,QAAU,KACf,KAAK,gBAAkBjD,EACvB,KAAK,QAAU,GACfF,EAAA,KAAKoE,EAAkB,MAEvB,KAAK,SAAWrO,GAAS,KAAK,UAAU,KAAK,IAAI,EAAGiO,EAAiB,EAE9D,IACP,CAED,IAAI,YAAa,CAChB,OAAO1D,EAAA,KAAK6C,GAAY,MAAM,SAAS,QACvC,CAED,IAAI,WAAY,CACf,OAAO7C,EAAA,KAAK6C,GAAY,QAAQ,SAChC,CAED,MAAM,KAAK,CAAE,OAAAlD,EAAQ,eAAAoE,GAAkB,CACtC,GAAI/D,EAAA,KAAK6C,IAAe,CAAC7C,EAAA,KAAK6C,GAAY,SAEzC,OAED,MAAMlG,EAAUoH,EACb,QAAQ,QAAQ,IAAI7D,GAAW,CAAE,KAAM6D,CAAc,EAAI,CAAA,CAAE,CAAC,EAC5D,KAAK,KAAK,KAAK,CAAE,OAAApE,EAAQ,gBAAiB,KAAK,gBAAiB,EAChE,MAAM1H,GAAS,KAAK,WAAWA,CAAK,CAAC,EACxCyH,EAAA,KAAKmD,EAAc,MAAMlG,GACpBqD,EAAA,KAAK6C,KAIV,KAAK,QAAU,IAAIJ,GAAe,KAAMzC,EAAA,KAAK6C,EAAW,EACxD,KAAK,QAAU7C,EAAA,KAAK6C,GAAY,gBAChC,KAAK,gBAAkB7C,EAAA,KAAK6C,GAAY,SAAS,gBACjD,KAAK,KAAK,SAAU,CACnB,GAAG7C,EAAA,KAAK6C,GAAY,MACpB,QAAS,KAAK,OACjB,CAAG,EACD,KAAK,KAAK,SAAU,CACnB,GAAG7C,EAAA,KAAK6C,GAAY,MACpB,QAAS,KAAK,OACjB,CAAG,EACD,CAED,WAAY,CACX,KAAK,QAAQ,QAAS,CACtB,CAED,QAAS,CACR,KAAK,QAAQ,kBAAmB,CAChC,CAED,WAAW5K,EAAO,CACb,CAACA,EAAM,UAAYA,EAAM,OAAS,eACrC,KAAK,KAAK,QAAS,CAAE,KAAMuL,EAAW,kBAAmB,KAAM,CAAA,EAAI,EAEnE,KAAK,KAAK,QAAS,CAAE,KAAMA,EAAW,WAAY,KAAMvL,EAAM,SAAU,CAEzE,CAED,cAAcyJ,EAAW,CACxB,OAAK1B,EAAA,KAAK6C,GAAY,SAGf7C,EAAA,KAAK6C,GAAY,OAAOnB,CAAS,EACtC,MAAOzJ,IACPkL,EAAO,MAAM,+BAAgC,CAAE,MAAAlL,CAAK,CAAE,EAC/C,QAAQ,OAAOA,CAAK,EAC3B,EANM,QAAQ,OAAO,IAAI,KAAO,CAOlC,CAED,UAAU+L,EAAa,CAEtB,GAAI,CAAKF,EAAAA,KAAAA,GAGT,OAAO,IAAI,QAAQ,CAACG,EAASC,IAAW,CACvCxE,EAAA,KAAKoE,EAAkB,YAAY,IAAM,CACpC9D,EAAA,KAAK6C,IAAe,CAAC,KAAK,SAC7B,KAAK,aAAamB,CAAW,EAAE,KAAKC,CAAO,EAAE,MAAMC,CAAM,CAE1D,EAAE,GAAG,EACT,CAAG,CACD,CAED,aAAaF,EAAa,CACzB,KAAK,QAAU,GACf,cAAchE,EAAA,KAAK8D,EAAe,EAClCpE,EAAA,KAAKoE,EAAkB,MACvB,MAAMlN,EAAOoN,EAAa,EAC1B,OAAIpN,EAAK,MAAM,OAAS,GACvB,KAAK,KAAK,cAAe,CAAE,MAAO,EAAI,CAAE,EAElCoJ,EAAA,KAAK6C,GAAY,KAAKjM,CAAI,EAC/B,KAAMqJ,GAAa,CACnB,KAAK,QAAU,GACf,KAAK,KAAK,OAAQ,CACjB,MAAO,CAAE,EACT,SAAUD,EAAA,KAAK6C,GAAY,SAC3B,QAAS,KAAK,OACnB,CAAK,CACL,CAAI,EAAE,MAAMsB,GAAO,OACf,KAAM,CAAE,SAAAlE,EAAU,KAAAmE,CAAI,EAAKD,EAC3B,MAAK,KAAA,QAAU,IACX,CAAClE,GAAYmE,IAAS,iBACzB,KAAK,KAAK,QAAS,CAAE,KAAMZ,EAAW,kBAAmB,KAAM,CAAA,EAAI,GAEhEvD,iBAAU,UAAW,IACxB,KAAK,KAAK,QAAS,CAAE,KAAMuD,EAAW,WAAY,KAAMvD,EAAU,GACxDA,iBAAU,UAAW,MAC1BrJ,EAAK,WAETuM,EAAO,MAAM,2CAA2C,EACxD,KAAK,KAAK,QAAS,CAAE,KAAMK,EAAW,eAAgB,KAAM,CAAA,EAAI,KAG7DvD,EAAAA,EAAS,KAAK,WAAdA,YAAAA,EAAwB,kBAAmB,KAAK,UACnD,KAAK,KAAK,QAAS,CAAE,KAAMuD,EAAW,aAAc,KAAM,CAAA,EAAI,EAC9D,GAAG,aAAa,cAAc,+BAA+B,IAGzD,IAAI,MAAM,gCAAiC,CAAE,MAAOW,CAAG,CAAE,CACnE,CAAI,CACF,CAED,cAAc,CAAE,MAAA1C,EAAO,SAAAX,EAAU,SAAAsC,CAAQ,EAAI,CAO5C,MAAMiB,EAAW,CAAC,GANAjB,EAChB,OAAOzE,GAAKA,EAAE,YAAe,KAAK,MAAM,KAAK,IAAK,EAAG,GAAI,EAAI6D,EAA6B,EAC1F,OAAO7D,GAAKA,EAAE,oBAAoB,EAClC,IAAIA,IACG,CAAE,KAAMA,EAAE,qBAAsB,SAAUA,EAAE,QAAU,EAC7D,CAC4B,EAC9B,QAASrL,EAAI,EAAGA,EAAImO,EAAM,OAAQnO,IAAK,CACtC,MAAMgR,EAAc7C,EAAMnO,CAAC,EAAE,KAI7B,GAHI,KAAK,QAAUmO,EAAMnO,CAAC,EAAE,UAC3B,KAAK,QAAUmO,EAAMnO,CAAC,EAAE,SAErB,CAAC,MAAM,QAAQgR,CAAW,EAAG,CAChCnB,EAAO,MAAM,mCAAoC,CAAE,KAAM1B,EAAMnO,CAAC,EAAG,EAEnE,QACA,CACDgR,EAAY,QAAQC,GAAQ,CAC3BF,EAAS,KAAK,CACb,KAAAE,EACA,SAAU9C,EAAMnO,CAAC,EAAE,SACxB,CAAK,CACL,CAAI,CACD,CACD,KAAK,aAAe,KAAK,IAAK,EAC9B,KAAK,KAAK,OAAQ,CACjB,MAAO+Q,EAEP,SAAUrE,EAAA,KAAK6C,GAAY,SAC3B,QAAS,KAAK,OACjB,CAAG,CACD,CAED,WAAY,CAEX,OAD4B,KAAK,IAAK,EAAG,KAAK,cAAgB,IAAO,GAC5CY,IACxBN,EAAO,MAAM,sCAAsC,YAAK,aAAY,kCAAiC,EACrG,KAAK,KAAK,MAAM,EACT,IAED,EACP,CAED,aAAc,CACb,OAAO,KAAK,UAAW,CACvB,CAED,MAAM,KAAK,CAAE,MAAA5B,EAAQ,GAAO,WAAAC,EAAa,EAAM,EAAG,GAAI,CACrD2B,EAAO,MAAM,uBAAwB,UAAU,CAAC,CAAC,EACjD,GAAI,CACH,MAAMlD,EAAW,MAAMD,EAAA,KAAK6C,GAAY,KAAK,CAC5C,QAAS,KAAK,QACd,gBAAiB,KAAK,YAAa,EACnC,cAAe,KAAK,iBAAkB,EACtC,MAAAtB,EACA,WAAAC,CACJ,CAAI,EACD,KAAK,KAAK,cAAe,CAAE,MAAO,EAAK,CAAE,EACzCxB,EAAA,KAAK6C,GAAY,SAAS,qBAAuB,KAAK,IAAG,EAAK,IAC9DM,EAAO,MAAM,sBAAuBlD,CAAQ,EAC5C,KAAM,CAAE,SAAAa,EAAU,SAAAsC,CAAU,EAAGnD,EAAS,KACxC,KAAK,KAAK,OAAQ,CAAE,SAAAa,EAAU,SAAAsC,CAAQ,CAAE,EACxC,KAAK,SAAS,MAAO,CACrB,OAAQ3K,EAAG,CACX,MAAA0K,EAAO,MAAM,2BAA4B,CAAE,MAAO1K,CAAC,CAAE,EAC/CA,CACN,CACD,CAED,WAAY,CACX,OAAO,KAAK,KAAK,CAAE,MAAO,EAAI,CAAE,CAChC,CAED,WAAY,CACX,OAAO,KAAK,KAAK,CAAE,WAAY,EAAK,CAAE,EAAE,MAAOR,GAAU,CACxDkL,EAAO,MAAM,+BAAgC,CAAE,MAAAlL,CAAK,CAAE,CACzD,CAAG,CACD,CAED,MAAM,mBAAmByG,EAAO,OAC/B,GAAIA,EAAM,SAAW,EACpB,OAED,IAAI8F,EAAS,CAAE,EACf,MAAM/C,EAAQhD,GAASC,CAAK,EACtBvL,EAAYyL,GAAaF,CAAK,EACpC,OAAOnJ,EAAA,KAAK,aAAa,IAAM,CAC9B,MAAMqB,EAAO,CAAE,MAAA6K,EAAO,UAAAtO,EAAW,QAAS,KAAK,OAAS,EACxD,OAAAqR,EAAS,CAAC,GAAG9F,CAAK,EAClByE,EAAO,MAAM,uBAAwBvM,CAAI,EAClCA,CACV,CAAG,IALM,YAAArB,EAKH,KAAK,IAAM,CAEdmJ,EAAM,OAAO,EACZA,EAAM,OACN,GAAGA,EAAM,OAAOC,GAAK,CAAC6F,EAAO,SAAS7F,CAAC,CAAC,CACxC,CACD,EAAEwF,GAAOhB,EAAO,MAAMgB,CAAG,EAC1B,CAED,MAAM,OAAQ,OAIb,GAFA,KAAK,SAAS,MAAO,GACrB5O,EAAA,KAAK,UAAL,MAAAA,EAAc,aACV,EAAC,CAAAyK,EAAA,KAAK6C,IAAe7C,EAAA,KAAK6C,GAAY,UAG1C,OAAO7C,EAAA,KAAK6C,GAAY,MAAO,EAE7B,MAAMpK,GAAK,CACX0K,EAAO,KAAK,8BAA+B,CAAE,EAAA1K,CAAC,CAAE,CACpD,CAAI,CACF,CAED,iBAAiBkJ,EAAM,CACtB,OAAO3B,EAAA,KAAK6C,GAAY,iBAAiBlB,CAAI,CAC7C,CAED,qBAAqBG,EAAU,CAC9B,OAAO9B,EAAA,KAAK6C,GAAY,qBAAqBf,CAAQ,CACrD,CAED,GAAG1L,EAAOqO,EAAU,CACnB,OAAA,KAAK,KAAK,GAAGrO,EAAOqO,CAAQ,EACrB,IACP,CAED,IAAIrO,EAAOqO,EAAU,CACpB,OAAK,KAAA,KAAK,IAAIrO,EAAOqO,CAAQ,EACtB,IACP,CAED,KAAKrO,EAAOQ,EAAM,CACjB,KAAK,KAAK,KAAKR,EAAOQ,CAAI,CAC1B,CAEF,CAvRCkN,EAAAA,YACAjB,EAAAA,+CCvDD,OAAO,eAAwB6B,EAAA,aAAc,CAC3C,MAAO,EACT,CAAC,EACDA,EAAQ,QAAa,OACrB,SAASC,EAAQC,EAAK,CAAE,0BAA2B,OAAOD,EAAwB,OAAO,QAArB,YAA2C,OAAO,OAAO,UAA1B,SAAqC,SAAUC,EAAK,CAAE,OAAO,OAAOA,GAAS,SAAUA,EAAK,CAAE,OAAOA,GAAqB,OAAO,QAArB,YAA+BA,EAAI,cAAgB,QAAUA,IAAQ,OAAO,UAAY,SAAW,OAAOA,CAAI,EAAID,EAAQC,CAAG,CAAI,CAEhV,IAAIC,EAAQ,GACRC,EAAM,GACNC,EAAa,SAAoBC,EAAM,CACzC,IAAI/F,EAAI0F,EAAQK,CAAI,EACpB,GAAI/F,IAAM,SACR,MAAM,IAAI,UAAU,4BAA4B,OAAOA,CAAC,CAAC,CAE7D,EAGIgG,EAAiB,SAAwBD,EAAME,EAAgB,CAMjE,QALIC,EAAM,GACNC,EAAoB,EACpBC,EAAY,GACZC,EAAO,EACPlB,EACK9Q,EAAI,EAAGA,GAAK0R,EAAK,OAAQ,EAAE1R,EAAG,CACrC,GAAIA,EAAI0R,EAAK,OACXZ,EAAOY,EAAK,WAAW1R,CAAC,MACnB,CAAA,GAAI8Q,IAASS,EAClB,MAEAT,EAAOS,CAAAA,CAET,GAAIT,IAASS,EAAO,CAClB,GAAI,EAAAQ,IAAc/R,EAAI,GAAKgS,IAAS,GAE7B,GAAID,IAAc/R,EAAI,GAAKgS,IAAS,EAAG,CAC5C,GAAIH,EAAI,OAAS,GAAKC,IAAsB,GAAKD,EAAI,WAAWA,EAAI,OAAS,CAAC,IAAML,GAAOK,EAAI,WAAWA,EAAI,OAAS,CAAC,IAAML,GAC5H,GAAIK,EAAI,OAAS,EAAG,CAClB,IAAII,GAAiBJ,EAAI,YAAY,GAAG,EACxC,GAAII,KAAmBJ,EAAI,OAAS,EAAG,CACjCI,KAAmB,IACrBJ,EAAM,GACNC,EAAoB,IAEpBD,EAAMA,EAAI,MAAM,EAAGI,EAAc,EACjCH,EAAoBD,EAAI,OAAS,EAAIA,EAAI,YAAY,GAAG,GAE1DE,EAAY/R,EACZgS,EAAO,EACP,QACD,CACb,SAAqBH,EAAI,SAAW,GAAKA,EAAI,SAAW,EAAG,CAC/CA,EAAM,GACNC,EAAoB,EACpBC,EAAY/R,EACZgS,EAAO,EACP,QACD,EAECJ,IACEC,EAAI,OAAS,EACfA,GAAO,MAEPA,EAAM,KAERC,EAAoB,EAE9B,MACYD,EAAI,OAAS,EACfA,GAAO,IAAMH,EAAK,MAAMK,EAAY,EAAG/R,CAAC,EAExC6R,EAAMH,EAAK,MAAMK,EAAY,EAAG/R,CAAC,EAEnC8R,EAAoB9R,EAAI+R,EAAY,EAEtCA,EAAY/R,EACZgS,EAAO,CACR,MAAUlB,IAASU,GAAOQ,IAAS,GAClC,EAAEA,EAEFA,EAAO,EAEV,CACD,OAAOH,CACT,EACIK,EAAS,SAAgB7G,EAAG,CAC9B,GAAI,CACF,OAAO,mBAAmBA,CAAC,CAC5B,MAAiB,CAChB,OAAOA,CACR,CACH,EACI8G,EAAY,SAAmBC,EAAG,CACpCX,EAAWW,CAAC,EACZ,IAAIV,EAAOU,EACX,GAAIV,EAAK,SAAW,EAClB,MAAO,IAET,IAAIW,EAAaX,EAAK,WAAW,CAAC,IAAMH,EACpCe,EAAoBZ,EAAK,WAAWA,EAAK,OAAS,CAAC,IAAMH,EAS7D,OARAG,EAAOQ,EAAOR,CAAI,EAClBA,EAAOC,EAAeD,EAAM,CAACW,CAAU,EACnCX,EAAK,SAAW,GAAK,CAACW,IACxBX,EAAO,KAELA,EAAK,OAAS,GAAKY,IACrBZ,GAAQ,KAENW,EACK,IAAMX,EAERA,CACT,EACIa,EAAWJ,EACff,EAAQ,QAAamB,EACrBC,EAAiB,QAAApB,EAAQ,2DCzGnBqB,GAAqBrQ,GAAQsQ,GAAM,SAAS,yBAA0BtQ,CAAG,EACzEuQ,GAAiBD,GAAM,QAAQ,qBAAqB,wCAE3C,MAAME,EAAmB,CASvC,YAAY,CAAE,QAAAnF,EAAS,KAAAoF,EAAM,WAAAC,EAAY,iBAAAC,EAAkB,OAAA1G,GAAU,CATvDJ,EAAA,KAAA+G,GAEd3F,EAAAA,KAAAA,IACA4F,EAAAA,KAAAA,GACAC,EAAAA,KAAAA,IACAC,EAAAA,KAAAA,IACAC,EAAAA,KAAAA,IACAC,EAAAA,KAAAA,IAGCjH,EAAA,KAAKiB,GAAWI,GAChBrB,EAAA,KAAK6G,EAAQJ,GACbzG,EAAA,KAAK8G,GAAcJ,GACnB1G,EAAA,KAAK+G,GAAoBJ,GACzB3G,EAAA,KAAKgH,GAAc/G,UAAUoB,EAAQ,YACrCrB,EAAA,KAAKiH,GAA6B7G,EAAA,KAAK8G,EAAAA,IAAL,WAClC,CAWD,MAAM,QAAQC,EAAKC,EAAW,GAAM,CACnC,IAAIC,EAGJ,MAAMC,EAAkB,wBACxB,GAAIH,EAAI,MAAMG,CAAe,EAAG,CAC/B,MAAMC,EAAgB,mBAAmBJ,EAAI,QAAQG,EAAiB,EAAE,EAAE,MAAM,GAAG,EAAE,CAAC,CAAC,EAYvF,GATA,MAAMhH,EAAA,KAAK2G,IACXI,EAAad,GAAegB,CAAa,EAErCH,GAAY,CAACC,IAEhB,MAAMjH,EAAA,KAAK8G,EAAAA,IAAL,WACNG,EAAad,GAAegB,CAAa,GAGtCF,EACH,OAAOA,CAGR,CAGD,OAAIG,GAAYL,CAAG,EACX,CACN,QAAS,GACT,KAAM/G,EAAA,KAAKqH,EAAAA,IAAL,UAAWN,GACjB,WAAYA,EACZ,QAASA,CACT,EAIK,CACN,QAAS,GACT,KAAM/G,EAAA,KAAKqH,EAAAA,IAAL,UAAWN,GACjB,WAAY/G,EAAA,KAAKsH,EAAAA,IAAL,UAAaP,GACzB,QAAS/G,EAAA,KAAKsH,EAAAA,IAAL,UAAaP,EACtB,CACD,CA0CF,CA5GClG,GAAAA,YACA4F,EAAAA,YACAC,GAAAA,YACAC,GAAAA,YACAC,GAAAA,YACAC,GAAAA,YAPcL,EAAA,YAkBRM,GAAwB,gBAAA,CAC7B,OAAOb,GAAkB,CAAE,WAAY/F,EAAA,KAAK0G,IAAa,QAAS1G,EAAA,KAAKW,IAAU,WAAYX,EAAA,KAAKwG,GAAW,CAAE,CAC/G,EAkDDW,GAAMN,SAAAA,EAAK,CACV,OAAOA,EAAI,MAAM,GAAG,EAAE,IAAK,CAC3B,EAEDO,GAAAA,SAAQP,EAAK,CACZ,GAAI7G,EAAA,KAAKuG,GAAO,CACf,MAAMc,EAAMrH,EAAA,KAAKuG,GAAM,IACjBvP,EAAU8I,EAAA,KAAKwH,EAAAA,IAAL,UAAeT,GAAK,MAAM,GAAG,EAAE,IAAI,kBAAkB,EAAE,KAAK,GAAG,EAC/E,OAAOU,GAAkB,aAAaF,UAAMrQ,OAAAA,EAAS,CACrD,CAED,MAAMgO,EAAOlF,EAAA,KAAKwH,EAAAA,IAAL,UAAeT,GAAK,MAAM,GAAG,EACpCW,EAAWxC,EAAK,IAAK,EACrByC,EAAUzC,EAAK,KAAK,GAAG,EAE7B,OAAO/C,GAAY,sDAAuD,CACzE,MAAOjC,EAAA,KAAKwG,IACZ,SAAAgB,EACA,QAAAC,CACH,CAAG,CACD,EAODC,GAAcb,SAAAA,EAAK,CAClB,OAAO,UAAUA,EAAI,MAAM,GAAG,EAAE,CAAC,CAAC,CAClC,EAEDS,GAAUT,SAAAA,EAAK,CACd,MAAMpN,EAAI,CACTuG,EAAA,KAAKyG,IACL3G,EAAA,KAAK4H,EAAAA,IAAL,UAAmBb,EACtB,EAAI,KAAK,GAAG,EAEV,OAAOc,GAAclO,CAAC,CACtB,EAUF,SAASyN,GAAYL,EAAK,CACzB,OAAOA,EAAI,WAAW,SAAS,GAC3BA,EAAI,WAAW,UAAU,GACzBA,EAAI,WAAW,OAAO,CAC3B,CCnHA,MAAApS,GAAAsB,GAAA,CAMA,KAAA,iBACA,WAAA,CACA,2BAAArB,GACA,KAAAkT,EACA,CACA,CAAA,sYCRAnT,GAAAsB,GAAA,CACA,KAAA,iBACA,WAAA,CACA,oBAAA8R,GACA,aAAAC,EACA,EACA,OAAA,CAAAC,EAAA,EACA,MAAA,CACA,QAAA,OACA,EACA,KAAA,KAAA,CACA,UAAA,EACA,UAAA,CACA,GACA,SAAA,CACA,aAAA,CACA,MAAA,GAAA/I,OAAAA,GAAA,OAAA,UAAA,WAAA,KAAA,SAAA,EAAA,MAAAA,OAAAA,GAAA,OAAA,UAAA,WAAA,KAAA,SAAA,EACA,CACA,EACA,MAAA,CACA,QAAA,SACA,EACA,SAAA,CACA,KAAA,QAAA,CACA,EACA,QAAA,CACA,SAAA,CAEA,KAAA,UAAA,KAAA,QAAA,QAAA,eAAA,MAAA,EACA,KAAA,UAAA,KAAA,QAAA,QAAA,eAAA,WAAA,CACA,CACA,CACA,CAAA,2XC7CO,SAASgJ,IAAmB,OAElC,QAAIzS,EAAA,iCAAW,gBAAX,YAAAA,EAA0B,UAAW,OAAkB,UAAU,cAAc,OAG7D,CACrB,WACA,SACA,UACA,QACA,QACA,YACA,QACA,cACA,gBACA,EAEoB,KAAK0S,GAAS,UAAU,UAAU,MAAMA,CAAK,CAAC,CACpE,CCmOA,MAAAxT,GAAA,CACA,KAAA,YACA,WAAA,CACA,SAAAyT,EACA,EACA,MAAA,CACA,MAAA,CACA,UAAA,CACA,KAAA,GACA,OAAA,GACA,cAAA,GACA,SAAA,GACA,SAAA,GACA,aAAA,GACA,YAAA,GACA,UAAA,GACA,WAAA,GACA,UAAA,EACA,CACA,CACA,EACA,SAAA,CACA,aAAA,CACA,OAAAC,GAAA,KAAA,UAAAA,CAAA,CACA,EAEA,gBAAA,CACA,OAAA,KAAA,iBAAA,CACA,CACA,EACA,QAAA,CACA,gBAAAA,EAAA,CACA,KAAA,UAAAA,CAAA,EAAA,CAAA,KAAA,UAAAA,CAAA,CACA,EACA,iBAAAH,EACA,CACA,gnLChNAvT,GAAA,CACA,KAAA,UACA,WAAA,CACA,qBAAA2T,GACA,WAAA5R,GACA,aAAAC,GACA,UAAA4R,GACA,kBAAAvT,GACA,eAAAwT,GACA,eAAAC,GACA,iBAAAC,EACA,EACA,QAAA1S,GACA,OAAA,CACAiS,GACAU,GACAC,GACAC,EACA,EACA,SAAA,CACA,MAAAjT,EAAA,CAAA,EAEA,OAAA,OAAA,iBAAAA,EAAA,CACA,CAAAkT,EAAA,EAAA,CACA,IAAA,IAAA,KAAA,QACA,CACA,CAAA,EAEAlT,CACA,EACA,MAAA,CACA,SAAA,CACA,KAAA,QACA,QAAA,EACA,CACA,EAEA,OAAA,CACA,MAAAmT,EAAAC,GAAA,EACA,CAAA,MAAAC,CAAA,EAAAC,GAAAH,CAAA,EACA,MAAA,CAAA,QAAAA,EAAA,MAAAE,CAAA,CACA,EAEA,MAAA,CACA,MAAA,CACA,QAAA,CAAA,GAAAE,EAAA,EACA,SAAA,YAAA,YAAA,KAAA,KAAA,OAAA,EAAA,IAAA,GAAA,EAAA,SAAA,EAAA,GACA,YAAA,GACA,QAAA,GACA,aAAAC,GAAA,OAAA,wBAAA,CAAA,CAAA,EAAA,OAAA,EACA,OAAA,IACA,CACA,EACA,SAAA,CACA,gBAAA,CAMA,OALA,KAAA,QAAA,OAAA,CAAA,CAAA,SAAAC,KAEAA,IAAA,QAAAA,GAAA,KAAA,UACA,CAGA,EACA,eAAA,CACA,MAAAC,EAAA,KAAA,QAAA,OAAA,CAAA,CAAA,SAAAD,KAEAA,IAAA,QAAAA,EAAA,KAAA,UACA,EACAzS,EAAA0S,EAAA,OAAA,CAAAC,EAAA1T,EAAAM,IAAA,OAEA,MAAAb,GAAAO,EAAAA,EAAA,WAAAA,KAAAA,EAAA,CAAAA,CAAA,EAEA,GAAAP,EAAA,OAAA,EAAA,CAEA,MAAAkU,EADAD,EAAA,QAAA,CAAAA,EAAA,GAAA,EAAA,EAAA,YACA,CAAA,CAAA,IAAA,oBAAA1T,OAAAA,EAAA,IAAA,YAAA,EAAA,CAAA,EAAA,CAAA,EAGA4T,EADAtT,IAAAmT,EAAA,OAAA,EACA,CAAA,CAAA,IAAA,mBAAAzT,OAAAA,EAAA,IAAA,YAAA,EAAA,CAAA,EAAA,CAAA,EAEA,MAAA,CAAA,GAAA0T,EAAA,GAAAC,EAAA,GAAAlU,EAAA,GAAAmU,CAAA,CACA,CACA,MAAA,CAAA,GAAAF,EAAA,GAAAjU,CAAA,CACA,EAAA,EAAA,EAEA,MAAA,CACA,IAAA,SACA,MAAA,KAAA,EAAA,OAAA,mBAAA,EACA,KAAAoU,GACA,SAAA9S,CACA,CACA,EACA,WAAA,OAEA,MAAA+S,GADAlU,EAAA,KAAA,SAAA,iBAAA,KAAA,OAAA,IAAA,YAAAA,EACA,iBAAA,4BACA,OAAA,SAAAkU,CAAA,GAAA,EACA,EACA,YAAA,CAEA,MAAAC,EAAA,KAAA,MAAA,EACAC,EAAA,KAAA,UACA,KAAA,UACA,KAAA,UAAA,EAGA,OAFA,KAAA,MAAAD,EAAAC,CAAA,EAEA,CACA,CACA,EACA,SAAA,CACA,KAAA,UAAA,IAAA,CACA,KAAA,QAAA,GACA,KAAA,MAAA,gBAAA,EAAA,CACA,CAAA,CACA,EACA,QAAA,CAEA,UAAA,CACA,KAAA,YAAA,EACA,EAEA,UAAA,CACA,KAAA,YAAA,EACA,EACA,eAAA,CACA,KAAA,CAAA,KAAAC,EAAA,GAAAC,CAAA,EAAA,KAAA,QAAA,KAAA,MAAA,UACA,IAAAC,EAAA,KAAA,QAAA,KAAA,MAAA,IAAA,YAAAF,EAAAC,EAAA,GAAA,EAEAC,EAAA,KAAA,EAAA,SACA,KAAA,QAAA,SAAA,UAAA,EACAA,EAAA,KAAA,QAAA,KAAA,MAAA,IAAA,aAGA,QAAA,MAAA,oBAAA,KAAA,QAAA,KAAA,MAAA,UAAAA,CAAA,EACAC,GAAA,4BAAA,CAAA,QAAAD,CAAA,CAAA,CACA,CACA,CACA,qjEC7LArV,GAAA,CACA,KAAA,mBACA,WAAA,CACA,cAAAuV,GACA,cAAAC,EACA,EACA,OAAA,CAAAlC,GAAA9S,EAAA,EACA,SAAA,CACA,aAAA,CACA,OAAA,KAAA,cAAA,OACA,CACA,CACA,ikBCEAiV,GAAAxU,GAAAA,EAAA,MAAA,GAAA,EAAA,MAAA,EAAA,EAAA,EAAA,KAAA,GAAA,EAEAjB,GAAA,CACA,KAAA,eACA,OAAA,CAAAsT,GAAAoC,GAAAC,EAAA,EACA,SAAA,CACA,MAAA1U,EAAA,CAAA,EAEA,OAAA,OAAA,iBAAAA,EAAA,CACA,CAAA2U,EAAA,EAAA,CACA,IAAA,IAAA,KAAA,oBACA,EACA,CAAAC,EAAA,EAAA,CACA,IAAA,IAAA,KAAA,eACA,EACA,CAAAC,EAAA,EAAA,CACA,IAAA,IAAA,KAAA,KACA,CACA,CAAA,EAEA7U,CACA,EACA,MAAA,CACA,MAAA,CACA,aAAA,KACA,YAAA,GAEA,MAAA,CACA,uBAAA,EACA,CACA,CACA,EACA,SAAA,CACA,iBAAA,WACA,OAAA8U,EAAA,KAAA,eAAA,KAAAA,EAAAN,IAAA7T,GAAAd,EAAA,KAAA,QAAA,YAAAA,EAAA,eAAA,KAAAc,EAAA,GAAA,CACA,CACA,EACA,QAAA,CACA,eAAAX,EAAA,CACA,KAAA,YAAAA,CACA,EACA,QAAA+C,EAAA,CACA,KAAA,sBAAAA,EAAA,OAAA,KAAA,CACA,EACA,aAAAA,EAAA,CACA,KAAA,sBAAAA,EAAA,OAAA,MAAAA,EAAA,OAAA,QAAA,EACA,KAAA,YAAA,EACA,EACA,6BAAArC,EAAA,CACA,KAAA,sBAAAA,EAAA,OAAA,KAAA,EAGAA,EAAA,OAAA,MAAA,EACA,EACA,iBAAA,CACA,KAAA,MAAA,oBAAA,MAAA,CACA,EACA,MAAA,sBAAAqU,EAAAC,EAAA,KAAA,CACA,GAAA,CAAAD,EACA,OAGA,KAAA,MAAA,uBAAA,GAEA,MAAAE,EAAA,CAAA,GAAAF,CAAA,EAAA,IAAA9I,GACA,KAAA,qBAAAA,EAAA+I,CAAA,CACA,EAEA,OAAA,QAAA,IAAAC,CAAA,EACA,MAAA1S,GAAA,SACAkL,EAAA,MAAA,mCAAA,CAAA,MAAAlL,CAAA,CAAA,EACA2S,KAAA3S,GAAAA,EAAAA,GAAAA,YAAAA,EAAA,WAAAA,YAAAA,EAAA,OAAAA,YAAAA,EAAA,QAAAA,EAAA,OAAA,CACA,CAAA,EACA,KAAA,IAAA,CACA,KAAA,MAAA,uBAAA,EACA,CAAA,CACA,EACA,MAAA,qBAAA0J,EAAA+I,EAAA,KAAA,CACA,OAAA,KAAA,MAAA,uBAAA,GAEA,KAAA,aAAA,iBAAA/I,CAAA,EACA,KAAA1B,GAAA,WACA,KAAA,kBACAA,EAAAA,EAAA,OAAAA,YAAAA,EAAA,MAAAA,EAAAA,EAAA,OAAAA,YAAAA,EAAA,GAAA0B,EAAA,KACA+I,GAAAzK,EAAAA,EAAA,OAAAA,YAAAA,EAAA,OACA,CACA,CAAA,EACA,MAAAhI,GAAA,SACAkL,EAAA,MAAA,yBAAA,CAAA,MAAAlL,CAAA,CAAA,EACA2S,IAAA3S,GAAAA,EAAAA,GAAAA,YAAAA,EAAA,WAAAA,YAAAA,EAAA,OAAAA,YAAAA,EAAA,KAAA,CACA,CAAA,EACA,KAAA,IAAA,CACA,KAAA,MAAA,uBAAA,EACA,CAAA,CACA,EACA,sBAAA,CACA4S,GAAA,GAKA,GAAA,QAAA,WAAA,EAAA,OAAA,sBAAA,EAAA/I,GAAA,CACA,KAAA,eAAAA,CAAA,CACA,EAAA,GAAA,CAAA,EAAA,GAAA,OAAA,KAAA,eAAA,CACA,EACA,eAAAA,EAAA,CACA,OAAA,KAAA,aAAAoI,GAAApI,CAAA,EAEA,KAAA,MAAA,uBAAA,GAEA,KAAA,aAAA,qBAAAA,CAAA,EAAA,KAAA7B,GAAA,aACA,KAAA,kBACAA,EAAAA,EAAA,OAAAA,YAAAA,EAAA,MAAAA,EAAAA,EAAA,OAAAA,YAAAA,EAAA,IAAAA,EAAAA,EAAA,OAAAA,YAAAA,EAAA,SACA,MAAAA,EAAAA,EAAA,OAAAA,YAAAA,EAAA,OACA,CACA,CAAA,EAAA,MAAAhI,GAAA,SACAkL,EAAA,MAAA,8BAAA,CAAA,MAAAlL,CAAA,CAAA,EACA2S,KAAA3S,GAAAA,EAAAA,GAAAA,YAAAA,EAAA,WAAAA,YAAAA,EAAA,OAAAA,YAAAA,EAAA,QAAAA,EAAA,OAAA,CACA,CAAA,EAAA,KAAA,IAAA,CACA,KAAA,MAAA,uBAAA,EACA,CAAA,CACA,EACA,iBAAA6S,EAAAnL,EAAAoL,EAAAL,EAAA,KAAAjD,EAAA,GAAA,CAGA,MAAAZ,EAAAY,EAAA,IACA,mBAAAqD,CAAA,EAAA,QAAA,WAAAhR,GACA,IAAAA,EAAA,WAAA,CAAA,EAAA,SAAA,EAAA,EAAA,YAAA,CACA,EAGAkR,EAAAF,EAAA,WAAA,SAAA,EAAA,GAEAJ,EACA,KAAA,QAAA,QAAA,MAAAA,CAAA,EACA,KAAA,QAAA,MAAA,GAEA,SAAA,CAAA,IAAA7D,EAAA,IAAAmE,CAAA,CAAA,EAAA,IAAA,EAEA,MAAAC,EAAA,KAAA,QAAA,KAAA,MAAA,UACAA,EAAA,OAIA,KAAA,QAAA,SAAA,MAAAA,EAAA,EAAA,EAIA,KAAA,QAAA,SAAA,eAAA,EAEAlB,GAAA,sBAAA,IAAA,CACA,CACA,CACA,suBCjLAtV,GAAA,CACA,KAAA,gBACA,WAAA,CACA,aAAAyW,EACA,EACA,OAAA,CACAC,EACA,CACA,sQCHA1W,GAAA,CACA,KAAA,UACA,OAAA,CAAAO,GAAA0T,GAAAC,EAAA,EACA,SAAA,CACA,MAAAjT,EAAA,CAAA,EAEA,OAAA,OAAA,iBAAAA,EAAA,CACA,CAAA0V,EAAA,EAAA,CACA,IAAA,IAAA,KAAA,OACA,EACA,CAAAC,EAAA,EAAA,CACA,IAAA,KAAA,CACA,OAAA,KAAA,aACA,EACA,CACA,CAAA,EAEA3V,CACA,EAEA,MAAA,CACA,UAAA,CACA,KAAA,OACA,QAAA,IACA,EACA,mBAAA,CACA,KAAA,QACA,QAAA,EACA,EACA,cAAA,CACA,KAAA,QACA,QAAA,EACA,EACA,mBAAA,CACA,KAAA,QACA,QAAA,EACA,CACA,EAEA,KAAA,KAAA,CACA,QAAA,CACA,QAAA,GACA,OAAA,EACA,CACA,GAEA,SAAA,CACA,GAAA4V,GAAA,CACA,UAAA/Y,GAAAA,EAAA,KAAA,SACA,CAAA,EAEA,mBAAA,CACA,OAAA,KAAA,WAAA,KAAA,UAAA,OAAAiR,EAAA,eACA,EACA,aAAA,CACA,OAAA,KAAA,oBACA,KAAA,QAAA,QACA,EACA,EACA,qBAAA,CACA,OAAA,KAAA,iBACA,GAGA,KAAA,UAAA,IACA,CACA,EAEA,MAAA,CACA,oBAAA,CACA,KAAA,QAAA,QAAA,KAAA,kBACA,CACA,EAEA,SAAA,CACA,KAAA,QAAA,OAAA,KAAA,oBAEA,KAAA,OACA,IAAA,KAAA,oBACA+H,GAAA,CAEA,OAAA,OAAA,KAAA,QAAA,CAAA,OAAAA,CAAA,CAAA,CACA,CACA,EAEA,SAAA,iBAAA,UAAA,KAAA,aAAA,CACA,EACA,eAAA,CACA,SAAA,oBAAA,UAAA,KAAA,aAAA,CACA,EACA,QAAA,CACA,eAAA,CACA,KAAA,QAAA,QAAA,CAAA,KAAA,QAAA,QACA,KAAA,MAAA,kBAAA,KAAA,QAAA,OAAA,CACA,EACA,cAAAnV,EAAA,CACAA,EAAA,SAAAA,EAAA,QAAAA,EAAA,MAAA,KACA,KAAA,cAAA,CAEA,CACA,CAEA","x_google_ignoreList":[0,7,8,9,10,11,13,17]}