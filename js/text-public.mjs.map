{"version":3,"mappings":"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","names":["documentReady","callback","fn","newRichWorkspaceFileMenuPlugin","menu","fileList","descriptionFile","loadState","emit","filesWorkspacePlugin","module","Vue","View","RichWorkspace","vm","subscribe","data","loadEditor","sharingToken","mimetype","fileId","$el","container","n","__vitePreload","vue","editor","Editor","h","error","logger","getSharingToken","registerFileActionFallback","registerFileCreate","openMimetypes"],"ignoreList":[],"sources":["../src/helpers/index.js","../src/public.js"],"sourcesContent":["/**\n * SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\n/**\n * Callback that should be executed after the document is ready\n *\n * @param callback\n */\n\nconst documentReady = function (callback) {\n\tconst fn = () => setTimeout(callback, 0)\n\tif (\n\t\tdocument.attachEvent\n\t\t\t? document.readyState === 'complete'\n\t\t\t: document.readyState !== 'loading'\n\t) {\n\t\tfn()\n\t} else {\n\t\tdocument.addEventListener('DOMContentLoaded', callback)\n\t}\n}\n\nexport { documentReady }\n","/**\n * SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { loadState } from '@nextcloud/initial-state'\nimport { getSharingToken } from '@nextcloud/sharing/public'\n// eslint-disable-next-line import/no-unresolved, n/no-missing-import\nimport 'vite/modulepreload-polyfill'\n\nimport {\n\tregisterFileActionFallback,\n\tregisterFileCreate,\n} from './helpers/files.js'\nimport { logger } from './helpers/logger.js'\nimport { openMimetypes } from './helpers/mime.js'\nimport { documentReady } from './helpers/index.js'\nimport { emit, subscribe } from '@nextcloud/event-bus'\nimport RichWorkspace from './views/RichWorkspace.vue'\n\nconst newRichWorkspaceFileMenuPlugin = {\n\tattach(menu) {\n\t\tconst fileList = menu.fileList\n\t\tconst descriptionFile = t('text', 'Readme') + '.' + loadState('text', 'default_file_extension')\n\t\t// only attach to main file list, public view is not supported yet\n\t\tif (fileList.id !== 'files' && fileList.id !== 'files.public') {\n\t\t\treturn\n\t\t}\n\n\t\t// register the new menu entry\n\t\tmenu.addMenuEntry({\n\t\t\tid: 'rich-workspace-init',\n\t\t\tdisplayName: t('text', 'Add folder description'),\n\t\t\ttemplateName: descriptionFile,\n\t\t\ticonClass: 'icon-add-folder-description',\n\t\t\tfileType: 'file',\n\t\t\tuseInput: false,\n\t\t\tactionHandler() {\n\t\t\t\treturn window.FileList\n\t\t\t\t\t.createFile(descriptionFile, { scrollTo: false, animate: false })\n\t\t\t\t\t.then(() => emit('Text::showRichWorkspace', { autofocus: true }))\n\t\t\t},\n\t\t\tshouldShow() {\n\t\t\t\treturn !fileList.findFile(descriptionFile)\n\t\t\t},\n\t\t})\n\t},\n}\n\nconst filesWorkspacePlugin = {\n\tel: null,\n\n\tattach(fileList) {\n\t\tif (fileList.id !== 'files' && fileList.id !== 'files.public') {\n\t\t\treturn\n\t\t}\n\t\tthis.el = document.createElement('div')\n\t\tfileList.registerHeader({\n\t\t\tid: 'workspace',\n\t\t\tel: this.el,\n\t\t\trender: this.render.bind(this),\n\t\t\tpriority: 10,\n\t\t})\n\t},\n\n\trender(fileList) {\n\t\tif (fileList.id !== 'files' && fileList.id !== 'files.public') {\n\t\t\treturn\n\t\t}\n\n\t\tOC.Plugins.register('OCA.Files.NewFileMenu', newRichWorkspaceFileMenuPlugin)\n\t\timport('vue').then((module) => {\n\t\t\tconst Vue = module.default\n\t\t\tthis.el.id = 'files-workspace-wrapper'\n\t\t\tVue.prototype.t = window.t\n\t\t\tVue.prototype.n = window.n\n\t\t\tVue.prototype.OCA = window.OCA\n\t\t\tconst View = Vue.extend(RichWorkspace)\n\t\t\tconst vm = new View({\n\t\t\t\tpropsData: {\n\t\t\t\t\tpath: fileList.getCurrentDirectory(),\n\t\t\t\t\thasRichWorkspace: true,\n\t\t\t\t},\n\t\t\t}).$mount(this.el)\n\t\t\tsubscribe('files:navigation:changed', () => {\n\t\t\t\t// Expose if the default file list is active to the component\n\t\t\t\t// to only render the workspace if the file list is actually visible\n\t\t\t\tvm.active = OCA.Files.App.getCurrentFileList() === fileList\n\t\t\t})\n\t\t\tfileList.$el.on('urlChanged', data => {\n\t\t\t\tvm.path = data.dir.toString()\n\t\t\t})\n\t\t\tfileList.$el.on('changeDirectory', data => {\n\t\t\t\tvm.path = data.dir.toString()\n\t\t\t})\n\t\t})\n\t},\n}\n\nconst loadEditor = ({ sharingToken, mimetype, fileId, $el }) => {\n\tconst container = document.createElement('div')\n\tcontainer.id = 'texteditor'\n\n\tdocument.getElementById('app-content').appendChild(container)\n\n\tPromise.all([\n\t\timport(/* webpackChunkName: \"vendor\" */'vue'),\n\t\timport(/* webpackChunkName: \"editor\" */'./components/Editor.vue'),\n\t])\n\t\t.then(([vue, editor]) => ({\n\t\t\tVue: vue.default,\n\t\t\tEditor: editor.default,\n\t\t}))\n\t\t.then(({ Vue, Editor }) => {\n\t\t\tVue.prototype.t = window.t\n\t\t\tVue.prototype.OCA = window.OCA\n\n\t\t\tnew Vue({\n\t\t\t\trender: h => h(Editor, {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tactive: true,\n\t\t\t\t\t\tshareToken: sharingToken,\n\t\t\t\t\t\tmime: mimetype,\n\t\t\t\t\t\tfileId,\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t})\n\t\t\t\t.$mount($el)\n\n\t\t})\n\t\t.catch((error) => logger.error('Failed to attach editor', { error }))\n}\n\ndocumentReady(() => {\n\tconst sharingToken = getSharingToken()\n\n\tif (!sharingToken) {\n\t\treturn\n\t}\n\n\tconst filesTable = document.querySelector('#preview table.files-filestable')\n\n\t// list of files - dir sharing\n\tif (filesTable) {\n\t\tOC.Plugins.register('OCA.Files.FileList', filesWorkspacePlugin)\n\t\tregisterFileActionFallback()\n\t\tregisterFileCreate()\n\t\treturn\n\t}\n\n\t// single file share\n\tconst mimetype = document.getElementById('mimetype')?.value\n\tif (mimetype && openMimetypes.indexOf(mimetype) !== -1) {\n\t\tconst $el = document.getElementById('preview')\n\t\tconst fileId = loadState('text', 'file_id')\n\t\tloadEditor({ mimetype, sharingToken, fileId, $el })\n\t}\n})\n\nOCA.Text = {\n\tRichWorkspaceEnabled: loadState('text', 'workspace_available'),\n\tOpenReadOnlyEnabled: loadState('text', 'open_read_only_enabled'),\n}\n"],"file":"js/text-public.mjs"}