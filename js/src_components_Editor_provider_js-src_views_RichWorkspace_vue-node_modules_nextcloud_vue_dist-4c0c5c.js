/*! For license information please see src_components_Editor_provider_js-src_views_RichWorkspace_vue-node_modules_nextcloud_vue_dist-4c0c5c.js.LICENSE.txt */
"use strict";(self.webpackChunk_nextcloud_text=self.webpackChunk_nextcloud_text||[]).push([["src_components_Editor_provider_js-src_views_RichWorkspace_vue-node_modules_nextcloud_vue_dist-4c0c5c"],{31728:(e,t,r)=>{r.d(t,{BG:()=>A,C6:()=>d,Cy:()=>m,FQ:()=>s,HB:()=>o,IT:()=>h,QT:()=>k,Uw:()=>i,Zf:()=>C,a_:()=>v,cY:()=>l,eP:()=>x,fB:()=>g,q$:()=>a,rz:()=>w,sw:()=>f,vo:()=>p,wU:()=>c,ww:()=>y,zZ:()=>u});var n=r(52029);const i=Symbol("tiptap:editor"),o=Symbol("editor:file"),s=Symbol("attachment:resolver"),a=Symbol("editor:is-mobile"),l=Symbol("editor:is-public"),p=Symbol("editor:is-rich-editor"),h=Symbol("editor:is-rich-woskapace"),c=Symbol("sync:service"),d=Symbol("editor:upload"),f=Symbol("hook:mention-search"),u=Symbol("hook:mention-insert"),m={inject:{$editor:{from:i,default:null}}},A={inject:{$syncService:{from:c,default:null}}},g={inject:{$isPublic:{from:l,default:!1}}},w={inject:{$isRichWorkspace:{from:h,default:!1}}},k={inject:{$isRichEditor:{from:p,default:!1}}},y={inject:{$isMobile:{from:a,default:!1}}},v={inject:{$file:{from:o,default:()=>({fileId:0,relativePath:null,document:null})}}},C={inject:{$attachmentResolver:{from:s,default:{resolve:e=>(n.k.warn("No attachment resolver provided. Some attachment sources cannot be resolved."),[e])}}}},x={inject:{$editorUpload:{from:d,default:!0}}}},20017:(e,t,r)=>{async function n(){if(!window._nc_text_editor_instance){if(window._nc_text_editor_importing)return await new Promise((e=>{const t=setInterval((()=>{window._nc_text_editor_instance&&(e(window._nc_text_editor_instance),clearInterval(t))}),200)}));window._nc_text_editor_importing=!0;const e=await Promise.all([r.e("mermaid"),r.e("vendors-node_modules_nextcloud_vue_dist_index_mjs"),r.e("vendors-node_modules_braintree_sanitize-url_dist_index_js-node_modules_quartzy_markdown-it-me-b0a421"),r.e("vendors-node_modules_nextcloud_files_node_modules_nextcloud_router_dist_index_js-node_modules-c81854"),r.e("vendors-node_modules_nextcloud_dialogs_dist_chunks_toast-7xJhDYMn_mjs"),r.e("vendors-node_modules_path-normalize_lib_index_js-node_modules_proxy-polyfill_src_index_js-nod-f01f40"),r.e("src_components_RichTextReader_vue-data_image_svg_xml_3csvg_20xmlns_27http_www_w3_org_2000_svg-01d96d"),r.e("editor")]).then(r.bind(r,15935));window._nc_text_editor_instance=e.default}return window._nc_text_editor_instance}r.d(t,{Z:()=>n})},52029:(e,t,r)=>{r.d(t,{k:()=>n});const n=(0,r(17499).IY)().setApp("text").detectUser().build()},77280:(e,t,r)=>{r.d(t,{Z:()=>a});var n=r(87537),i=r.n(n),o=r(23645),s=r.n(o)()(i());s.push([e.id,'#rich-workspace[data-v-4d768d2c]{padding:0 50px;margin-bottom:-24px;text-align:left;max-height:0;transition:max-height .5s cubic-bezier(0, 1, 0, 1);z-index:61;position:relative}.rich-workspace--preview[data-v-4d768d2c]{margin-top:44px}.rich-workspace--preview[data-v-4d768d2c] div[contenteditable="false"]{margin:0}#rich-workspace[data-v-4d768d2c]:only-child{margin-bottom:0}.empty-workspace[data-v-4d768d2c]{cursor:pointer;display:block;padding-top:43px;color:var(--color-text-maxcontrast)}#rich-workspace[data-v-4d768d2c] div[contenteditable=false]{width:100%;padding:0px;background-color:var(--color-main-background);opacity:1;border:none}#rich-workspace[data-v-4d768d2c] .text-editor{height:100%;position:unset !important;top:auto !important}#rich-workspace[data-v-4d768d2c] .text-editor__wrapper{position:unset !important;overflow:visible}#rich-workspace[data-v-4d768d2c] .text-editor__main{overflow:visible !important}#rich-workspace[data-v-4d768d2c] .content-wrapper{overflow:scroll !important;max-height:calc(40vh - 50px);padding-left:10px;padding-bottom:10px}#rich-workspace[data-v-4d768d2c] .text-editor__wrapper .ProseMirror{padding:0px;margin:0}#rich-workspace[data-v-4d768d2c] .editor__content{margin:0}#rich-workspace.focus[data-v-4d768d2c]{max-height:50vh}#rich-workspace[data-v-4d768d2c]:not(.focus){max-height:30vh;position:relative;overflow:hidden}#rich-workspace[data-v-4d768d2c]:not(.focus):not(.empty):after{content:"";position:absolute;z-index:1;bottom:0;left:0;pointer-events:none;background-image:linear-gradient(to bottom, rgba(255, 255, 255, 0), var(--color-main-background));width:100%;height:4em}#rich-workspace.dark[data-v-4d768d2c]:not(.focus):after{background-image:linear-gradient(to bottom, rgba(0, 0, 0, 0), var(--color-main-background))}@media only screen and (max-width: 1024px){#rich-workspace[data-v-4d768d2c]:not(.focus){max-height:30vh}}',"",{version:3,sources:["webpack://./src/views/RichWorkspace.vue"],names:[],mappings:"AACA,iCACC,cAAA,CAEA,mBAAA,CACA,eAAA,CACA,YAAA,CACA,kDAAA,CACA,UAAA,CACA,iBAAA,CAGD,0CACC,eAAA,CAEA,uEACC,QAAA,CAKF,4CACC,eAAA,CAGD,kCACC,cAAA,CACA,aAAA,CACA,gBAAA,CACA,mCAAA,CAGD,4DACC,UAAA,CACA,WAAA,CACA,6CAAA,CACA,SAAA,CACA,WAAA,CAGD,8CACC,WAAA,CACA,yBAAA,CACA,mBAAA,CAGD,uDACC,yBAAA,CACA,gBAAA,CAGD,oDACC,2BAAA,CAGD,kDACC,0BAAA,CACA,4BAAA,CACA,iBAAA,CACA,mBAAA,CAGD,oEACC,WAAA,CACA,QAAA,CAGD,kDACC,QAAA,CAGD,uCACC,eAAA,CAGD,6CACC,eAAA,CACA,iBAAA,CACA,eAAA,CAGD,+DACC,UAAA,CACA,iBAAA,CACA,SAAA,CACA,QAAA,CACA,MAAA,CACA,mBAAA,CACA,iGAAA,CACA,UAAA,CACA,UAAA,CAGD,wDACC,2FAAA,CAGD,2CACC,6CACC,eAAA,CAAA",sourcesContent:["\n#rich-workspace {\n\tpadding: 0 50px;\n\t/* Slightly reduce vertical space */\n\tmargin-bottom: -24px;\n\ttext-align: left;\n\tmax-height: 0;\n\ttransition: max-height 0.5s cubic-bezier(0, 1, 0, 1);\n\tz-index: 61;\n\tposition: relative;\n}\n\n.rich-workspace--preview {\n\tmargin-top: 44px;\n\n\t&:deep(div[contenteditable='false']) {\n\t\tmargin: 0;\n\t}\n}\n\n/* For subfolders, where there are no Recommendations */\n#rich-workspace:only-child {\n\tmargin-bottom: 0;\n}\n\n.empty-workspace {\n\tcursor: pointer;\n\tdisplay: block;\n\tpadding-top: 43px;\n\tcolor: var(--color-text-maxcontrast);\n}\n\n#rich-workspace:deep(div[contenteditable=false]) {\n\twidth: 100%;\n\tpadding: 0px;\n\tbackground-color: var(--color-main-background);\n\topacity: 1;\n\tborder: none;\n}\n\n#rich-workspace:deep(.text-editor) {\n\theight: 100%;\n\tposition: unset !important;\n\ttop: auto !important;\n}\n\n#rich-workspace:deep(.text-editor__wrapper) {\n\tposition: unset !important;\n\toverflow: visible;\n}\n\n#rich-workspace:deep(.text-editor__main) {\n\toverflow: visible !important;\n}\n\n#rich-workspace:deep(.content-wrapper) {\n\toverflow: scroll !important;\n\tmax-height: calc(40vh - 50px);\n\tpadding-left: 10px;\n\tpadding-bottom: 10px;\n}\n\n#rich-workspace:deep(.text-editor__wrapper .ProseMirror) {\n\tpadding: 0px;\n\tmargin: 0;\n}\n\n#rich-workspace:deep(.editor__content) {\n\tmargin: 0;\n}\n\n#rich-workspace.focus {\n\tmax-height: 50vh;\n}\n\n#rich-workspace:not(.focus) {\n\tmax-height: 30vh;\n\tposition: relative;\n\toverflow: hidden;\n}\n\n#rich-workspace:not(.focus):not(.empty):after {\n\tcontent: '';\n\tposition: absolute;\n\tz-index: 1;\n\tbottom: 0;\n\tleft: 0;\n\tpointer-events: none;\n\tbackground-image: linear-gradient(to bottom, rgba(255, 255, 255, 0), var(--color-main-background));\n\twidth: 100%;\n\theight: 4em;\n}\n\n#rich-workspace.dark:not(.focus):after {\n\tbackground-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), var(--color-main-background));\n}\n\n@media only screen and (max-width: 1024px) {\n\t#rich-workspace:not(.focus) {\n\t\tmax-height: 30vh;\n\t}\n}\n"],sourceRoot:""}]);const a=s},7444:(e,t,r)=>{r.d(t,{default:()=>S});var n=r(47845),i=r(11480),o=r(69183),s=r(20017),a=r(97009);const l=!!document.getElementById("isPublic"),p=(0,i.Ii)("apps/text"+(l?"/public":"")+"/workspace",2),h=["Readme.md","README.md","readme.md"],c={name:"RichWorkspace",components:{RichTextReader:a.Z,Editor:s.Z},props:{content:{type:String,default:""},path:{type:String,required:!0},active:{type:Boolean,default:!0},hasRichWorkspace:{type:Boolean,default:!1}},data:()=>({localHasRichWorkspace:!1,focus:!1,folder:null,file:null,loaded:!1,ready:!1,autofocus:!1,hideMenu:!0,darkTheme:OCA.Accessibility&&"dark"===OCA.Accessibility.theme,enabled:OCA.Text.RichWorkspaceEnabled}),computed:{shareToken(){var e;return null===(e=document.getElementById("sharingToken"))||void 0===e?void 0:e.value}},watch:{path(){this.getFileInfo()},focus(e){e||document.querySelector("#rich-workspace .text-editor__main").scrollTo(0,0)},hasRichWorkspace(e){this.localHasRichWorkspace=e}},mounted(){this.localHasRichWorkspace=this.hasRichWorkspace,this.enabled&&this.hasRichWorkspace&&this.getFileInfo(),(0,o.Ld)("Text::showRichWorkspace",this.showRichWorkspace),(0,o.Ld)("Text::hideRichWorkspace",this.hideRichWorkspace),(0,o.Ld)("files:node:created",this.onFileCreated),(0,o.Ld)("files:node:deleted",this.onFileDeleted),(0,o.Ld)("files:node:renamed",this.onFileRenamed),this.listenKeydownEvents()},beforeDestroy(){(0,o.r1)("Text::showRichWorkspace",this.showRichWorkspace),(0,o.r1)("Text::hideRichWorkspace",this.hideRichWorkspace),(0,o.r1)("files:node:created",this.onFileCreated),(0,o.r1)("files:node:deleted",this.onFileDeleted),(0,o.r1)("files:node:renamed",this.onFileRenamed),this.unlistenKeydownEvents()},methods:{onFocus(){this.focus=!0,this.hideMenu=!1,this.unlistenKeydownEvents()},reset(){this.localHasRichWorkspace=!1,this.file=null,this.focus=!1,this.$nextTick((()=>{this.creating=!1,this.getFileInfo()}))},getFileInfo(e){if(!this.enabled)return;this.file=null,this.ready=!1,this.loaded=!0,this.autofocus=!1;const t={path:this.path};return l&&(t.shareToken=this.shareToken),n.Z.get(p,{params:t}).then((t=>{const r=t.data.ocs.data;return this.folder=r.folder||null,this.file=r.file,this.editing=!0,this.loaded=!0,this.autofocus=e||!1,this.localHasRichWorkspace=!0,!0})).catch((e=>(e.response.data.ocs&&e.response.data.ocs.data.folder?this.folder=e.response.data.ocs.data.folder:this.folder=null,this.file=null,this.loaded=!0,this.ready=!0,this.creating=!1,!1)))},showRichWorkspace(e){this.enabled=!0,this.getFileInfo((null==e?void 0:e.autofocus)||!1)},hideRichWorkspace(){this.enabled=!1},listenKeydownEvents(){window.addEventListener("keydown",this.onKeydown)},unlistenKeydownEvents(){window.removeEventListener("keydown",this.onKeydown)},onKeydown(e){"Tab"===e.key&&(this.hideMenu=!1)},onFileCreated(e){h.includes(e.basename)&&(this.localHasRichWorkspace=!0,this.getFileInfo(!0))},onFileDeleted(e){var t;e.path===(null===(t=this.file)||void 0===t?void 0:t.path)&&(this.localHasRichWorkspace=!1)},onFileRenamed(e){var t,r;h.includes(e.basename)?this.localHasRichWorkspace=!0:e.fileid===(null===(t=this.file)||void 0===t?void 0:t.id)&&e.path!==(null===(r=this.file)||void 0===r?void 0:r.path)&&(this.localHasRichWorkspace=!1)}}};var d=r(93379),f=r.n(d),u=r(7795),m=r.n(u),A=r(90569),g=r.n(A),w=r(3565),k=r.n(w),y=r(19216),v=r.n(y),C=r(44589),x=r.n(C),b=r(77280),_={};_.styleTagTransform=x(),_.setAttributes=k(),_.insert=g().bind(null,"head"),_.domAPI=m(),_.insertStyleElement=v();f()(b.Z,_);b.Z&&b.Z.locals&&b.Z.locals;const S=(0,r(51900).Z)(c,(function(){var e=this,t=e._self._c;return e.enabled&&e.localHasRichWorkspace?t("div",{class:{focus:e.focus,dark:e.darkTheme},attrs:{id:"rich-workspace"}},[e.loaded&&e.ready?e._e():t("RichTextReader",{staticClass:"rich-workspace--preview",attrs:{content:e.content}}),e._v(" "),e.file?t("Editor",{directives:[{name:"show",rawName:"v-show",value:e.ready,expression:"ready"}],key:e.file.path,attrs:{"file-id":e.file.id,"relative-path":e.file.path,"share-token":e.shareToken,mime:e.file.mimetype,autofocus:e.autofocus,"hide-menu":e.hideMenu,active:"","rich-workspace":""},on:{ready:function(t){e.ready=!0},focus:e.onFocus,error:e.reset}}):e._e()],1):e._e()}),[],!1,null,"4d768d2c",null).exports},31443:(e,t,r)=>{r.d(t,{a:()=>l,e:()=>a,g:()=>p,s:()=>h});var n=r(62556),i=r(59673),o=r(32859);const s=(0,n.Kc)("nextcloud-vue").persist(!0).build();const a=(e,t=10)=>{const r=new i.EmojiIndex(o),n=p();let s;return e?(s=r.search(`:${e}`,t),s.length<t&&(s=s.concat(r.search(e,t-s.length)))):s=i.frequently.get(t).map((e=>r.emoji(e)))||[],s.map((e=>e.getSkin(n)))},l=function(e){i.frequently.add(e)},p=()=>{const e=Number.parseInt(s.getItem("NcEmojiPicker::currentSkinTone")??"1");return Math.min(Math.max(e,1),6)},h=e=>{e=Math.min(Math.max(e,1),6),s.setItem("NcEmojiPicker::currentSkinTone",e.toString())}},16560:(e,t,r)=>{r.d(t,{Ax:()=>b,FC:()=>w,GJ:()=>R,Mn:()=>_,Pu:()=>g,dR:()=>I,k9:()=>v,nd:()=>C,nj:()=>M,vs:()=>l,wx:()=>$});var n=r(87823);const i=Math.pow(2,16);function o(e){return 65535&e}class s{constructor(e,t,r){this.pos=e,this.delInfo=t,this.recover=r}get deleted(){return(8&this.delInfo)>0}get deletedBefore(){return(5&this.delInfo)>0}get deletedAfter(){return(6&this.delInfo)>0}get deletedAcross(){return(4&this.delInfo)>0}}class a{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&a.empty)return a.empty}recover(e){let t=0,r=o(e);if(!this.inverted)for(let e=0;e<r;e++)t+=this.ranges[3*e+2]-this.ranges[3*e+1];return this.ranges[3*r]+t+function(e){return(e-(65535&e))/i}(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,r){let n=0,o=this.inverted?2:1,a=this.inverted?1:2;for(let l=0;l<this.ranges.length;l+=3){let p=this.ranges[l]-(this.inverted?n:0);if(p>e)break;let h=this.ranges[l+o],c=this.ranges[l+a],d=p+h;if(e<=d){let o=p+n+((h?e==p?-1:e==d?1:t:t)<0?0:c);if(r)return o;let a=e==(t<0?p:d)?null:l/3+(e-p)*i,f=e==p?2:e==d?1:4;return(t<0?e!=p:e!=d)&&(f|=8),new s(o,f,a)}n+=c-h}return r?e+n:new s(e+n,0,null)}touches(e,t){let r=0,n=o(t),i=this.inverted?2:1,s=this.inverted?1:2;for(let t=0;t<this.ranges.length;t+=3){let o=this.ranges[t]-(this.inverted?r:0);if(o>e)break;let a=this.ranges[t+i];if(e<=o+a&&t==3*n)return!0;r+=this.ranges[t+s]-a}return!1}forEach(e){let t=this.inverted?2:1,r=this.inverted?1:2;for(let n=0,i=0;n<this.ranges.length;n+=3){let o=this.ranges[n],s=o-(this.inverted?i:0),a=o+(this.inverted?0:i),l=this.ranges[n+t],p=this.ranges[n+r];e(s,s+l,a,a+p),i+=p-l}}invert(){return new a(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return 0==e?a.empty:new a(e<0?[0,-e,0]:[0,0,e])}}a.empty=new a([]);class l{constructor(e=[],t,r=0,n=e.length){this.maps=e,this.mirror=t,this.from=r,this.to=n}slice(e=0,t=this.maps.length){return new l(this.maps,this.mirror,e,t)}copy(){return new l(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)}appendMap(e,t){this.to=this.maps.push(e),null!=t&&this.setMirror(this.maps.length-1,t)}appendMapping(e){for(let t=0,r=this.maps.length;t<e.maps.length;t++){let n=e.getMirror(t);this.appendMap(e.maps[t],null!=n&&n<t?r+n:void 0)}}getMirror(e){if(this.mirror)for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}setMirror(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,r=this.maps.length+e.maps.length;t>=0;t--){let n=e.getMirror(t);this.appendMap(e.maps[t].invert(),null!=n&&n>t?r-n-1:void 0)}}invert(){let e=new l;return e.appendMappingInverted(this),e}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let r=this.from;r<this.to;r++)e=this.maps[r].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,r){let n=0;for(let r=this.from;r<this.to;r++){let i=this.maps[r].mapResult(e,t);if(null!=i.recover){let t=this.getMirror(r);if(null!=t&&t>r&&t<this.to){r=t,e=this.maps[t].recover(i.recover);continue}}n|=i.delInfo,e=i.pos}return r?e:new s(e,n,null)}}const p=Object.create(null);class h{getMap(){return a.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let r=p[t.stepType];if(!r)throw new RangeError(`No step type ${t.stepType} defined`);return r.fromJSON(e,t)}static jsonID(e,t){if(e in p)throw new RangeError("Duplicate use of step JSON ID "+e);return p[e]=t,t.prototype.jsonID=e,t}}class c{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new c(e,null)}static fail(e){return new c(null,e)}static fromReplace(e,t,r,i){try{return c.ok(e.replace(t,r,i))}catch(e){if(e instanceof n.e4)return c.fail(e.message);throw e}}}function d(e,t,r){let i=[];for(let n=0;n<e.childCount;n++){let o=e.child(n);o.content.size&&(o=o.copy(d(o.content,t,o))),o.isInline&&(o=t(o,r,n)),i.push(o)}return n.HY.fromArray(i)}class f extends h{constructor(e,t,r){super(),this.from=e,this.to=t,this.mark=r}apply(e){let t=e.slice(this.from,this.to),r=e.resolve(this.from),i=r.node(r.sharedDepth(this.to)),o=new n.p2(d(t.content,((e,t)=>e.isAtom&&t.type.allowsMarkType(this.mark.type)?e.mark(this.mark.addToSet(e.marks)):e),i),t.openStart,t.openEnd);return c.fromReplace(e,this.from,this.to,o)}invert(){return new u(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return t.deleted&&r.deleted||t.pos>=r.pos?null:new f(t.pos,r.pos,this.mark)}merge(e){return e instanceof f&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new f(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new f(t.from,t.to,e.markFromJSON(t.mark))}}h.jsonID("addMark",f);class u extends h{constructor(e,t,r){super(),this.from=e,this.to=t,this.mark=r}apply(e){let t=e.slice(this.from,this.to),r=new n.p2(d(t.content,(e=>e.mark(this.mark.removeFromSet(e.marks))),e),t.openStart,t.openEnd);return c.fromReplace(e,this.from,this.to,r)}invert(){return new f(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return t.deleted&&r.deleted||t.pos>=r.pos?null:new u(t.pos,r.pos,this.mark)}merge(e){return e instanceof u&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new u(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new u(t.from,t.to,e.markFromJSON(t.mark))}}h.jsonID("removeMark",u);class m extends h{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return c.fail("No node at mark step's position");let r=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return c.fromReplace(e,this.pos,this.pos+1,new n.p2(n.HY.from(r),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let e=this.mark.addToSet(t.marks);if(e.length==t.marks.length){for(let r=0;r<t.marks.length;r++)if(!t.marks[r].isInSet(e))return new m(this.pos,t.marks[r]);return new m(this.pos,this.mark)}}return new A(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new m(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if("number"!=typeof t.pos)throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new m(t.pos,e.markFromJSON(t.mark))}}h.jsonID("addNodeMark",m);class A extends h{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return c.fail("No node at mark step's position");let r=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return c.fromReplace(e,this.pos,this.pos+1,new n.p2(n.HY.from(r),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return t&&this.mark.isInSet(t.marks)?new m(this.pos,this.mark):this}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new A(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if("number"!=typeof t.pos)throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new A(t.pos,e.markFromJSON(t.mark))}}h.jsonID("removeNodeMark",A);class g extends h{constructor(e,t,r,n=!1){super(),this.from=e,this.to=t,this.slice=r,this.structure=n}apply(e){return this.structure&&k(e,this.from,this.to)?c.fail("Structure replace would overwrite content"):c.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new a([this.from,this.to-this.from,this.slice.size])}invert(e){return new g(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return t.deletedAcross&&r.deletedAcross?null:new g(t.pos,Math.max(t.pos,r.pos),this.slice)}merge(e){if(!(e instanceof g)||e.structure||this.structure)return null;if(this.from+this.slice.size!=e.from||this.slice.openEnd||e.slice.openStart){if(e.to!=this.from||this.slice.openStart||e.slice.openEnd)return null;{let t=this.slice.size+e.slice.size==0?n.p2.empty:new n.p2(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new g(e.from,this.to,t,this.structure)}}{let t=this.slice.size+e.slice.size==0?n.p2.empty:new n.p2(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new g(this.from,this.to+(e.to-e.from),t,this.structure)}}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new g(t.from,t.to,n.p2.fromJSON(e,t.slice),!!t.structure)}}h.jsonID("replace",g);class w extends h{constructor(e,t,r,n,i,o,s=!1){super(),this.from=e,this.to=t,this.gapFrom=r,this.gapTo=n,this.slice=i,this.insert=o,this.structure=s}apply(e){if(this.structure&&(k(e,this.from,this.gapFrom)||k(e,this.gapTo,this.to)))return c.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return c.fail("Gap is not a flat range");let r=this.slice.insertAt(this.insert,t.content);return r?c.fromReplace(e,this.from,this.to,r):c.fail("Content does not fit in gap")}getMap(){return new a([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new w(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),r=e.mapResult(this.to,-1),n=e.map(this.gapFrom,-1),i=e.map(this.gapTo,1);return t.deletedAcross&&r.deletedAcross||n<t.pos||i>r.pos?null:new w(t.pos,r.pos,n,i,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to||"number"!=typeof t.gapFrom||"number"!=typeof t.gapTo||"number"!=typeof t.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new w(t.from,t.to,t.gapFrom,t.gapTo,n.p2.fromJSON(e,t.slice),t.insert,!!t.structure)}}function k(e,t,r){let n=e.resolve(t),i=r-t,o=n.depth;for(;i>0&&o>0&&n.indexAfter(o)==n.node(o).childCount;)o--,i--;if(i>0){let e=n.node(o).maybeChild(n.indexAfter(o));for(;i>0;){if(!e||e.isLeaf)return!0;e=e.firstChild,i--}}return!1}function y(e,t,r){return(0==t||e.canReplace(t,e.childCount))&&(r==e.childCount||e.canReplace(0,r))}function v(e){let t=e.parent.content.cutByIndex(e.startIndex,e.endIndex);for(let r=e.depth;;--r){let n=e.$from.node(r),i=e.$from.index(r),o=e.$to.indexAfter(r);if(r<e.depth&&n.canReplace(i,o,t))return r;if(0==r||n.type.spec.isolating||!y(n,i,o))break}return null}function C(e,t,r=null,n=e){let i=function(e,t){let{parent:r,startIndex:n,endIndex:i}=e,o=r.contentMatchAt(n).findWrapping(t);if(!o)return null;let s=o.length?o[0]:t;return r.canReplaceWith(n,i,s)?o:null}(e,t),o=i&&function(e,t){let{parent:r,startIndex:n,endIndex:i}=e,o=r.child(n),s=t.contentMatch.findWrapping(o.type);if(!s)return null;let a=(s.length?s[s.length-1]:t).contentMatch;for(let e=n;a&&e<i;e++)a=a.matchType(r.child(e).type);return a&&a.validEnd?s:null}(n,t);return o?i.map(x).concat({type:t,attrs:r}).concat(o.map(x)):null}function x(e){return{type:e,attrs:null}}function b(e,t,r=1,n){let i=e.resolve(t),o=i.depth-r,s=n&&n[n.length-1]||i.parent;if(o<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!s.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let e=i.depth-1,t=r-2;e>o;e--,t--){let r=i.node(e),o=i.index(e);if(r.type.spec.isolating)return!1;let s=r.content.cutByIndex(o,r.childCount),a=n&&n[t]||r;if(a!=r&&(s=s.replaceChild(0,a.type.create(a.attrs))),!r.canReplace(o+1,r.childCount)||!a.type.validContent(s))return!1}let a=i.indexAfter(o),l=n&&n[0];return i.node(o).canReplaceWith(a,a,l?l.type:i.node(o+1).type)}function _(e,t){let r=e.resolve(t),n=r.index();return S(r.nodeBefore,r.nodeAfter)&&r.parent.canReplace(n,n+1)}function S(e,t){return!(!e||!t||e.isLeaf||!e.canAppend(t))}function R(e,t,r=-1){let n=e.resolve(t);for(let e=n.depth;;e--){let i,o,s=n.index(e);if(e==n.depth?(i=n.nodeBefore,o=n.nodeAfter):r>0?(i=n.node(e+1),s++,o=n.node(e).maybeChild(s)):(i=n.node(e).maybeChild(s-1),o=n.node(e+1)),i&&!i.isTextblock&&S(i,o)&&n.node(e).canReplace(s,s+1))return t;if(0==e)break;t=r<0?n.before(e):n.after(e)}}function M(e,t,r){let n=e.resolve(t);if(!r.content.size)return t;let i=r.content;for(let e=0;e<r.openStart;e++)i=i.firstChild.content;for(let e=1;e<=(0==r.openStart&&r.size?2:1);e++)for(let t=n.depth;t>=0;t--){let r=t==n.depth?0:n.pos<=(n.start(t+1)+n.end(t+1))/2?-1:1,o=n.index(t)+(r>0?1:0),s=n.node(t),a=!1;if(1==e)a=s.canReplace(o,o,i);else{let e=s.contentMatchAt(o).findWrapping(i.firstChild.type);a=e&&s.canReplaceWith(o,o,e[0])}if(a)return 0==r?n.pos:r<0?n.before(t+1):n.after(t+1)}return null}function I(e,t,r=t,i=n.p2.empty){if(t==r&&!i.size)return null;let o=e.resolve(t),s=e.resolve(r);return N(o,s,i)?new g(t,r,i):new T(o,s,i).fit()}function N(e,t,r){return!r.openStart&&!r.openEnd&&e.start()==t.start()&&e.parent.canReplace(e.index(),t.index(),r.content)}h.jsonID("replaceAround",w);class T{constructor(e,t,r){this.$from=e,this.$to=t,this.unplaced=r,this.frontier=[],this.placed=n.HY.empty;for(let t=0;t<=e.depth;t++){let r=e.node(t);this.frontier.push({type:r.type,match:r.contentMatchAt(e.indexAfter(t))})}for(let t=e.depth;t>0;t--)this.placed=n.HY.from(e.node(t).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let e=this.findFittable();e?this.placeNodes(e):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,r=this.$from,i=this.close(e<0?this.$to:r.doc.resolve(e));if(!i)return null;let o=this.placed,s=r.depth,a=i.depth;for(;s&&a&&1==o.childCount;)o=o.firstChild.content,s--,a--;let l=new n.p2(o,s,a);return e>-1?new w(r.pos,e,this.$to.pos,this.$to.end(),l,t):l.size||r.pos!=this.$to.pos?new g(r.pos,i.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let t=this.unplaced.content,r=0,n=this.unplaced.openEnd;r<e;r++){let i=t.firstChild;if(t.childCount>1&&(n=0),i.type.spec.isolating&&n<=r){e=r;break}t=i.content}for(let t=1;t<=2;t++)for(let r=1==t?e:this.unplaced.openStart;r>=0;r--){let e,i=null;r?(i=W(this.unplaced.content,r-1).firstChild,e=i.content):e=this.unplaced.content;let o=e.firstChild;for(let e=this.depth;e>=0;e--){let s,{type:a,match:l}=this.frontier[e],p=null;if(1==t&&(o?l.matchType(o.type)||(p=l.fillBefore(n.HY.from(o),!1)):i&&a.compatibleContent(i.type)))return{sliceDepth:r,frontierDepth:e,parent:i,inject:p};if(2==t&&o&&(s=l.findWrapping(o.type)))return{sliceDepth:r,frontierDepth:e,parent:i,wrap:s};if(i&&l.matchType(i.type))break}}}openMore(){let{content:e,openStart:t,openEnd:r}=this.unplaced,i=W(e,t);return!(!i.childCount||i.firstChild.isLeaf)&&(this.unplaced=new n.p2(e,t+1,Math.max(r,i.size+t>=e.size-r?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:r}=this.unplaced,i=W(e,t);if(i.childCount<=1&&t>0){let o=e.size-t<=t+i.size;this.unplaced=new n.p2(E(e,t-1,1),t-1,o?t-1:r)}else this.unplaced=new n.p2(E(e,t,1),t,r)}placeNodes({sliceDepth:e,frontierDepth:t,parent:r,inject:i,wrap:o}){for(;this.depth>t;)this.closeFrontierNode();if(o)for(let e=0;e<o.length;e++)this.openFrontierNode(o[e]);let s=this.unplaced,a=r?r.content:s.content,l=s.openStart-e,p=0,h=[],{match:c,type:d}=this.frontier[t];if(i){for(let e=0;e<i.childCount;e++)h.push(i.child(e));c=c.matchFragment(i)}let f=a.size+e-(s.content.size-s.openEnd);for(;p<a.childCount;){let e=a.child(p),t=c.matchType(e.type);if(!t)break;p++,(p>1||0==l||e.content.size)&&(c=t,h.push(z(e.mark(d.allowedMarks(e.marks)),1==p?l:0,p==a.childCount?f:-1)))}let u=p==a.childCount;u||(f=-1),this.placed=F(this.placed,t,n.HY.from(h)),this.frontier[t].match=c,u&&f<0&&r&&r.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let e=0,t=a;e<f;e++){let e=t.lastChild;this.frontier.push({type:e.type,match:e.contentMatchAt(e.childCount)}),t=e.content}this.unplaced=u?0==e?n.p2.empty:new n.p2(E(s.content,e-1,1),e-1,f<0?s.openEnd:e-1):new n.p2(E(s.content,e,p),s.openStart,s.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e,t=this.frontier[this.depth];if(!t.type.isTextblock||!O(this.$to,this.$to.depth,t.type,t.match,!1)||this.$to.depth==this.depth&&(e=this.findCloseLevel(this.$to))&&e.depth==this.depth)return-1;let{depth:r}=this.$to,n=this.$to.after(r);for(;r>1&&n==this.$to.end(--r);)++n;return n}findCloseLevel(e){e:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:r,type:n}=this.frontier[t],i=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),o=O(e,t,n,r,i);if(o){for(let r=t-1;r>=0;r--){let{match:t,type:n}=this.frontier[r],i=O(e,r,n,t,!0);if(!i||i.childCount)continue e}return{depth:t,fit:o,move:i?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=F(this.placed,t.depth,t.fit)),e=t.move;for(let r=t.depth+1;r<=e.depth;r++){let t=e.node(r),n=t.type.contentMatch.fillBefore(t.content,!0,e.index(r));this.openFrontierNode(t.type,t.attrs,n)}return e}openFrontierNode(e,t=null,r){let i=this.frontier[this.depth];i.match=i.match.matchType(e),this.placed=F(this.placed,this.depth,n.HY.from(e.create(t,r))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let e=this.frontier.pop().match.fillBefore(n.HY.empty,!0);e.childCount&&(this.placed=F(this.placed,this.frontier.length,e))}}function E(e,t,r){return 0==t?e.cutByIndex(r,e.childCount):e.replaceChild(0,e.firstChild.copy(E(e.firstChild.content,t-1,r)))}function F(e,t,r){return 0==t?e.append(r):e.replaceChild(e.childCount-1,e.lastChild.copy(F(e.lastChild.content,t-1,r)))}function W(e,t){for(let r=0;r<t;r++)e=e.firstChild.content;return e}function z(e,t,r){if(t<=0)return e;let i=e.content;return t>1&&(i=i.replaceChild(0,z(i.firstChild,t-1,1==i.childCount?r-1:0))),t>0&&(i=e.type.contentMatch.fillBefore(i).append(i),r<=0&&(i=i.append(e.type.contentMatch.matchFragment(i).fillBefore(n.HY.empty,!0)))),e.copy(i)}function O(e,t,r,n,i){let o=e.node(t),s=i?e.indexAfter(t):e.index(t);if(s==o.childCount&&!r.compatibleContent(o.type))return null;let a=n.fillBefore(o.content,!0,s);return a&&!function(e,t,r){for(let n=r;n<t.childCount;n++)if(!e.allowsMarks(t.child(n).marks))return!0;return!1}(r,o.content,s)?a:null}function D(e){return e.spec.defining||e.spec.definingForContent}function B(e,t,r,i,o){if(t<r){let n=e.firstChild;e=e.replaceChild(0,n.copy(B(n.content,t+1,r,i,n)))}if(t>i){let t=o.contentMatchAt(0),r=t.fillBefore(e).append(e);e=r.append(t.matchFragment(r).fillBefore(n.HY.empty,!0))}return e}function J(e,t){let r=[];for(let n=Math.min(e.depth,t.depth);n>=0;n--){let i=e.start(n);if(i<e.pos-(e.depth-n)||t.end(n)>t.pos+(t.depth-n)||e.node(n).type.spec.isolating||t.node(n).type.spec.isolating)break;(i==t.start(n)||n==e.depth&&n==t.depth&&e.parent.inlineContent&&t.parent.inlineContent&&n&&t.start(n-1)==i-1)&&r.push(n)}return r}class H extends h{constructor(e,t,r){super(),this.pos=e,this.attr=t,this.value=r}apply(e){let t=e.nodeAt(this.pos);if(!t)return c.fail("No node at attribute step's position");let r=Object.create(null);for(let e in t.attrs)r[e]=t.attrs[e];r[this.attr]=this.value;let i=t.type.create(r,null,t.marks);return c.fromReplace(e,this.pos,this.pos+1,new n.p2(n.HY.from(i),0,t.isLeaf?0:1))}getMap(){return a.empty}invert(e){return new H(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new H(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if("number"!=typeof t.pos||"string"!=typeof t.attr)throw new RangeError("Invalid input for AttrStep.fromJSON");return new H(t.pos,t.attr,t.value)}}h.jsonID("attr",H);let j=class extends Error{};j=function e(t){let r=Error.call(this,t);return r.__proto__=e.prototype,r},(j.prototype=Object.create(Error.prototype)).constructor=j,j.prototype.name="TransformError";class ${constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new l}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new j(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,r=n.p2.empty){let i=I(this.doc,e,t,r);return i&&this.step(i),this}replaceWith(e,t,r){return this.replace(e,t,new n.p2(n.HY.from(r),0,0))}delete(e,t){return this.replace(e,t,n.p2.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,r){return function(e,t,r,i){if(!i.size)return e.deleteRange(t,r);let o=e.doc.resolve(t),s=e.doc.resolve(r);if(N(o,s,i))return e.step(new g(t,r,i));let a=J(o,e.doc.resolve(r));0==a[a.length-1]&&a.pop();let l=-(o.depth+1);a.unshift(l);for(let e=o.depth,t=o.pos-1;e>0;e--,t--){let r=o.node(e).type.spec;if(r.defining||r.definingAsContext||r.isolating)break;a.indexOf(e)>-1?l=e:o.before(e)==t&&a.splice(1,0,-e)}let p=a.indexOf(l),h=[],c=i.openStart;for(let e=i.content,t=0;;t++){let r=e.firstChild;if(h.push(r),t==i.openStart)break;e=r.content}for(let e=c-1;e>=0;e--){let t=h[e].type,r=D(t);if(r&&o.node(p).type!=t)c=e;else if(r||!t.isTextblock)break}for(let t=i.openStart;t>=0;t--){let l=(t+c+1)%(i.openStart+1),d=h[l];if(d)for(let t=0;t<a.length;t++){let h=a[(t+p)%a.length],c=!0;h<0&&(c=!1,h=-h);let f=o.node(h-1),u=o.index(h-1);if(f.canReplaceWith(u,u,d.type,d.marks))return e.replace(o.before(h),c?s.after(h):r,new n.p2(B(i.content,0,i.openStart,l),l,i.openEnd))}}let d=e.steps.length;for(let n=a.length-1;n>=0&&(e.replace(t,r,i),!(e.steps.length>d));n--){let e=a[n];e<0||(t=o.before(e),r=s.after(e))}}(this,e,t,r),this}replaceRangeWith(e,t,r){return function(e,t,r,i){if(!i.isInline&&t==r&&e.doc.resolve(t).parent.content.size){let n=function(e,t,r){let n=e.resolve(t);if(n.parent.canReplaceWith(n.index(),n.index(),r))return t;if(0==n.parentOffset)for(let e=n.depth-1;e>=0;e--){let t=n.index(e);if(n.node(e).canReplaceWith(t,t,r))return n.before(e+1);if(t>0)return null}if(n.parentOffset==n.parent.content.size)for(let e=n.depth-1;e>=0;e--){let t=n.indexAfter(e);if(n.node(e).canReplaceWith(t,t,r))return n.after(e+1);if(t<n.node(e).childCount)return null}return null}(e.doc,t,i.type);null!=n&&(t=r=n)}e.replaceRange(t,r,new n.p2(n.HY.from(i),0,0))}(this,e,t,r),this}deleteRange(e,t){return function(e,t,r){let n=e.doc.resolve(t),i=e.doc.resolve(r),o=J(n,i);for(let t=0;t<o.length;t++){let r=o[t],s=t==o.length-1;if(s&&0==r||n.node(r).type.contentMatch.validEnd)return e.delete(n.start(r),i.end(r));if(r>0&&(s||n.node(r-1).canReplace(n.index(r-1),i.indexAfter(r-1))))return e.delete(n.before(r),i.after(r))}for(let o=1;o<=n.depth&&o<=i.depth;o++)if(t-n.start(o)==n.depth-o&&r>n.end(o)&&i.end(o)-r!=i.depth-o)return e.delete(n.before(o),r);e.delete(t,r)}(this,e,t),this}lift(e,t){return function(e,t,r){let{$from:i,$to:o,depth:s}=t,a=i.before(s+1),l=o.after(s+1),p=a,h=l,c=n.HY.empty,d=0;for(let e=s,t=!1;e>r;e--)t||i.index(e)>0?(t=!0,c=n.HY.from(i.node(e).copy(c)),d++):p--;let f=n.HY.empty,u=0;for(let e=s,t=!1;e>r;e--)t||o.after(e+1)<o.end(e)?(t=!0,f=n.HY.from(o.node(e).copy(f)),u++):h++;e.step(new w(p,h,a,l,new n.p2(c.append(f),d,u),c.size-d,!0))}(this,e,t),this}join(e,t=1){return function(e,t,r){let i=new g(t-r,t+r,n.p2.empty,!0);e.step(i)}(this,e,t),this}wrap(e,t){return function(e,t,r){let i=n.HY.empty;for(let e=r.length-1;e>=0;e--){if(i.size){let t=r[e].type.contentMatch.matchFragment(i);if(!t||!t.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}i=n.HY.from(r[e].type.create(r[e].attrs,i))}let o=t.start,s=t.end;e.step(new w(o,s,o,s,new n.p2(i,0,0),r.length,!0))}(this,e,t),this}setBlockType(e,t=e,r,i=null){return function(e,t,r,i,o){if(!i.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let s=e.steps.length;e.doc.nodesBetween(t,r,((t,r)=>{if(t.isTextblock&&!t.hasMarkup(i,o)&&function(e,t,r){let n=e.resolve(t),i=n.index();return n.parent.canReplaceWith(i,i+1,r)}(e.doc,e.mapping.slice(s).map(r),i)){e.clearIncompatible(e.mapping.slice(s).map(r,1),i);let a=e.mapping.slice(s),l=a.map(r,1),p=a.map(r+t.nodeSize,1);return e.step(new w(l,p,l+1,p-1,new n.p2(n.HY.from(i.create(o,null,t.marks)),0,0),1,!0)),!1}}))}(this,e,t,r,i),this}setNodeMarkup(e,t,r=null,i){return function(e,t,r,i,o){let s=e.doc.nodeAt(t);if(!s)throw new RangeError("No node at given position");r||(r=s.type);let a=r.create(i,null,o||s.marks);if(s.isLeaf)return e.replaceWith(t,t+s.nodeSize,a);if(!r.validContent(s.content))throw new RangeError("Invalid content for node type "+r.name);e.step(new w(t,t+s.nodeSize,t+1,t+s.nodeSize-1,new n.p2(n.HY.from(a),0,0),1,!0))}(this,e,t,r,i),this}setNodeAttribute(e,t,r){return this.step(new H(e,t,r)),this}addNodeMark(e,t){return this.step(new m(e,t)),this}removeNodeMark(e,t){if(!(t instanceof n.vc)){let r=this.doc.nodeAt(e);if(!r)throw new RangeError("No node at position "+e);if(!(t=t.isInSet(r.marks)))return this}return this.step(new A(e,t)),this}split(e,t=1,r){return function(e,t,r=1,i){let o=e.doc.resolve(t),s=n.HY.empty,a=n.HY.empty;for(let e=o.depth,t=o.depth-r,l=r-1;e>t;e--,l--){s=n.HY.from(o.node(e).copy(s));let t=i&&i[l];a=n.HY.from(t?t.type.create(t.attrs,a):o.node(e).copy(a))}e.step(new g(t,t,new n.p2(s.append(a),r,r),!0))}(this,e,t,r),this}addMark(e,t,r){return function(e,t,r,n){let i,o,s=[],a=[];e.doc.nodesBetween(t,r,((e,l,p)=>{if(!e.isInline)return;let h=e.marks;if(!n.isInSet(h)&&p.type.allowsMarkType(n.type)){let p=Math.max(l,t),c=Math.min(l+e.nodeSize,r),d=n.addToSet(h);for(let e=0;e<h.length;e++)h[e].isInSet(d)||(i&&i.to==p&&i.mark.eq(h[e])?i.to=c:s.push(i=new u(p,c,h[e])));o&&o.to==p?o.to=c:a.push(o=new f(p,c,n))}})),s.forEach((t=>e.step(t))),a.forEach((t=>e.step(t)))}(this,e,t,r),this}removeMark(e,t,r){return function(e,t,r,i){let o=[],s=0;e.doc.nodesBetween(t,r,((e,a)=>{if(!e.isInline)return;s++;let l=null;if(i instanceof n.ZU){let t,r=e.marks;for(;t=i.isInSet(r);)(l||(l=[])).push(t),r=t.removeFromSet(r)}else i?i.isInSet(e.marks)&&(l=[i]):l=e.marks;if(l&&l.length){let n=Math.min(a+e.nodeSize,r);for(let e=0;e<l.length;e++){let r,i=l[e];for(let e=0;e<o.length;e++){let t=o[e];t.step==s-1&&i.eq(o[e].style)&&(r=t)}r?(r.to=n,r.step=s):o.push({style:i,from:Math.max(a,t),to:n,step:s})}}})),o.forEach((t=>e.step(new u(t.from,t.to,t.style))))}(this,e,t,r),this}clearIncompatible(e,t,r){return function(e,t,r,i=r.contentMatch){let o=e.doc.nodeAt(t),s=[],a=t+1;for(let t=0;t<o.childCount;t++){let l=o.child(t),p=a+l.nodeSize,h=i.matchType(l.type);if(h){i=h;for(let t=0;t<l.marks.length;t++)r.allowsMarkType(l.marks[t].type)||e.step(new u(a,p,l.marks[t]))}else s.push(new g(a,p,n.p2.empty));a=p}if(!i.validEnd){let t=i.fillBefore(n.HY.empty,!0);e.replace(a,a,new n.p2(t,0,0))}for(let t=s.length-1;t>=0;t--)e.step(s[t])}(this,e,t,r),this}}}}]);
//# sourceMappingURL=src_components_Editor_provider_js-src_views_RichWorkspace_vue-node_modules_nextcloud_vue_dist-4c0c5c.js.map?v=e058a1f6d33f196a10bc