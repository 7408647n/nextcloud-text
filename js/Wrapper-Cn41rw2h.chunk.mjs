import{a as g,r as L}from"./vue.runtime.esm-8l0cPn1o.chunk.mjs";import{B as M,u as P,i as W,N as F,j,k as V,l as z,O as $,H as q,A as J,T as Q,n as Y,o as Z,D as G,p as X,q as S,r as tt,E as et,b as it,s as nt,t as st,v as ot}from"./RichText-C-1U88yl.chunk.mjs";import{n as h,d as w,e as at,k as rt,u as lt}from"./_plugin-vue2_normalizer-DDW5k4Px.chunk.mjs";import{m as ct,d as dt,c as ht,_ as E,U as ut,f as O,u as pt}from"./index-C9LeCMoi.chunk.mjs";import{g as _t}from"./emoji-picker-_ZUJ6YnW.chunk.mjs";import{e as T,a as mt}from"./index-HQWwoT4K.chunk.mjs";import{l as vt}from"./index-DfiDB3im.chunk.mjs";import{d as x,e as bt,f as U,g as B,h as ft,u as yt,S as gt,i as xt,j as kt,b as Ct,k as At}from"./MediaHandler.provider-Cqg_7OO6.chunk.mjs";import{N as Et}from"./NcDialog-I_9fyJVt-BHNN_2eT.chunk.mjs";import{s as f}from"./_plugin-vue2_normalizer--qmvqNVe-BvLuO0O2.chunk.mjs";import{l as y}from"./logger-Csk1_XRx.chunk.mjs";const Mt={name:"NcActionButton",components:{NextcloudVueNcActionButton:w},extends:M,mounted(){this.$editor.on("transaction",()=>this.updateState())},methods:{runAction(){const{actionEntry:e}=this;e.click?e.click(this):e.action(this.$editor.chain().focus(),this.$editor)?.run(),this.$nextTick(()=>{this.$emit("trigged",{...e})})}}};var wt=function(){var e=this,i=e._self._c;return i("NextcloudVueNcActionButton",e._g({staticClass:"entry-single-action entry-action entry-action-item",class:e.state.class,attrs:{title:e.listItemTooltip||void 0,disabled:e.state.disabled,"aria-keyshortcuts":e.keyshortcuts||void 0,"data-text-action-entry":e.actionEntry.key,type:e.state.type,"model-value":e.state.type!=="button"?e.state.active:void 0,"close-after-click":""},on:{click:e.runAction},scopedSlots:e._u([{key:"icon",fn:function(){return[i(e.icon,{tag:"component"})]},proxy:!0}])},e.$listeners),[e._v(" "+e._s(e.label)+" ")])},$t=[],St=h(Mt,wt,$t,!1,null,null);const Ot=St.exports,It={name:"ActionList",components:{NcActions:ct,NcActionSeparator:F,ActionListItem:Ot},extends:M,mixins:[P,W],props:{forceEnabled:{type:Boolean,default:!1}},data:()=>({visible:!1,hasEnabledChild:!0}),computed:{currentChild(){const{state:e,$editor:i,actionEntry:{children:n}}=this;return e.active?n.find(s=>V(s,i)):null},icon(){return this.currentChild?this.currentChild.icon:this.actionEntry.icon},iconKey(){return`${this.actionEntry.key}/${this.activeKey}`},activeKey(){return this.currentChild?.key},children(){return this.actionEntry.children.filter(({visible:e})=>e===void 0?!0:typeof e=="function"?e(this):e)},labelWithSelected(){return this.currentChild?t("text",'{menuItemName}, "{selectedSubMenuItemName}" is selected',{menuItemName:this.actionEntry.label,selectedSubMenuItemName:this.currentChild.label}):this.actionEntry.label},isEnabled(){return this.forceEnabled||this.hasEnabledChild}},mounted(){this.$_updateState=at(this.checkStateOfChildren.bind(this),50),this.$editor.on("update",this.$_updateState),this.$editor.on("selectionUpdate",this.$_updateState)},beforeDestroy(){this.$editor.off("update",this.$_updateState),this.$editor.off("selectionUpdate",this.$_updateState)},methods:{onOpenChange(e){this.visible=e},runAction(){},onTrigger(e){e?.click||(this.$editor.chain().focus().run(),this.$emit("trigged",e))},checkStateOfChildren(){this.hasEnabledChild=this.children.some(e=>this.isChildEnabled(e))},isChildEnabled(e){return!e.isSeparator&&!j(e,this.$editor).disabled}}};var Nt=function(){var e=this,i=e._self._c;return i("NcActions",e._b({staticClass:"entry-list-action entry-action",attrs:{title:e.tooltip,container:e.menuIDSelector,"aria-label":e.labelWithSelected,type:e.state.active?"primary":"tertiary","force-menu":!0,"data-text-action-entry":e.actionEntry.key,"data-text-action-active":e.activeKey,disabled:!e.isEnabled},on:{"update:open":e.onOpenChange},scopedSlots:e._u([{key:"icon",fn:function(){return[i(e.icon,{key:e.iconKey,tag:"component"})]},proxy:!0}])},"NcActions",e.state,!1),[e._l(e.children,function(n){return[n.isSeparator?i("NcActionSeparator",{key:`child-${n.key}`}):i("ActionListItem",e._g({key:`child-${n.key}`,attrs:{active:e.currentChild?.key===n.key,"is-item":"","action-entry":n},on:{trigged:e.onTrigger}},e.$listeners))]}),e._t("lastAction",null,null,{visible:e.visible})],2)},Pt=[],Ft=h(It,Nt,Pt,!1,null,null);const R=Ft.exports,Tt={name:"ActionSingle",components:{NcButton:dt},extends:M,props:{isItem:{type:Boolean,default:!1}},mounted(){this.$editor.on("transaction",()=>this.updateState())},methods:{runAction(){const{actionEntry:e}=this;e.click?e.click(this):e.action(this.$editor.chain().focus(),this.$editor)?.run(),this.$nextTick(()=>{this.$emit("trigged",{...e})})}}};var Ut=function(){var e=this,i=e._self._c;return i("NcButton",e._g({staticClass:"entry-single-action entry-action",class:e.state.class,attrs:{disabled:e.state.disabled,"aria-keyshortcuts":e.keyshortcuts||void 0,"data-text-action-entry":e.actionEntry.key,"aria-label":e.label,title:e.tooltip,type:"tertiary",pressed:e.state.type!=="button"?e.state.active:void 0},on:{click:e.runAction},scopedSlots:e._u([{key:"icon",fn:function(){return[i(e.icon,{tag:"component"})]},proxy:!0},e.actionEntry.forceLabel?{key:"default",fn:function(){return[e._v(" "+e._s(e.label)+" ")]},proxy:!0}:null],null,!0)},e.$listeners))},Bt=[],Rt=h(Tt,Ut,Bt,!1,null,null);const H=Rt.exports,K=g({data(){return{activeMenuEntry:0,entries:[]}},computed:{visibleEntries(){return this.entries}},watch:{visibleEntries(){this.$nextTick(()=>{(this.activeMenuEntry>this.visibleEntries.length||this.visibleEntries[this.activeMenuEntry]?.disabled)&&this.setNextMenuEntry()})}},methods:{disableMenuEntry(e,i){const n=this.visibleEntries.findIndex(({key:s})=>s===e);this.visibleEntries[n].disabled=i,i===!1&&this.activeMenuEntry===n&&this.$nextTick(()=>this.setNextMenuEntry())},setNextMenuEntry(){const e=this.visibleEntries.length+(this.$refs.remainingEntries?1:0);do this.activeMenuEntry=(this.activeMenuEntry+1)%e;while(this.activeMenuEntry<this.visibleEntries.length&&this.visibleEntries[this.activeMenuEntry].disabled)},setPreviousMenuEntry(){const e=this.visibleEntries.length+(this.$refs.remainingEntries?1:0);do{const i=this.activeMenuEntry-1;this.activeMenuEntry=(i%e+e)%e}while(this.activeMenuEntry<this.visibleEntries.length&&this.visibleEntries[this.activeMenuEntry].disabled)},handleToolbarNavigation(e){e.key==="ArrowRight"?this.setNextMenuEntry():e.key==="ArrowLeft"&&this.setPreviousMenuEntry(),this.activeMenuEntry===this.visibleEntries.length?this.$refs.remainingEntries?.focusButton?.():[...this.$refs.menuEntries].sort((i,n)=>this.visibleEntries.findIndex(({key:s})=>s===i.$vnode.data.key)-this.visibleEntries.findIndex(({key:s})=>s===n.$vnode.data.key))[this.activeMenuEntry].focusButton()}}}),Ht=g({name:"ReadonlyBar",components:{ActionList:R,ActionSingle:H},extends:K,props:{openReadOnly:{type:Boolean,default:!1}},data(){return{entries:this.openReadOnly?[...z,...$]:[...$]}}});var Kt=function(){var e=this,i=e._self._c;return e._self._setupProxy,i("div",{staticClass:"text-readonly-bar",attrs:{"data-text-el":"readonly-bar"}},[i("div",{ref:"menubar",staticClass:"text-readonly-bar__entries",attrs:{role:"toolbar","aria-label":e.t("text","Editor actions")}},e._l(e.visibleEntries,function(n,s){return i(n.component?n.component:n.children?"ActionList":"ActionSingle",{key:n.key,ref:"menuEntries",refInFor:!0,tag:"component",attrs:{"action-entry":n,"can-be-focussed":e.activeMenuEntry===s},on:{disabled:function(r){return e.disableMenuEntry(n.key,r)}}})}),1),i("div",{staticClass:"text-menubar__slot"},[e._t("default")],2)])},Dt=[],Lt=h(Ht,Kt,Dt,!1,null,"d51b2b29");const De=Lt.exports;var A={exports:{}},I;function Wt(){return I||(I=1,function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;function n(l){"@babel/helpers - typeof";return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},n(l)}var s=47,r=46,c=function(l){var a=n(l);if(a!=="string")throw new TypeError("Expected a string, got a ".concat(a))},m=function(l,a){for(var o="",u=0,p=-1,_=0,b,d=0;d<=l.length;++d){if(d<l.length)b=l.charCodeAt(d);else{if(b===s)break;b=s}if(b===s){if(!(p===d-1||_===1))if(p!==d-1&&_===2){if(o.length<2||u!==2||o.charCodeAt(o.length-1)!==r||o.charCodeAt(o.length-2)!==r){if(o.length>2){var C=o.lastIndexOf("/");if(C!==o.length-1){C===-1?(o="",u=0):(o=o.slice(0,C),u=o.length-1-o.lastIndexOf("/")),p=d,_=0;continue}}else if(o.length===2||o.length===1){o="",u=0,p=d,_=0;continue}}a&&(o.length>0?o+="/..":o="..",u=2)}else o.length>0?o+="/"+l.slice(p+1,d):o=l.slice(p+1,d),u=d-p-1;p=d,_=0}else b===r&&_!==-1?++_:_=-1}return o},v=function(l){try{return decodeURIComponent(l)}catch{return l}},k=function(l){c(l);var a=l;if(a.length===0)return".";var o=a.charCodeAt(0)===s,u=a.charCodeAt(a.length-1)===s;return a=v(a),a=m(a,!o),a.length===0&&!o&&(a="."),a.length>0&&u&&(a+="/"),o?"/"+a:a},D=k;i.default=D,e.exports=i.default}(A,A.exports)),A.exports}var jt=Wt();const Vt=_t(jt);class Le{#t;#e;#i;#n;#s;#o;#a=[];constructor({session:i,user:n,shareToken:s,currentDirectory:r,fileId:c}){this.#t=i,this.#e=n,this.#i=s,this.#n=r,this.#s=c??i.documentId,this.#o=this.#r()}async#r(){const i=await ht.post(E("/apps/text/attachments"),{documentId:this.#t?.documentId??this.#s,sessionId:this.#t?.id,sessionToken:this.#t?.token,shareToken:this.#i});this.#a=i.data}#l(i){return this.#a.find(n=>n.name===i)}async resolve(i,n=!0){let s;const r=/^\.attachments\.\d+\//;if(i.match(r)){const c=decodeURIComponent(i.replace(r,"").split("?")[0]);if(await this.#o,s=this.#l(c),n&&!s&&(await this.#r(),s=this.#l(c)),s)return s}return zt(i)?{isImage:!0,name:this.#c(i),previewUrl:i,fullUrl:i}:{isImage:!0,name:this.#c(i),previewUrl:this.#d(i),fullUrl:this.#d(i)}}#c(i){return i.split("/").pop()}#d(i){if(this.#e){const c=this.#e.uid,m=this.#h(i).split("/").map(encodeURIComponent).join("/");return ut(`dav/files/${c}${m}`)}const n=this.#h(i).split("/"),s=n.pop(),r=n.join("/");return E("/s/{token}/download?path={dirname}&files={basename}",{token:this.#i,basename:s,dirname:r})}#u(i){return decodeURI(i.split("?")[0])}#h(i){const n=[this.#n,this.#u(i)].join("/");return Vt(n)}}function zt(e){return e.startsWith("http://")||e.startsWith("https://")||e.startsWith("data:")}const qt=g({name:"NcActionButton",components:{NextcloudVueNcActionButton:w,Help:q}});var Jt=function(){var e=this,i=e._self._c;return e._self._setupProxy,i("NextcloudVueNcActionButton",e._g({attrs:{"close-after-click":"","data-text-action-entry":"formatting-help"},scopedSlots:e._u([{key:"icon",fn:function(){return[i("Help")]},proxy:!0}])},e.$listeners),[e._v(" "+e._s(e.t("text","Formatting help"))+" ")])},Qt=[],Yt=h(qt,Jt,Qt,!1,null,null);const Zt=Yt.exports,Gt=g({name:"CharacterCount",components:{AlphabeticalVariant:J,NcActionText:rt},mixins:[x],props:{visible:Boolean},data:()=>({wordCount:0,charCount:0}),computed:{countString(){return`${O("text","%n word","%n words",this.wordCount)}, ${O("text","%n char","%n chars",this.charCount)}`}},watch:{visible:"refresh"},created(){this.refresh()},methods:{refresh(){this.wordCount=this.$editor.storage.characterCount.words(),this.charCount=this.$editor.storage.characterCount.characters()}}});var Xt=function(){var e=this,i=e._self._c;return e._self._setupProxy,i("NcActionText",{attrs:{"data-text-action-entry":"character-count"},scopedSlots:e._u([{key:"icon",fn:function(){return[i("AlphabeticalVariant")]},proxy:!0},{key:"default",fn:function(){return[e._v(" "+e._s(e.countString)+" ")]},proxy:!0}])})},te=[],ee=h(Gt,Xt,te,!1,null,null);const ie=ee.exports;function ne(){return navigator?.userAgentData?.mobile!==void 0?navigator.userAgentData.mobile:[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/playbook/i,/silk/i,/BlackBerry/i,/Windows Phone/i].some(e=>navigator.userAgent.match(e))}const se={name:"HelpModal",components:{NcDialog:Et},data(){return{formatted:{bold:!0,italic:!0,strikethrough:!0,heading1:!0,heading6:!0,unorderdList:!0,orderedList:!0,checkList:!0,blockQuote:!0,codeBlock:!0},ctrlOrModKey:Q[Y.Mod]}},computed:{isFormatted(){return e=>this.formatted[e]},isMobileCached(){return this.isMobilePlatform()}},methods:{toggleFormatted(e){this.formatted[e]=!this.formatted[e]},isMobilePlatform:ne}};var oe=function(){var e=this,i=e._self._c;return i("NcDialog",{attrs:{size:"large","data-text-el":"formatting-help",name:e.t("text","Formatting and shortcuts"),"close-on-click-outside":!0},on:{closing:function(n){return e.$emit("close")}}},[i("h2",[e._v(e._s(e.t("text","Formatting and shortcuts")))]),i("p",[e._v(e._s(e.t("text","Speed up your writing with simple shortcuts.")))]),e.isMobileCached?i("p",[e._v(" "+e._s(e.t("text","Just type the Markdown syntax from below."))+" ")]):i("p",[e._v(" "+e._s(e.t("text","Just type the Markdown syntax or use keyboard shortcuts from below."))+" ")]),i("table",[i("thead",[i("tr",[i("th",[e._v(e._s(e.t("text","Style")))]),i("th",[e._v(e._s(e.t("text","Syntax")))]),e.isMobileCached?e._e():i("th",[e._v(" "+e._s(e.t("text","Keyboard shortcuts"))+" ")])])]),i("tbody",[i("tr",[i("td",[e._v(e._s(e.t("text","New paragraph")))]),i("td",[i("kbd",[e._v(e._s(e.t("text","Enter")))])]),e.isMobileCached?e._e():i("td")]),i("tr",[i("td",[e._v(e._s(e.t("text","Hard line break")))]),i("td",[i("kbd",[e._v(e._s(e.t("text","Enter")))]),e._v(" "+e._s(e.t("text","followed by"))+" "),i("kbd",[e._v(e._s(e.t("text","Backspace")))])]),e.isMobileCached?e._e():i("td",[i("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),i("kbd",[e._v(e._s(e.t("text","Enter")))])])]),i("tr",[i("td",[e._v(e._s(e.t("text","Bold")))]),i("td",[i("code",[e._v("**"+e._s(e.t("text","Bold text"))+"**")])]),e.isMobileCached?e._e():i("td",[i("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),i("kbd",[e._v("B")])])]),i("tr",[i("td",[e._v(e._s(e.t("text","Italic")))]),i("td",[i("code",[e._v("*"+e._s(e.t("text","Italicized text"))+"*")])]),e.isMobileCached?e._e():i("td",[i("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),i("kbd",[e._v("I")])])]),i("tr",[i("td",[e._v(e._s(e.t("text","Strikethrough")))]),i("td",[i("code",[e._v("~~"+e._s(e.t("text","Mistaken text"))+"~~")])]),e.isMobileCached?e._e():i("td",[i("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),i("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),i("kbd",[e._v("S")])])]),i("tr",[i("td",[e._v(e._s(e.t("text","Underline")))]),i("td",[i("code",[e._v("__"+e._s(e.t("text","Underlined text"))+"__")])]),e.isMobileCached?e._e():i("td",[i("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),i("kbd",[e._v("U")])])]),i("tr",[i("td",{staticClass:"ellipsis_top"},[e._v(" "+e._s(e.t("text","Heading 1"))+" ")]),i("td",{staticClass:"ellipsis_top"},[i("code",[e._v("# "+e._s(e.t("text","Heading level 1")))])]),e.isMobileCached?e._e():i("td",{staticClass:"ellipsis_top"},[i("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),i("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),i("kbd",[e._v("1")])])]),i("tr",[i("td",{staticClass:"noborder ellipsis"},[e._v("…")]),i("td",{staticClass:"noborder ellipsis"},[e._v("…")]),e.isMobileCached?e._e():i("td",{staticClass:"ellipsis noborder"},[e._v("…")])]),i("tr",[i("td",{staticClass:"noborder ellipsis_bottom"},[e._v(" "+e._s(e.t("text","Heading 6"))+" ")]),i("td",{staticClass:"noborder ellipsis_bottom"},[i("code",[e._v("###### "+e._s(e.t("text","Heading level 6")))])]),e.isMobileCached?e._e():i("td",{staticClass:"noborder ellipsis_bottom"},[i("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),i("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),i("kbd",[e._v("6")])])]),i("tr",[i("td",[e._v(e._s(e.t("text","Unordered list")))]),i("td",[i("code",[e._v("* "+e._s(e.t("text","An item")))])]),e.isMobileCached?e._e():i("td",[i("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),i("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),i("kbd",[e._v("8")])])]),i("tr",[i("td",[e._v(e._s(e.t("text","Ordered list")))]),i("td",[i("code",[e._v("1. "+e._s(e.t("text","First item")))])]),e.isMobileCached?e._e():i("td",[i("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),i("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),i("kbd",[e._v("7")])])]),i("tr",[i("td",[e._v(e._s(e.t("text","Checklist")))]),i("td",[i("code",[e._v("* [] "+e._s(e.t("text","To-Do item")))])]),e.isMobileCached?e._e():i("td",[i("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),i("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),i("kbd",[e._v("9")])])]),i("tr",[i("td",[e._v(e._s(e.t("text","Blockquote")))]),i("td",[i("code",[e._v("> "+e._s(e.t("text","Quoted text")))])]),e.isMobileCached?e._e():i("td",[i("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),i("kbd",[e._v(">")])])]),i("tr",[i("td",[e._v(e._s(e.t("text","Code block")))]),i("td",[i("code",[e._v("``` "+e._s(e.t("text","Some code")))])]),e.isMobileCached?e._e():i("td")]),i("tr",[i("td",[e._v(e._s(e.t("text","Link")))]),i("td",[i("code",[e._v("[Title](https://example.org)")])]),e.isMobileCached?e._e():i("td")]),i("tr",[i("td",[e._v(e._s(e.t("text","Insert emoji")))]),i("td",[i("code",[e._v(":"+e._s(e.t("text","emoji")))])]),e.isMobileCached?e._e():i("td")]),i("tr",[i("td",[e._v(e._s(e.t("text","Mention someone")))]),i("td",[i("code",[e._v("@"+e._s(e.t("text","name")))])]),e.isMobileCached?e._e():i("td")]),i("tr",[i("td",[e._v(e._s(e.t("text","Smart picker")))]),i("td",[i("code",[e._v("/"+e._s(e.t("text","something")))])]),e.isMobileCached?e._e():i("td")])])]),i("table",{attrs:{vif:"!isMobileCached"}},[i("thead",[i("tr",[i("th",[e._v(e._s(e.t("text","Action")))]),i("th",[e._v(e._s(e.t("text","Keyboard shortcuts")))])])]),i("tbody",[i("tr",[i("td",[e._v(e._s(e.t("text","Undo")))]),i("td",[i("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),i("kbd",[e._v("Z")])])]),i("tr",[i("td",[e._v(e._s(e.t("text","Redo")))]),i("td",[i("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),i("kbd",[e._v("Y")])])]),i("tr",[i("td",[e._v(e._s(e.t("text","Toggle outline")))]),i("td",[i("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),i("kbd",[e._v(e._s(e.t("text","Alt")))]),e._v(" + "),i("kbd",[e._v("H")])])])])])])},ae=[],re=h(se,oe,ae,!1,null,"4388ed8e");const le=re.exports,ce={name:"MenuBar",components:{ActionFormattingHelp:Zt,ActionList:R,ActionSingle:H,HelpModal:le,NcActionSeparator:F,NcActionButton:w,CharacterCount:ie,TranslateVariant:Z},extends:K,mixins:[x,bt,U,B],provide(){const e={};return Object.defineProperties(e,{[tt]:{get:()=>this.randomID}}),e},props:{isHidden:{type:Boolean,default:!1},openReadOnly:{type:Boolean,default:!1}},setup(){const e=L(),{width:i}=pt(e);return{menubar:e,width:i}},data(){return{entries:this.openReadOnly?[...X,...S]:[...S],randomID:`menu-bar-${Math.ceil(Math.random()*1e4+500).toString(16)}`,displayHelp:!1,isReady:!1,canTranslate:vt("text","translation_languages",[]).from?.length>0,resize:null}},computed:{visibleEntries(){return this.entries.filter(({priority:e})=>e===void 0||e<=this.iconsLimit)},hiddenEntries(){const e=this.entries.filter(({priority:n})=>n!==void 0&&n>this.iconsLimit),i=e.reduce((n,s,r)=>{const c=s.children??[s];if(c.length>1){const m=n.length&&!n.at(-1).isSeparator?[{key:`separator-before-${s.id}`,isSeparator:!0}]:[],v=r!==e.length-1?[{key:`separator-after-${s.id}`,isSeparator:!0}]:[];return[...n,...m,...c,...v]}return[...n,...c]},[]);return{key:"remain",label:this.t("text","Remaining actions"),icon:G,children:i}},iconWidth(){const e=(this.menubar&&getComputedStyle(this.menubar))?.getPropertyValue("--default-clickable-area");return parseInt(e)||34},iconsLimit(){const e=this.width-4,i=this.$isMobile?this.iconWidth:this.iconWidth+2;return Math.floor(e/i)-1}},mounted(){this.$nextTick(()=>{this.isReady=!0,this.$emit("update:loaded",!0)})},methods:{showHelp(){this.displayHelp=!0},hideHelp(){this.displayHelp=!1},showTranslate(){const{from:e,to:i}=this.$editor.view.state.selection;let n=this.$editor.view.state.doc.textBetween(e,i," ");n.trim().length||(this.$editor.commands.selectAll(),n=this.$editor.view.state.doc.textContent),console.debug("translation click",this.$editor.view.state.selection,n),T("text:translate-modal:show",{content:n})}}};var de=function(){var e=this,i=e._self._c;return i("div",{staticClass:"text-menubar",class:{"text-menubar--ready":e.isReady,"text-menubar--hide":e.isHidden,"text-menubar--is-workspace":e.$isRichWorkspace,"is-mobile":e.$isMobile},attrs:{id:e.randomID,"data-text-el":"menubar",role:"region","aria-label":e.t("text","Editor actions")}},[e.displayHelp?i("HelpModal",{on:{close:e.hideHelp}}):e._e(),e.$isRichEditor?i("div",{ref:"menubar",staticClass:"text-menubar__entries",attrs:{role:"toolbar","aria-label":e.t("text","Formatting menu bar")},on:{keydown:[function(n){return!n.type.indexOf("key")&&e._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&n.button!==0?null:(n.stopPropagation(),e.handleToolbarNavigation.apply(null,arguments))},function(n){return!n.type.indexOf("key")&&e._k(n.keyCode,"right",39,n.key,["Right","ArrowRight"])||"button"in n&&n.button!==2?null:(n.stopPropagation(),e.handleToolbarNavigation.apply(null,arguments))}]}},[e._l(e.visibleEntries,function(n,s){return i(n.component?n.component:n.children?"ActionList":"ActionSingle",{key:n.key,ref:"menuEntries",refInFor:!0,tag:"component",attrs:{"action-entry":n,"can-be-focussed":e.activeMenuEntry===s},on:{disabled:function(r){return e.disableMenuEntry(n.key,r)},click:function(r){e.activeMenuEntry=s}}})}),i("ActionList",{ref:"remainingEntries",attrs:{"action-entry":e.hiddenEntries,"can-be-focussed":e.activeMenuEntry===e.visibleEntries.length,"force-enabled":!0},on:{click:function(n){e.activeMenuEntry="remain"}},scopedSlots:e._u([{key:"lastAction",fn:function({visible:n}){return[e.canTranslate?i("NcActionButton",{attrs:{"close-after-click":""},on:{click:e.showTranslate},scopedSlots:e._u([{key:"icon",fn:function(){return[i("TranslateVariant")]},proxy:!0}],null,!0)},[e._v(" "+e._s(e.t("text","Translate"))+" ")]):e._e(),i("ActionFormattingHelp",{on:{click:e.showHelp}}),i("NcActionSeparator"),i("CharacterCount",e._b({},"CharacterCount",{visible:n},!1))]}}],null,!1,2316723924)})],2):e._e(),i("div",{staticClass:"text-menubar__slot"},[e._t("default")],2)],1)},he=[],ue=h(ce,de,he,!1,null,"b5ea29ce");const We=ue.exports,pe={name:"ContentContainer",components:{EditorContent:it,EditorOutline:et},mixins:[x,P],computed:{showOutline(){return this.$outlineState.visible}}};var _e=function(){var e=this,i=e._self._c;return i("div",{staticClass:"content-wrapper text-editor__content-wrapper",class:{"--show-outline":e.showOutline},attrs:{"data-text-el":"editor-content-wrapper"}},[e.showOutline?i("div",{staticClass:"text-editor__content-wrapper__left"},[i("EditorOutline")],1):e._e(),e._t("default"),i("EditorContent",{staticClass:"editor__content text-editor__content",attrs:{role:"document",editor:e.$editor}}),i("div",{staticClass:"text-editor__content-wrapper__right"})],2)},me=[],ve=h(pe,_e,me,!1,null,"2c31e6f3");const je=ve.exports,N=e=>e.split("/").slice(0,-1).join("/"),be={name:"MediaHandler",mixins:[x,ft,yt],provide(){const e={};return Object.defineProperties(e,{[Ct]:{get:()=>this.showAttachmentPrompt},[kt]:{get:()=>this.chooseLocalFile},[xt]:{get:()=>this.createAttachment},[gt]:{get:()=>this.state}}),e},setup(){return{isMobile:lt()}},data(){return{lastFilePath:null,draggedOver:!1,state:{isUploadingAttachments:!1}}},computed:{initialFilePath(){return this.lastFilePath??N(this.$file?.relativePath??"/")}},methods:{setDraggedOver(e){this.draggedOver=e},onPaste(e){this.uploadAttachmentFiles(e.detail.files)},onEditorDrop(e){this.uploadAttachmentFiles(e.detail.files,e.detail.position)},onAttachmentUploadFilePicked(e){this.uploadAttachmentFiles(e.target.files),e.target.value=""},chooseLocalFile(){this.$refs.attachmentFileInput.click()},async uploadAttachmentFiles(e,i=null){if(!e)return;this.state.isUploadingAttachments=!0;const n=[...e].map(s=>this.uploadAttachmentFile(s,i));return Promise.all(n).catch(s=>{y.error("Uploading multiple attachments failed",{error:s}),f(t("text","Uploading multiple attachments failed."))}).then(()=>{this.state.isUploadingAttachments=!1})},async uploadAttachmentFile(e,i=null){return this.state.isUploadingAttachments=!0,this.$syncService.uploadAttachment(e).then(n=>{this.insertAttachment(n.data?.name,n.data?.id,e.type,i,n.data?.dirname)}).catch(n=>{y.error("Uploading attachment failed",{error:n}),n.response?.data.error?f(t("text","Uploading attachment failed: {error}",{error:n.response.data.error})):f(t("text","Uploading attachment failed."))}).then(()=>{this.state.isUploadingAttachments=!1})},showAttachmentPrompt(){mt()&&OC.dialogs.filepicker(t("text","Insert an attachment"),e=>{this.insertFromPath(e)},!1,[],!0,void 0,this.initialFilePath)},insertFromPath(e){return this.lastFilePath=N(e),this.state.isUploadingAttachments=!0,this.$syncService.insertAttachmentFile(e).then(i=>{this.insertAttachment(i.data?.name,i.data?.id,i.data?.mimetype,null,i.data?.dirname)}).catch(i=>{y.error("Failed to insert from Files",{error:i}),f(t("text","Failed to insert from Files"))}).then(()=>{this.state.isUploadingAttachments=!1})},createAttachment(e){return this.state.isUploadingAttachments=!0,this.$syncService.createAttachment(e).then(i=>{this.insertAttachmentPreview(i.data?.id)}).catch(i=>{y.error("Failed to create attachment",{error:i}),f(t("text","Failed to create attachment"))}).then(()=>{this.state.isUploadingAttachments=!1})},insertAttachmentPreview(e){const i=new URL(E(`/f/${e}`),window.origin).href.replaceAll(" ","%20");this.$editor.chain().focus().insertPreview(i).run()},insertAttachment(e,i,n,s=null,r=""){const c=r+"/"+encodeURIComponent(e).replace(/[!'()*]/g,k=>"%"+k.charCodeAt(0).toString(16).toUpperCase()),m=e.replaceAll(/[[\]]/g,"");(s?this.$editor.chain().focus(s):this.$editor.chain()).setImage({src:c,alt:m}).run();const v=this.$editor.view.state.selection;v.empty||this.$editor.commands.focus(v.to),this.$editor.commands.scrollIntoView(),T("text:image-node:add",null)}}};var fe=function(){var e=this,i=e._self._c;return i("div",{staticClass:"editor editor-media-handler",class:{draggedOver:e.draggedOver,"is-mobile":e.isMobile},attrs:{"data-text-el":"editor-media-handler"},on:{"image-paste":e.onPaste,dragover:function(n){return n.preventDefault(),n.stopPropagation(),e.setDraggedOver(!0)},dragleave:function(n){return n.preventDefault(),n.stopPropagation(),e.setDraggedOver(!1)},drop:function(n){return n.preventDefault(),n.stopPropagation(),e.setDraggedOver(!1)},"file-drop":e.onEditorDrop}},[i("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"attachmentFileInput",attrs:{"data-text-el":"attachment-file-input",type:"file",accept:"*/*",multiple:""},on:{change:e.onAttachmentUploadFilePicked}}),e._t("default")],2)},ye=[],ge=h(be,fe,ye,!1,null,null);const xe=ge.exports,ke={name:"MainContainer",components:{MediaHandler:xe},mixins:[At]};var Ce=function(){var e=this,i=e._self._c;return i("div",{staticClass:"editor"},[e.$editorUpload?i("MediaHandler",{staticClass:"text-editor__main"},[e._t("default")],2):e._t("default")],2)},Ae=[],Ee=h(ke,Ce,Ae,!1,null,"1a11bcc3");const Ve=Ee.exports,Me={name:"Wrapper",mixins:[U,B],provide(){const e={};return Object.defineProperties(e,{[ot]:{get:()=>this.outline},[st]:{get:()=>({toggle:this.outlineToggle})},[nt]:{get:()=>({toggle:this.readOnlyToggle})}}),e},props:{isResolvingConflict:{type:Boolean,default:!1},hasConnectionIssue:{type:Boolean,default:!1},contentLoaded:{type:Boolean,default:!0},showOutlineOutside:{type:Boolean,default:!1}},data:()=>({outline:{visible:!1,enable:!1}}),computed:{showOutline(){return this.isAbleToShowOutline?this.outline.visible:!1},isAbleToShowOutline(){return!this.$isRichWorkspace}},watch:{showOutlineOutside(){this.outline.visible=this.showOutlineOutside}},mounted(){this.outline.enable=this.isAbleToShowOutline,this.$watch(()=>this.isAbleToShowOutline,e=>{Object.assign(this.outline,{enable:e})}),document.addEventListener("keydown",this.handleKeyDown)},beforeDestroy(){document.removeEventListener("keydown",this.handleKeyDown)},methods:{outlineToggle(){this.outline.visible=!this.outline.visible,this.$emit("outline-toggled",this.outline.visible)},handleKeyDown(e){e.ctrlKey&&e.altKey&&e.key==="h"&&this.outlineToggle()},readOnlyToggle(){this.$emit("read-only-toggled")}}};var we=function(){var e=this,i=e._self._c;return i("div",{staticClass:"text-editor__wrapper",class:{"has-conflicts":e.isResolvingConflict,"is-rich-workspace":e.$isRichWorkspace,"is-rich-editor":e.$isRichEditor}},[e._t("default")],2)},$e=[],Se=h(Me,we,$e,!1,null,"833e90c7");const ze=Se.exports;export{Le as A,je as C,Ve as M,De as R,ze as W,We as a};
//# sourceMappingURL=Wrapper-Cn41rw2h.chunk.mjs.map
